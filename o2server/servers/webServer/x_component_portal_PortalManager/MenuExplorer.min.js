MWF.xDesktop.requireApp("process.ProcessManager","Explorer",null,false);MWF.xApplication.portal.PortalManager.MenuExplorer=new Class({Extends:MWF.xApplication.process.ProcessManager.Explorer,Implements:[Options,Events],options:{style:"default",tooltip:{create:MWF.xApplication.portal.PortalManager.LP.menu.create,search:MWF.xApplication.portal.PortalManager.LP.menu.search,searchText:MWF.xApplication.portal.PortalManager.LP.menu.searchText,noElement:MWF.xApplication.portal.PortalManager.LP.menu.noProcessNoticeText}},_createElement:function(e){var t=function(e,t){var n={template:t,onQueryLoad:function(){this.actions=a.app.restActions;this.application=a.app.options.application}};layout.desktop.openApplication(e,"portal.MenuDesigner",n)};var n=new Element("div",{styles:this.css.createTemplateMaskNode}).inject(this.app.content);var s=new Element("div",{styles:this.css.createTemplateAreaNode}).inject(this.app.content);s.fade("in");var i=new Element("div",{styles:this.css.createTemplateScrollNode}).inject(s);var o=new Element("div",{styles:this.css.createTemplateContentNode}).inject(i);MWF.require("MWF.widget.ScrollBar",function(){new MWF.widget.ScrollBar(i,{indent:false})}.bind(this));var a=this;var r="/x_component_portal_PageDesigner/$Page/template/templates.json";MWF.getJSON(r,function(e){e.each(function(e){var t=new Element("div",{styles:this.css.templateNode}).inject(o);var i=new Element("div",{styles:this.css.templateIconNode}).inject(t);var r=new Element("div",{styles:this.css.templateTitleNode,text:e.title}).inject(t);t.store("template",e.name);var l=new Element("img",{styles:this.css.templateIconImgNode}).inject(i);l.set("src","/x_component_process_ProcessDesigner/$Process/template/"+e.icon);t.addEvents({mouseover:function(){this.setStyles(a.css.templateNode_over)},mouseout:function(){this.setStyles(a.css.templateNode)},mousedown:function(){this.setStyles(a.css.templateNode_down)},mouseup:function(){this.setStyles(a.css.templateNode_over)},click:function(e){createPage(e,this.retrieve("template"));s.destroy();n.destroy()}})}.bind(this))}.bind(this));n.addEvent("click",function(){s.destroy();n.destroy()});var l=this.app.content.getSize();var p=(l.y-262)/2;var c=(l.x-828)/2;if(p<0)p=0;if(c<0)c=0;s.setStyles({top:""+p+"px",left:""+c+"px"})},_loadItemDataList:function(e){this.app.restActions.listMenu(this.app.options.application.id,e)},_getItemObject:function(e){return new MWF.xApplication.portal.PortalManager.MenuExplorer.Menu(this,e)},deleteItems:function(){this.hideDeleteAction();while(this.deleteMarkItems.length){var e=this.deleteMarkItems.shift();if(this.deleteMarkItems.length){e.deleteMenu()}else{e.deleteMenu(function(){}.bind(this))}}}});MWF.xApplication.portal.PortalManager.MenuExplorer.Menu=new Class({Extends:MWF.xApplication.process.ProcessManager.Explorer.Item,_open:function(e){var t=this;var n={onQueryLoad:function(){this.actions=t.explorer.actions;this.category=t;this.options.id=t.data.id;this.application=t.explorer.app.options.application}};this.explorer.app.desktop.openApplication(e,"portal.MenuDesigner",n)},_getIcon:function(){var e=(Math.random()*49).toInt();return"process_icon_"+e+".png"},_getLnkPar:function(){return{icon:this.explorer.path+this.explorer.options.style+"/processIcon/lnk.png",title:this.data.name,par:'portal.MenuDesigner#{"id": "'+this.data.id+'"}'}},deleteMenu:function(e){this.explorer.actions.deleteMenu(this.data.id,function(){this.node.destroy();if(e)e()}.bind(this))}});