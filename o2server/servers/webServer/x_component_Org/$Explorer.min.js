MWF.require("MWF.widget.Tab",null,false);MWF.xDesktop.requireApp("Org","List",null,false);MWF.xApplication.Org.$Explorer=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],options:{style:"default"},_loadPath:function(){this.path="/x_component_Org/$Explorer/";this.cssPath="/x_component_Org/$Explorer/"+this.options.style+"/css.wcss"},initialize:function(e,t,i){this.setOptions(i);this._loadPath();this._loadCss();this.actions=t;this.node=$(e);this.loaddingElement=false;this.elements=[];this.isElementLoaded=false;this.loadElementQueue=0;this.deleteElements=[]},_loadLp:function(){this.options.lp={elementLoaded:this.app.lp.personLoaded,search:this.app.lp.search,searchText:this.app.lp.searchText,elementSave:this.app.lp.personSave,deleteElements:this.app.lp.deletePersons,deleteElementsCancel:this.app.lp.deleteElementsCancel,deleteElementsTitle:this.app.lp.deletePersonsTitle,deleteElementsConfirm:this.app.lp.deletePersonsConfirm,elementBaseText:this.app.lp.personBaseText,elementName:this.app.lp.personName,noSignature:this.app.lp.noSignature,edit:this.app.lp.edit,cancel:this.app.lp.cancel,save:this.app.lp.save,add:this.app.lp.add}},clear:function(){this.loaddingElement=false;this.isElementLoaded=false;this.loadElementQueue=0;this.listNode.empty()},load:function(){this._loadLp();this.loadLayout();this.loadList()},loadLayout:function(){this.listAreaNode=new Element("div",{styles:this.css.listAreaNode}).inject(this.node);this.propertyAreaNode=new Element("div",{styles:this.css.propertyAreaNode}).inject(this.node);this.resizeBarNode=new Element("div",{styles:this.css.resizeBarNode}).inject(this.propertyAreaNode);this.propertyNode=new Element("div",{styles:this.css.propertyNode}).inject(this.propertyAreaNode);this.propertyTitleNode=new Element("div",{styles:this.css.propertyTitleNode}).inject(this.propertyNode);this.propertyContentNode=new Element("div",{styles:this.css.propertyContentNode}).inject(this.propertyNode);this.propertyContentNode.setStyle("-webkit-user-select","text");this.node.addEvent("selectstart",function(e){this.propertyContentNode.setStyle("-webkit-user-select","text")}.bind(this));this.toolbarNode=new Element("div",{styles:this.css.toolbarNode}).inject(this.listAreaNode);this.listScrollNode=new Element("div",{styles:this.css.listScrollNode}).inject(this.listAreaNode);this.listNode=new Element("div",{styles:this.css.listNode}).inject(this.listScrollNode);this.loadToolbar();this.resizePropertyContentNodeFun=this.resizePropertyContentNode.bind(this);this.resizePropertyContentNodeFun();this.app.addEvent("resize",this.resizePropertyContentNodeFun);this.loadScroll();this.loadResize()},loadToolbar:function(){if(this._isActionManager()){this.isEditor=true;this.addTopElementNode=new Element("div",{styles:this.css.addTopGroupNode}).inject(this.toolbarNode);this.addTopElementNode.addEvent("click",function(){this.addTopElement()}.bind(this))}this.createSearchNode();this.loadPingyinArea()},loadPingyinArea:function(){debugger;this.pingyinAction=new Element("div",{styles:this.css.pingyinAction}).inject(this.app.pingyinArea);this.pingyinAction.addEvent("click",function(e){if(!this.pingyinNode)this.createPingyinNode();if(this.pingyinMorph){if(!this.pingyinMorph.isRunning()){if(this.pingyinNode.getStyle("display")==="none"){this.showPingyin()}else{this.hidePingyin()}}}else{this.showPingyin()}}.bind(this));this.pingyinAction.addEvent("mousedown",function(e){e.stopPropagation()});this.hidePingyinFun=this.hidePingyin.bind(this);this.app.content.addEvent("mousedown",this.hidePingyinFun);this.removePingyinFun=this.removePingyin.bind(this);this.app.addEvent("queryClose",this.removePingyinFun)},removePingyin:function(){this.app.content.removeEvent("mousedown",this.hidePingyinFun)},hidePingyin:function(){if(this.pingyinNode){if(!this.pingyinMorph){this.pingyinMorph=new Fx.Morph(this.pingyinNode,{duration:50,link:"chain"})}if(!this.pingyinMorph.isRunning()){if(this.pingyinNode.getStyle("display")!=="none"){this.pingyinMorph.start(this.css.pingyinNode).chain(function(){this.pingyinNode.setStyle("display","none")}.bind(this))}}}},showPingyin:function(){this.resizePropertyContentNode();if(!this.pingyinMorph){this.pingyinMorph=new Fx.Morph(this.pingyinNode,{duration:50,link:"chain"})}this.pingyinNode.setStyle("display","block");this.pingyinMorph.start(this.css.pingyinNode_to).chain(function(){this.pingyinNode.setStyles(this.css.pingyinNode_to)}.bind(this))},setPingyinNodePosition:function(){this.pingyinNode.position({relativeTo:this.node,position:"leftTop",edge:"leftTop"})},createPingyinNode:function(){this.pingyinNode=new Element("div",{styles:this.css.pingyinNode}).inject(this.node);this.pingyinNode.addEvent("mousedown",function(e){e.stopPropagation()});letters=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];letters.each(function(e){var t=new Element("div",{styles:this.css.letterNode,text:e}).inject(this.pingyinNode);t.addEvents({mouseover:function(e){e.target.setStyles(this.css.letterNode_over)}.bind(this),mouseout:function(e){e.target.setStyles(this.css.letterNode)}.bind(this),click:function(e){this.searchInputNode.set("value",e.target.get("text"));this.searchOrg();this.hidePingyin()}.bind(this)})}.bind(this))},addTopElement:function(){var e=true;if(this.currentItem)e=this.currentItem.unSelected();if(e){var t=this._getAddElementData();var i=this._newElement(t,this);i.load();i.selected();i.editBaseInfor();new Fx.Scroll(this.listScrollNode).toElementCenter(i.node)}else{this.app.notice(this.options.lp.elementSave,"error",this.propertyContentNode)}},createSearchNode:function(){this.searchNode=new Element("div",{styles:this.css.searchNode}).inject(this.toolbarNode);this.searchButtonNode=new Element("div",{styles:this.css.searchButtonNode,title:this.options.lp.search}).inject(this.searchNode);this.searchButtonNode.addEvent("click",function(){this.searchOrg()}.bind(this));this.searchInputAreaNode=new Element("div",{styles:this.css.searchInputAreaNode}).inject(this.searchNode);this.searchInputNode=new Element("input",{type:"text",value:this.options.lp.searchText,styles:this.css.searchInputNode,"x-webkit-speech":"x-webkit-speech"}).inject(this.searchInputAreaNode);var e=this;this.searchInputNode.addEvents({focus:function(){if(this.value===e.options.lp.searchText)this.set("value","")},blur:function(){if(!this.value)this.set("value",e.options.lp.searchText)},keydown:function(e){if(e.code===13){this.searchOrg();e.preventDefault()}}.bind(this),selectstart:function(e){e.preventDefault()},change:function(){var e=this.searchInputNode.get("value");if(!e||e===this.options.lp.searchText){if(this.currentItem){if(this.currentItem.unSelected()){this.clear();this.loadElements()}else{this.app.notice(this.options.lp.elementSave,"error",this.propertyContentNode)}}}}.bind(this)});this.searchButtonNode.addEvent("click",function(){this.searchOrg()}.bind(this))},searchOrg:function(){var e=this.searchInputNode.get("value");if(e){if(e!==this.options.lp.searchText){var t=true;if(this.currentItem)t=this.currentItem.unSelected();if(t){this._listElementByKey(function(e){if(this.currentItem)this.currentItem.unSelected();this.clear();e.data.each(function(e){var t=this._newElement(e,this);t.load()}.bind(this))}.bind(this),null,e)}else{this.app.notice(this.options.lp.elementSave,"error",this.propertyContentNode)}}else{if(this.currentItem)t=this.currentItem.unSelected();if(t){this.clear();this.loadElements()}else{this.app.notice(this.options.lp.elementSave,"error",this.propertyContentNode)}}}else{if(this.currentItem)t=this.currentItem.unSelected();if(t){this.clear();this.loadElements()}else{this.app.notice(this.options.lp.elementSave,"error",this.propertyContentNode)}}},resizePropertyContentNode:function(){var e=this.node.getSize();var t=this.propertyTitleNode.getSize();var i=this.propertyTitleNode.getStyle("margin-top").toFloat();var n=this.propertyTitleNode.getStyle("margin-bottom").toFloat();var s=this.propertyContentNode.getStyle("margin-top").toFloat();var o=this.propertyContentNode.getStyle("margin-bottom").toFloat();var l=e.y-t.y-i-n-s-o;this.propertyContentNode.setStyle("height",l);t=this.toolbarNode.getSize();i=this.toolbarNode.getStyle("margin-top").toFloat();n=this.toolbarNode.getStyle("margin-bottom").toFloat();s=this.toolbarNode.getStyle("margin-top").toFloat();o=this.toolbarNode.getStyle("margin-bottom").toFloat();l=e.y-t.y-i-n-s-o;this.listScrollNode.setStyle("height",""+l+"px");if(this.pingyinNode){this.setPingyinNodePosition();this.pingyinNode.setStyle("height",""+e.y+"px")}},loadScroll:function(){MWF.require("MWF.widget.ScrollBar",function(){var e=this;new MWF.widget.ScrollBar(this.listScrollNode,{style:"xApp_Organization_Explorer",where:"before",distance:100,friction:4,axis:{x:false,y:true},onScroll:function(t){var i=e.listScrollNode.getScrollSize();var n=e.listScrollNode.getSize();var s=i.y-n.y;if(t+200>s){if(!e.isElementLoaded)e.loadElements()}}})}.bind(this))},loadResize:function(){this.propertyResize=new Drag(this.resizeBarNode,{snap:1,onStart:function(e,t){var i=t.event.clientX;var n=t.event.clientY;e.store("position",{x:i,y:n});var s=this.listAreaNode.getSize();e.store("initialWidth",s.x)}.bind(this),onDrag:function(e,t){var i=t.event.clientX;var n=this.node.getSize();var s=e.retrieve("position");var o=e.retrieve("initialWidth").toFloat();var l=s.x.toFloat()-i.toFloat();var d=o-l;if(d>n.x/1.5)d=n.x/1.5;if(d<300)d=300;this.listAreaNode.setStyle("width",d+1);this.propertyAreaNode.setStyle("margin-left",d)}.bind(this)})},getPageNodeCount:function(){var e=this.listScrollNode.getSize();return(e.y/50).toInt()+5},loadList:function(){this.loadElements();this.continueLoadFun=this.continueLoad.bind(this);this.app.addEvent("resize",this.continueLoadFun)},continueLoad:function(){if(this.elements.length<this.getPageNodeCount()){this.loadElements(true)}},loadElements:function(e){if(!this.isElementLoaded){if(!this.loaddingElement){this.loaddingElement=true;var t=this.getPageNodeCount();this._listElementNext(this.getLastLoadedElementId(),t,function(e){if(e.data.length){this.loadListContent(e.data);this.loaddingElement=false;if(e.data.length<t){this.isElementLoaded=true;this.app.notice(this.options.lp.elementLoaded,"ok",this.listScrollNode,{x:"center",y:"bottom"})}else{if(this.loadElementQueue>0){this.loadElementQueue--;this.loadElements()}}}else{if(!this.elements.length){}else{this.app.notice(this.options.lp.elementLoaded,"ok",this.listScrollNode,{x:"center",y:"bottom"})}this.isElementLoaded=true;this.loaddingElement=false}}.bind(this))}else{if(e)this.loadElementQueue++}}},getLastLoadedElementId:function(){return this.elements.length?this.elements[this.elements.length-1].data.id:""},loadListContent:function(e){e.each(function(e,t){var i=this._newElement(e,this,t);this.elements.push(i);i.load();if(this.elements.length===1)i.selected()}.bind(this))},setNoElementNoticeArea:function(){},checkDeleteElements:function(e){if(this.deleteElements.length){if(!this.deleteElementsNode){this.deleteElementsNode=new Element("div",{styles:this.css.deleteElementsNode}).inject(this.node);this.deleteElementsDeleteNode=new Element("div",{styles:this.css.deleteElementsDeleteNode,text:this.options.lp.deleteElements}).inject(this.deleteElementsNode);this.deleteElementsCancelNode=new Element("div",{styles:this.css.deleteElementsCancelNode,text:this.options.lp.deleteElementsCancel}).inject(this.deleteElementsNode);this.deleteElementsDeleteNode.addEvent("click",function(e){this.deleteSelectedElements(e)}.bind(this));this.deleteElementsCancelNode.addEvent("click",function(e){this.deleteSelectedElementsCancel(e)}.bind(this))}this.deleteElementsNode.position({relativeTo:e?e.node:this.toolbarNode,position:"centerBottom",edge:"centerTop"})}else{if(this.deleteElementsNode){this.deleteElementsNode.destroy();this.deleteElementsNode=null;delete this.deleteElementsNode}}},deleteSelectedElements:function(e){var t=this;this.app.confirm("infor",e,this.options.lp.deleteElementsTitle,this.options.lp.deleteElementsConfirm,300,120,function(){var e=[];var i=0;var n=t.deleteElements.length;var s="";var o;o=function(){if(i===n){if(s){t.app.notice(s,"error",t.propertyContentNode,{x:"left",y:"top"})}}};t.deleteElements.each(function(n){n["delete"](function(){e.push(n);i++;if(t.deleteElements.length===i){t.deleteElements=t.deleteElements.filter(function(t){return!e.contains(t)});t.checkDeleteElements()}o()},function(n){s=s?s+"<br/><br/>"+n:n;i++;if(t.deleteElements.length!==i){}else{t.deleteElements=t.deleteElements.filter(function(t){return!e.contains(t)});t.checkDeleteElements()}o()})});this.close()},function(){this.close()})},deleteSelectedElementsCancel:function(){debugger;while(this.deleteElements.length){var e=this.deleteElements[0];e.setUndelete();if(this.currentItem!==e){e.contentNode.setStyles(e.style.contentNode);if(e.data.id)e.actionNode.fade("out")}}this.checkDeleteElements()},destroy:function(){debugger;if(this.hidePingyinFun)this.app.content.removeEvent("mousedown",this.hidePingyinFun);if(this.resizePropertyContentNodeFun)this.app.removeEvent("resize",this.resizePropertyContentNodeFun);if(this.continueLoadFun)this.app.removeEvent("resize",this.continueLoadFun);if(this.removePingyinFun)this.app.removeEvent("queryClose",this.removePingyinFun);MWF.release(this)},_isActionManager:function(){return MWF.AC.isOrganizationManager()},_listElementNext:function(e,t,i){this.actions.listPersonNext(e,t,function(e){if(i){i.apply(this,[e])}}.bind(this))},_newElement:function(e,t,i){return new MWF.xApplication.Org.PersonExplorer.Person(e,t,this.isEditor,i)},_listElementByKey:function(e,t,i){this.actions.listPersonByKey(function(t){if(e){e.apply(this,[t])}}.bind(this),t,i)},_getAddElementData:function(){return{employee:"",password:"",display:"",qq:"",mail:"",weixin:"",weibo:"",mobile:"",name:"",controllerList:[]}},getContentStyle:function(e,t){var i=this.propertyContentNode.getPosition(this.propertyContentNode.getOffsetParent());var n=this.propertyContentNode.getSize();e.position({relativeTo:t,position:"upperLeft",edge:"upperLeft"});return{top:""+i.y+"px",left:""+i.x+"px",height:""+n.y+"px",width:""+n.x+"px"}},openPerson:function(e,t){this.openContent("PersonExplorer","PersonContent",e,t)},openGroup:function(e,t){this.openContent("GroupExplorer","GroupContent",e,t)},openContent:function(e,t,i,n){MWF.xDesktop.requireApp("Org",e,function(){var s=new Element("div",{styles:this.css.popContentNode}).inject(this.propertyContentNode,"top");var o=this.getContentStyle(s,n);var l=true;new Fx.Morph(s,{duration:300,transition:Fx.Transitions.Expo.easeOut}).start(o).chain(function(){r.setContentSize();l=false;s.setStyles({position:"static",width:"100%",height:"100%"})}.bind(this));var d={explorer:this,style:this.css.item,data:i,isEdit:false,refresh:function(){},propertyContentNode:s};var r=new MWF.xApplication.Org[e][t](d,true);var h=function(){r.setContentSize();if(l)window.setTimeout(function(){h()},30)};window.setTimeout(function(){h()},30)}.bind(this))}});MWF.xApplication.Org.$Explorer.Item=new Class({initialize:function(e,t,i,n){this.i=n;this.data=e;this.explorer=t;this.listNode=this.explorer.listNode;this.propertyContentNode=this.explorer.propertyContentNode;this.initStyle();this.selectedAttributes=[];this.isEdit=false;this.isEditor=i;this.deleteSelected=false},initStyle:function(){this.style=this.explorer.css.item},refresh:function(){this.iconNode.getElement("img").set("src",this._getIcon());this._loadTextNode();if(this.content){if(this.content.titleInfor)this.content.titleInfor.refresh();if(this.content.bottomInfor)this.content.bottomInfor.refresh()}debugger;this.addActions()},load:function(){this.node=new Element("div",{styles:this.style.node}).inject(this.listNode);this.contentNode=new Element("div",{styles:this.style.contentNode}).inject(this.node);this.iconNode=new Element("div",{styles:this.style.iconNode}).inject(this.contentNode);var e=this._getIcon();var t=new Element("img",{styles:this.style.iconImgNode,src:e}).inject(this.iconNode);this.actionNode=new Element("div",{styles:this.style.actionNode}).inject(this.contentNode);this.textNode=new Element("div",{styles:this.style.textNode}).inject(this.contentNode);this._loadTextNode();this.setNewItem();this.node.inject(this.listNode);this.addActions();this.setEvent()},setNewItem:function(){if(!this.created){if(!this.data.id){this.created=false;this.contentNode.setStyles(this.style.contentNodeNew)}else{this.created=true;this.contentNode.setStyles(this.style.contentNode)}}},addActions:function(){if(this.isEditor){if(this.data.id){if(this.data.control.allowDelete){if(!this.deleteNode){this.deleteNode=new Element("div",{styles:this.style.actionDeleteNode}).inject(this.actionNode);this.deleteNode.addEvent("click",function(e){if(!this.notDelete){if(!this.deleteSelected){this.setDelete()}else{this.setUndelete()}}e.stopPropagation()}.bind(this));if(this.explorer.currentItem===this){if(this.deleteNode)this.deleteNode.setStyles(this.style.actionDeleteNode_selected)}}}}}},setDelete:function(){this.actionNode.fade("in");this.deleteNode.setStyles(this.style.actionDeleteNode_delete);this.contentNode.setStyles(this.style.contentNode_delete);this.textNode.setStyles(this.style.textNode);this.explorer.deleteElements.push(this);this.deleteSelected=true;this.explorer.checkDeleteElements(this)},setUndelete:function(){this.actionNode.fade("out");if(this.explorer.currentItem!==this){this.deleteNode.setStyles(this.style.actionDeleteNode);this.contentNode.setStyles(this.style.contentNode);this.textNode.setStyles(this.style.textNode)}else{this.contentNode.setStyles(this.style.contentNode_selected);this.textNode.setStyles(this.style.textNode_selected);this.actionNode.setStyles(this.style.actionNode_selected);if(this.deleteNode)this.deleteNode.setStyles(this.style.actionDeleteNode_selected)}this.explorer.deleteElements.erase(this);this.deleteSelected=false;this.explorer.checkDeleteElements(this)},setEvent:function(){this.contentNode.addEvents({mouseover:function(e){if(this.explorer.currentItem!==this&&!this.deleteSelected){this.contentNode.setStyles(this.style.nodeOver);if(!this.deleteSelected)if(this.data.id)this.actionNode.fade("in")}}.bind(this),mouseout:function(e){if(this.explorer.currentItem!==this&&!this.deleteSelected){this.contentNode.setStyles(this.style.contentNode);if(!this.deleteSelected)if(this.data.id)this.actionNode.fade("out")}}.bind(this),click:function(e){if(!this.deleteSelected){if(this.explorer.currentItem){if(this.explorer.currentItem.unSelected()){this.selected()}else{this.explorer.app.notice(this.explorer.options.lp.elementSave,"error",this.propertyContentNode)}}else{this.selected()}}}.bind(this)})},unSelected:function(){if(this.content.baseInfor.mode==="edit")return false;if(!this.deleteSelected){this.explorer.currentItem=null;this.contentNode.setStyles(this.style.contentNode);this.textNode.setStyles(this.style.textNode);this.actionNode.setStyles(this.style.actionNode);if(this.deleteNode)this.deleteNode.setStyles(this.style.actionDeleteNode)}this.clearItemProperty();return true},clearItemProperty:function(){this.explorer.propertyTitleNode.empty();if(this.content)this.content.destroy();this.explorer.propertyContentNode.empty()},selected:function(){this.explorer.currentItem=this;this.contentNode.setStyles(this.style.contentNode_selected);this.textNode.setStyles(this.style.textNode_selected);this.actionNode.setStyles(this.style.actionNode_selected);if(this.deleteNode)this.deleteNode.setStyles(this.style.actionDeleteNode_selected);this.showItemProperty()},editBaseInfor:function(){this.content.edit()},showItemProperty:function(){this.content=new MWF.xApplication.Org.PersonExplorer.PersonContent(this)},destroy:function(){if(this.explorer.currentItem===this){this.explorer.currentItem=null;this.clearItemProperty()}this.node.destroy();delete this},delete:function(e,t){this.explorer.actions.deletePerson(this.data.id,function(){this.destroy();if(e)e()}.bind(this),function(e,i,n){var s=n;if(e)s=e.responseText;MWF.xDesktop.notice("error",{x:"right",y:"top"},"request json error: "+s);if(t)t()})},_loadTextNode:function(){this.textNode.set({text:this.data.name})},_getIcon:function(e){var t=this.data.id?this.explorer.actions.getPersonIcon(this.data.id):"/x_component_Org/$Explorer/default/icon/man.png";return e?t+"?"+(new Date).getTime():t}});MWF.xApplication.Org.$Explorer.ItemContent=new Class({initialize:function(e,t){this.item=e;this.isClose=t;this.explorer=this.item.explorer;this.contentNode=this.item.propertyContentNode;this.style=this.item.style.person;this.load()},_getData:function(e){this.data=this.item.data;if(e)e()},load:function(){debugger;this.titleContentNode=new Element("div").inject(this.contentNode);this.propertyContentScrollNode=new Element("div",{styles:{overflow:"hidden"}}).inject(this.contentNode);this.propertyContentNode=new Element("div",{styles:{overflow:"hidden"}}).inject(this.propertyContentScrollNode);this.bottomContentNode=new Element("div").inject(this.contentNode);this._getData(function(){this.explorer.propertyTitleNode.set("text",this.data.name);this._showItemPropertyTitle();this.loadItemPropertyTab(function(){this._loadTabs();this._loadContent();if(this.propertyTab.pages.length)this.propertyTab.pages[0].showTabIm()}.bind(this));this._showItemPropertyBottom();this.setContentSizeFun=this.setContentSize.bind(this);this.setContentSize();this.explorer.app.addEvent("resize",this.setContentSizeFun);new MWF.widget.ScrollBar(this.propertyContentScrollNode,{style:"xApp_Organization_Explorer",where:"before",distance:100,friction:4,axis:{x:false,y:true}})}.bind(this))},setContentSize:function(){var e=this.contentNode.getSize();var t=this.titleContentNode.getSize();var i=this.bottomContentNode.getSize();var n=e.y-t.y-i.y;this.propertyContentScrollNode.setStyle("height",""+n+"px")},loadItemPropertyTab:function(e){this.propertyTabContainerNode=new Element("div",{styles:this.item.style.tabTitleNode}).inject(this.propertyContentNode,"top");MWF.require("MWF.widget.Tab",function(){this.propertyTab=new MWF.widget.Tab(this.propertyContentNode,{style:"org"});this.propertyTab.load();this.propertyTab.tabNodeContainer.inject(this.propertyTabContainerNode);if(e)e()}.bind(this))},edit:function(){debugger;if(this.baseInfor)this.baseInfor.edit()},destroy:function(){if(this.setContentSizeFun)this.explorer.app.removeEvent("resize",this.setContentSizeFun);if(this.titleInfor)this.titleInfor.destroy();if(this.bottomInfor)this.bottomInfor.destroy();if(this.baseInfor)this.baseInfor.destroy();this.contentNode.empty();MWF.release(this)},_showItemPropertyTitle:function(){this.titleInfor=new MWF.xApplication.Org.$Explorer.ItemContent.TitleInfor(this)},_showItemPropertyBottom:function(){this.bottomInfor=new MWF.xApplication.Org.$Explorer.ItemContent.BottmInfor(this)},_loadTabs:function(){},_loadContent:function(){}});MWF.xApplication.Org.$Explorer.ItemContent.TitleInfor=new Class({initialize:function(e){this.content=e;this.item=e.item;this.data=this.content.data;this.explorer=this.item.explorer;this.contentNode=this.content.titleContentNode;this.style=this._getStyle();this.load()},_getStyle:function(){return this.item.style.person},load:function(){this.titleBgNode=new Element("div",{styles:this.style.titleBgNode}).inject(this.contentNode);this.titleNode=new Element("div",{styles:this.style.titleNode}).inject(this.titleBgNode);this.setBackground();this.titleInforNode=new Element("div",{styles:this.style.titleInforNode}).inject(this.titleNode);this.titleInforLeftNode=new Element("div",{styles:this.style.titleInforLeftNode}).inject(this.titleInforNode);this.titleInforRightNode=new Element("div",{styles:this.style.titleInforRightNode}).inject(this.titleInforNode);this.loadLeftInfor();this.loadRightInfor();this.loadAction();if(this.content.isClose)this.createCloseNode()},createCloseNode:function(){this.closeNode=new Element("div",{styles:this.style.titleCloseNode}).inject(this.titleBgNode);this.closeNode.addEvents({mousedown:function(){this.closeNode.setStyles(this.style.titleCloseNode_down)}.bind(this),mouseup:function(){this.closeNode.setStyles(this.style.titleCloseNode)}.bind(this),click:function(){var e=this.content.contentNode;this.content.destroy();e.destroy();e=null}.bind(this)})},setBackground:function(){this.titleBgNode.setStyle("background-image","url(/x_component_Org/$Explorer/"+this.explorer.app.options.style+"/icon/person_bg_bg.png)");this.titleNode.setStyle("background-image","url(/x_component_Org/$Explorer/"+this.explorer.app.options.style+"/icon/person_bg.png)")},loadLeftInfor:function(){debugger;if(!this.iconAreaNode)this.iconAreaNode=new Element("div",{styles:this.style.titleInforIconAreaNode}).inject(this.titleInforLeftNode);if(!this.iconNode)this.iconNode=new Element("img",{styles:this.style.titleInforIconNode}).inject(this.iconAreaNode);this.iconNode.set("src",this._getIcon())},_getIcon:function(e){var t=this.data.id?this.explorer.actions.getPersonIcon(this.data.id):"/x_component_Org/$Explorer/default/icon/man.png";return e?t+"?"+(new Date).getTime():t},loadRightInfor:function(){var e=this.data.name+(this.data.employee?"（"+this.data.employee+"）":"");if(!this.nameNode)this.nameNode=new Element("div",{styles:this.style.titleInforNameNode}).inject(this.titleInforRightNode);if(!this.signatureNode)this.signatureNode=new Element("div",{styles:this.style.titleInforSignatureNode}).inject(this.titleInforRightNode);this.nameNode.set("text",e);this.signatureNode.set("text",this.data.signature||"")},refresh:function(){this.loadLeftInfor();this.loadRightInfor()},loadAction:function(){},destroy:function(){this.contentNode.empty();MWF.release(this)}});MWF.xApplication.Org.$Explorer.ItemContent.BottomInfor=new Class({initialize:function(e){this.content=e;this.item=e.item;this.data=this.content.data;this.explorer=this.item.explorer;this.contentNode=this.content.bottomContentNode;this.style=this._getStyle();this.load()},_getStyle:function(){return this.item.style.person},load:function(){this.readContentNode=new Element("div",{styles:this.style.baseReadNode}).inject(this.contentNode);this.addInforList()},addInfor:function(e){return new Element("div",{styles:this.style.baseReadContentNode,text:e}).inject(this.readContentNode)},addInforList:function(){},refresh:function(){this.readContentNode.empty();this.addInforList()},destroy:function(){this.readContentNode.empty();this.readContentNode.destroy();MWF.release(this)}});