MWF.xApplication.cms=MWF.xApplication.cms||{};MWF.xApplication.cms.Module=MWF.xApplication.cms.Module||{};MWF.require("MWF.xAction.org.express.RestActions",null,false);MWF.require("MWF.widget.Mask",null,false);MWF.require("MWF.widget.O2Identity",null,false);MWF.xDesktop.requireApp("cms.Module","lp."+MWF.language,null,false);MWF.xDesktop.requireApp("cms.Module","package",null,false);MWF.xApplication.cms.Module.ListExplorer=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],options:{style:"default",status:"published",isAdmin:false,searchKey:"",tooltip:{}},initialize:function(e,t,i,s,o,n,r){this.setOptions(n);this.setTooltip();this.path="/x_component_cms_Module/$ListExplorer/";this.cssPath="/x_component_cms_Module/$ListExplorer/"+this.options.style+"/css.wcss";this._loadCss();this.categoryData=s;this.columnData=i;this.revealData=o;this.actions=t;this.node=$(e);this.searchNode=$(r);this.initData();if(!this.personActions)this.personActions=new MWF.xAction.org.express.RestActions},setTooltip:function(e){if(e)this.options.tooltip=Object.merge(this.options.tooltip,e)},initData:function(){this.toolItemNodes=[]},reload:function(){this.node.empty();this.searchNode.empty();this.load()},load:function(){this.loadSearchNode();this.loadViewData(function(){this.loadContentNode();this.loadView();this.setNodeScroll()}.bind(this))},loadViewData:function(i){if(this.revealData.isAll){if(i)i()}else if(this.revealData.id=="defaultList"){if(i)i()}else if(this.revealData.type=="list"){this.app.restActions.getView(this.revealData.id,function(e){var t=this.viewData=e.data;if(t.content&&typeof t.content=="string"){t.content=JSON.parse(t.content)}if(i)i()}.bind(this))}},loadToolbar:function(){var e=this.path+"toolbar.json";MWF.getJSON(e,function(e){e.each(function(e){this.createToolbarItemNode(e)}.bind(this))}.bind(this))},createToolbarItemNode:function(e){var t=new Element("div",{styles:e.styles&&this.css[e.styles]?this.css[e.styles]:this.css.toolbarItemNode});t.store("toolData",e);var i=new Element("div",{styles:this.css.toolbarItemIconNode}).inject(t);i.setStyle("background-image","url("+this.path+this.options.style+"/icon/"+e.icon+")");var s=new Element("div",{styles:this.css.toolbarItemTextNode,text:e.title});s.inject(t);t.inject(this.toolbarNode);this.toolItemNodes.push(t);this.setToolbarItemEvent(t)},setToolbarItemEvent:function(e){var t=this;e.addEvents({click:function(){var e=this.retrieve("toolData");if(t[e.action])t[e.action].apply(t,[this])}})},loadContentNode:function(){this.elementContentNode=new Element("div",{styles:this.css.elementContentNode}).inject(this.node);this.app.addEvent("resize",function(){this.setContentSize()}.bind(this))},loadView:function(){if(this.revealData.isAll){this.view=new MWF.xApplication.cms.Module.ListExplorer.ListForALL(this.elementContentNode,this.app,this,this.viewData,this.options.searchKey)}else if(this.revealData.id=="defaultList"||this.options.searchKey&&this.options.searchKey!=""){this.view=new MWF.xApplication.cms.Module.ListExplorer.DefaultList(this.elementContentNode,this.app,this,this.viewData,this.options.searchKey)}else{this.view=new MWF.xApplication.cms.Module.ListExplorer.List(this.elementContentNode,this.app,this,this.viewData)}this.view.load();this.setContentSize()},setContentSize:function(){var e=this.toolbarNode?this.toolbarNode.getSize():{x:0,y:0};var t=this.app.titleBar?this.app.titleBar.getSize():{x:0,y:0};var i=this.app.node.getSize();var s=0;var o=0;var n=this.filterConditionNode?this.filterConditionNode.getSize():{x:0,y:0};var r=i.y-e.y-s-o-n.y-t.y;this.elementContentNode.setStyle("height",""+r+"px");this.pageCount=(r/40).toInt()+5;if(this.view.items.length<this.pageCount){this.view.loadElementList(this.pageCount-this.view.items.length)}},setNodeScroll:function(){var o=this;MWF.require("MWF.widget.ScrollBar",function(){new MWF.widget.ScrollBar(this.elementContentNode,{indent:false,style:"xApp_TaskList",where:"before",distance:30,friction:4,axis:{x:false,y:true},onScroll:function(e){var t=o.elementContentNode.getScrollSize();var i=o.elementContentNode.getSize();var s=t.y-i.y;if(e+200>s){if(!o.view.isItemsLoaded)o.view.loadElementList()}}})}.bind(this))},loadFileter:function(e){this._loadFileter(e)},_loadFileter:function(e){if(!this.filter){this.filter=new MWF.xApplication.cms.Module.Module.Filter(this.app,this,this.toolbarNode,e,this.filterConditionNode,this.actions,this.css);this.filter.load()}else{this.filter.load()}},loadSearchNode:function(){this.searchBarAreaNode=new Element("div",{styles:this.css.searchBarAreaNode}).inject(this.searchNode);this.searchBarNode=new Element("div",{styles:this.css.searchBarNode}).inject(this.searchBarAreaNode);this.searchBarActionNode=new Element("div",{styles:this.css.searchBarActionNode}).inject(this.searchBarNode);this.searchBarResetActionNode=new Element("div",{styles:this.css.searchBarResetActionNode}).inject(this.searchBarNode);this.searchBarResetActionNode.setStyle("display","none");this.searchBarInputBoxNode=new Element("div",{styles:this.css.searchBarInputBoxNode}).inject(this.searchBarNode);this.searchBarInputNode=new Element("input",{type:"text",value:this.options.searchKey!=""?this.options.searchKey:this.app.lp.searchKey,styles:this.css.searchBarInputNode}).inject(this.searchBarInputBoxNode);var e=this;this.searchBarActionNode.addEvent("click",function(){this.search()}.bind(this));this.searchBarResetActionNode.addEvent("click",function(){this.reset()}.bind(this));this.searchBarInputNode.addEvents({focus:function(){if(this.value==e.app.lp.searchKey)this.set("value","")},blur:function(){if(!this.value)this.set("value",e.app.lp.searchKey)},keydown:function(e){if(e.code==13){this.search();e.preventDefault()}}.bind(this),selectstart:function(e){e.preventDefault()}})},search:function(e){if(!e)e=this.searchBarInputNode.get("value");if(e==this.app.lp.searchKey)e="";if(e!=""){this.searchBarResetActionNode.setStyle("display","block");this.searchBarActionNode.setStyle("display","none")}this.options.searchKey=e;this.clearContentNode();this.loadView()},clearContentNode:function(){this.elementContentNode.empty()},reset:function(){this.searchBarInputNode.set("value",this.app.lp.searchKey);this.searchBarResetActionNode.setStyle("display","none");this.searchBarActionNode.setStyle("display","block");this.options.searchKey="";this.clearContentNode();this.loadView()}});MWF.xApplication.cms.Module.ListExplorer.DefaultList=new Class({initialize:function(e,t,i,s,o){this.container=e;this.app=t;this.explorer=i;this.css=i.css;this.actions=i.actions;this.data=s;this.searchKey=o},initData:function(){this.items=[];this.documents={};this.isItemsLoaded=false;this.isItemLoadding=false;this.loadItemQueue=0},load:function(){this.initData();this.node=new Element("div",{styles:this.css.elementContentListNode}).inject(this.container);this.table=new Element("table",{width:"100%",border:"0",cellpadding:"5",cellspacing:"0",class:"editTable"}).inject(this.node);this.initSortData();this.createListHead();this.loadElementList()},initSortData:function(){},clear:function(){this.documents=null;MWF.release(this.items);this.items=[];this.documents={};this.container.empty();this.isItemsLoaded=false;this.isItemLoadding=false;this.loadItemQueue=0},reload:function(){this.clear();this.node=new Element("div",{styles:this.css.elementContentListNode}).inject(this.container);this.table=new Element("table",{width:"100%",border:"0",cellpadding:"5",cellspacing:"0",class:"editTable"}).inject(this.node);this.createListHead();this.loadElementList()},resort:function(e){this.orderField=e.retrieve("field");var t=e.retrieve("orderType");if(t==""){this.orderType="asc"}else if(this.orderType=="asc"){this.orderType="desc"}else{this.orderField="";this.orderType=""}this.reload()},createListHead:function(){var s=this;var o=new Element("tr",{styles:this.css.listHeadNode}).inject(this.table);var e=this.explorer.path+"listItem.json";MWF.getJSON(e,function(e){this.listItemTemplate=e;e.each(function(e){var t=true;if(e.access){if(e.access=="admin"&&!this.explorer.options.isAdmin){t=false}}if(t){var i=new Element("th",{styles:this.css[e.headStyles],width:e.width,text:e.title}).inject(o);if(e.sortByClickTitle=="yes"){i.store("field",e.item);if(this.orderField==e.item&&this.orderType!=""){i.store("orderType",this.orderType);this.sortIconNode=new Element("div",{styles:this.orderType=="asc"?this.css.sortIconNode_asc:this.css.sortIconNode_desc}).inject(i,"bottom")}else{i.store("orderType","");this.sortIconNode=new Element("div",{styles:this.css.sortIconNode}).inject(i,"bottom")}i.setStyle("cursor","pointer");i.addEvent("click",function(){s.resort(this)})}}}.bind(this))}.bind(this),false)},loadElementList:function(e){if(!this.isItemsLoaded){if(!this.isItemLoadding){this.isItemLoadding=true;this._getCurrentPageData(function(e){this.count=e.count;if(e.count<=this.items.length){this.isItemsLoaded=true}e.data.each(function(e){if(!this.documents[e.id]){var t=this._createItem(e);this.items.push(t);this.documents[e.id]=t}}.bind(this));this.isItemLoadding=false;if(this.loadItemQueue>0){this.loadItemQueue--;this.loadElementList()}}.bind(this),e)}else{this.loadItemQueue++}}},_getCurrentPageData:function(t,e){if(!e)e=20;var i=this.items.length?this.items[this.items.length-1].data.id:"(0)";var s={categoryIdList:[this.explorer.categoryData.id],statusList:[this.explorer.options.status],orderField:this.orderField||null,orderType:this.orderType||null};if(this.searchKey&&this.searchKey!=""){s.title=this.searchKey}if(this.filter&&this.filter.filter){var o=this.filter.getFilterResult();for(var n in o){s[n]=o[n]}this.actions.listDocumentFilterNext(i,e||this.pageCount,s,function(e){if(t)t(e)})}else{this.actions.listDocumentFilterNext(i,e||this.pageCount,s,function(e){if(t)t(e)})}},removeDocument:function(e,t){var i=e.data.id;this.actions.removeDocument(i,function(e){this.items.erase(this.documents[i]);this.documents[i].destroy();MWF.release(this.documents[i]);this.app.notice(this.app.lp.deleteDocumentOK,"success")}.bind(this))},_createItem:function(e){return new MWF.xApplication.cms.Module.ListExplorer.DefaultDocument(this.table,e,this.explorer,this)}});MWF.xApplication.cms.Module.ListExplorer.ListForALL=new Class({Extends:MWF.xApplication.cms.Module.ListExplorer.DefaultList,createListHead:function(){var s=this;var o=new Element("tr",{styles:this.css.listHeadNode}).inject(this.table);var e=this.explorer.path+"listItemForAll.json";MWF.getJSON(e,function(e){this.listItemTemplate=e;e.each(function(e){var t=true;if(e.access){if(e.access=="admin"&&!this.explorer.options.isAdmin){t=false}}if(t){var i=new Element("th",{styles:this.css[e.headStyles],width:e.width,text:e.title}).inject(o)}if(e.sortByClickTitle=="yes"){i.store("field",e.item);if(this.orderField==e.item&&this.orderType!=""){i.store("orderType",this.orderType);this.sortIconNode=new Element("div",{styles:this.orderType=="asc"?this.css.sortIconNode_asc:this.css.sortIconNode_desc}).inject(i,"bottom")}else{i.store("orderType","");this.sortIconNode=new Element("div",{styles:this.css.sortIconNode}).inject(i,"bottom")}i.setStyle("cursor","pointer");i.addEvent("click",function(){s.resort(this)})}}.bind(this))}.bind(this),false)},_getCurrentPageData:function(t,e){if(!e)e=20;var i=this.items.length?this.items[this.items.length-1].data.id:"(0)";var s={appIdList:[this.explorer.columnData.id],statusList:[this.explorer.options.status],orderField:this.orderField||null,orderType:this.orderType||null};if(this.searchKey&&this.searchKey!=""){s.title=this.searchKey}if(this.filter&&this.filter.filter){var o=this.filter.getFilterResult();for(var n in o){s[n]=o[n]}this.actions.listDocumentFilterNext(i,e||this.pageCount,s,function(e){if(t)t(e)})}else{this.actions.listDocumentFilterNext(i,e||this.pageCount,s,function(e){if(t)t(e)})}}});MWF.xApplication.cms.Module.ListExplorer.List=new Class({Extends:MWF.xApplication.cms.Module.ListExplorer.DefaultList,initSortData:function(){this.orderField=this.data.orderField?this.data.orderField:"";this.orderType=this.data.orderType?this.data.orderType:"";this.viewId=this.data.id;this.categoryId=this.explorer.categoryData.id;this.status=this.explorer.options.status},createListHead:function(){var s=this;var o=new Element("tr",{styles:this.css.listHeadNode}).inject(this.table);this.data.content.columns.each(function(e){var t=e.widthType=="px"?e.width+"px":e.widthPer+"%";var i=new Element("th",{styles:this.css.normalThNode,width:t,text:e.title?e.title:""}).inject(o);if(e.sortByClickTitle=="yes"){i.store("field",e.value);if(this.orderField==e.value&&this.orderType!=""){i.store("orderType",this.orderType);this.sortIconNode=new Element("div",{styles:this.orderType.toLowerCase()=="asc"?this.css.sortIconNode_asc:this.css.sortIconNode_desc}).inject(i,"bottom")}else{i.store("orderType","");this.sortIconNode=new Element("div",{styles:this.css.sortIconNode}).inject(i,"bottom")}i.setStyle("cursor","pointer");i.addEvent("click",function(){s.resort(this)})}}.bind(this))},resort:function(e){this.orderField=e.retrieve("field");this.orderType=(e.retrieve("orderType")||"").toLowerCase();if(this.orderType==""){this.orderType="asc"}else if(this.orderType=="asc"){this.orderType="desc"}else{this.orderField=this.data.orderField?this.data.orderField:"";this.orderType=this.data.orderType?this.data.orderType:""}this.reload()},_getCurrentPageData:function(t,e){if(!e)e=20;var i=this.items.length?this.items[this.items.length-1].data.document.id:"(0)";var s={orderField:this.orderField,orderType:this.orderType,categoryId:this.categoryId,viewId:this.viewId,searchDocStatus:this.status};this.actions.listViewDataNext(i,e,s,function(e){e.data.each(function(e){if(!e.id)e.id=e.document.id;if(!e.title)e.title=e.document.title});if(t)t(e)})},_createItem:function(e){return new MWF.xApplication.cms.Module.ListExplorer.Document(this.table,e,this.explorer,this)}});MWF.xApplication.cms.Module.ListExplorer.Filter=new Class({initialize:function(e,t,i,s,o,n,r){this.app=e;this.explorer=t;this.css=r;this.actions=n;this.filterNode=$(i);this.filterActionNode=$(s);this.filterConditionNode=o},load:function(){var e=this.explorer.path+"filterItem.json";MWF.getJSON(e,function(e){this.filterSetting=e;if(!this.isFilterOpen){if(!this.filterAreaMorph||!this.filterAreaMorph.isRunning())this.showFilter()}else{if(this.filterAreaMorph||!this.filterAreaMorph.isRunning())this.hideFilter()}}.bind(this))},showFilter:function(){if(!this.filterAreaNode)this.createFilterAreaNode();this.filterAreaTipNode.setStyle("display","block");this.filterAreaNode.setStyle("display","block");this.resizeFilterAreaNode();var e={width:"460px",height:"500px"};this.isFilterOpen=true;this.filterAreaMorph.start(e).chain(function(){this.createFilterAreaTitle();this.createFilterAreaContent();this.hideFilterFun=this.hideFilter.bind(this);$(document.body).addEvent("click",this.hideFilterFun)}.bind(this))},hideFilter:function(){if(this.filterAreaNode){var e={width:"460px",height:"0px"};this.filterAreaNode.empty();this.isFilterOpen=false;this.filterAreaMorph.start(e).chain(function(){this.filterAreaNode.eliminate("input");this.filterAreaNode.setStyle("display","none");this.filterAreaTipNode.setStyle("display","none");$(document.body).removeEvent("click",this.hideFilterFun)}.bind(this));$(document.body).removeEvent("click",this.hideFilterFun)}},createFilterAreaNode:function(){this.filterAreaNode=new Element("div",{styles:this.css.filterAreaNode}).inject(this.app.content);this.filterAreaNode.addEvent("click",function(e){e.stopPropagation()});this.filterAreaTipNode=new Element("div",{styles:this.css.filterAreaTipNode}).inject(this.app.content);this.filterAreaNode.setStyles({width:"460px",height:"0px"});this.filterAreaNode.position({relativeTo:this.filterNode,position:"bottomRight",edge:"upperRight",offset:{x:-20,y:-1}});this.filterAreaTipNode.position({relativeTo:this.filterNode,position:"bottomRight",edge:"bottomRight",offset:{x:-38,y:0}});this.app.addEvent("resize",function(){this.resizeFilterAreaNode()}.bind(this));this.filterAreaMorph=new Fx.Morph(this.filterAreaNode,{duration:"100",transition:Fx.Transitions.Sine.easeInOut})},resizeFilterAreaNode:function(){if(this.filterAreaNode){this.filterAreaNode.position({relativeTo:this.filterNode,position:"bottomRight",edge:"upperRight",offset:{x:-20,y:-1}});if(this.filterAreaTipNode){this.filterAreaTipNode.position({relativeTo:this.filterNode,position:"bottomRight",edge:"bottomRight",offset:{x:-38,y:0}})}}},createFilterAreaTitle:function(){var e=new Element("div",{styles:this.css.filterAreaTitleNode}).inject(this.filterAreaNode);var t=new Element("div",{styles:this.css.filterAreaTitleActionOkNode,text:this.app.lp.ok}).inject(e);var i=new Element("div",{styles:this.css.filterAreaTitleActionClearNode,text:this.app.lp.clear}).inject(e);i.addEvent("click",function(){this.filterAreaNode.getElements(".filterItem").each(function(e){this.unSelectedFilterItem(e)}.bind(this));var e=this.filterAreaNode.retrieve("input");e.set("value","");this.filter=null;this.hideFilter();this.setFilterConditions();this.explorer.reloadElementContent()}.bind(this));t.addEvent("click",function(){var e=this.filterAreaNode.retrieve("input");if(!this.filter)this.filter={};var t=e.get("value");if(t&&t!=this.app.lp.searchKey){this.filter.key=t}else{this.filter.key="";delete this.filter.key}this.hideFilter();this.setFilterConditions();this.explorer.reloadElementContent()}.bind(this));var s=new Element("div",{styles:this.css.filterAreaTitleSearchNode}).inject(e);var o=new Element("div",{styles:this.css.filterAreaTitleSearchIconNode}).inject(s);var n=new Element("div",{styles:this.css.filterAreaTitleSearchInputAreaNode}).inject(s);var r=new Element("input",{styles:this.css.filterAreaTitleSearchInputNode,value:this.app.lp.searchKey}).inject(n);if(this.filter){if(this.filter.key)r.set("value",this.filter.key)}this.filterAreaNode.store("input",r);var a=this.app.lp.searchKey;r.addEvents({blur:function(){if(!this.get("value"))this.set("value",a)},focus:function(){if(this.get("value")==a)this.set("value","")},keydown:function(e){if(e.code==13){var t=this.filterAreaNode.retrieve("input");if(!this.filter)this.filter={};var i=t.get("value");if(i&&i!=this.app.lp.searchKey){this.filter.key=i}else{this.filter.key="";delete this.filter.key}this.hideFilter();this.setFilterConditions();this.explorer.reloadElementContent()}}.bind(this)})},createFilterAreaContent:function(){var e=new Element("div",{styles:this.css.applicationFilterAreaContentScrollNode}).inject(this.filterAreaNode);var o=new Element("div",{styles:{overflow:"hidden"}}).inject(e);MWF.require("MWF.widget.ScrollBar",function(){new MWF.widget.ScrollBar(e,{style:"xApp_filter",where:"after",distance:30,friction:4,axis:{x:false,y:true}})}.bind(this));var n=this;this._getFilterCount(function(e){Object.each(e,function(e,i){var t=new Element("div",{styles:this.css.applicationFilterCategoryNode}).inject(o);t.set("text",e.name);var s=new Element("div",{styles:this.css.applicationFilterItemAreaNode}).inject(o);e.data.each(function(e){var t=new Element("div",{styles:this.css.applicationFilterItemNode}).inject(s);t.set("text",e.name+"("+e.count+")");t.store("value",e.value);t.store("textname",e.name);t.store("key",i);t.store("resultItemName",e.resultItemName);t.addEvent("click",function(){if(this.hasClass("applicationFilterItemNode_over")){n.unSelectedFilterItem(this)}else{n.selectedFilterItem(this)}});if(this.filter){if(this.filter[i]){if(e.value==this.filter[i][0].value){this.selectedFilterItem(t)}}}}.bind(this))}.bind(this))}.bind(this))},_getFilterCount:function(t){var e="listCategoryDraftFilterAttribute";if(this.explorer.options.status=="published"){e="listCategoryPublishFilterAttribute"}else if(this.explorer.options.status=="archived"){e="listCategoryArchiveFilterAttribute"}this.actions[e](this.explorer.categoryData.id,function(e){this.filterAttribute={};Object.each(e.data,function(e,t){var i=this.filterSetting[t];if(i){var s=this.filterAttribute[i.resultListKey]={name:i.categoryTitle,data:[]};e.each(function(e){s.data.push({name:e[i.itemNameKey],value:e[i.itemValueKey],count:e.count,resultItemName:i.resultItemName})})}}.bind(this));if(t)t(this.filterAttribute)}.bind(this))},unSelectedFilterItem:function(e){if(e.hasClass("applicationFilterItemNode_over")){var t=e.retrieve("value");var i=e.retrieve("textname");var s=e.retrieve("key");e.setStyles(this.css.applicationFilterItemNode);e.removeClass("applicationFilterItemNode_over");e.addClass("applicationFilterItemNode");if(!this.filter)this.filter={};this.filter[s]=null;delete this.filter[s];e.getParent().eliminate("current")}},selectedFilterItem:function(e){if(!e.hasClass("applicationFilterItemNode_over")){var t=e.getParent().retrieve("current");if(t)this.unSelectedFilterItem(t);var i=e.retrieve("value");var s=e.retrieve("key");var o=e.retrieve("textname");var n=e.retrieve("resultItemName");e.setStyles(this.css.applicationFilterItemNode_over);e.removeClass("applicationFilterItemNode");e.addClass("applicationFilterItemNode_over");if(!this.filter)this.filter={};this.filter[s]=[{value:i,name:o,resultItemName:n}];e.getParent().store("current",e)}},searchElement:function(){if(!this.filter)this.filter={};var e=this.searchElementInputNode.get("value");if(e&&e!=this.app.lp.searchKey){this.filter.key=e;this.hideFilter();this.setFilterConditions();this.explorer.reloadElementContent()}},setFilterConditions:function(){this.filterConditionNode.empty();if(this.filter){Object.each(this.filter,function(e,t){if(t!="key"){this.createFilterItemNode(t,e[0])}}.bind(this));if(this.filter.key){this.createFilterItemNode("key",{name:this.filter.key})}}},createFilterItemNode:function(e,t){var i=this;var s=new Element("div",{styles:this.css.filterListItemNode}).inject(this.filterConditionNode);var o=new Element("div",{styles:this.css.filterListItemActionNode}).inject(s);var n=new Element("div",{styles:this.css.filterListItemTextNode}).inject(s);if(e!="key"){n.set("text",this.filterAttribute[e].name+": "+t.name)}else{n.set("text",this.filterSetting.key.categoryTitle+": "+t.name)}o.store("key",e);s.addEvents({mouseover:function(){this.setStyles(i.css.filterListItemNode_over);this.getLast().setStyles(i.css.filterListItemTextNode_over);this.getFirst().setStyles(i.css.filterListItemActionNode_over)},mouseout:function(){this.setStyles(i.css.filterListItemNode);this.getLast().setStyles(i.css.filterListItemTextNode);this.getFirst().setStyles(i.css.filterListItemActionNode)}});o.addEvent("click",function(){var e=this.retrieve("key");if(i.filter[e])i.filter[e]=null;delete i.filter[e];this.destroy();i.setFilterConditions();i.explorer.reloadElementContent()})},getFilterResult:function(){var i={};Object.each(this.filter,function(e,t){if(t=="key"&&this.filterSetting.key){i[this.filterSetting.key.resultListKey]=[{name:this.filterSetting.key.resultItemName,value:e}]}else{i[t]=[{name:e[0].resultItemName,value:e[0].value}]}}.bind(this));return i}});MWF.xApplication.cms.Module.ListExplorer.DefaultDocument=new Class({initialize:function(e,t,i,s){this.explorer=i;this.app=i.app;this.data=t;this.container=e;this.view=s;this.css=this.explorer.css;this.load()},load:function(){this.node=new Element("tr",{styles:this.css.documentItemNode});this.node.inject(this.container);this.view.listItemTemplate.each(function(e){var t=true;if(e.access){if(e.access=="admin"&&!this.explorer.options.isAdmin){t=false}}if(t){this[e.name]=new Element("td",{styles:this.css[e.contentStyles],text:this.data[e.item]?this.data[e.item]:""}).inject(this.node)}}.bind(this));this.setActions();this.setEvents()},setEvents:function(){this.node.addEvents({mouseover:function(){if(!this.readyRemove)this.node.setStyles(this.css.documentItemDocumentNode_over)}.bind(this),mouseout:function(){if(!this.readyRemove)this.node.setStyles(this.css.documentItemDocumentNode)}.bind(this),click:function(e){this.openDocument(e)}.bind(this)});if(this.setTopNode){this.setTopNode.addEvents({mouseover:function(){this.setTopNode.setStyles(this.css.actionSetTopNode_over)}.bind(this),mouseout:function(){this.setTopNode.setStyles(this.css.actionSetTopNode)}.bind(this),mousedown:function(){this.setTopNode.setStyles(this.css.actionSetTopNode_down)}.bind(this),mouseup:function(){this.setTopNode.setStyles(this.css.actionSetTopNode_over)}.bind(this),click:function(e){this.setTop(e);e.stopPropagation()}.bind(this)})}if(this.shareNode){this.shareNode.addEvents({mouseover:function(){this.shareNode.setStyles(this.css.actionShareNode_over)}.bind(this),mouseout:function(){this.shareNode.setStyles(this.css.actionShareNode)}.bind(this),mousedown:function(){this.shareNode.setStyles(this.css.actionShareNode_down)}.bind(this),mouseup:function(){this.shareNode.setStyles(this.css.actionShareNode_over)}.bind(this),click:function(e){this.share(e);e.stopPropagation()}.bind(this)})}if(this.openNode){this.openNode.addEvents({mouseover:function(){this.openNode.setStyles(this.css.actionOpenNode_over)}.bind(this),mouseout:function(){this.openNode.setStyles(this.css.actionOpenNode)}.bind(this),mousedown:function(){this.openNode.setStyles(this.css.actionOpenNode_down)}.bind(this),mouseup:function(){this.openNode.setStyles(this.css.actionOpenNode_over)}.bind(this),click:function(e){this.openDocument(e);e.stopPropagation()}.bind(this)})}if(this.deleteNode){this.deleteNode.addEvents({mouseover:function(){this.deleteNode.setStyles(this.css.actionDeleteNode_over)}.bind(this),mouseout:function(){this.deleteNode.setStyles(this.css.actionDeleteNode)}.bind(this),mousedown:function(){this.deleteNode.setStyles(this.css.actionDeleteNode_down)}.bind(this),mouseup:function(){this.deleteNode.setStyles(this.css.actionDeleteNode_over)}.bind(this),click:function(e){this.remove(e);e.stopPropagation()}.bind(this)})}if(this.editNode){this.editNode.addEvents({mouseover:function(){this.editNode.setStyles(this.css.actionEditNode_over)}.bind(this),mouseout:function(){this.editNode.setStyles(this.css.actionEditNode)}.bind(this),mousedown:function(){this.editNode.setStyles(this.css.actionEditNode_down)}.bind(this),mouseup:function(){this.editNode.setStyles(this.css.actionEditNode_over)}.bind(this),click:function(e){this.openDocument(e,true);e.stopPropagation()}.bind(this)})}},setActions:function(){if(this.actionAreaNode){if(this.explorer.options.isAdmin){this.deleteNode=new Element("div",{styles:this.css.actionDeleteNode,title:this.explorer.app.lp["delete"]}).inject(this.actionAreaNode);this.editNode=new Element("div",{styles:this.css.actionEditNode,title:this.explorer.app.lp.edit}).inject(this.actionAreaNode)}}},openDocument:function(e,t){var i="cms.Document"+this.data.id;if(this.app.desktop.apps[i]){this.app.desktop.apps[i].setCurrent()}else{var s={documentId:this.data.id,appId:i,readonly:!t,postDelete:function(){this.view.reload()}.bind(this)};this.explorer.app.desktop.openApplication(e,"cms.Document",s)}},remove:function(e){var t=this.explorer.app.lp;var i=t.deleteDocument.replace(/{title}/g,this.data.title);var s=this;this.node.setStyles(this.css.documentItemDocumentNode_remove);this.readyRemove=true;this.explorer.app.confirm("warn",e,t.deleteDocumentTitle,i,350,120,function(){s.view.removeDocument(s,false);this.close()},function(){s.node.setStyles(s.css.documentItemDocumentNode);s.readyRemove=false;this.close()})},destroy:function(){this.node.destroy()},setPersonData:function(){var e={actions:this.explorer.personActions,app:{lp:this.explorer.app.lp}};new MWF.widget.O2Identity({name:this.data.creatorIdentity},this.personAreaNode,{style:"work"})}});MWF.xApplication.cms.Module.ListExplorer.Document=new Class({Extends:MWF.xApplication.cms.Module.ListExplorer.DefaultDocument,load:function(){this.node=new Element("tr",{styles:this.css.documentItemNode}).inject(this.container);this.view.data.content.columns.each(function(e){var t=e.value&&e.value!=""?this.data.document[e.value]||this.data.data[e.value]||"":"";if(typeOf(t)=="array"){var i=[];t.each(function(e){if(typeOf(e)=="object"){if(e.name){i.push(e.name)}}else if(typeOf(e)=="string"){i.push(e)}else if(typeOf(e)=="array"){i.push(e.join(","))}else{i.push(e.toString())}});t=i.join(",")}var s=new Element("td",{styles:this.css.normalTdNode,text:t}).inject(this.node);if(e.align&&e!="center"){if(e.align=="left"){s.setStyle("text-align","left")}else if(e.align=="right"){s.setStyle("text-align","right")}}if(e.operation){if(this.explorer.options.isAdmin){if(e.operation.deleteDocument){this.deleteNode=new Element("div",{styles:this.css.actionDeleteNode,title:this.explorer.app.lp["delete"]}).inject(s)}if(e.operation.editDocument){this.editNode=new Element("div",{styles:this.css.actionEditNode,title:this.explorer.app.lp.edit}).inject(s)}}if(e.operation.share){this.shareNode=new Element("div",{styles:this.css.actionShareNode,title:this.explorer.app.lp.share}).inject(s)}}}.bind(this));this.setEvents()}});