MWF.xApplication.cms.FormDesigner.Module=MWF.xApplication.cms.FormDesigner.Module||{};MWF.xDesktop.requireApp("process.FormDesigner","Module.Form",null,false);MWF.xDesktop.requireApp("cms.FormDesigner","Property",null,false);MWF.xApplication.cms.FormDesigner.Module.Form=MWF.CMSFCForm=new Class({Extends:MWF.FCForm,options:{style:"default",propertyPath:"/x_component_cms_FormDesigner/Module/Form/form.html",mode:"PC"},initialize:function(e,t,s){this.setOptions(s);this.path="/x_component_process_FormDesigner/Module/Form/";this.cssPath="/x_component_process_FormDesigner/Module/Form/"+this.options.style+"/css.wcss";this._loadCss();this.container=null;this.form=this;this.moduleType="form";this.moduleList=[];this.moduleNodeList=[];this.moduleContainerNodeList=[];this.moduleElementNodeList=[];this.moduleComponentNodeList=[];this.dataTemplate={};this.designer=e;this.container=t;this.selectedModules=[]},loadStylesList:function(t){var e="/x_component_cms_FormDesigner/Module/Form/template/"+(this.options.mode=="Mobile"?"styles":"styles")+".json";MWF.getJSON(e,{onSuccess:function(e){this.stylesList=e;if(t)t(this.stylesList)}.bind(this),onRequestFailure:function(){this.stylesList={};if(t)t(this.stylesList)}.bind(this),onError:function(){this.stylesList={};if(t)t(this.stylesList)}.bind(this)})},loadModule:function(e,t,s){if(MWF["CMSFC"+e.type]){var i=new MWF["CMSFC"+e.type](this);i.load(e,t,s);return i}else{var i=new MWF["CMSFCDiv"](this);i.load(e,t,s);return i}},createModule:function(i,o){var n="CMSFC";this.getTemplateData(i,function(e){var t=Object.clone(e);var s=new MWF[n+i](this);s.create(t,o)}.bind(this))},getTemplateData:function(s,i){if(this.dataTemplate[s]){if(i)i(this.dataTemplate[s])}else{var e=MWF.CMSFD.ResetTemplateModules.indexOf(s.toLowerCase())!=-1?"x_component_cms_FormDesigner":"x_component_process_FormDesigner";var t="/"+e+"/Module/"+s+"/template.json";MWF.getJSON(t,function(e,t){this.dataTemplate[s]=e;if(i)i(e)}.bind(this))}},showProperty:function(){if(!this.property){this.property=new MWF.xApplication.cms.FormDesigner.Property(this,this.designer.propertyContentArea,this.designer,{path:this.options.propertyPath,onPostLoad:function(){this.property.show()}.bind(this)});this.property.load()}else{this.property.show()}},save:function(e){this.designer.saveForm()},preview:function(){MWF.xDesktop.requireApp("cms.FormDesigner","Preview",function(){if(this.options.mode=="Mobile"){this.previewBox=new MWF.xApplication.cms.FormDesigner.Preview(this,{size:{x:"340",y:580}})}else{this.previewBox=new MWF.xApplication.cms.FormDesigner.Preview(this)}this.previewBox.load()}.bind(this))}});