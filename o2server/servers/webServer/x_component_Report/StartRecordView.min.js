MWF.xDesktop.requireApp("Template","Explorer",null,false);MWF.xDesktop.requireApp("Template","MForm",null,false);MWF.xDesktop.requireApp("Template","MSelector",null,false);MWF.xApplication.Report.StartRecordView=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],options:{style:"default",action:""},initialize:function(e,t,i){this.setOptions(i);this.path="/x_component_Report/$StartRecordView/";this.cssPath="/x_component_Report/$StartRecordView/"+this.options.style+"/css.wcss";this._loadCss();this.app=t;this.container=$(e);this.load()},load:function(){this.node=new Element("div",{styles:this.css.node}).inject(this.container);this.contentAreaNode=new Element("div.contentAreaNode",{styles:this.css.contentAreaNode}).inject(this.node);this.contentNode=new Element("div.contentNode",{styles:this.css.contentNode}).inject(this.contentAreaNode);this.filterNode=new Element("div.filterNode",{styles:this.css.filterNode}).inject(this.contentNode);this.viewNode=new Element("div.viewNode",{styles:this.css.viewNode}).inject(this.contentNode);this.resetNodeSizeFun=this.resetNodeSize.bind(this);this.app.addEvent("resize",this.resetNodeSizeFun);this.loadFilter();this.loadView();this.resetNodeSize()},resetNodeSize:function(){var e=this.container.getSize();var t=e.y-120;if(!this.app.inContainer)this.viewNode.setStyle("height",""+t+"px");var i=this.app.sideBar?this.app.sideBar.getSize():{x:0,y:0};this.contentAreaNode.setStyle("margin-right",i.x+"px")},loadFilter:function(e,t){this.yearSelectorArea=new Element("div",{styles:this.css.yearSelectorArea}).inject(this.filterNode);this.selector=new MWF.xApplication.Report.StartRecordView.YearSelect(this.yearSelectorArea,{onSelectItem:function(e,t){this.loadView()}.bind(this)},this.app);this.selector.load()},loadView:function(){if(this.currentView)this.currentView.destroy();this.currentView=new MWF.xApplication.Report.StartRecordView.View(this.viewNode,this.app,this,{year:this.selector.getValue()||(new Date).getFullYear(),templateUrl:this.path+this.options.style+"/listItem.json"});this.currentView.load()},hide:function(){var e=new Fx.Morph(this.node,{duration:"300",transition:Fx.Transitions.Expo.easeOut});e.start({opacity:0}).chain(function(){this.node.setStyle("display","none")}.bind(this))},show:function(){this.node.setStyles(this.css.node);var e=new Fx.Morph(this.node,{duration:"800",transition:Fx.Transitions.Expo.easeOut});this.app.fireAppEvent("resize");e.start({opacity:1,left:"0px"}).chain(function(){this.node.setStyles({position:"static",width:"auto"})}.bind(this))},reload:function(){this.app.reload()},recordStatus:function(){var e="";if(this.currentNavi)e=this.currentNavi.retrieve("action");return{action:e}},destroy:function(){if(this.currentView){this.currentView.destroy()}this.app.removeEvent("resize",this.resetNodeSizeFun);this.node.destroy()}});MWF.xApplication.Report.StartRecordView.YearSelect=new Class({Extends:MSelector,options:{style:"default",width:"230px",height:"30px",textField:"text",valueField:"value",emptyOptionEnable:false,value:(new Date).getFullYear().toString()},_selectItem:function(e,t){},_loadData:function(e){var t=[];var i=new Date;i.decrement("year",5);for(var o=0;o<11;o++){i.increment("year",1);t.push({text:i.getFullYear(),value:i.getFullYear().toString()})}if(e)e(t)}});MWF.xApplication.Report.StartRecordView.View=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexView,options:{scrollEnable:true,scrollType:"window"},_createDocument:function(e,t){return new MWF.xApplication.Report.StartRecordView.Document(this.viewNode,e,this.explorer,this,null,t)},_getCurrentPageData:function(t,e){this.actions.listStartProfileByYear(this.options.year,function(e){if(!e.data)e.data=[];if(t)t(e)})},_removeDocument:function(e,t){this.actions.deleteStartProfile(e.id,function(e){this.reload();this.app.notice(this.app.lp.deleteStartRecordOK,"success")}.bind(this))},_create:function(){},_openDocument:function(e,t){},_queryCreateViewNode:function(){},_postCreateViewNode:function(e){},_queryCreateViewHead:function(){},_postCreateViewHead:function(e){}});MWF.xApplication.Report.StartRecordView.Document=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexDocument,_queryCreateDocumentNode:function(e){},_postCreateDocumentNode:function(e,t){if(this.index%2==1){e.setStyle("background-color","#f0f0f0")}},open:function(e){},edit:function(){},remove:function(e){var t=this.app.lp;var i=this.data.reportYear+"年"+this.data.reportMonth+"月";var o=t.deleteStartRecord.replace(/{title}/g,i).replace(/{count}/g,this.data.createDocumentCount);var n=this;this.node.setStyles(this.css.listViewTableTr_remove);this.readyRemove=true;this.view.lockNodeStyle=true;this.app.confirm("warn",e,t.deleteStartRecordTitle,o,350,120,function(){n.view._removeDocument(n.data,false);n.view.lockNodeStyle=false;this.close()},function(){n.node.setStyles(n.css.listViewTableTr);e.setStyles(n.css.actionDeleteNode);n.readyRemove=false;n.view.lockNodeStyle=false;this.close()})},mouseoverDocument:function(){this.node.setStyle("background-color","#fff7eb")},mouseoutDocument:function(){if(this.index%2==1){this.node.setStyle("background-color","#f0f0f0")}else{this.node.setStyle("background-color","#fff")}}});