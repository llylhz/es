MWF.xApplication.Report.StrategyExplorer.Print=new Class({Implements:[Options,Events],options:{style:"default",isEdited:false,status:""},initialize:function(t,e,i,s){this.setOptions(s);this.container=t;this.explorer=e;this.app=this.explorer.app;this.lp=this.app.lp;this.css=this.explorer.css;this.actions=this.app.restActions;this.data=i;this.path="/x_component_Report/$StrategyExplorer/"},load:function(){if(this.data.detail.opinions){var t=JSON.parse(this.data.detail.opinions);if(typeOf(t)=="array"){this.loadOpinion()}}this._load()},loadOpinion:function(){var t=new Element("table",{width:"96%",border:"0",cellpadding:"5",cellspacing:"0",styles:this.css.formTable}).inject(this.explorer.ideaContainer);var e=new Element("tr").inject(t);var i=new Element("td",{styles:this.css.formTableTitle,text:"领导意见"}).inject(e);i.setStyle("width","14%");var i=new Element("td",{styles:this.css.formTableValue}).inject(e);var s=this.data.detail.opinions;if(s){var n=JSON.parse(s);if(typeOf(n)=="array"){var a=new Element("div").inject(i);n.each(function(t){var e=new Element("table",{width:"100%",border:"0",cellpadding:"0",cellspacing:"0"}).inject(a);var i=new Element("tr").inject(e);var s=new Element("td",{text:t.identity.split("@")[0]+":"}).inject(i);s.setStyle("width","50px");s=new Element("td",{text:(t.content?this.app.common.replaceWithBr(t.content):"已阅")+"      ("+t.datetime+")"}).inject(i)}.bind(this))}}},_load:function(){this.month=parseInt(this.data.month);var t=this.table=new Element("table",{width:"100%",border:"0",cellpadding:"5",cellspacing:"0",styles:this.css.formTable}).inject(this.explorer.totalContainer);var e=new Element("tr").inject(t);new Element("td",{rowspan:2,width:"30",styles:this.css.formTableTitle,text:"序号"}).inject(e);new Element("td",{colspan:3,text:this.data.year+"年"+parseInt(this.data.month)+"月工作总结",styles:this.css.formTableTitle}).inject(e);var i=new Date(this.data.year,this.data.month,1).increment("month",1);var s=i.getFullYear()+"年"+i.getMonth()+"月工作计划";new Element("td",{colspan:2,text:s,styles:this.css.formTableTitle}).inject(e);new Element("td",{rowspan:2,width:"200",text:"服务客户",styles:this.css.formTableTitle}).inject(e);new Element("td",{rowspan:2,width:"200",text:"关爱员工",styles:this.css.formTableTitle}).inject(e);new Element("td",{rowspan:2,width:"200",text:"意见建议",styles:this.css.formTableTitle}).inject(e);var e=new Element("tr").inject(t);new Element("td",{text:"部门重点工作",width:"200",styles:this.css.formTableTitle}).inject(e);new Element("td",{text:"计划",width:"200",styles:this.css.formTableTitle}).inject(e);new Element("td",{text:"总结",width:"200",styles:this.css.formTableTitle}).inject(e);new Element("td",{text:"部门重点工作",width:"200",styles:this.css.formTableTitle}).inject(e);new Element("td",{text:"计划",width:"200",styles:this.css.formTableTitle}).inject(e);this.loadContent()},loadContent:function(){var t=this.getTableData();t.each(function(t,e){var i=new Element("tr").inject(this.table);new Element("td",{text:t.sequence,align:"center",styles:this.css.formTableValue}).inject(i);var s=new Element("td",{valign:"top",html:this.app.common.replaceWithBr(t.thisMonth.title),styles:this.css.formTableValue}).inject(i);if(t.thisMonth.measuresList.length){var n=new Element("input",{type:"button",styles:this.css.showMeasureNode2,value:"查看举措"}).inject(s);var a=new MWF.xApplication.Report.ShowMeasureTooltip(this.app.content,n,this.app,this.data,{style:"report",position:{x:"auto",y:"auto"},event:"click"});a.measuresList=t.thisMonth.measuresList}new Element("td",{valign:"top",html:this.app.common.replaceWithBr(t.thisMonth.plan),styles:this.css.formTableValue}).inject(i);s=new Element("td",{valign:"top",styles:this.css.formTableValue}).inject(i);if(this.options.status=="deployment"){}else if(this.options.status=="write"){var l=new Element("div").inject(s);this.loadThisMontWorkProg(l,e,false)}else if(this.options.status=="confirm"){s.set("html",this.app.common.replaceWithBr(t.thisMonth.prog))}else if(this.options.status=="audit"){s.set("html",this.app.common.replaceWithBr(t.thisMonth.prog))}else if(this.options.status=="summary"){s.set("html",this.app.common.replaceWithBr(t.thisMonth.prog))}if(this.options.status=="confirm"||this.options.status=="audit"){if(t.nextMonth.measuresList.length){var n=new Element("input",{type:"button",styles:this.css.showMeasureNode2,value:"查看举措"}).inject(s);var a=new MWF.xApplication.Report.ShowMeasureTooltip(this.app.content,n,this.app,this.data,{style:"report",position:{x:"auto",y:"auto"},event:"click"});a.measuresList=t.nextMonth.measuresList}}s=new Element("td",{valign:"top",styles:this.css.formTableValue}).inject(i);if(this.options.status=="deployment"){}else if(this.options.status=="write"){var l=new Element("div").inject(s);this.loadNextMontWorkTitle(l,e,false)}else if(this.options.status=="confirm"){s.set("html",this.app.common.replaceWithBr(t.nextMonth.title))}else if(this.options.status=="audit"){s.set("html",this.app.common.replaceWithBr(t.nextMonth.title))}else if(this.options.status=="summary"){s.set("html",this.app.common.replaceWithBr(t.nextMonth.title))}s=new Element("td",{valign:"top",styles:this.css.formTableValue}).inject(i);if(this.options.status=="deployment"){}else if(this.options.status=="write"){var l=new Element("div").inject(s);this.loadNextMontWorkPlan(l,e,false)}else if(this.options.status=="confirm"){s.set("html",this.app.common.replaceWithBr(t.nextMonth.plan))}else if(this.options.status=="audit"){s.set("html",this.app.common.replaceWithBr(t.nextMonth.plan))}else if(this.options.status=="summary"){s.set("html",this.app.common.replaceWithBr(t.nextMonth.plan))}this.loadExtTd(t,i,e,"fuwu");this.loadExtTd(t,i,e,"guanai");this.loadExtTd(t,i,e,"yijian")}.bind(this))},loadExtTd:function(t,e,i,s){var n;if(this.options.status=="deployment"){n=new Element("td",{valign:"top",styles:this.css.formTableValue}).inject(e)}else if(this.options.status=="write"){n=new Element("td",{valign:"top",styles:this.css.formTableValue}).inject(e);this.loadExtWork_write(n,false,s,i)}else if(this.options.status=="confirm"){n=new Element("td",{valign:"top",styles:this.css.formTableValue}).inject(e);n.set("html",this.app.common.replaceWithBr(t.extWork[s]))}else if(this.options.status=="audit"){n=new Element("td",{valign:"top",styles:this.css.formTableValue}).inject(e);n.set("html",this.app.common.replaceWithBr(t.extWork[s]))}else if(this.options.status=="summary"){n=new Element("td",{valign:"top",styles:this.css.formTableValue}).inject(e);n.set("html",this.app.common.replaceWithBr(t.extWork[s]))}},loadExtWork_write:function(t,e,s,i){var n;if(!this.ExtWorkData){var a=this.ExtWorkData=this.data.WoReport_I_Ext_Contents||[];this.ExtWorkObject={};a.sort(function(t,e){var i=t.targetPerson.localeCompare(e.targetPerson);if(i==0){return t.orderNumber-e.orderNumber}else{return i}});a.each(function(t){if(!this.ExtWorkObject[t.orderNumber]){this.ExtWorkObject[t.orderNumber]=[]}this.ExtWorkObject[t.orderNumber].push(t)}.bind(this))}n=new Element("table",{width:"100%",border:"0",cellpadding:"3",cellspacing:"0"}).inject(t);if(this.ExtWorkObject[i+1]){this.ExtWorkObject[i+1].each(function(t){if(t[s]){var e=new Element("tr").inject(n);new Element("td",{width:"40",text:t.targetPerson.split("@")[0]+":"}).inject(e);var i=new Element("td",{}).inject(e);i.set("html",this.app.common.replaceWithBr(t[s]))}}.bind(this))}if(e&&n){var n=new Element("table",{width:"100%",border:"0",cellpadding:"3",cellspacing:"0",styles:this.css.formTable}).inject(t);this.data.WoReport_I_Ext_Contents_sumamry.each(function(t){if(t[s]){var e=new Element("tr").inject(n);new Element("td",{width:"40",text:"汇总:"}).inject(e);var i=new Element("td",{}).inject(e);i.set("html",this.app.common.replaceWithBr(t[s]))}}.bind(this))}},loadThisMontWorkProg:function(t,e,i){var s;debugger;var n=this.data.thisMonth_workList[e];if(n&&n.progList&&n.progList.length>0){s=new Element("table",{width:"100%",border:"0",cellpadding:"3",cellspacing:"0"}).inject(t);n.progList.each(function(t){if(t.progressContent){var e=new Element("tr").inject(s);new Element("td",{width:"40",text:t.targetPerson.split("@")[0]+":"}).inject(e);var i=new Element("td",{}).inject(e);i.set("html",this.app.common.replaceWithBr(t.progressContent))}}.bind(this))}if(i&&s){var a=new Element("tr").inject(s);new Element("td",{width:"40",text:"汇总:"}).inject(a);var l=new Element("td",{}).inject(a);l.set("html",this.app.common.replaceWithBr(n.workProgSummary))}},loadNextMontWorkTitle:function(t,e,i){var s=this.data.nextMonth_workList[e];var n;if(s&&s.planNextList&&s.planNextList.length>0){n=new Element("table",{width:"100%",border:"0",cellpadding:"3",cellspacing:"0",styles:this.css.formTable}).inject(t);s.planNextList.each(function(t){if(t.title){var e=new Element("tr").inject(n);new Element("td",{width:"40",text:t.targetPerson.split("@")[0]+":"}).inject(e);var i=new Element("td",{}).inject(e);i.set("html",this.app.common.replaceWithBr(t.title))}}.bind(this))}if(i&&n){var a=new Element("tr").inject(n);new Element("td",{width:"40",text:"汇总:"}).inject(a);var l=new Element("td",{}).inject(a);l.set("html",this.app.common.replaceWithBr(s.workTitle))}},loadNextMontWorkPlan:function(t,e,i){var s=this.data.nextMonth_workList[e];var n;if(s&&s.planNextList&&s.planNextList.length>0){n=new Element("table",{width:"100%",border:"0",cellpadding:"3",cellspacing:"0",styles:this.css.formTable}).inject(t);s.planNextList.each(function(t){if(t.planContent){var e=new Element("tr").inject(n);new Element("td",{width:"40",text:t.targetPerson.split("@")[0]+":"}).inject(e);var i=new Element("td",{}).inject(e);i.set("html",this.app.common.replaceWithBr(t.planContent))}}.bind(this))}if(i&&n){var a=new Element("tr").inject(n);new Element("td",{width:"40",text:"汇总:"}).inject(a);var l=new Element("td",{}).inject(a);l.set("html",this.app.common.replaceWithBr(s.workPlanSummary))}},getTableData:function(){this.tableData=[];for(var t=0;t<5;t++){var e=this.data.WoReport_I_Ext_Contents_sumamry?this.data.WoReport_I_Ext_Contents_sumamry[t]:null;var i=this.data.thisMonth_workList?this.data.thisMonth_workList[t]:null;var s=this.data.nextMonth_workList?this.data.nextMonth_workList[t]:null;var n={sequence:t+1,thisMonth:{title:i?i.workTitle:"",plan:i?i.workPlanSummary:"",prog:i?i.workProgSummary:"",measuresList:i?i.measuresList:[]},nextMonth:{title:s?s.workTitle:"",plan:s?s.workPlanSummary:"",measuresList:s?s.measuresList:[]},extWork:{fuwu:e?e.fuwu:"",guanai:e?e.guanai:"",yijian:e?e.yijian:""}};this.tableData.push(n)}return this.tableData}});