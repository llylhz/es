MWF.xDesktop.requireApp("process.ProcessManager","Explorer",null,false);MWF.xApplication.service.ServiceManager.AgentExplorer=new Class({Extends:MWF.xApplication.process.ProcessManager.Explorer,Implements:[Options,Events],options:{style:"default",tooltip:{create:MWF.xApplication.service.ServiceManager.LP.agent.create,search:MWF.xApplication.service.ServiceManager.LP.agent.search,searchText:MWF.xApplication.service.ServiceManager.LP.agent.searchText,noElement:MWF.xApplication.service.ServiceManager.LP.agent.noAgentNoticeText}},createTitleElementNode:function(){this.titleElementNode=new Element("div",{styles:this.css.titleElementNode,text:"代理配置"}).inject(this.toolbarNode)},_createElement:function(e){var t=this;var i={onQueryLoad:function(){this.actions=t.app.restActions;this.application=t.app.options.application;this.explorer=t}};this.app.desktop.openApplication(e,"service.AgentDesigner",i)},_loadItemDataList:function(e){this.app.restActions.listAgent(e)},_getItemObject:function(e){return new MWF.xApplication.service.ServiceManager.AgentExplorer.Agent(this,e)},deleteItems:function(){this.hideDeleteAction();while(this.deleteMarkItems.length){var e=this.deleteMarkItems.shift();if(this.deleteMarkItems.length){e.deleteAgent()}else{e.deleteAgent(function(){}.bind(this))}}}});MWF.xApplication.service.ServiceManager.AgentExplorer.Agent=new Class({Extends:MWF.xApplication.process.ProcessManager.Explorer.Item,createTextNodes:function(){var e=new Element("div",{styles:this.css.itemTextTitleNode,text:(this.data.enable?"":"(禁用)")+this.data.name,title:this.data.name,events:{click:function(e){this._open(e)}.bind(this)}}).inject(this.node);if(!this.data.enable){e.setStyle("color","#999")}new Element("div",{styles:this.css.itemTextDescriptionNode,text:this.data.description||"",title:this.data.description||""}).inject(this.node);new Element("div",{styles:this.css.itemTextDateNode,text:this.data.updateTime||""}).inject(this.node)},_open:function(e){var t=this;var i={onQueryLoad:function(){this.actions=t.explorer.actions;this.category=t;this.options.id=t.data.id}};this.explorer.app.desktop.openApplication(e,"service.AgentDesigner",i)},_getIcon:function(){var e=(Math.random()*49).toInt();return"process_icon_"+e+".png"},_getLnkPar:function(){return{icon:this.explorer.path+this.explorer.options.style+"/processIcon/lnk.png",title:this.data.name,par:'service.AgentDesigner#{"id": "'+this.data.id+'"}'}},deleteAgent:function(e){this.explorer.actions.deleteAgent(this.data.id,function(){this.node.destroy();if(e)e()}.bind(this))}});