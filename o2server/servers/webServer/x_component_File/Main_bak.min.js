MWF.require("MWF.xApplication.File.Actions.RestActions",null,false);MWF.require("MWF.xApplication.File.AttachmentController",null,false);MWF.xApplication.File.Main=new Class({Extends:MWF.xApplication.Common.Main,Implements:[Options,Events],options:{style:"default",name:"File",icon:"icon.png",width:"1000",height:"600",title:MWF.xApplication.File.LP.title},onQueryLoad:function(){this.lp=MWF.xApplication.File.LP},loadApplication:function(e){this.history=[];this.currentHistory=1;this.currentFolder=null;this.restActions=new MWF.xApplication.File.Actions.RestActions;MWF.getJSON("/x_component_File/$Main/icon.json",function(e){this.icons=e}.bind(this),false);this.createNode();this.loadApplicationContent();if(e)e()},createNode:function(){this.content.setStyle("overflow","hidden");this.node=new Element("div",{styles:{width:"100%",height:"100%",overflow:"hidden"}}).inject(this.content)},loadApplicationContent:function(){this.loadTop();this.fileContentNode=new Element("div",{styles:this.css.fileContentNode}).inject(this.node);this.folderContentNode=new Element("div",{styles:this.css.folderContentNode}).inject(this.fileContentNode);this.attachmentContentNode=new Element("div",{styles:this.css.attachmentContentNode}).inject(this.fileContentNode);this.resizeContentNode=new Element("div",{styles:this.css.resizeContentNode}).inject(this.folderContentNode);this.folderTreeAreaNode=new Element("div",{styles:this.css.folderTreeAreaNode}).inject(this.folderContentNode);this.folderTreeAreaScrollNode=new Element("div",{styles:this.css.folderTreeAreaScrollNode}).inject(this.folderContentNode);this.shareTreeAreaScrollNode=new Element("div",{styles:this.css.folderTreeAreaScrollNode}).inject(this.folderContentNode);this.loadFileContentAreaNode();this.loadFolderTreeNode();this.treeResize=new Drag(this.resizeContentNode,{snap:1,onStart:function(e,t){var i=t.event.clientX;var s=t.event.clientY;e.store("position",{x:i,y:s});var n=this.folderContentNode.getSize();e.store("initialWidth",n.x)}.bind(this),onDrag:function(e,t){var i=t.event.clientX;var s=this.content.getSize();var n=e.retrieve("position");var o=e.retrieve("initialWidth").toFloat();var l=i.toFloat()-n.x.toFloat();var d=o+l;if(d>s.x/2)d=s.x/2;if(d<160)d=160;this.attachmentContentNode.setStyle("margin-left",d);this.folderContentNode.setStyle("width",d)}.bind(this)});MWF.require("MWF.widget.Tab",function(){this.treeTab=new MWF.widget.Tab(this.folderTreeAreaNode,{style:"processlayout"});this.treeTab.load();this.fileTabe=this.treeTab.addTab(this.folderTreeAreaScrollNode,this.lp.myFiles,false);this.shareTab=this.treeTab.addTab(this.shareTreeAreaScrollNode,this.lp.shareFiles,false);this.fileTabe.showIm();this.setContentHeight();this.addEvent("resize",function(){this.setContentHeight()}.bind(this))}.bind(this));MWF.require("MWF.widget.ScrollBar",function(){new MWF.widget.ScrollBar(this.folderTreeAreaScrollNode,{style:"xApp_Organization_Explorer",where:"before",distance:100,friction:4,axis:{x:false,y:true}});new MWF.widget.ScrollBar(this.shareTreeAreaScrollNode,{style:"xApp_Organization_Explorer",where:"before",distance:100,friction:4,axis:{x:false,y:true}})}.bind(this))},loadTop:function(){this.topNode=new Element("div",{styles:this.css.topNode}).inject(this.node);this.leftNode=new Element("div",{styles:this.css.leftNode}).inject(this.topNode);this.leftNode.addEvent("click",function(){this.leftPath()}.bind(this));this.rightNode=new Element("div",{styles:this.css.rightNode}).inject(this.topNode);this.rightNode.addEvent("click",function(){this.rightPath()}.bind(this));this.refreshNode=new Element("div",{styles:this.css.refreshNode}).inject(this.topNode);this.searchNode=new Element("div",{styles:this.css.searchNode}).inject(this.topNode);this.pathNode=new Element("div",{styles:this.css.pathNode}).inject(this.topNode)},loadTools:function(){this.toolsNode=new Element("div",{styles:this.css.toolsNode}).inject(this.node);this.uploadNode=new Element("div",{styles:this.css.toolsActionNode,text:this.lp.upload}).inject(this.toolsNode);this.createFolderNode=new Element("div",{styles:this.css.toolsActionNode,text:this.lp.createFolder}).inject(this.toolsNode);this.operationNode=new Element("div",{styles:this.css.toolsMenuActionNode}).inject(this.toolsNode);var e=new Element("div",{styles:this.css.downTextNode,text:this.lp.operation}).inject(this.operationNode);var t=new Element("div",{styles:this.css.downIconNode}).inject(this.operationNode);this.uploadNode.addEvents({mouseover:function(){this.uploadNode.setStyles(this.css.toolsActionNode_over)}.bind(this),mouseout:function(){this.uploadNode.setStyles(this.css.toolsActionNode)}.bind(this),click:function(){this.createUploadFile()}.bind(this)});this.createFolderNode.addEvents({mouseover:function(){this.createFolderNode.setStyles(this.css.toolsActionNode_over)}.bind(this),mouseout:function(){this.createFolderNode.setStyles(this.css.toolsActionNode)}.bind(this),click:function(){this.createFolder()}.bind(this)});this.operationNode.addEvents({mouseover:function(){this.operationNode.setStyles(this.css.toolsMenuActionNode_over)}.bind(this),mouseout:function(){this.operationNode.setStyles(this.css.toolsMenuActionNode)}.bind(this),click:function(){}.bind(this)});this.operationMenu=new MWF.xDesktop.Menu(this.operationNode,{event:"click",style:"fileOperation",offsetX:-4,offsetY:4,onQueryShow:function(){this.operationMenu.items.each(function(e){e.setDisable(true)});if(this.selectedItem){if(this.selectedItem.type=="folder"){this.operationMenu.items[0].setText(this.lp.uploadTo+" "+this.selectedItem.data.name+"...");this.operationMenu.items[0].setDisable(false);this.operationMenu.items[3].setDisable(false);this.operationMenu.items[4].setDisable(false);this.operationMenu.items[7].setDisable(false)}if(this.selectedItem.type=="file"){this.operationMenu.items[0].setText(this.lp.uploadTo);this.operationMenu.items[0].setDisable(true);this.operationMenu.items[1].setDisable(false);this.operationMenu.items[3].setDisable(false);this.operationMenu.items[4].setDisable(false);this.operationMenu.items[5].setDisable(false);this.operationMenu.items[7].setDisable(false)}}}.bind(this)});this.operationMenu.load();var i=this.path+this.options.style+"/operation/upload.png";this.operationMenu.addMenuItem(this.lp.uploadTo,"click",function(){this.createUploadFile(this.selectedItem)}.bind(this),i);var i=this.path+this.options.style+"/operation/download.png";this.operationMenu.addMenuItem(this.lp.download,"click",function(){this.downloadCurrentFile()}.bind(this),i);this.operationMenu.addMenuLine();var i=this.path+this.options.style+"/operation/move.png";this.operationMenu.addMenuItem(this.lp.move,"click",function(){this.moveFileFolder()}.bind(this),i);var i=this.path+this.options.style+"/operation/rename.png";this.operationMenu.addMenuItem(this.lp.rename,"click",function(){this.renameFileFolder()}.bind(this),i);var i=this.path+this.options.style+"/operation/share.png";this.operationMenu.addMenuItem(this.lp.share,"click",function(){this.shareFile()}.bind(this),i);this.operationMenu.addMenuLine();var i=this.path+this.options.style+"/operation/delete.png";this.operationMenu.addMenuItem(this.lp["delete"],"click",function(e){this.deleteFileFolder(e)}.bind(this),i)},downloadCurrentFile:function(){if(this.selectedItem){if(this.selectedItem.type=="file"){this.selectedItem.open()}}},moveFileFolder:function(){},renameFileFolder:function(){this.content.mask({style:{opacity:.7,"background-color":"#999"}});var e=new Element("div",{styles:this.css.createFolderNode}).inject(this.content);e.position({relativeTo:this.node,position:"center"});var t=new Element("div",{styles:this.css.createFolderTitleNode,text:this.lp.rename}).inject(e);var i=new Element("div",{styles:this.css.createFolderInforNode,text:this.lp.inputName}).inject(e);var s=new Element("div",{styles:this.css.createFolderInputAreaNode}).inject(e);var n=new Element("input",{type:"text",styles:this.css.createFolderInputNode,value:this.selectedItem.data.name}).inject(s);var o=new Element("div",{styles:this.css.createFolderActionNode}).inject(e);var l=new Element("button",{styles:this.css.createFolderCancelButton,text:this.lp.cancel}).inject(o);var d=new Element("button",{styles:this.css.createFolderOkButton,text:this.lp.ok}).inject(o);l.addEvent("click",function(){this.content.unmask();e.destroy()}.bind(this));d.addEvent("click",function(){if(n.get("value")){this.selectedItem.data.name=n.get("value");if(this.selectedItem.type=="folder"){this.restActions.saveFolder(this.selectedItem.data,function(e){if(this.currentFolder){this.currentFolder.clickNode()}else{this.topTreeNode.clickNode()}this.selectedItem.treeNode.setText(this.selectedItem.data.name)}.bind(this))}else{this.restActions.updateAttachment(this.selectedItem.data,function(e){if(this.currentFolder){this.currentFolder.clickNode()}else{this.topTreeNode.clickNode()}}.bind(this))}e.destroy();this.content.unmask()}else{this.notice(this.lp.nameNotEmpty,"error",e)}}.bind(this))},deleteFileFolder:function(e){if(this.selectedItem){var t=this;var i=this.selectedItem.type=="folder"?this.lp.deleteFolderTitle:this.lp.deleteFileTitle;var s=this.selectedItem.type=="folder"?this.lp.deleteFolder:this.lp.deleteFile;var n=this.node.getSize();var o={event:{x:(n.x-300)/2,y:(n.y-120)/2}};this.confirm("infor",o,i,s+"（"+this.selectedItem.data.name+"）",300,120,function(){var e=function(){if(this.currentFolder){this.currentFolder.clickNode()}else{this.topTreeNode.clickNode()}};if(t.selectedItem.type=="folder"){t.selectedItem.treeNode.destroy();t.restActions.deleteFolder(t.selectedItem.data.id,e.bind(t))}else{t.restActions.deleteFile(t.selectedItem.data.id,e.bind(t))}this.close()},function(){this.close()})}},shareFile:function(){this.content.mask({style:{opacity:.7,"background-color":"#999"}});var e=new Element("div",{styles:this.css.createFolderNode}).inject(this.content);e.position({relativeTo:this.node,position:"center"});var t=new Element("div",{styles:this.css.createFolderTitleNode,text:this.lp.shareFile}).inject(e);var i=new Element("div",{styles:this.css.createFolderInforNode,text:this.lp.selectShareUser}).inject(e);var s=new Element("div",{styles:this.css.createFolderInputAreaNode}).inject(e);var n=new Element("input",{type:"text",readonly:true,styles:this.css.shareFileInputNode,value:this.selectedItem.data.shareList.join(", ")}).inject(s);n.addEvent("click",function(){MWF.require("MWF.xApplication.Organization.Selector.Person",function(){var e=new MWF.xApplication.Organization.Selector.Person(this.node,{names:this.selectedItem.data.shareList,onComplete:function(e){var t=[];e.each(function(e){t.push(e.data.name)});n.set("value",t.join(", "))}.bind(this)});e.load()}.bind(this))}.bind(this));var o=new Element("div",{styles:this.css.createFolderActionNode}).inject(e);var l=new Element("button",{styles:this.css.createFolderCancelButton,text:this.lp.cancel}).inject(o);var d=new Element("button",{styles:this.css.createFolderOkButton,text:this.lp.ok}).inject(o);l.addEvent("click",function(){this.content.unmask();e.destroy()}.bind(this));d.addEvent("click",function(){this.selectedItem.data.shareList=n.get("value").split(/,\s*/g);this.restActions.updateAttachment(this.selectedItem.data,function(e){if(n.get("value"))this.notice(this.lp.fileShareSuccess+n.get("value"),"success",this.content)}.bind(this));e.destroy();this.content.unmask()}.bind(this))},createUploadFile:function(e){if(!this.uploadFileAreaNode){this.uploadFileAreaNode=new Element("div");var t='<input name="file" multiple type="file"/>';this.uploadFileAreaNode.set("html",t);this.fileUploadNode=this.uploadFileAreaNode.getFirst();this.fileUploadNode.addEvent("change",function(){var t="";if(e){t=e.data.id}else{t=this.currentFolder&&this.currentFolder.data?this.currentFolder.data.id:""}var s=i.files;if(s.length){for(var n=0;n<s.length;n++){var o=s.item(n);var l=new FormData;l.append("file",o);l.append("name",o.name);l.append("folder",t);this.restActions.addAttachment(function(){if(this.currentFolder){this.currentFolder.clickNode()}else{this.topTreeNode.clickNode()}}.bind(this),null,l,o)}}}.bind(this))}var i=this.uploadFileAreaNode.getFirst();i.click()},createFolder:function(){this.content.mask({style:{opacity:.7,"background-color":"#999"}});var e=new Element("div",{styles:this.css.createFolderNode}).inject(this.content);e.position({relativeTo:this.node,position:"center"});var t=new Element("div",{styles:this.css.createFolderTitleNode,text:this.lp.createFolder}).inject(e);var i=new Element("div",{styles:this.css.createFolderInforNode,text:this.lp.inputFolderName}).inject(e);var s=new Element("div",{styles:this.css.createFolderInputAreaNode}).inject(e);var n=new Element("input",{type:"text",styles:this.css.createFolderInputNode}).inject(s);var o=new Element("div",{styles:this.css.createFolderActionNode}).inject(e);var l=new Element("button",{styles:this.css.createFolderCancelButton,text:this.lp.cancel}).inject(o);var d=new Element("button",{styles:this.css.createFolderOkButton,text:this.lp.ok}).inject(o);l.addEvent("click",function(){this.content.unmask();e.destroy()}.bind(this));d.addEvent("click",function(){if(n.get("value")){var t={name:n.get("value"),superior:this.currentFolder&&this.currentFolder.data?this.currentFolder.data.id:""};this.restActions.saveFolder(t,function(e){t.id=e.data.id;if(this.currentFolder){var e={data:[t]};this.createTreeNode(e,this.currentFolder);this.currentFolder.clickNode()}else{this.topTreeNode.clickNode()}}.bind(this));e.destroy();this.content.unmask()}else{this.notice(this.lp.folderNameNotEmpty,"error",e)}}.bind(this))},loadFolderTreeNode:function(){this.folderTreeNode=new Element("div",{styles:this.css.folderTreeNode}).inject(this.folderTreeAreaScrollNode);MWF.require("MWF.widget.Tree",function(){this.folderTree=new MWF.widget.Tree(this.folderTreeNode,{style:"file"});this.folderTree.load();var e={expand:false,title:"root",text:"root",action:function(e){this.recordHistory(e);this.expand(e,function(){this.loadSub(e)}.bind(this))}.bind(this),icon:"folder.png"};this.topTreeNode=this.folderTree.appendChild(e);this.topTreeNode.clickNode()}.bind(this))},createShareTreeNode:function(e){e.data.each(function(e){var t={expand:false,title:e.person+"("+e.count+")",text:e.person+"("+e.count+")",action:function(e){this.loadShareFile(e)}.bind(this),icon:"folder.png"};var i=this.shareTree.appendChild(t);i.data=e}.bind(this))},loadShareTreeNode:function(){this.shareTreeNode=new Element("div",{styles:this.css.folderTreeNode}).inject(this.shareTreeAreaScrollNode);MWF.require("MWF.widget.Tree",function(){this.shareTree=new MWF.widget.Tree(this.shareTreeNode,{style:"file"});this.shareTree.load();this.restActions.listShare(function(e){this.createShareTreeNode(e)}.bind(this),null,false)}.bind(this))},loadShareFile:function(e){var t=e.data.person;this.restActions.listShareAttachment(function(e){this.fileContentAreaNode.empty();e.data.each(function(e){new MWF.xApplication.File.ShareAttachment(e,this)}.bind(this))}.bind(this),null,t)},loadFileContentAreaNode:function(){this.controller=new MWF.xApplication.File.AttachmentController(this.attachmentContentNode,this,{resize:false,isSizeChange:false});this.controller.load()},createTreeNode:function(e,t){e.data.each(function(e){var i={expand:false,title:e.name,text:e.name,action:function(e){this.recordHistory(e);this.expand(e,function(){this.loadSub(e)}.bind(this))}.bind(this),icon:"folder.png"};var s=t.appendChild(i);s.data=e}.bind(this))},loadFolderTree:function(e,t){if(!e.loaded){if(e.data){this.restActions.listFolder(function(i){this.createTreeNode(i,e);e.setOperateIcon();if(t)t()}.bind(this),null,e.data.id,false)}else{this.restActions.listTopFolder(function(i){this.createTreeNode(i,e);e.setOperateIcon();if(t)t()}.bind(this),null,false)}e.loaded=true}else{if(t)t()}},setContentHeight:function(e){var t=this.node.getSize();var i=this.topNode.getSize();var s=this.topNode.getStyle("margin-top").toFloat();var n=this.topNode.getStyle("margin-bottom").toFloat();var o=this.fileContentNode.getStyle("margin-top").toFloat();var l=this.fileContentNode.getStyle("margin-bottom").toFloat();var d=t.y-i.y-s-n-o-l;this.fileContentNode.setStyle("height",d);this.attachmentContentNode.setStyle("height",d);var a=this.controller.topNode.getSize();var h=d-a.y;this.controller.contentScrollNode.setStyle("height",""+h+"px");var r=this.treeTab.tabNodeContainer.getSize();var d=d-r.y;this.folderTreeAreaScrollNode.setStyle("height",d);this.shareTreeAreaScrollNode.setStyle("height",d)},expand:function(e,t){if(!e.options.expand){this.loadFolderTree(e,function(){if(t)t()}.bind(this));this.folderTree.expand(e);e.options.expand=true;e.setOperateIcon()}else{if(t)t()}},checkHistory:function(){if(this.history.length>1){if(this.currentHistory>0){this.enabledLeftNode()}else{this.disabledLeftNode()}if(this.currentHistory<this.history.length-1){this.enabledRightNode()}else{this.disabledRightNode()}}else{this.disabledLeftNode();this.disabledRightNode()}},enabledLeftNode:function(){this.leftNode.setStyle("background-image","url("+"/x_component_File/$Main/default/icon/left_enabled.png)")},enabledRightNode:function(){this.rightNode.setStyle("background-image","url("+"/x_component_File/$Main/default/icon/right_enabled.png)")},disabledLeftNode:function(){this.leftNode.setStyle("background-image","url("+"/x_component_File/$Main/default/icon/left.png)")},disabledRightNode:function(){this.rightNode.setStyle("background-image","url("+"/x_component_File/$Main/default/icon/right.png)")},leftPath:function(){if(this.currentHistory>0){this.currentHistory--;var e=this.history[this.currentHistory];if(e){e.selectNode();this.loadSub(e);this.checkHistory()}}},rightPath:function(){if(this.currentHistory<this.history.length-1){this.currentHistory++;var e=this.history[this.currentHistory];if(e){e.selectNode();this.loadSub(e);this.checkHistory()}}},recordHistory:function(e){if(!this.history.length||this.history[this.history.length-1]!=e){this.history.push(e);this.currentHistory=this.history.length-1;this.checkHistory()}},setPathNode:function(e){this.pathNode.empty();var t=[];var i=e;while(i){t.unshift(i);i=i.parentNode}var s=this;t.each(function(e,i){this.expand(e);var n=new Element("div",{styles:this.css.pathItemNode,text:e.data?e.data.name:"root",events:{mouseover:function(){this.setStyles(s.css.pathItemNode_over)},mouseout:function(){this.setStyles(s.css.pathItemNode)},click:function(){e.clickNode()}}}).inject(this.pathNode);if(i<t.length-1)new Element("div",{styles:this.css.pathItemIconNode}).inject(this.pathNode)}.bind(this))},loadSub:function(e){this.setPathNode(e);this.controller.clear();e.children.each(function(e){this.controller.addAttachmentFolder(e.data)}.bind(this));this.currentFolder=e;if(e.data){this.restActions.listAttachment(function(e){e.data.each(function(e){this.controller.addAttachment(e)}.bind(this))}.bind(this),null,e.data.id)}else{this.restActions.listAttachmentTop(function(e){e.data.each(function(e){this.controller.addAttachment(e)}.bind(this))}.bind(this))}},uploadFiles:function(e){if(!this.uploadFileList)this.uploadFileList=[];if(!this.uploadFileTotalSize)this.uploadFileTotalSize=0;if(!e||!e.length)return;for(var t=0;t<e.length&&t<5;t++){this.uploadFileList.push(e[t]);this.uploadFileTotalSize+=e[t].size}this.uploadNext()},uploadNext:function(){if(this.uploadFileList.length){var e=this.uploadFileList.shift();if(e){this.uploadFile(e);this.uploadNext()}}},uploadFile:function(e){var t=new FormData;t.append("file",e);t.append("name",e.name);t.append("folder",this.currentFolder&&this.currentFolder.data?this.currentFolder.data.id:"");this.restActions.addAttachment(function(){if(!this.uploadFileList.length){if(this.currentFolder){this.currentFolder.clickNode()}else{this.topTreeNode.clickNode()}}}.bind(this),null,t,e)},initDropUpLoad:function(){this.fileContentAreaNode.addEventListener("drop",function(e){e.stopPropagation();e.preventDefault();if(this.dropUploadInforNode){this.dropUploadInforNode.destroy();this.dropUploadInforNode=null}if(e.dataTransfer.types.length<2){this.uploadFiles(e.dataTransfer.files)}}.bind(this),false);this.fileContentAreaNode.addEventListener("dragover",function(e){if(e.dataTransfer.types.length<2){e.stopPropagation();e.preventDefault();if(!this.dropUploadInforNode){this.dropUploadInforNode=new Element("div",{styles:this.css.dropUploadInforNode,text:this.lp.dropUpload}).inject(this.node);this.dropUploadInforNode.position({relativeTo:this.fileContentAreaNode,position:"centerBottom",edge:"centerBottom",offset:{x:0,y:-100}});this.dropUploadInforNode.fade(.7)}}}.bind(this),false);this.fileContentAreaNode.addEventListener("dragleave",function(e){e.stopPropagation();e.preventDefault();if(this.dropUploadInforNode)window.setTimeout(function(){if(this.dropUploadInforNode){this.dropUploadInforNode.destroy();this.dropUploadInforNode=null}}.bind(this),2e3)}.bind(this),false)}});MWF.xApplication.File.Attachment=new Class({initialize:function(e,t){this.data=e;this.file=t;this.type="file";this.extension=this.data.name.substr(this.data.name.lastIndexOf(".")+1,this.data.name.length);this.load()},getIcon:function(){var e=this.file.icons[this.extension]||this.file.icons.unknow;return"/x_component_File/$Main/default/file/"+e},load:function(){this.node=new Element("div",{styles:this.file.css.attachmentNode});this.iconNode=new Element("div",{styles:this.file.css.attachmentIconNode}).inject(this.node);this.imgNode=new Element("div",{styles:this.file.css.attachmentImgNode}).inject(this.iconNode);this.imgNode.setStyle("background-image","url("+this.getIcon()+")");this.textNode=new Element("div",{styles:this.file.css.attachmentTextNode,text:this.data.name,title:this.data.name}).inject(this.node);if(this.data.shareList){if(this.data.shareList.length){this.shareIconNode=new Element("div",{styles:this.file.css.shareIconNode}).inject(this.node)}}this.node.inject(this.file.fileContentAreaNode);this.setEvents()},setEvents:function(){this.node.addEvents({mouseover:function(){if(!this.isSelected)this.node.setStyles(this.file.css.attachmentNode_over)}.bind(this),mouseout:function(){if(!this.isSelected)this.node.setStyles(this.file.css.attachmentNode)}.bind(this),click:function(e){this.selected();e.stop();e.stopPropagation()}.bind(this),dblclick:function(){this.open()}.bind(this)});this.node.makeLnk({par:{icon:this.getIcon(),title:this.data.name,par:'FileOpen#{"id": "'+this.data.id+'", "type": "file"}'}})},selected:function(){if(this.file.selectedItem)this.file.selectedItem.unSelected();this.isSelected=true;this.node.setStyles(this.file.css.attachmentNode_select);this.file.selectedItem=this},unSelected:function(){this.isSelected=false;this.node.setStyles(this.file.css.attachmentNode);this.file.selectedItem=null},open:function(){this.file.restActions.getAttachment(this.data.id)}});MWF.xApplication.File.Folder=new Class({initialize:function(e,t){this.data=e;this.file=t;this.type="folder";this.load()},getIcon:function(){return"/x_component_File/$Main/default/file/folder.png"},load:function(){this.node=new Element("div",{styles:this.file.css.attachmentNode});this.iconNode=new Element("div",{styles:this.file.css.attachmentIconNode}).inject(this.node);this.imgNode=new Element("img",{styles:this.file.css.attachmentImgNode,src:this.getIcon(),border:"0"}).inject(this.iconNode);this.textNode=new Element("div",{styles:this.file.css.attachmentTextNode,text:this.data.name}).inject(this.node);this.node.inject(this.file.fileContentAreaNode);this.setEvents()},setEvents:function(){this.node.addEvents({mouseover:function(){if(!this.isSelected)this.node.setStyles(this.file.css.attachmentNode_over)}.bind(this),mouseout:function(){if(!this.isSelected)this.node.setStyles(this.file.css.attachmentNode)}.bind(this),click:function(e){this.selected();e.stop();e.stopPropagation()}.bind(this),dblclick:function(){this.open()}.bind(this)})},selected:function(){if(this.file.selectedItem)this.file.selectedItem.unSelected();this.isSelected=true;this.node.setStyles(this.file.css.attachmentNode_select);this.file.selectedItem=this},unSelected:function(){this.isSelected=false;this.node.setStyles(this.file.css.attachmentNode);this.file.selectedItem=null},open:function(){this.treeNode.clickNode()}});MWF.xApplication.File.ShareAttachment=new Class({Extends:MWF.xApplication.File.Attachment,initialize:function(e,t){this.data=e;this.file=t;this.type="share";this.extension=this.data.name.substr(this.data.name.lastIndexOf(".")+1,this.data.name.length);this.load()}});