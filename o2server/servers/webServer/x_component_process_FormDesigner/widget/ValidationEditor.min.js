MWF.xApplication.process.FormDesigner.widget=MWF.xApplication.process.FormDesigner.widget||{};MWF.require("MWF.widget.UUID",null,false);MWF.xApplication.process.FormDesigner.widget.ValidationEditor=new Class({Implements:[Options,Events],Extends:MWF.widget.Common,options:{style:"default",maxObj:document.body},initialize:function(t,e,i){this.setOptions(i);this.node=$(t);this.designer=e;this.path="/x_component_process_FormDesigner/widget/$ValidationEditor/";this.cssPath="/x_component_process_FormDesigner/widget/$ValidationEditor/"+this.options.style+"/css.wcss";this._loadCss();this.items=[]},load:function(t){this.titleNode=new Element("div",{styles:this.css.titleNode,text:this.designer.lp.validation.validation}).inject(this.node);this.editorNode=new Element("div",{styles:this.css.editorNode}).inject(this.node);this.actionNode=new Element("div",{styles:this.css.actionNode}).inject(this.node);this.listNode=new Element("div",{styles:this.css.listNode}).inject(this.node);this.loadEditorNode();this.loadActionNode();this.loadListNode(t)},loadEditorNode:function(){var t="<table width='100%' border='0' cellpadding='5' cellspacing='0' class='editTable'>"+"<tr><td></td></tr><tr><td></td></tr><tr><td></td></tr></table>";this.editorNode.set("html",t);var e=this.editorNode.getElements("td").setStyles(this.css.editTableTdValue);this.loadStatus(e);this.loadConditions(e);this.loadPrompt(e)},loadStatus:function(t){var e="<table width='100%' border='0' cellpadding='0' cellspacing='0'><tr>"+"<td width='140px'>"+"<input type='radio' value='all' checked />"+this.designer.lp.validation.anytime+"<input type='radio' value='decision' />"+this.designer.lp.validation.decision+"</td>"+"<td><input type='text' value='"+this.designer.lp.validation.decisionName+"'></td>"+"</tr></table>";t[0].set("html",e);var i=t[0].getElements("input");var s=(new MWF.widget.UUID).toString();i[0].set("name","condition"+s);i[1].set("name","condition"+s);i[2].setStyles(this.css.decisionNameInput);this.decisionInputNode=i[2];this.statusRadioNodes=i;this.statusRadioNodes.pop();this.decisionInputNode.addEvents({focus:function(){if(this.decisionInputNode.get("value")==this.designer.lp.validation.decisionName)this.decisionInputNode.set("value","")}.bind(this),blur:function(){if(!this.decisionInputNode.get("value"))this.decisionInputNode.set("value",this.designer.lp.validation.decisionName)}.bind(this)})},loadConditions:function(t){var e="<table width='100%' border='0' cellpadding='0' cellspacing='0'><tr>"+"<td width='140px'>"+"<select><option value='value'>"+this.designer.lp.validation.value+"</option>"+"<option value='length'>"+this.designer.lp.validation.length+"</option></select>"+"&nbsp;<select><option value='isnull'>"+this.designer.lp.validation.isnull+"</option>"+"<option value='notnull'>"+this.designer.lp.validation.notnull+"</option>"+"<option value='gt'>"+this.designer.lp.validation.gt+"</option>"+"<option value='lt'>"+this.designer.lp.validation.lt+"</option>"+"<option value='equal'>"+this.designer.lp.validation.equal+"</option>"+"<option value='neq'>"+this.designer.lp.validation.neq+"</option>"+"<option value='contain'>"+this.designer.lp.validation.contain+"</option>"+"<option value='notcontain'>"+this.designer.lp.validation.notcontain+"</option>"+"</select>"+"</td>"+"<td><input style='display: none' type='text' value='"+this.designer.lp.validation.valueInput+"'/></td>"+"</tr></table>";t[1].set("html",e);var i=t[1].getElements("select");i.setStyles(this.css.valueSelect);this.valueTypeSelectNode=i[0];this.operateorSelectNode=i[1];this.valueInputNode=t[1].getElement("input").setStyles(this.css.valueInput);this.operateorSelectNode.addEvent("change",function(){var t=this.operateorSelectNode.options[this.operateorSelectNode.selectedIndex].value;if(t&&t!="isnull"&&t!="notnull"){this.valueInputNode.setStyle("display","inline")}else{this.valueInputNode.setStyle("display","none")}}.bind(this));this.valueInputNode.addEvents({focus:function(){if(this.valueInputNode.get("value")==this.designer.lp.validation.valueInput)this.valueInputNode.set("value","")}.bind(this),blur:function(){if(!this.valueInputNode.get("value"))this.valueInputNode.set("value",this.designer.lp.validation.valueInput)}.bind(this)})},loadPrompt:function(t){var e="<table width='100%' border='0' cellpadding='0' cellspacing='0'><tr><td width='60px'>"+this.designer.lp.validation.prompt+"</td><td><input type='text' /></td></tr></table>";t[2].set("html",e);t[2].getElements("td")[0].setStyles(this.css.titleTd);this.promptInputNode=t[2].getElement("input").setStyles(this.css.promptInput)},loadActionNode:function(){this.actionAreaNode=new Element("div",{styles:this.css.actionAreaNode}).inject(this.actionNode);this.addAction=new Element("div",{styles:this.css.addAction,text:this.designer.lp.validation.add}).inject(this.actionAreaNode);this.modifyAction=new Element("div",{styles:this.css.modifyAction_disabled,text:this.designer.lp.validation.modify}).inject(this.actionAreaNode);this.addAction.addEvent("click",function(){this.addValidation()}.bind(this));this.modifyAction.addEvent("click",function(){this.modifyValidation()}.bind(this))},getData:function(){var t=this.getStatusValue();var e=this.decisionInputNode.get("value");var i=this.valueTypeSelectNode.options[this.valueTypeSelectNode.selectedIndex].value;var s=this.operateorSelectNode.options[this.operateorSelectNode.selectedIndex].value;var o=this.valueInputNode.get("value");var n=this.promptInputNode.get("value");if(e==this.designer.lp.validation.decisionName)e="";if(o==this.designer.lp.validation.valueInput)o="";return{status:t,decision:e,valueType:i,operateor:s,value:o,prompt:n}},addValidation:function(){this.hideErrorNode();var t=this.getData();if(t.status!="all"){if(!t.decision||t.decision==this.designer.lp.validation.decisionName){this.showErrorNode(this.designer.lp.validation.inputDecisionName);return false}}if(t.operateor!="isnull"&&t.operateor!="notnull"){if(!t.value||t.value==this.designer.lp.validation.valueInput){this.showErrorNode(this.designer.lp.validation.inputValue);return false}}if(!t.prompt){this.showErrorNode(this.designer.lp.validation.inputPrompt);return false}var e=new MWF.xApplication.process.FormDesigner.widget.ValidationEditor.Item(t,this);this.items.push(e);e.selected();this.fireEvent("change")},showErrorNode:function(t){this.errorNode=new Element("div",{styles:this.css.errorNode}).inject(this.actionNode,"before");this.errorTextNode=new Element("div",{styles:this.css.errorTextNode}).inject(this.errorNode);this.errorTextNode.set("text",t);this.errorNode.addEvent("click",function(){this.hideErrorNode()}.bind(this))},hideErrorNode:function(){if(this.errorNode)this.errorNode.destroy()},getStatusValue:function(){for(var t=0;t<this.statusRadioNodes.length;t++){var e=this.statusRadioNodes[t];if(e.checked)return e.value}return""},modifyValidation:function(){if(this.currentItem){this.hideErrorNode();var t=this.getData();if(t.status!="all"){if(!t.decision||t.decision==this.designer.lp.validation.decisionName){this.showErrorNode(this.designer.lp.validation.inputDecisionName);return false}}if(t.operateor!="isnull"&&t.operateor!="notnull"){if(!t.value||t.value==this.designer.lp.validation.valueInput){this.showErrorNode(this.designer.lp.validation.inputValue);return false}}if(!t.prompt){this.showErrorNode(this.designer.lp.validation.inputPrompt);return false}this.currentItem.reload(t);this.currentItem.unSelected();this.disabledModify();this.fireEvent("change")}},loadListNode:function(t){if(t){if(t.length){t.each(function(t){var e=new MWF.xApplication.process.FormDesigner.widget.ValidationEditor.Item(t,this);this.items.push(e)}.bind(this))}}},enabledModify:function(){this.modifyAction.setStyles(this.css.modifyAction)},disabledModify:function(){this.modifyAction.setStyles(this.css.modifyAction_disabled)},setData:function(t){if(t.decision)this.decisionInputNode.set("value",t.decision);if(t.status){for(var e=0;e<this.statusRadioNodes.length;e++){if(t.status==this.statusRadioNodes[e].get("value")){this.statusRadioNodes[e].set("checked",true);break}}}else{this.statusRadioNodes[0].set("checked",true)}for(var e=0;e<this.valueTypeSelectNode.options.length;e++){if(t.valueType==this.valueTypeSelectNode.options[e].get("value")){this.valueTypeSelectNode.options[e].set("selected",true);break}}for(var e=0;e<this.operateorSelectNode.options.length;e++){if(t.operateor==this.operateorSelectNode.options[e].get("value")){this.operateorSelectNode.options[e].set("selected",true);break}}if(t.value)this.valueInputNode.set("value",t.value);if(t.prompt)this.promptInputNode.set("value",t.prompt)},deleteItem:function(t){if(this.currentItem==t)t.unSelected();this.items.erase(t);t.node.destroy();MWF.release(t);this.fireEvent("change")},getValidationData:function(){var t=[];this.items.each(function(e){t.push(e.data)});return t}});MWF.xApplication.process.FormDesigner.widget.ValidationEditor.Item=new Class({initialize:function(t,e){this.data=t;this.editor=e;this.container=this.editor.listNode;this.css=this.editor.css;this.lp=this.editor.designer.lp;this.load()},load:function(){this.node=new Element("div",{styles:this.css.itemNode}).inject(this.container);this.deleteNode=new Element("div",{styles:this.css.itemDeleteNode}).inject(this.node);this.contentNode=new Element("div",{styles:this.css.itemContentNode}).inject(this.node);this.contentNode.set("text",this.getText());this.contentNode.addEvent("click",function(){this.selected()}.bind(this));this.deleteNode.addEvent("click",function(t){this.deleteItem(t)}.bind(this))},reload:function(t){this.data=t;this.contentNode.set("text",this.getText())},getText:function(){var t="";if(this.data.status=="all"){t=this.lp.validation.anytime+" "}else{t=this.lp.validation.when+this.lp.validation.decision+' "'+this.data.decision+'" '+this.lp.validation.as+" "}t+=this.lp.validation[this.data.valueType]+" ";t+=this.lp.validation[this.data.operateor]+" ";t+=' "'+this.data.value+'" ';t+=this.lp.validation.prompt+': "'+this.data.prompt+'"';return t},selected:function(){if(this.editor.currentItem)this.editor.currentItem.unSelected();this.node.setStyles(this.css.itemNode_current);this.editor.currentItem=this;this.editor.setData(this.data);this.editor.enabledModify()},unSelected:function(){this.node.setStyles(this.css.itemNode);this.editor.currentItem=this;this.editor.disabledModify()},deleteItem:function(t){var e=this;this.editor.designer.confirm("warn",t,this.lp.validation.delete_title,this.lp.validation.delete_text,300,120,function(){e.destroy();this.close()},function(){this.close()})},destroy:function(){this.editor.deleteItem(this)}});