MWF.xApplication.process.FormDesigner.Module=MWF.xApplication.process.FormDesigner.Module||{};MWF.xDesktop.requireApp("process.FormDesigner","Module.$Component",null,false);MWF.xDesktop.requireApp("process.FormDesigner","Module.Tab$Page",null,false);MWF.xDesktop.requireApp("process.FormDesigner","Module.Tab$Content",null,false);MWF.require("MWF.widget.Tab",null,false);MWF.xApplication.process.FormDesigner.Module.Tab=MWF.FCTab=new Class({Extends:MWF.FC$Component,Implements:[Options,Events],options:{style:"default",propertyPath:"/x_component_process_FormDesigner/Module/Tab/tab.html",actions:[{name:"move",icon:"move1.png",event:"mousedown",action:"move",title:MWF.APPFD.LP.formAction.move},{name:"copy",icon:"copy1.png",event:"mousedown",action:"copy",title:MWF.APPFD.LP.formAction.copy},{name:"add",icon:"add.png",event:"click",action:"addPage",title:MWF.APPFD.LP.formAction.add},{name:"delete",icon:"delete1.png",event:"click",action:"delete",title:MWF.APPFD.LP.formAction["delete"]}]},initialize:function(t,e){this.setOptions(e);this.path="/x_component_process_FormDesigner/Module/Tab/";this.cssPath="/x_component_process_FormDesigner/Module/Tab/"+this.options.style+"/css.wcss";this._loadCss();this.moduleType="component";this.moduleName="tab";this.form=t;this.container=null;this.containerNode=null;this.containers=[];this.elements=[]},clearTemplateStyles:function(t){if(t){if(t.styles)this.removeStyles(t.styles,"styles");if(t.properties)this.removeStyles(t.properties,"properties");if(t.tabAreaStyles)this.removeStyles(t.tabAreaStyles,"tabNodeContainer");if(t.contentAreaStyles)this.removeStyles(t.contentAreaStyles,"contentNodeContainer");if(t.tabStyles)this.removeStyles(t.tabStyles,"tabStyles");if(t.tabTextStyles)this.removeStyles(t.tabTextStyles,"tabTextStyles");if(t.tabCurrentStyles)this.removeStyles(t.tabCurrentStyles,"tabCurrentStyles");if(t.tabCurrentTextStyles)this.removeStyles(t.tabCurrentTextStyles,"tabTextCurrentStyles")}},setTemplateStyles:function(t){debugger;if(t.styles)this.copyStyles(t.styles,"styles");if(t.properties)this.copyStyles(t.properties,"properties");if(t.tabAreaStyles)this.copyStyles(t.tabAreaStyles,"tabNodeContainer");if(t.contentAreaStyles)this.copyStyles(t.contentAreaStyles,"contentNodeContainer");if(t.tabStyles)this.copyStyles(t.tabStyles,"tabStyles");if(t.tabTextStyles)this.copyStyles(t.tabTextStyles,"tabTextStyles");if(t.tabCurrentStyles)this.copyStyles(t.tabCurrentStyles,"tabCurrentStyles");if(t.tabCurrentTextStyles)this.copyStyles(t.tabCurrentTextStyles,"tabTextCurrentStyles")},_createMoveNode:function(){this.moveNode=new Element("div",{styles:this.css.moduleNodeMove}).inject(this.form.container);var t=new Element("div",{styles:this.css.moduleNodeMove_tab_current});var e=new Element("div",{styles:this.css.moduleNodeMove_tab});var s=new Element("div",{styles:this.css.moduleNodeMove_content});t.inject(this.moveNode);e.inject(this.moveNode);s.inject(this.moveNode)},_createNode:function(t){this.node=new Element("div",{id:this.json.id,MWFType:"tab",styles:this.css.moduleNode,events:{selectstart:function(t){t.preventDefault()}}}).inject(this.form.node);var e="form";if(this.form.options.mode=="Mobile")e="mobileForm";this.tabWidget=new MWF.widget.Tab(this.node,{style:e});this._loadPageStyle();this.tabWidget.load();var s=new Element("div");this.tabWidget.addTab(s,"page1",false);s=new Element("div");this.tabWidget.addTab(s,"page2",false);s=new Element("div");this.tabWidget.addTab(s,"page3",false);s=new Element("div");this.tabWidget.addTab(s,"page4",false)},_createTabWidget:function(){var t="form";if(this.form.options.mode=="Mobile")t="mobileForm";this.tabWidget=new MWF.widget.Tab(this.node,{style:t});debugger;this._loadPageStyle();this.tabWidget.tabNodeContainer=this.node.getFirst();this.tabWidget.contentNodeContainer=this.node.getLast();this.tabWidget.load();var e=this.tabWidget.contentNodeContainer.getChildren();var s=this.tabWidget.tabNodeContainer.getChildren();e.each(function(t,e){var i=s[e];var o=new MWF.widget.TabPage(t.getFirst(),"",this.tabWidget,{isClose:false});o.contentNodeArea=t;if(i){o.tabNode=i;o.textNode=i.getFirst();o.closeNode=o.textNode.getFirst()}o.load();this.tabWidget.pages.push(o)}.bind(this))},_loadPageStyle:function(){if(!this.json.tabNodeContainer)this.json.tabNodeContainer=Object.clone(this.tabWidget.css.tabNodeContainer);if(!this.json.contentNodeContainer)this.json.contentNodeContainer=Object.clone(this.tabWidget.css.contentNodeContainer);if(!this.json.tabStyles)this.json.tabStyles=Object.clone(this.tabWidget.css.tabNode);if(!this.json.tabTextStyles)this.json.tabTextStyles=Object.clone(this.tabWidget.css.tabTextNode);if(!this.json.tabCurrentStyles)this.json.tabCurrentStyles=Object.clone(this.tabWidget.css.tabNodeCurrent);if(!this.json.tabTextCurrentStyles)this.json.tabTextCurrentStyles=Object.clone(this.tabWidget.css.tabTextNodeCurrent);if(!this.json.contentNodeContainer)this.json.contentNodeContainer.clear="both";this._setTabWidgetStyles()},_setTabWidgetStyles:function(){this.tabWidget.css.tabNodeContainer=this.json.tabNodeContainer;this.tabWidget.css.contentNodeContainer=this.json.contentNodeContainer;this.tabWidget.css.tabNode=this.json.tabStyles;this.tabWidget.css.tabTextNode=this.json.tabTextStyles;this.tabWidget.css.tabNodeCurrent=this.json.tabCurrentStyles;this.tabWidget.css.contentNodeContainer.clear="both";this.tabWidget.css.tabTextNodeCurrent=this.json.tabTextCurrentStyles},_getElements:function(){if(!this.tabWidget)this._createTabWidget();this.form.getTemplateData("Tab$Page",function(t){this.tabWidget.pages.each(function(e){var s=null;var i=this.form.getDomjson(e.tabNode);if(!i){var o=Object.clone(t);o.name=e.tabNode.get("text");s=new MWF.FCTab$Page(this,e);s.page=e;s.load(o,e.tabNode,this)}else{s=new MWF.FCTab$Page(this,e);s.page=e;s.load(i,e.tabNode,this)}if(s)this.elements.push(s)}.bind(this))}.bind(this));if(!this.tabWidget.showPage)this.tabWidget.pages[0].showTabIm()},_getContainers:function(){if(!this.tabWidget)this._createTabWidget();this.form.getTemplateData("Tab$Content",function(t){this.tabWidget.pages.each(function(e){var s=null;var i=this.form.getDomjson(e.contentNode);if(!i){var o=Object.clone(t);s=new MWF.FCTab$Content(this,e);s.page=e;s.load(o,e.contentNode,this)}else{s=new MWF.FCTab$Content(this,e);s.page=e;s.load(i,e.contentNode,this)}if(s)this.containers.push(s)}.bind(this))}.bind(this))},_setEditStyle_custom:function(t){if(t=="tabNodeContainer"){this.tabWidget.tabNodeContainer.clearStyles();this.tabWidget.tabNodeContainer.setStyles(this.json.tabNodeContainer);this._setTabWidgetStyles()}if(t=="contentNodeContainer"){this.tabWidget.contentNodeContainer.clearStyles();this.tabWidget.contentNodeContainer.setStyles(this.json.contentNodeContainer);this._setTabWidgetStyles()}if(t=="tabStyles"){this.tabWidget.pages.each(function(t){if(!t.isShow){t.tabNode.clearStyles();t.tabNode.setStyles(this.json.tabStyles)}}.bind(this));this._setTabWidgetStyles()}if(t=="tabTextStyles"){this.tabWidget.pages.each(function(t){if(!t.isShow){t.textNode.clearStyles();t.textNode.setStyles(this.json.tabTextStyles)}}.bind(this));this._setTabWidgetStyles()}if(t=="tabCurrentStyles"){this.tabWidget.pages.each(function(t){if(t.isShow){t.tabNode.clearStyles();t.tabNode.setStyles(this.json.tabCurrentStyles)}}.bind(this));this._setTabWidgetStyles()}if(t=="tabTextCurrentStyles"){this.tabWidget.pages.each(function(t){if(t.isShow){t.textNode.clearStyles();t.textNode.setStyles(this.json.tabTextCurrentStyles)}}.bind(this));this._setTabWidgetStyles()}},setTabStyles:function(){this._setEditStyle_custom("tabNodeContainer");this._setEditStyle_custom("contentNodeContainer");this._setEditStyle_custom("tabStyles");this._setEditStyle_custom("tabTextStyles");this._setEditStyle_custom("tabCurrentStyles");this._setEditStyle_custom("tabTextCurrentStyles")},setAllStyles:function(){this.setPropertiesOrStyles("styles");this.setPropertiesOrStyles("properties");this.setTabStyles();this.reloadMaplist()},addPage:function(){tabNode=new Element("div");var t=this.tabWidget.addTab(tabNode,"page",false);this.form.getTemplateData("Tab$Page",function(e){var s=Object.clone(e);s.name=t.tabNode.get("text");var i=new MWF.FCTab$Page(this,t);i.load(s,t.tabNode,this);this.elements.push(i)}.bind(this));this.form.getTemplateData("Tab$Content",function(e){var s=Object.clone(e);var i=new MWF.FCTab$Content(this,t);i.load(s,t.contentNode,this);this.containers.push(i)}.bind(this));t.showTabIm();return t},copyComponentJsonData:function(t,e){var s=t.getFirst();var i=t.getLast();var o=i.getChildren();var n=s.getChildren();o.each(function(t,s){var i=Object.clone(this.containers[s].json);var o=Object.clone(this.elements[s].json);var a=n[s];i.id=this.containers[s]._getNewId(e);this.form.json.moduleList[i.id]=i;t.getFirst().set("id",i.id);o.id=this.elements[s]._getNewId(e);this.form.json.moduleList[o.id]=o;a.set("id",o.id)}.bind(this))}});