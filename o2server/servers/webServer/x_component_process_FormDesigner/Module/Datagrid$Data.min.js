MWF.xApplication.process.FormDesigner.Module=MWF.xApplication.process.FormDesigner.Module||{};MWF.xDesktop.requireApp("process.FormDesigner","Module.$Container",null,false);MWF.xApplication.process.FormDesigner.Module.Datagrid$Data=MWF.FCDatagrid$Data=new Class({Extends:MWF.FCTable$Td,Implements:[Options,Events],options:{propertyPath:"/x_component_process_FormDesigner/Module/Datagrid$Data/datagrid$Data.html",actions:[{name:"insertCol",icon:"insertCol1.png",event:"click",action:"insertCol",title:MWF.LP.process.formAction.insertCol},{name:"deleteCol",icon:"deleteCol1.png",event:"click",action:"deleteCol",title:MWF.LP.process.formAction.deleteCol}],allowModules:["textfield","number","personfield","calendar","textarea","select","radio","checkbox","html","image","label","htmleditor","button"]},initialize:function(e,t){this.setOptions(t);this.path="/x_component_process_FormDesigner/Module/Datagrid$Data/";this.cssPath="/x_component_process_FormDesigner/Module/Datagrid$Data/"+this.options.style+"/css.wcss";this._loadCss();this.moduleType="container";this.moduleName="datagrid$Data";this.Node=null;this.form=e},setAllStyles:function(){Object.each(this.json.styles,function(e,t){var s=/^border\w*/gi;if(!t.test(s)){if(t)this.node.setStyle(t,e)}}.bind(this));this.setPropertiesOrStyles("properties");this.reloadMaplist()},load:function(e,t,s){this.json=e;this.node=t;this.node.store("module",this);this.node.setStyles(this.css.moduleNode);if(!this.json.id){var i=this._getNewId(s.json.id);this.json.id=i}t.set({MWFType:"datagrid$Data",id:this.json.id});if(!this.form.json.moduleList[this.json.id]){this.form.json.moduleList[this.json.id]=this.json}this._initModule();this._loadTreeNode(s);this.form.parseModules(this,this.node);this.parentContainer=this.treeNode.parentNode.module;this._setEditStyle_custom("id");this.checkSequence();this.json.moduleName=this.moduleName},_setEditStyle_custom:function(e,t,s){if(e=="cellType")this.checkSequence(t,s)},setCustomStyles:function(){var e=this.node.getStyle("border");this.node.clearStyles();this.node.setStyles(this.css.moduleNode);if(this.initialStyles)this.node.setStyles(this.initialStyles);this.node.setStyle("border",e);Object.each(this.json.styles,function(e,t){var s=/^border\w*/gi;if(!t.test(s)){this.node.setStyle(t,e)}}.bind(this))},checkSequence:function(e,t){if(this.json.cellType=="sequence"&&t!="sequence"){if(this.treeNode.firstChild){var s=this;var i=this.treeNode.firstChild.module;this.form.designer.confirm("warn",i.node,MWF.APPFD.LP.notice.changeToSequenceTitle,MWF.APPFD.LP.notice.changeToSequence,300,120,function(){debugger;i.destroy();this.close();if(!s.sequenceNode){s.node.empty();s.sequenceNode=new Element("div",{styles:s.css.sequenceNode,text:"(N)",MWFType1:"MWFTemp"}).inject(s.node)}},function(){s.json.cellType="content";e.checked=false;this.close()},null)}else{if(!this.sequenceNode){this.node.empty();this.sequenceNode=new Element("div",{styles:this.css.sequenceNode,text:"(N)",MWFType1:"MWFTemp"}).inject(this.node)}}}else if(t=="sequence"){}else{if(this.sequenceNode){this.sequenceNode.destroy();this.sequenceNode=null}}},_dragIn:function(e){if(this.treeNode.firstChild||this.json.cellType=="sequence"){this.parentContainer._dragIn(e)}else{if(this.options.allowModules.indexOf(e.moduleName)!=-1){if(!this.Component)e.inContainer=this;e.parentContainer=this;e.nextModule=null;this.node.setStyles({border:"1px solid #ffa200"});var t=e._getCopyNode();t.inject(this.node)}else{this.parentContainer._dragIn(e)}}},_showActions:function(){if(this.actionArea){this._setActionAreaPosition();this.actionArea.setStyle("display","block")}},_insertCol:function(){var e=$("MWFInsertColNumber").get("value");var t=document.getElementsByName("MWFInsertColPosition");var s="before";for(var i=0;i<t.length;i++){if(t[i].checked){s=t[i].value;break}}var n=this.node.getParent("tr");var o=n.getParent("table");var r=this.node.cellIndex;var a=o.rows[0];var l=o.rows[1];var d=a.cells[r];for(var c=1;c<=e;c++){var h=new Element("th").inject(d,s);this.form.getTemplateData("Datagrid$Title",function(e){var t=Object.clone(e);var s=new MWF.FCDatagrid$Title(this.form);s.load(t,h,this.parentContainer);this.parentContainer.elements.push(s)}.bind(this))}var u=l.cells[r];for(var p=1;p<=e;p++){var m=new Element("td").inject(u,s);this.form.getTemplateData("Datagrid$Data",function(e){var t=Object.clone(e);var s=new MWF.FCDatagrid$Data(this.form);s.load(t,m,this.parentContainer);this.parentContainer.containers.push(s)}.bind(this))}this.unSelected();this.selected()},_deleteCol:function(){var e=this.node.getParent("tr");var t=e.getParent("table");var s=this.node.cellIndex;var i=t.rows[0];var n=t.rows[1];if(e.cells.length<=1){this.parentContainer.destroy()}else{var o=i.cells[s];var r=n.cells[s];var a=o.retrieve("module");if(a){a.parentContainer.elements.erase(a);a.destroy()}var l=r.retrieve("module");if(l){l.parentContainer.containers.erase(l);l.destroy()}}}});