MWF.xApplication.process.FormDesigner.Module=MWF.xApplication.process.FormDesigner.Module||{};MWF.xDesktop.requireApp("process.FormDesigner","Module.$Container",null,false);MWF.xApplication.process.FormDesigner.Module.Datagrid$Title=MWF.FCDatagrid$Title=new Class({Extends:MWF.FC$Element,Implements:[Options,Events],options:{style:"default",propertyPath:"/x_component_process_FormDesigner/Module/Datagrid$Title/datagrid$Title.html",actions:[{name:"insertCol",icon:"insertCol1.png",event:"click",action:"insertCol",title:MWF.LP.process.formAction.insertCol},{name:"deleteCol",icon:"deleteCol1.png",event:"click",action:"deleteCol",title:MWF.LP.process.formAction.deleteCol}]},initialize:function(e,t){this.setOptions(t);this.path="/x_component_process_FormDesigner/Module/Datagrid$Title/";this.cssPath="/x_component_process_FormDesigner/Module/Datagrid$Title/"+this.options.style+"/css.wcss";this._loadCss();this.moduleType="element";this.moduleName="datagrid$Title";this.Node=null;this.form=e},setAllStyles:function(){Object.each(this.json.styles,function(e,t){var i=/^border\w*/gi;if(!t.test(i)){if(t)this.node.setStyle(t,e)}}.bind(this));this.setPropertiesOrStyles("properties");this.reloadMaplist()},_dragIn:function(e){this.parentContainer._dragIn(e)},over:function(){if(this.form.selectedModules.indexOf(this)==-1){if(!this.form.moveModule)if(this.form.currentSelectedModule!=this)this.node.setStyles({"border-width":"1px","border-color":"#0072ff"})}},unOver:function(){if(this.form.selectedModules.indexOf(this)==-1){if(!this.form.moveModule)if(this.form.currentSelectedModule!=this)this.node.setStyles({"border-width":"1px","border-color":"#999"})}},unSelected:function(){this.node.setStyles({"border-width":"1px","border-color":"#999"});this._hideActions();this.form.currentSelectedModule=null;this.hideProperty()},load:function(e,t,i){this.json=e;this.node=t;this.node.store("module",this);this.node.setStyles(this.css.moduleNode);this.node.set("text",this.json.name||"DataTitle");if(!this.json.id){var o=this._getNewId(i.json.id);this.json.id=o}t.set({MWFType:"datagrid$Title",id:this.json.id});if(!this.form.json.moduleList[this.json.id]){this.form.json.moduleList[this.json.id]=this.json}this._initModule();this._loadTreeNode(i);this.parentContainer=this.treeNode.parentNode.module;this._setEditStyle_custom("id");this.json.moduleName=this.moduleName},_createMoveNode:function(){return false},_setEditStyle_custom:function(e){},_dragInLikeElement:function(e){return false},insertCol:function(){var e=this;var t=this.path+"insertCol.html";MWF.require("MWF.widget.Dialog",function(){var i=$(document.body).getSize();var o=i.x/2-150;var s=i.y/2-90;var n=new MWF.DL({title:"Insert Col",style:"property",top:s,left:o-40,fromTop:i.y/2-45,fromLeft:i.x/2,width:300,height:180,url:t,buttonList:[{text:MWF.APPFD.LP.button.ok,action:function(){e._insertCol();this.close()}},{text:MWF.APPFD.LP.button.cancel,action:function(){this.close()}}]});n.show()}.bind(this))},_insertCol:function(){var e=$("MWFInsertColNumber").get("value");var t=document.getElementsByName("MWFInsertColPosition");var i="before";for(var o=0;o<t.length;o++){if(t[o].checked){i=t[o].value;break}}var s=this.node.getParent("tr");var n=s.getParent("table");var r=this.node.cellIndex;var l=n.rows[0];var a=n.rows[1];var d=l.cells[r];for(var h=1;h<=e;h++){var c=new Element("th").inject(d,i);this.form.getTemplateData("Datagrid$Title",function(e){var t=Object.clone(e);var i=new MWF.FCDatagrid$Title(this.form);i.load(t,c,this.parentContainer);this.parentContainer.elements.push(i)}.bind(this))}var u=a.cells[r];for(var f=1;f<=e;f++){var m=new Element("td").inject(u,i);this.form.getTemplateData("Datagrid$Data",function(e){var t=Object.clone(e);var i=new MWF.FCDatagrid$Data(this.form);i.load(t,m,this.parentContainer);this.parentContainer.containers.push(i)}.bind(this))}this.unSelected();this.selected()},deleteCol:function(e){var t=this;this.form.designer.confirm("warn",e,MWF.LP.process.notice.deleteColTitle,MWF.LP.process.notice.deleteCol,300,120,function(){t._deleteCol();this.close()},function(){this.close()},null)},_deleteCol:function(){var e=this.node.getParent("tr");var t=e.getParent("table");var i=this.node.cellIndex;var o=t.rows[0];var s=t.rows[1];if(e.cells.length<=1){this.parentContainer.destroy()}else{var n=o.cells[i];var r=s.cells[i];var l=n.retrieve("module");if(l){l.parentContainer.elements.erase(l);l.destroy()}var a=r.retrieve("module");if(a){a.parentContainer.containers.erase(a);a.destroy()}}},_setEditStyle_custom:function(e){if(e=="name"){if(!this.json.name){this.node.set("text","DataTitle")}else{this.node.set("text",this.json.name)}}}});