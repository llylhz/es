MWF.xApplication.process=MWF.xApplication.process||{};MWF.xApplication.process.TaskCenter=MWF.xApplication.process.TaskCenter||{};MWF.xApplication.process.TaskCenter.TaskWidget=new Class({Extends:MWF.xApplication.Common.Widget,Implements:[Options,Events],options:{style:"default",title:MWF.xApplication.process.TaskCenter.LP.title,appName:"process.TaskCenter",name:"TaskWidget",position:{right:10,bottom:10},width:"400",height:"550"},init:function(){this.isItemsLoaded=false;this.isItemLoadding=false;this.loadItemQueue=0;this.items=[];this.pageCount=10},loadContent:function(t){this.init();this.addEvent("scroll",function(t){var e=this.widget.contentScrollNode.getScrollSize();var i=this.widget.contentScrollNode.getSize();var s=e.y-i.y;if(t+60>s){if(!this.isElementLoaded)this.listItemNext()}}.bind(this));this.addEvent("dragComplete",function(t,e){var i=this.widget.node.getPosition(this.widget.node.getOffsetParent());this.options.position={top:i.y,left:i.x}});this.listItemNext();if(t)t()},listItemNext:function(t){if(!this.isItemsLoaded){if(!this.isItemLoadding){this.isItemLoadding=true;this._getCurrentPageData(function(t){this.count=t.count;if(t.count<=this.items.length){this.isItemsLoaded=true}t.data.each(function(t){this.items.push(new MWF.xApplication.process.TaskCenter.TaskWidget.Item(t,this))}.bind(this));this.isItemLoadding=false;if(this.loadItemQueue>0){this.loadItemQueue--;this.listItemNext()}}.bind(this),t)}else{this.loadItemQueue++}}},_getCurrentPageData:function(t,e){this.getAction(function(){var i=this.items.length?this.items[this.items.length-1].data.id:"(0)";this.action.listTaskNext(function(e){if(t)t(e)},null,i,e||this.pageCount)}.bind(this))},getAction:function(t){if(!this.action){this.action=MWF.Actions.get("x_processplatform_assemble_surface");if(t)t()}else{if(t)t()}}});MWF.xApplication.process.TaskCenter.TaskWidget.Item=new Class({initialize:function(t,e){this.data=t;this.list=e;this.container=this.list.content;this.load()},load:function(){this.node=new Element("div",{styles:this.list.css.itemNode}).inject(this.container);this.iconNode=new Element("div",{styles:this.list.css.itemIconNode}).inject(this.node);this.actionAreaNode=new Element("div",{styles:this.list.css.itemActionAreaNode}).inject(this.node);this.contentNode=new Element("div",{styles:this.list.css.itemContentNode}).inject(this.node);this.inforTopNode=new Element("div",{styles:this.list.css.itemInforTopNode}).inject(this.contentNode);this.inforTopActivityNode=new Element("div",{styles:this.list.css.itemInforTopActivityNode}).inject(this.inforTopNode);this.inforTopTimeNode=new Element("div",{styles:this.list.css.itemInforTopTimeNode}).inject(this.inforTopNode);this.titleNode=new Element("div",{styles:this.list.css.itemTitleNode}).inject(this.contentNode);this.inforBottomNode=new Element("div",{styles:this.list.css.itemInforBottomNode}).inject(this.contentNode);this.setContent();this.setEvent()},setContent:function(){var t=(Math.random()*10).toInt();if(t%2==0){this.iconNode.setStyle("background-image","url("+"/x_component_process_TaskCenter/$TaskWidget/default/read2.png)")}else{this.iconNode.setStyle("background-image","url("+"/x_component_process_TaskCenter/$TaskWidget/default/task2.png)")}this.inforTopActivityNode.set("text",this.data.activityName);this.inforTopTimeNode.set("text",this.data.startTime);this.titleNode.set("text",this.data.title);this.inforBottomNode.set("text",this.data.applicationName+">>"+this.data.processName)},setEvent:function(){this.contentNode.addEvent("click",function(){this.openTask()}.bind(this))},openTask:function(t){var e={workId:this.data.work};this.list.desktop.openApplication(t,"process.Work",e,{taskObject:this})},destroy:function(){this.node.destroy();delete this.node;delete this.iconNode;delete this.actionAreaNode;delete this.contentNode;delete this.inforTopNode;delete this.inforTopActivityNode;delete this.inforTopTimeNode;delete this.titleNode;delete this.inforBottomNode;delete this}});