MWF.require("MWF.widget.Mask",null,false);MWF.require("MWF.xDesktop.UserData",null,false);MWF.xDesktop.requireApp("process.TaskCenter","TaskList",null,false);MWF.xDesktop.requireApp("process.TaskCenter","TaskCompletedList",null,false);MWF.xDesktop.requireApp("process.TaskCenter","ReadList",null,false);MWF.xDesktop.requireApp("process.TaskCenter","ReadCompletedList",null,false);MWF.xDesktop.requireApp("process.TaskCenter","ReviewList",null,false);MWF.xApplication.process.TaskCenter.options.multitask=false;MWF.xApplication.process.TaskCenter.Main=new Class({Extends:MWF.xApplication.Common.Main,Implements:[Options,Events],options:{style:"default",name:"process.TaskCenter",icon:"icon.png",width:"1280",height:"700",title:MWF.xApplication.process.TaskCenter.LP.title,filterMap:{applicationList:"applicationList",processList:"processList",creatorUnitList:"creatorUnitList",creatorCompanyList:"creatorCompanyList",creatorDepartmentList:"creatorDepartmentList",activityNameList:"activityNameList",completedTimeMonthList:"completedTimeMonthList",key:"key"}},onQueryLoad:function(){this.lp=MWF.xApplication.process.TaskCenter.LP},loadApplication:function(t){this.appIcons={};this.tabs=[];this.tabShadows=[];this.startApplications=[];this.appStartableData=null;this.loadTitle();this.loadTab();this.loadFilterAction();this.loadContent();this.currentTab="";this.openTab();if(t)t()},loadTitle:function(){this.loadTitleBar();if(!layout.mobile)this.loadTitleUserNode();this.loadStartProcessActionNode();if(!layout.mobile)this.loadTitleTextNode();this.loadSearchNode()},loadTitleBar:function(){this.taskTitleBar=new Element("div",{styles:this.css.taskTitleBar}).inject(this.content)},loadTitleUserNode:function(){this.taskTitleUserNode=new Element("div",{styles:this.css.taskTitleUserNode}).inject(this.taskTitleBar);this.taskTitleUserIconNode=new Element("div",{styles:this.css.taskTitleUserIconNode}).inject(this.taskTitleUserNode);this.taskTitleUserTextNode=new Element("div",{styles:this.css.taskTitleUserTextNode,text:this.desktop.session.user.name}).inject(this.taskTitleUserNode)},loadStartProcessActionNode:function(){this.startProcessAction=new Element("div",{styles:this.css.startProcessAction}).inject(this.taskTitleBar);this.startProcessAction.addEvents({click:function(t){this.showStartProcessArea(t)}.bind(this)})},loadTitleTextNode:function(){this.taskTitleTextNode=new Element("div",{styles:this.css.taskTitleTextNode,text:this.lp.title}).inject(this.taskTitleBar)},loadSearchNode:function(){this.searchBarAreaNode=new Element("div",{styles:this.css.searchBarAreaNode}).inject(this.taskTitleBar);if(layout.mobile)this.searchBarAreaNode.setStyle("margin-left","10px");if(layout.mobile)this.searchBarAreaNode.setStyle("margin-right","20px");this.searchBarNode=new Element("div",{styles:this.css.searchBarNode}).inject(this.searchBarAreaNode);this.searchBarActionNode=new Element("div",{styles:this.css.searchBarActionNode}).inject(this.searchBarNode);this.searchBarInputBoxNode=new Element("div",{styles:this.css.searchBarInputBoxNode}).inject(this.searchBarNode);this.searchBarInputNode=new Element("input",{type:"text",value:this.lp.searchKey,styles:this.css.searchBarInputNode}).inject(this.searchBarInputBoxNode);var t=this;this.searchBarActionNode.addEvent("click",function(){this.searchTask()}.bind(this));this.searchBarInputNode.addEvents({focus:function(){if(this.value===t.lp.searchKey)this.set("value","")},blur:function(){if(!this.value)this.set("value",t.lp.searchKey)},keydown:function(t){if(t.code===13){this.searchTask();t.preventDefault()}}.bind(this),selectstart:function(t){t.preventDefault()}})},loadTab:function(){this.tabAreaNode=new Element("div",{styles:this.css.tabAreaNode}).inject(this.content);this.createTabItem(this.lp.task,"task.png","task",function(){this.showTask()}.bind(this));this.createTabItem(this.lp.done,"done.png","taskCompleted",function(){this.showDone()}.bind(this));this.createTabItem(this.lp.read,"read.png","read",function(){this.showRead()}.bind(this));this.createTabItem(this.lp.readed,"readed.png","readCompleted",function(){this.showReaded()}.bind(this));this.getWorkCounts()},createTabItem:function(t,s,e,i){var a=new Element("div",{styles:this.css.tabItemNode}).inject(this.tabAreaNode);if(!layout.mobile){var o=new Element("div",{styles:this.css.tabItemIconNode}).inject(a);o.setStyle("background-image","url("+"/x_component_process_TaskCenter/$Main/default/tab/"+s+")")}var r=new Element("div",{styles:this.css.tabItemTextNode,text:t}).inject(a);this[e+"CountNode"]=new Element("div",{styles:this.css.tabItemCountNode}).inject(a);a.addEvent("click",function(){i()}.bind(this));this.tabs.push(a)},loadFilterAction:function(){},getWorkCounts:function(){debugger;this.getAction(function(){this.action.getCount(function(t){debugger;this.counts=t.data;this["taskCountNode"].set("text","( "+(this.counts.task>100?"99":this.counts.task)+" )");this["taskCompletedCountNode"].set("text","( "+(this.counts.taskCompleted>100?"99":this.counts.taskCompleted)+" )");this["readCountNode"].set("text","( "+(this.counts.read>100?"99":this.counts.read)+" )");this["readCompletedCountNode"].set("text","( "+(this.counts.readCompleted>100?"99":this.counts.readCompleted)+" )")}.bind(this),null,this.desktop.session.user.distinguishedName)}.bind(this))},loadContent:function(){this.contentNode=new Element("div",{styles:this.css.contentNode}).inject(this.content);this.contentListAreaNode=new Element("div",{styles:this.css.contentListAreaNode}).inject(this.contentNode);this.setContentNodeHeight();this.addEvent("resize",this.setContentNodeHeight.bind(this))},setContentNodeHeight:function(){var t=this.content.getSize();var s=this.taskTitleBar.getSize();var e=this.tabAreaNode.getSize();var i=t.y-s.y-e.y-1;this.contentNode.setStyle("height",""+i+"px");var a=0;if(this.taskList)a=a+t.x;if(this.taskCompletedList)a=a+t.x;if(this.readList)a=a+t.x;if(this.readCompletedList)a=a+t.x;this.contentListAreaNode.setStyle("width",""+a+"px")},openTab:function(){var t="task";if(this.status)t=this.status.navi;switch(t){case"task":this.showTask();break;case"done":this.showDone();break;case"read":this.showRead();break;case"readed":this.showReaded();break;case"review":this.showReview();break;default:this.showTask();break}},showTask:function(){if(this.currentTab!=="task"){this.showTab(0);this.currentTab="task";if(!this.taskList){this.createTaskList();this.taskList.show()}else{this.taskList.show();if(this.taskList)this.taskList.refresh()}}else{if(this.taskList)this.taskList.refresh()}},showTab:function(t){this.tabs.each(function(s,e){if(e===t){s.getLast().setStyles(this.css.tabItemTextNode_current);if(!layout.mobile){s.getFirst().getNext().setStyles(this.css.tabItemTextNode_current);var i=s.getFirst().getStyle("background-image");s.getFirst().setStyle("background-image",i.replace(".png","_cur.png"))}else{s.getFirst().setStyles(this.css.tabItemTextNode_current)}}else{s.getLast().setStyles(this.css.tabItemCountNode);if(!layout.mobile){s.getFirst().getNext().setStyles(this.css.tabItemTextNode);var i=s.getFirst().getStyle("background-image");s.getFirst().setStyle("background-image",i.replace("_cur.png",".png"))}else{s.getFirst().setStyles(this.css.tabItemTextNode)}}}.bind(this))},createTaskList:function(){if(!this.contentNode)this.loadContent();this.taskList=new MWF.xApplication.process.TaskCenter.TaskList(this.contentListAreaNode,this)},showStartProcessArea:function(){if(layout.mobile){this.showStartProcessArea_mobile()}else{this.showStartProcessArea_pc()}},showStartProcessArea_mobile:function(){if(!this.startProcessAreaNode){this.createStartProcessArea_mobile()}this.startProcessAreaNode.setStyle("display","block");var t=new Fx.Morph(this.startProcessAreaNode,{duration:200,transition:Fx.Transitions.Expo.easeOut});t.start({left:"0px"})},showStartProcessArea_pc:function(){if(!this.startProcessAreaNode){this.createStartProcessArea()}this.content.mask({destroyOnHide:true,id:"process_taskcenter_startProcessMask",style:this.css.maskNode});var t=this.window.node.getElement("#process_taskcenter_startProcessMask");if(t){t.addEvent("click",function(t){this.closeStartProcessArea(t)}.bind(this))}this.startProcessAreaNode.fade("in")},createStartProcessArea_mobile:function(){this.startProcessAreaNode=new Element("div",{styles:this.css.startProcessAreaNode_mobile}).inject(this.content);var t=this.content.getSize();this.startProcessAreaNode.setStyles({width:""+t.x+"px",height:""+t.y+"px",top:"0px",left:""+t.x+"px"});this.startProcessTopNode=new Element("div",{styles:this.css.startProcessTopNode_mobile}).inject(this.startProcessAreaNode);this.startProcessCloseNode=new Element("div",{styles:this.css.startProcessCloseNode_mobile,text:this.lp.back}).inject(this.startProcessTopNode);this.startProcessCloseNode.addEvent("click",function(t){this.closeStartProcessArea(t)}.bind(this));this.startProcessListNode=new Element("div",{styles:this.css.startProcessListNode_mobile}).inject(this.startProcessAreaNode);var s=t.y-this.startProcessTopNode.getSize().y;this.startProcessListNode.setStyle("height",""+s+"px");this.getAction(function(){this.action.listApplicationStartable(function(t){this.app=this;MWF.UD.getDataJson("taskCenter_startTop",function(s){this.top5Data=s;if(this.top5Data&&this.top5Data.length){new Element("div",{styles:this.css.applicationChildTitleNode,text:this.lp.startTop5}).inject(this.startProcessListNode);var e=new Element("div",{styles:this.css.applicationChildChildNode}).inject(this.startProcessListNode);this.top5Data.sort(function(t,s){return 0-(t.count-s.count)});this.top5Data.each(function(t,s){if(s<5)new MWF.xApplication.process.TaskCenter.Process(t,this,{name:t.applicationName},e)}.bind(this))}t.data.each(function(t){new Element("div",{styles:this.css.applicationChildTitleNode,text:t.name}).inject(this.startProcessListNode);var s=new Element("div",{styles:this.css.applicationChildChildNode}).inject(this.startProcessListNode);t.processList.each(function(e){new MWF.xApplication.process.TaskCenter.Process(e,this,t,s)}.bind(this))}.bind(this))}.bind(this))}.bind(this))}.bind(this))},createStartProcessArea:function(){this.createStartProcessAreaNode();this.createStartProcessScrollNode();this.listApplications();this.setResizeStartProcessAreaHeight();this.addEvent("resize",this.setResizeStartProcessAreaHeight.bind(this))},createStartProcessAreaNode:function(){this.startProcessAreaNode=new Element("div",{styles:this.css.startProcessAreaNode}).inject(this.content)},createStartProcessCloseNode:function(){this.startProcessTopNode=new Element("div",{styles:this.css.startProcessTopNode}).inject(this.startProcessRightListNode);this.startProcessCloseNode=new Element("div",{styles:this.css.startProcessCloseNode}).inject(this.startProcessTopNode);this.startProcessCloseNode.addEvent("click",function(t){this.closeStartProcessArea(t)}.bind(this))},createStartProcessSearchNode:function(){this.startProcessSearchNode=new Element("div",{styles:this.css.startProcessSearchNode}).inject(this.startProcessRightListNode);this.startProcessSearchIconNode=new Element("div",{styles:this.css.startProcessSearchIconNode}).inject(this.startProcessSearchNode);this.startProcessSearchAreaNode=new Element("div",{styles:this.css.startProcessSearchAreaNode}).inject(this.startProcessSearchNode);this.startProcessSearchInputNode=new Element("input",{styles:this.css.startProcessSearchInputNode}).inject(this.startProcessSearchAreaNode);this.startProcessSearchInputNode.set("value",this.lp.searchProcess);this.startProcessSearchInputNode.addEvents({focus:function(){if(this.startProcessSearchInputNode.get("value")===this.lp.searchProcess)this.startProcessSearchInputNode.set("value","")}.bind(this),blur:function(){if(!this.startProcessSearchInputNode.get("value"))this.startProcessSearchInputNode.set("value",this.lp.searchProcess)}.bind(this),keydown:function(t){if(t.code===13)this.searchStartProcess()}.bind(this)});this.startProcessSearchIconNode.addEvent("click",function(){this.searchStartProcess()}.bind(this))},searchStartProcess:function(){var t=this.startProcessSearchInputNode.get("value");if(t&&t!==this.lp.searchProcess){if(this.appStartableData){this.startApplications.each(function(t){t.unselected()});if(this.searchProcessSearchchildNode)this.searchProcessSearchchildNode.destroy();var s=this.lp.searchProcessResault.replace("{key}",t);this.searchProcessSearchchildNode=new Element("div",{styles:this.css.applicationChildNode}).inject(this.startProcessProcessAreaNode);this.searchProcessSearchchildNode.setStyle("display","block");new Element("div",{styles:this.css.applicationChildTitleNode,text:s}).inject(this.searchProcessSearchchildNode);var e=new Element("div",{styles:this.css.applicationChildChildNode}).inject(this.searchProcessSearchchildNode);this.appStartableData.each(function(s){s.processList.each(function(i){if(i.name.indexOf(t)!==-1){var a=Object.clone(i);a.applicationName=s.name;new MWF.xApplication.process.TaskCenter.Process(a,{app:this},{name:s},e)}}.bind(this))}.bind(this))}}},createStartProcessScrollNode:function(){this.startProcessApplicationListNode=new Element("div",{styles:this.css.startProcessApplicationListNode}).inject(this.startProcessAreaNode);this.startProcessRightListNode=new Element("div",{styles:this.css.startProcessRightListNode}).inject(this.startProcessAreaNode);this.createStartProcessCloseNode();this.createStartProcessSearchNode();this.startProcessApplicationScrollNode=new Element("div",{styles:this.css.startProcessApplicationScrollNode}).inject(this.startProcessApplicationListNode);this.startProcessApplicationAreaNode=new Element("div",{styles:this.css.startProcessApplicationAreaNode}).inject(this.startProcessApplicationScrollNode);this.startProcessProcessListNode=new Element("div",{styles:this.css.startProcessProcessListNode}).inject(this.startProcessRightListNode);this.startProcessProcessScrollNode=new Element("div",{styles:this.css.startProcessProcessScrollNode}).inject(this.startProcessProcessListNode);this.startProcessProcessAreaNode=new Element("div",{styles:this.css.startProcessProcessAreaNode}).inject(this.startProcessProcessScrollNode);MWF.require("MWF.widget.ScrollBar",function(){new MWF.widget.ScrollBar(this.startProcessApplicationScrollNode,{distance:100,friction:4});new MWF.widget.ScrollBar(this.startProcessProcessScrollNode,{distance:100,friction:4})}.bind(this))},closeStartProcessArea:function(){if(layout.mobile){var t=this.startProcessAreaNode.getSize();var s=new Fx.Morph(this.startProcessAreaNode,{duration:200,transition:Fx.Transitions.Expo.easeOut,onComplete:function(){this.startProcessAreaNode.setStyle("display","none")}.bind(this)});s.start({left:""+t.x+"px"})}else{this.content.unmask();if(this.startProcessAreaNode)this.startProcessAreaNode.fade("out")}},setResizeStartProcessAreaHeight:function(){if(this.startProcessAreaNode){var t=this.content.getSize();var s=this.startProcessAreaNode.getSize();var e=(t.x-s.x)/2;var i=(t.y-s.y)/2;this.startProcessAreaNode.setStyle("top",""+i+"px");this.startProcessAreaNode.setStyle("left",""+e+"px");var a=this.window.node.getElement("#process_taskcenter_startProcessMask");if(a){a.setStyles({width:""+t.x+"px",height:""+t.y+"px"});a.position({relativeTo:this.content,position:"topLeft",edge:"topLeft"})}if(this.startProcessProcessListNode){var o=this.startProcessTopNode.getSize();var r=this.startProcessSearchNode.getSize();var n=s.y-o.y-r.y;this.startProcessProcessListNode.setStyle("height",""+n+"px")}}},listApplications:function(){this.getAction(function(){this.action.listApplicationStartable(function(t){this.appStartableData=t.data;this.startProcessSearchNode.setStyle("display","block");this.allApplicationStarter=new MWF.xApplication.process.TaskCenter.AllApplication(t.data,this);this.allApplicationStarter.selected();t.data.each(function(t){new MWF.xApplication.process.TaskCenter.Application(t,this)}.bind(this))}.bind(this))}.bind(this))},getAction:function(t){if(!this.action){this.action=MWF.Actions.get("x_processplatform_assemble_surface");if(t)t()}else{if(t)t()}},refreshAll:function(){this.getWorkCounts();if(this.taskList)if(this.currentTab==="task")this.taskList.refresh()},createTaskCompletedList:function(t){if(!this.contentNode)this.loadContent();this.taskCompletedList=new MWF.xApplication.process.TaskCenter.TaskCompletedList(this.contentListAreaNode,this,t)},showDone:function(){if(this.currentTab!=="done"){this.showTab(1);this.currentTab="done";if(!this.taskCompletedList){this.createTaskCompletedList(this.status?this.status.filter:null);this.taskCompletedList.show()}else{this.taskCompletedList.show();if(this.taskCompletedList)this.taskCompletedList.refresh()}}else{if(this.taskCompletedList)this.taskCompletedList.refresh()}this.searchBarAreaNode.setStyle("display","block");this.searchBarInputNode.set("value",this.lp.searchKey)},createReadList:function(t){if(!this.contentNode)this.loadContent();this.readList=new MWF.xApplication.process.TaskCenter.ReadList(this.contentListAreaNode,this,t)},showRead:function(){if(this.currentTab!=="read"){this.showTab(2);this.currentTab="read";if(!this.readList){this.createReadList(this.status?this.status.filter:null);this.readList.show()}else{this.readList.show();if(this.readList)this.readList.refresh()}}else{if(this.readList)this.readList.refresh()}this.searchBarAreaNode.setStyle("display","block");this.searchBarInputNode.set("value",this.lp.searchKey)},createReadedList:function(t){if(!this.contentNode)this.loadContent();this.readedList=new MWF.xApplication.process.TaskCenter.ReadCompletedList(this.contentListAreaNode,this,t)},showReaded:function(){if(this.currentTab!=="readed"){this.showTab(3);this.currentTab="readed";if(!this.readedList){this.createReadedList(this.status?this.status.filter:null);this.readedList.show()}else{this.readedList.show();if(this.readedList)this.readedList.refresh()}}else{if(this.readedList)this.readedList.refresh()}this.searchBarAreaNode.setStyle("display","block");this.searchBarInputNode.set("value",this.lp.searchKey)},createReviewList:function(t){if(!this.contentNode)this.loadContent();this.reviewList=new MWF.xApplication.process.TaskCenter.ReviewList(this.contentListAreaNode,this,t)},showReview:function(){if(this.currentTab!=="review"){this.showTab(4);this.currentTab="review";if(!this.reviewList){this.createReviewList(this.status?this.status.filter:null);this.reviewList.show()}else{this.reviewList.show();if(this.reviewList)this.reviewList.refresh()}}else{if(this.reviewList)this.reviewList.refresh()}this.searchBarAreaNode.setStyle("display","block")},recordStatus:function(){var t=this.currentTab||"task";var s=null;if(t==="done"){s=this.taskCompletedList.filterData}if(t==="read"){s=this.readList.filterData}if(t==="readed"){s=this.readedList.filterData}if(t==="review"){s=this.reviewList.filterData}return{navi:this.currentTab||"task",filter:s}},searchTask:function(){var t=this.searchBarInputNode.get("value");if(t&&t!==this.lp.searchKey){var s=this.currentTab||"task";switch(s){case"task":if(!this.taskList.filterData)this.taskList.filterData={};this.taskList.filterData.key=t;this.taskList.refilter();break;case"done":if(!this.taskCompletedList.filterData)this.taskCompletedList.filterData={};this.taskCompletedList.filterData.key=t;this.taskCompletedList.refilter();break;case"read":if(!this.readList.filterData)this.readList.filterData={};this.readList.filterData.key=t;this.readList.refilter();break;case"readed":if(!this.readedList.filterData)this.readedList.filterData={};this.readedList.filterData.key=t;this.readedList.refilter();break;case"review":if(!this.reviewList.filterData)this.reviewList.filterData={};this.reviewList.filterData.key=t;this.reviewList.refilter();break}}}});MWF.xApplication.process.TaskCenter.Application=new Class({initialize:function(t,s){this.bgColors=["#30afdc","#e9573e","#8dc153","#9d4a9c","#ab8465","#959801","#434343","#ffb400","#9e7698","#00a489"];this.data=t;this.app=s;this.container=this.app.startProcessApplicationAreaNode;this.processContainer=this.app.startProcessProcessAreaNode;this.css=this.app.css;this.isLoaded=false;this.load()},load:function(){this.node=new Element("div",{styles:this.css.applicationNode}).inject(this.container);this.iconAreaNode=new Element("div",{styles:this.css.applicationIconAreaNode}).inject(this.node);this.iconNode=new Element("img",{styles:this.css.applicationIconNode}).inject(this.iconAreaNode);if(this.data.icon){this.iconNode.set("src","data:image/png;base64,"+this.data.icon+"")}else{this.iconNode.set("src","/x_component_process_ApplicationExplorer/$Main/default/icon/application.png")}this.textNode=new Element("div",{styles:this.css.applicationTextNode}).inject(this.node);this.textNode.set("text",this.data.name);this.textNode.set("title",this.data.name);this.childNode=new Element("div",{styles:this.css.applicationChildNode}).inject(this.processContainer);this.node.addEvent("click",function(){this.selected()}.bind(this));this.app.startApplications.push(this)},unselected:function(){this.childNode.setStyle("display","none");this.node.setStyles(this.css.applicationNode)},selected:function(){this.app.startApplications.each(function(t){t.unselected()});if(this.app.searchProcessSearchchildNode)this.app.searchProcessSearchchildNode.destroy();if(this.app.startProcessSearchInputNode)this.app.startProcessSearchInputNode.set("value",this.app.lp.searchProcess);this.childNode.setStyle("display","block");this.node.setStyles(this.css.applicationNode_selected);if(!this.isLoaded){this.loadChild();this.isLoaded=true}},loadChild:function(){new Element("div",{styles:this.css.applicationChildTitleNode,text:this.app.lp.startProcess}).inject(this.childNode);var t=new Element("div",{styles:this.css.applicationChildChildNode}).inject(this.childNode);this.data.processList.each(function(s){new MWF.xApplication.process.TaskCenter.Process(s,this,this.data,t)}.bind(this))}});MWF.xApplication.process.TaskCenter.AllApplication=new Class({Extends:MWF.xApplication.process.TaskCenter.Application,initialize:function(t,s){this.bgColors=["#30afdc","#e9573e","#8dc153","#9d4a9c","#ab8465","#959801","#434343","#ffb400","#9e7698","#00a489"];this.data=t;this.app=s;this.container=this.app.startProcessApplicationAreaNode;this.processContainer=this.app.startProcessProcessAreaNode;this.css=this.app.css;this.isLoaded=false;this.load()},load:function(){this.node=new Element("div",{styles:this.css.applicationNode}).inject(this.container);this.iconAreaNode=new Element("div",{styles:this.css.applicationIconAreaNode}).inject(this.node);this.iconNode=new Element("img",{styles:this.css.applicationIconNode}).inject(this.iconAreaNode);this.iconNode.set("src","/x_component_process_TaskCenter/$Main/default/icon/appAppliction.png");this.textNode=new Element("div",{styles:this.css.applicationTextNode}).inject(this.node);this.textNode.set("text",this.app.lp.all);this.textNode.set("title",this.app.lp.all);this.childNode=new Element("div",{styles:this.css.applicationChildNode}).inject(this.processContainer);this.node.addEvent("click",function(){this.selected()}.bind(this));this.app.startApplications.push(this)},unselected:function(){this.childNode.empty();this.isLoaded=false;this.childNode.setStyle("display","none");this.node.setStyles(this.css.applicationNode)},loadChild:function(){MWF.UD.getDataJson("taskCenter_startTop",function(t){this.top5Data=t;if(this.top5Data&&this.top5Data.length){new Element("div",{styles:this.css.applicationChildTitleNode,text:this.app.lp.startTop5}).inject(this.childNode);var s=new Element("div",{styles:this.css.applicationChildChildNode}).inject(this.childNode);this.top5Data.sort(function(t,s){return 0-(t.count-s.count)});this.top5Data.each(function(t,e){if(e<5)new MWF.xApplication.process.TaskCenter.Process(t,this,{name:t.applicationName},s)}.bind(this))}this.data.each(function(t){new Element("div",{styles:this.css.applicationChildTitleNode,text:t.name}).inject(this.childNode);var s=new Element("div",{styles:this.css.applicationChildChildNode}).inject(this.childNode);t.processList.each(function(e){new MWF.xApplication.process.TaskCenter.Process(e,this,t,s)}.bind(this))}.bind(this))}.bind(this))}});MWF.xApplication.process.TaskCenter.Process=new Class({initialize:function(t,s,e,i){this.data=t;this.application=s;this.applicationData=e;this.app=this.application.app;this.container=i;this.css=this.app.css;this.load()},load:function(){this.node=new Element("div.processItem",{styles:this.css.startProcessNode}).inject(this.container);this.iconNode=new Element("div",{styles:this.css.processIconNode}).inject(this.node);if(this.data.icon){this.iconNode.setStyle("background-image","url("+this.data.icon+")")}else{this.iconNode.setStyle("background-image","url(/x_component_process_ProcessManager/$Explorer/default/processIcon/process.png)")}this.actionNode=new Element("div",{styles:this.css.processActionNode,text:this.app.lp.start}).inject(this.node);this.textNode=new Element("div",{styles:this.css.processTextNode}).inject(this.node);this.textNode.set({text:this.data.name+(this.data.applicationName?" -- ("+this.data.applicationName+")":""),title:this.data.name+"-"+this.data.description});this.actionNode.addEvents({mouseover:function(){this.actionNode.setStyles(this.css.processActionNode_over)}.bind(this),mouseout:function(){this.actionNode.setStyles(this.css.processActionNode)}.bind(this),click:function(t){this.startProcess(t)}.bind(this)});this.node.addEvents({mouseover:function(){this.node.setStyles(this.css.startProcessNode_over);this.actionNode.setStyle("display","block")}.bind(this),mouseout:function(){this.node.setStyles(this.css.startProcessNode_out)}.bind(this)})},startProcess:function(){this.app.closeStartProcessArea();MWF.xDesktop.requireApp("process.TaskCenter","ProcessStarter",function(){var t=new MWF.xApplication.process.TaskCenter.ProcessStarter(this.data,this.app,{onStarted:function(t,s,e){this.afterStartProcess(t,s,e)}.bind(this)});t.load()}.bind(this))},recordProcessData:function(){MWF.UD.getDataJson("taskCenter_startTop",function(t){if(!t||!t.length)t=[];var s=null;this.data.lastStartTime=new Date;var e=0;var i=true;for(var a=0;a<t.length;a++){var o=t[a];if(o.id===this.data.id)s=o;if(i){if(!o.lastStartTime){e=a;i=false}else{if(new Date(o.lastStartTime)<new Date(t[e].lastStartTime)){e=a}}}}if(s){s.lastStartTime=new Date;s.count=(s.count||0)+1;s.applicationName=this.applicationData.name}else{if(t.length<10){this.data.count=1;this.data.applicationName=this.applicationData.name;t.push(this.data)}else{t.splice(e,1);this.data.count=1;this.data.applicationName=this.applicationData.name;t.push(this.data)}}MWF.UD.putData("taskCenter_startTop",t)}.bind(this))},afterStartProcess:function(t,s,e){this.recordProcessData();var i=[];var a=[];t.each(function(t){if(t.currentTaskIndex!==-1)a.push(t.taskList[t.currentTaskIndex].work);i.push(this.getStartWorkInforObj(t))}.bind(this));if(a.length===1){var o={workId:a[0],appId:a[0]};this.app.desktop.openApplication(null,"process.Work",o);this.createStartWorkResault(i,s,e,false)}else{this.createStartWorkResault(i,s,e,true)}},getStartWorkInforObj:function(t){var s=[];var e="";t.taskList.each(function(i,a){s.push(i.person+"("+i.department+")");if(t.currentTaskIndex===a)e=i.id}.bind(this));return{activity:t.fromActivityName,users:s,currentTask:e}},createStartWorkResault:function(t,s,e,i){var a="";t.each(function(t){var s=[];t.users.each(function(t){s.push(MWF.name.cn(t))});a+="<div><b>"+this.app.lp.nextActivity+'<font style="color: #ea621f">'+t.activity+"</font>, "+this.app.lp.nextUser+'<font style="color: #ea621f">'+s.join(", ")+"</font></b>";if(t.currentTask&&i){a+='&nbsp;&nbsp;&nbsp;&nbsp;<span value="'+t.currentTask+'">'+this.app.lp.deal+"</span></div>"}else{a+="</div>"}}.bind(this));var o={subject:this.app.lp.processStarted,content:"<div>"+this.app.lp.processStartedMessage+"“["+e+"]"+s+"”</div>"+a};var r=layout.desktop.message.addTooltip(o);var n=layout.desktop.message.addMessage(o);this.setStartWorkResaultAction(r);this.setStartWorkResaultAction(n)},setStartWorkResaultAction:function(t){var s=t.node.getElements("span");s.setStyles(this.app.css.dealStartedWorkAction);var e=this;s.addEvent("click",function(t){var s={taskId:this.get("value"),appId:this.get("value")};e.app.desktop.openApplication(t,"process.Work",s)})}});