MWF.xApplication.process.TaskCenter.List=new Class({initialize:function(t,e,i){this.container=$(t);this.app=e;this.css=this.app.css;this.currentPageData=[];this.nextPageData=[];this.prevPageData=[];this.initData();this.filterData=null;if(i)this.filterData=i;this.load()},initData:function(){this.count=0;this.isCountShow=false;this.currentPage=1;this.pageCount=20;this.pages=0;this.items=[];this.isItemsLoaded=false;this.isItemLoadding=false;this.loadItemQueue=0;this.filterApplication="";this.currentFilterNode=null;this.filterListNode=null},load:function(){this.mask=new MWF.widget.Mask({style:"desktop"});this.mask.loadNode(this.app.content);this.contentNode=new Element("div",{styles:this.css.listContentNode}).inject(this.container);this.createActionBarNode();this.createListAreaNode();this.resetListAreaHeight();this.app.addEvent("resize",this.resetListAreaHeight.bind(this))},refresh:function(){this.mask=new MWF.widget.Mask({style:"desktop"});this.mask.loadNode(this.app.content);this.initData();this.filterData=null;this.applicationFilterAreaNode.empty();this.createAppFilterNodes();this.listAreaNode.empty();this.resetListAreaHeight();this.app.getWorkCounts()},refilter:function(){this.mask=new MWF.widget.Mask({style:"desktop"});this.mask.loadNode(this.app.content);this.initData();this.applicationFilterAreaNode.empty();this.createAppFilterNodes();this.listAreaNode.empty();this.resetListAreaHeight()},listItemNext:function(t){if(!this.isItemsLoaded){if(!this.isItemLoadding){this.isItemLoadding=true;this._getCurrentPageData(function(t){this.count=t.count;if(!this.isCountShow){this.currentFilterNode.getFirst("span").set("text","("+this.count+")");this.isCountShow=true}if(t.count<=this.items.length){this.isItemsLoaded=true}t.data.each(function(t){this.items.push(this._createItem(t))}.bind(this));this.isItemLoadding=false;if(this.loadItemQueue>0){this.loadItemQueue--;this.listItemNext()}this.mask.hide()}.bind(this),t)}else{this.loadItemQueue++}}},createActionBarNode:function(){this.actionBarNode=new Element("div",{styles:this.css.actionBarNode}).inject(this.contentNode);this.isFilterOpen=false;this.filterActionNode=new Element("div",{styles:this.css.filterActionNode,text:this.app.lp.filter}).inject(this.actionBarNode);this.filterActionNode.addEvents({click:function(t){this.showOrHideFilter();t.stopPropagation()}.bind(this)});this.applicationFilterAreaNode=new Element("div",{styles:this.css.applicationFilterAreaNode}).inject(this.actionBarNode);this.createAppFilterNodes()},showOrHideFilter:function(){if(!this.isFilterOpen){if(!this.filterAreaMorph||!this.filterAreaMorph.isRunning())this.showFilter()}else{if(this.filterAreaMorph||!this.filterAreaMorph.isRunning())this.hideFilter()}},showFilter:function(){this.filterActionNode.setStyles(this.css.filterActionNode_check);if(!this.filterAreaNode)this.createFilterAreaNode();this.filterAreaTipNode.setStyle("display","block");this.filterAreaNode.setStyle("display","block");this.resizeFilterAreaNode();var t=this.app.content.getSize();var e={width:!layout.mobile?"460px":""+t.x+"px",height:!layout.mobile?"500px":""+t.y+"px"};this.isFilterOpen=true;this.filterAreaMorph.start(e).chain(function(){this.createFilterAreaTitle();this.createFilterAreaContent();this.hideFilterFun=this.hideFilter.bind(this);$(document.body).addEvent("click",this.hideFilterFun)}.bind(this))},hideFilter:function(){if(this.filterAreaNode){var t={width:"460px",height:"0px"};this.filterAreaNode.empty();this.isFilterOpen=false;this.filterAreaMorph.start(t).chain(function(){this.filterAreaNode.eliminate("input");this.filterAreaNode.setStyle("display","none");this.filterAreaTipNode.setStyle("display","none");this.filterActionNode.setStyles(this.css.filterActionNode)}.bind(this));$(document.body).removeEvent("click",this.hideFilterFun)}},createFilterAreaContent:function(){var t=new Element("div",{styles:this.css.applicationFilterAreaContentListNode}).inject(this.filterAreaNode);var e=new Element("div",{styles:this.css.applicationFilterAreaContentScrollNode}).inject(t);var i=new Element("div",{styles:{overflow:"hidden","padding-bottom":"20px"}}).inject(e);MWF.require("MWF.widget.ScrollBar",function(){new MWF.widget.ScrollBar(e,{style:"default",distance:30,friction:4,axis:{x:false,y:true}})}.bind(this));var s=this;this.app.getAction(function(){this._getFilterCount(function(t){var e=t.data;Object.each(e,function(t,e){var o=new Element("div",{styles:this.css.applicationFilterCategoryNode}).inject(i);o.set("text",this.app.lp[e]);var n=new Element("div",{styles:this.css.applicationFilterItemAreaNode}).inject(i);t.each(function(t){var i=new Element("div",{styles:this.css.applicationFilterItemNode}).inject(n);i.set("text",t.name);i.store("value",t.value);i.store("textname",t.name);i.store("key",e);i.addEvent("click",function(){if(this.hasClass("applicationFilterItemNode_over")){s.unSelectedFilterItem(this)}else{s.selectedFilterItem(this)}});if(this.filterData){if(this.filterData[e]){if(t.value===this.filterData[e].value){this.selectedFilterItem(i)}}}}.bind(this))}.bind(this))}.bind(this))}.bind(this))},_getFilterCount:function(t){this.app.action.listTaskCompletedFilterCount(function(e){if(t)t(e)})},unSelectedFilterItem:function(t){if(t.hasClass("applicationFilterItemNode_over")){var e=t.retrieve("key");t.setStyles(this.css.applicationFilterItemNode);t.removeClass("applicationFilterItemNode_over");t.addClass("applicationFilterItemNode");if(!this.filterData)this.filterData={};this.filterData[e]=null;delete this.filterData[e];t.getParent().eliminate("current")}},selectedFilterItem:function(t){if(!t.hasClass("applicationFilterItemNode_over")){var e=t.getParent().retrieve("current");if(e)this.unSelectedFilterItem(e);var i=t.retrieve("value");var s=t.retrieve("key");var o=t.retrieve("textname");t.setStyles(this.css.applicationFilterItemNode_over);t.removeClass("applicationFilterItemNode");t.addClass("applicationFilterItemNode_over");if(!this.filterData)this.filterData={};this.filterData[s]={value:i,name:o};t.getParent().store("current",t)}},createFilterAreaTitle:function(){var t=new Element("div",{styles:this.app.css.filterAreaTitleNode}).inject(this.filterAreaNode);var e=new Element("div",{styles:this.app.css.filterAreaTitleActionOkNode,text:this.app.lp.ok}).inject(t);var i=new Element("div",{styles:this.app.css.filterAreaTitleActionClearNode,text:this.app.lp.clear}).inject(t);i.addEvent("click",function(){this.filterAreaNode.getElements(".filterItem").each(function(t){this.unSelectedFilterItem(t)}.bind(this));var t=this.filterAreaNode.retrieve("input");t.set("value","");this.filterData=null;this.hideFilter();this.refilter()}.bind(this));e.addEvent("click",function(){var t=this.filterAreaNode.retrieve("input");if(!this.filterData)this.filterData={};var e=t.get("value");if(e&&e!==this.app.lp.searchKey){this.filterData.key=e}else{this.filterData.key="";delete this.filterData.key}this.hideFilter();this.refilter()}.bind(this));var s=new Element("div",{styles:this.app.css.filterAreaTitleSearchNode}).inject(t);var o=new Element("div",{styles:this.app.css.filterAreaTitleSearchIconNode}).inject(s);var n=new Element("div",{styles:this.app.css.filterAreaTitleSearchInputAreaNode}).inject(s);var l=new Element("input",{styles:this.app.css.filterAreaTitleSearchInputNode,value:this.app.lp.searchKey}).inject(n);if(this.filterData){if(this.filterData.key)l.set("value",this.filterData.key)}this.filterAreaNode.store("input",l);var a=this.app.lp.searchKey;l.addEvents({blur:function(){if(!this.get("value"))this.set("value",a)},focus:function(){if(this.get("value")===a)this.set("value","")}})},createFilterAreaNode:function(){this.filterAreaNode=new Element("div",{styles:this.app.css.filterAreaNode}).inject(this.container);this.filterAreaNode.addEvent("click",function(t){t.stopPropagation()});this.filterAreaTipNode=new Element("div",{styles:this.app.css.filterAreaTipNode}).inject(this.container);this.filterAreaNode.setStyles({width:!layout.mobile?"460px":""+this.app.content.getSize().x+"px",height:"0px"});this.filterAreaNode.position({relativeTo:this.filterActionNode,position:"bottomRight",edge:"upperRight",offset:{x:10,y:7}});this.filterAreaTipNode.position({relativeTo:this.filterAreaNode,position:"topRight",edge:"bottomRight",offset:{x:-26,y:1}});this.app.addEvent("resize",function(){this.resizeFilterAreaNode()}.bind(this));this.filterAreaMorph=new Fx.Morph(this.filterAreaNode,{duration:"100",transition:Fx.Transitions.Sine.easeInOut})},resizeFilterAreaNode:function(){if(this.filterAreaNode){this.filterAreaNode.position({relativeTo:this.filterActionNode,position:"bottomRight",edge:"upperRight",offset:{x:10,y:7}});if(this.filterAreaTipNode){this.filterAreaTipNode.position({relativeTo:this.filterAreaNode,position:"topRight",edge:"bottomRight",offset:{x:-26,y:1}})}}},createAppFilterNodes:function(){var t={name:this.app.lp.all,application:"",count:0};this.allAppFilterNode=this.createAppFilterNode(t,"appFilterNode_current");this.currentFilterNode=this.allAppFilterNode;this._getApplicationCount(function(t){t.data.each(function(t){this.createAppFilterNode(t)}.bind(this))}.bind(this))},createAppFilterNode:function(t,e){e=e||"appFilterNode";var i=new Element("div",{styles:this.app.css[e]}).inject(this.applicationFilterAreaNode);var s=t.count?t.name+"<span>("+t.count+")</span>":t.name+"<span></span>";i.set({html:s,id:t.value});var o=this;i.addEvent("click",function(t){o.filterByApplication(this)});return i},filterByApplication:function(t){var e=t.get("id");if(!e){this.refresh()}else{if(this.currentFilterNode)this.currentFilterNode.setStyles(this.app.css.appFilterNode);this.initData();this.filterApplication=e;this.listAreaNode.empty();this.resetListAreaHeight();this.currentFilterNode=t;this.currentFilterNode.setStyles(this.app.css.appFilterNode_current)}},createListAreaNode:function(){this.listScrollAreaNode=new Element("div",{styles:this.css.listScrollAreaNode}).inject(this.contentNode);this.listAreaNode=new Element("div",{styles:this.css.listAreaNode}).inject(this.listScrollAreaNode);var t=this;MWF.require("MWF.widget.ScrollBar",function(){new MWF.widget.ScrollBar(this.listScrollAreaNode,{style:"xApp_TaskList",where:"before",distance:30,friction:4,axis:{x:false,y:true},onScroll:function(e,i){var s=t.listScrollAreaNode.getScrollSize();var o=t.listScrollAreaNode.getSize();var n=s.y-o.y;if(e+200>n){if(!t.isElementLoaded)t.listItemNext()}}})}.bind(this))},resetListAreaHeight:function(){if(layout.mobile){this.resetListAreaHeight_mobile()}else{this.resetListAreaHeight_pc()}},resetListAreaHeight_mobile:function(){var t=this.app.contentNode.getSize();this.contentNode.setStyle("width",""+t.x+"px");var e=this.contentNode.getSize();var i=this.actionBarNode.getSize();var s=e.y-i.y;this.listScrollAreaNode.setStyle("height",""+s+"px");if(this.listAreaNode){this.pageCount=50;debugger;if(this.items.length<this.pageCount){this.listItemNext(this.pageCount-this.items.length)}}},resetListAreaHeight_pc:function(){debugger;var t=this.app.contentNode.getSize();this.contentNode.setStyle("width",""+t.x+"px");var e=this.contentNode.getSize();var i=this.actionBarNode.getSize();var s=e.y-i.y;this.listScrollAreaNode.setStyle("height",""+s+"px");if(this.listAreaNode){var o=(e.x/350).toInt();var n=350*o;var l=(e.x-n)/2;this.listAreaNode.setStyles({width:""+n+"px","margin-left":""+l+"px"});if(this.actionBarNode)this.actionBarNode.setStyles({width:""+n+"px","margin-left":""+l+"px"});var a=(s/182).toInt()+1;this.pageCount=o*a;if(this.items.length<this.pageCount){this.listItemNext(this.pageCount-this.items.length)}}},show:function(){debugger;if(this.app.currentList)this.app.currentList.hide();this.app.currentList=this;this.contentNode.setStyle("display","block")},hide:function(){this.contentNode.setStyle("display","none")},_getCurrentPageData:function(t,e){this.app.getAction(function(){var i;if(this.filterApplication){i=this.items.length?this.items[this.items.length-1].data.id:"(0)";this.app.action.listTaskNextByApp(function(e){if(t)t(e)},null,i,e||this.pageCount,this.filterApplication)}else{i=this.items.length?this.items[this.items.length-1].data.id:"(0)";this.app.action.listTaskNext(function(e){if(t)t(e)},null,i,e||this.pageCount)}}.bind(this))},_getApplicationCount:function(t){this.app.getAction(function(){this.app.action.listTaskApplication(function(e){if(t)t(e)}.bind(this))}.bind(this))},_createItem:function(t){return new MWF.xApplication.process.TaskCenter.TaskList.Item(t,this)},showDatch:function(){if(!this.datchActionNode){this.datchActionNode=new Element("div",{styles:this.css.datchActionNode,text:this.app.lp.datch}).inject(this.app.content);this.datchActionNode.position({relativeTo:this.actionBarNode,position:"centerbottom",edge:"centerbottom"});this.datchActionNode.addEvent("click",function(t){this.datchProcess()}.bind(this))}},hideDatch:function(){if(this.datchActionNode){this.datchActionNode.destroy();this.datchActionNode=null}},datchProcess:function(){var t="580";var e="260";size=this.app.content.getSize();var i=(size.x-t)/2;var s=(size.y-e)/2;if(i<0)i=0;if(s<0)s=0;var o=this;MWF.require("MWF.xDesktop.Dialog",function(){var n=new MWF.xDesktop.Dialog({title:this.app.lp.datch,style:"datch",top:s-20,left:i,fromTop:s-20,fromLeft:i,width:t,height:e,html:"",maskNode:this.app.content,container:this.app.content});n.show();MWF.xDesktop.requireApp("process.Work","Processor",function(){new MWF.xApplication.process.Work.Processor(n.content,this.selectedTask[0].data,{style:"task",onCancel:function(){n.close();delete this},onSubmit:function(t,e){o.submitDatchTask(t,e,this);n.close();delete this}})}.bind(this))}.bind(this))},submitDatchTask:function(t,e,i){this.hideDatch();this.selectedTask.each(function(s){s.submitTask(t,e,i,true)}.bind(this));this.selectedTask=[]}});MWF.xApplication.process.TaskCenter.List.Item=new Class({initialize:function(t,e){this.data=t;this.list=e;this.container=this.list.listAreaNode;this.load()},load:function(){this.node=new Element("div",{styles:this.list.css.itemNode}).inject(this.container);if(layout.mobile){this.node.setStyles(this.list.css.itemNode_mobile)}this.mainContentNode=new Element("div",{styles:this.list.css.itemMainContentAreaNode}).inject(this.node);this.timeContentNode=new Element("div",{styles:this.list.css.itemTimeContentAreaNode}).inject(this.node);this.leftContentNode=new Element("div",{styles:this.list.css.itemMainLeftContentAreaNode}).inject(this.mainContentNode);this.applicationIconAreaNode=new Element("div",{styles:this.list.css.itemApplicationIconAreaNode,title:this.data.applicationName}).inject(this.leftContentNode);this.timeIconNode=new Element("div",{styles:this.list.css.itemTimeIconNode}).inject(this.leftContentNode);this.applicationIconNode=new Element("div",{styles:this.list.css.itemApplicationIconNode}).inject(this.applicationIconAreaNode);this.actionContentNode=new Element("div",{styles:this.list.css.itemMainActionContentAreaNode}).inject(this.mainContentNode);this.rightContentNode=new Element("div",{styles:this.list.css.itemMainRightContentAreaNode}).inject(this.mainContentNode);this.applicationTitleNode=new Element("div",{styles:this.list.css.itemApplicationTitleNode}).inject(this.rightContentNode);this.titleNode=new Element("div",{styles:this.list.css.itemTitleNode}).inject(this.rightContentNode);this.activityNode=new Element("div",{styles:this.list.css.itemActivityNode}).inject(this.rightContentNode);this.newIconNode=new Element("div",{styles:this.list.css.itemNewIconNode}).inject(this.node);this.setContent();this.setNewIcon();this.setEvent();this.setTimeIcon();this.node.fade("in")},setTimeIcon:function(){if(this.data.completed){this.newIconNode.setStyle("background-image","url("+"/x_component_process_TaskCenter/$Main/default/time/pic_ok.png)");return true}this.timeIconNode.empty();if(this.data.expireTime){var t=Date.parse(this.data.expireTime);var e=Date.parse(this.data.createTime);var i=new Date;var s=e.diff(i,"second");var o=i.diff(t,"second");var n=e.diff(t,"second");var l=s/n;var a="";var r=this.list.app.lp.expire1;r=r.replace(/{time}/g,this.data.expireTime);if(l<.5){a="1.png"}else if(l<.75){a="2.png"}else if(l<1){r=this.list.app.lp.expire2.replace(/{time}/g,this.data.expireTime);a="3.png";this.newIconNode.setStyle("background-image","url("+"/x_component_process_TaskCenter/$Main/default/time/pic_jichao.png)")}else if(l<2){r=this.list.app.lp.expire3.replace(/{time}/g,this.data.expireTime);a="4.png";this.newIconNode.setStyle("background-image","url("+"/x_component_process_TaskCenter/$Main/default/time/pic_yichao.png)")}else{r=this.list.app.lp.expire3.replace(/{time}/g,this.data.expireTime);a="5.png";this.newIconNode.setStyle("background-image","url("+"/x_component_process_TaskCenter/$Main/default/time/pic_yanchao.png)")}this.timeIconNode.setStyle("background-image","url("+this.list.app.path+this.list.app.options.style+"/time/"+a+")");this.timeIconNode.set("title",r)}},setEvent:function(){this.node.addEvents({mouseover:function(){this.showAction()}.bind(this),mouseout:function(){this.hideAction()}.bind(this)});if(this.editNode){this.editNode.addEvent("click",function(t){this.editTask()}.bind(this))}if(this.closeNode){this.closeNode.addEvent("click",function(t){this.closeEditTask()}.bind(this))}if(this.rightContentNode){this.rightContentNode.addEvent("click",function(t){this.openTask(t)}.bind(this))}if(this.applicationIconNode){this.applicationIconNode.addEvent("click",function(t){this.selectTask(t)}.bind(this))}},selectTask:function(){if(!this.list.selectedTask)this.list.selectedTask=[];if(!this.selectedStatus){this.list.selectedTask.push(this);this.mainContentNodeBorder=this.mainContentNode.getStyle("border");debugger;this.mainContentNode.setStyles(this.list.css.itemMainContentAreaNode_selected);this.selectedStatus=true}else{this.list.selectedTask.erase(this);this.mainContentNode.setStyles(this.list.css.itemMainContentAreaNode);this.mainContentNode.setStyle("border",this.mainContentNodeBorder);this.selectedStatus=false}if(this.checkProcess()){this.list.showDatch()}else{this.list.hideDatch()}},checkProcess:function(){var t=true;var e="";if(this.list.selectedTask.length){for(var i=0;i<this.list.selectedTask.length;i++){var s=this.list.selectedTask[i];if(!s.data.allowRapid)return false;if(!e){e=s.data.activity}else{if(e!=s.data.activity||!s.data.allowRapid)return false}}}else{return false}return true},showAction:function(){},hideAction:function(){},openTask:function(t){var e={workId:this.data.work,appId:this.data.work};this.list.app.desktop.openApplication(t,"process.Work",e)},closeEditTask:function(t){this.closeNode.setStyle("display","none");this.flowInforLeftNode.destroy();this.flowInforRightNode.destroy();this.flowInforContentNode.destroy();this.flowInforScrollNode.destroy();this.flowInforNode.destroy();this.processNode.destroy();this.flowInforScrollFx=null;this.flowInforLeftNode=null;this.flowInforRightNode=null;this.flowInforScrollNode=null;this.flowInforContentNode=null;delete this.flowInforScrollFx;delete this.flowInforLeftNode;delete this.flowInforRightNode;delete this.flowInforScrollNode;delete this.flowInforContentNode;delete this.flowInforNode;delete this.processNode;var e=this.node.getPosition(this.list.app.content);this.list.css.itemNode_edit_from.top=""+e.y+"px";this.list.css.itemNode_edit_from.left=""+e.x+"px";var i=new Fx.Morph(this.mainContentNode,{duration:200,transition:Fx.Transitions.Expo.easeIn,onComplete:function(){this.nodeClone.destroy();this.nodeClone=null;this.list.app.content.unmask();document.body.setStyle("-webkit-overflow-scrolling","touch");this.mainContentNode.setStyles(this.list.css.itemMainContentAreaNode);this.mainContentNode.setStyle("opacity",1);this.list.app.removeEvent("resize",this.resizeEditNodeFun);this.editNode.setStyle("display","block");if(t)t()}.bind(this)});i.start(this.list.css.itemNode_edit_from)},editTask:function(){if(layout.mobile){this.editTask_mobile()}else{this.editTask_pc()}},editTask_mobile:function(){if(!this.nodeClone){this._getJobByTask(function(t){this.nodeClone=this.mainContentNode.clone(false);this.nodeClone.inject(this.mainContentNode,"after");this.mainContentNode.setStyles(this.list.css.itemNode_edit_from_mobile);this.mainContentNode.position({relativeTo:this.nodeClone,position:"topleft",edge:"topleft"});this.showEditNode(t)}.bind(this))}},editTask_pc:function(){this.list.app.content.mask({destroyOnHide:true,id:"mask_"+this.data.id,style:this.list.css.maskNode});this._getJobByTask(function(t){this.nodeClone=this.mainContentNode.clone(false);this.nodeClone.inject(this.mainContentNode,"after");this.mainContentNode.setStyles(this.list.css.itemNode_edit_from);this.mainContentNode.position({relativeTo:this.nodeClone,position:"topleft",edge:"topleft"});this.showEditNode(t)}.bind(this))},setEditTaskNodes:function(t){this.flowInforNode=new Element("div",{styles:this.list.css.flowInforNode}).inject(this.mainContentNode);this.processNode=new Element("div",{styles:this.list.css.processNode}).inject(this.mainContentNode);this.setFlowInfor(t);this.setProcessor()},setFlowChart:function(t){var e=0;t.workLogList.each(function(i){if(!i.taskCompletedList)i.taskCompletedList=[];if(!i.taskList)i.taskList=[];if(i.taskCompletedList.length||i.taskList.length){this.createFlowInforWorklogNode(i.fromActivityName,i.taskCompletedList,i.taskList||[],e,i.fromActivityToken==t.task.activityToken);e++}}.bind(this));return e},setFlowInfor:function(t){this.flowInforLeftNode=new Element("div",{styles:this.list.css.flowInforLeftNode}).inject(this.flowInforNode);this.flowInforRightNode=new Element("div",{styles:this.list.css.flowInforRightNode}).inject(this.flowInforNode);this.flowInforScrollNode=new Element("div",{styles:this.list.css.flowInforScrollNode}).inject(this.flowInforNode);this.flowInforContentNode=new Element("div",{styles:this.list.css.flowInforContentNode}).inject(this.flowInforScrollNode);var e=this.setFlowChart(t);var i=e*40+(e-1)*16;this.flowInforContentNode.setStyle("width",""+i+"px");this.setFlowInforScroll()},toFlowInforLeft:function(){var t=this.flowInforScrollNode.getSize();var e=this.flowInforScrollNode.getScrollSize();var i=this.flowInforScrollNode.getScroll();if(i.x>0){var s=i.x-t.x;if(s<0)s=0;if(s>0){}else{this.flowInforLeftNode.setStyle("background-image","")}if(s+t.x<e.x){this.flowInforRightNode.setStyle("background-image","url("+"/x_component_process_TaskCenter/$Main/default/processor/right.png)")}else{}this.flowInforScrollFx.start(s)}},toFlowInforRight:function(){var t=this.flowInforScrollNode.getSize();var e=this.flowInforScrollNode.getScrollSize();var i=this.flowInforScrollNode.getScroll();if(i.x+t.x<e.x){var s=i.x+t.x;if(s>e.x)s=e.x;if(s>0){this.flowInforLeftNode.setStyle("background-image","url("+"/x_component_process_TaskCenter/$Main/default/processor/left.png)")}else{}if(s+t.x<e.x){}else{this.flowInforRightNode.setStyle("background-image","")}this.flowInforScrollFx.start(s)}},setFlowInforScroll:function(){var t=this.flowInforScrollNode.getSize();var e=this.flowInforScrollNode.getScrollSize();var i=this.flowInforScrollNode.getScroll();if(e.x>t.x){if(!this.flowInforScrollFx)this.flowInforScrollFx=new Fx.Scroll(this.flowInforScrollNode,{wheelStops:false});this.flowInforScrollFx.toRight();this.flowInforLeftNode.setStyle("background-image","url("+"/x_component_process_TaskCenter/$Main/default/processor/left.png)");this.flowInforLeftNode.addEvent("click",function(){this.toFlowInforLeft()}.bind(this));this.flowInforRightNode.addEvent("click",function(){this.toFlowInforRight()}.bind(this))}},createFlowInforWorklogNode:function(t,e,i,s,o){if(s!=0)var n=new Element("div",{styles:this.list.css.logLineNode}).inject(this.flowInforContentNode);var l=new Element("div",{styles:this.list.css.logActivityNode}).inject(this.flowInforContentNode);var a=new Element("div",{styles:this.list.css.logActivityIconNode}).inject(l);var r=new Element("div",{styles:this.list.css.logActivityTextNode,text:t}).inject(l);var h="user";var d="";if(e.length+i.length>1)h="users";if(o)d="_red";var c=new Element("div",{styles:this.list.css.logInforNode});e.each(function(t){var e=new Element("div",{styles:this.list.css.logRouteNode}).inject(c);e.set("text",t.person.substring(0,t.person.indexOf("@"))+": ");var i=new Element("div",{styles:this.list.css.logOpinionNode}).inject(c);if(!t.opinion)t.opinion="";i.set("text","["+t.routeName+"] "+t.opinion);var s=new Element("div",{styles:this.list.css.logTimeNode}).inject(c);s.set("text",t.completedTime);if(this.list.app.desktop.session.user.distinguishedName===t.person)if(!d)d="_yellow"}.bind(this));i.each(function(t){var e=new Element("div",{styles:this.list.css.taskTextNode}).inject(c);e.set("text",t.person.substring(0,t.person.indexOf("@"))+" "+this.list.app.lp.processing)}.bind(this));var p="url("+"/x_component_process_TaskCenter/$Main/default/processor/"+h+d+".png)";a.setStyle("background-image",p);if(i.length){var f=new Element("div",{styles:this.list.css.logTaskCountNode}).inject(l);var u=i.length>99?"99+":i.length;f.set("text",u)}new mBox.Tooltip({content:c,setStyles:{content:{padding:10,lineHeight:20}},attach:l,transition:"flyin",offset:{x:this.list.app.contentNode.getScroll().x,y:this.list.listScrollAreaNode.getScroll().y}})},setProcessor:function(){var t=this;MWF.xDesktop.requireApp("process.Work","Processor",function(){new MWF.xApplication.process.Work.Processor(this.processNode,this.data,{style:"task",onCancel:function(){t.closeEditTask();delete this},onSubmit:function(e,i){t.submitTask(e,i,this);delete this}})}.bind(this))},addMessage:function(t){var e="";if(t.length){t.each(function(t){var i=[];t.taskList.each(function(t){i.push(t.person+"("+t.department+")")}.bind(this));e+="<div><b>"+this.list.app.lp.nextActivity+'<font style="color: #ea621f">'+t.fromActivityName+"</font>, "+this.list.app.lp.nextUser+'<font style="color: #ea621f">'+i.join(", ")+"</font></b></div>"}.bind(this))}else{e+=this.list.app.lp.workCompleted}var i={subject:this.list.app.lp.taskProcessed,content:"<div>"+this.list.app.lp.taskProcessedMessage+"“"+this.data.title+"”</div>"+e};layout.desktop.message.addTooltip(i);layout.desktop.message.addMessage(i)},submitTask:function(t,e,i,s){if(!e)e=t;this.data.routeName=t;this.data.opinion=e;this.list.app.action.processTask(function(t){if(i)i.destroy();if(!s){this.closeEditTask(function(){this.node.destroy();this.list.refresh();this.addMessage(t.data);delete this}.bind(this))}else{this.node.destroy();this.list.refresh();this.addMessage(t.data);delete this}}.bind(this),null,this.data.id,this.data)},resizeEditNode:function(){var t=this.getEditNodePosition();var e=this.list.app.content.getSize();var i=this.list.app.window.node.getElement("#mask_"+this.data.id);if(i)i.setStyles({width:""+e.x+"px",height:""+e.y+"px"});this.mainContentNode.setStyles({top:""+t.y+"px",left:""+t.x+"px"})},getEditNodePosition:function(){var t=this.list.app.content.getSize();var e=this.node.getPosition(this.list.app.content);var i=e.y;var s=e.x;var o=this.list.css.itemNode_edit.width.toInt();var n=this.list.css.itemNode_edit.height.toInt();if(i+n>t.y){i=t.y-n;if(i<0)i=0}if(s+o>t.x){s=t.x-o;if(s<0)s=0}return{x:s,y:i}},showEditNode:function(t,e){if(layout.mobile){this.showEditNode_mobile(t,e)}else{this.showEditNode_pc(t,e)}},showEditNode_mobile:function(t,e){var i=this.list.app.tabAreaNode.getPosition(this.list.app.content);var s=this.list.app.contentNode.getSize();var o=this.list.app.tabAreaNode.getSize();var n=s.y+o.y;this.list.css.itemNode_edit.top=""+i.y+"px";this.list.css.itemNode_edit.left=""+i.x+"px";this.list.css.itemNode_edit.width=""+s.x+"px";this.list.css.itemNode_edit.height=""+n+"px";document.body.setStyle("-webkit-overflow-scrolling","auto");this.editNode.setStyle("display","none");var l=new Fx.Morph(this.mainContentNode,{duration:200,transition:Fx.Transitions.Expo.easeOut,onComplete:function(){this.resizeEditNodeFun=this.resizeEditNode.bind(this);this.list.app.addEvent("resize",this.resizeEditNodeFun);this.setEditTaskNodes(t);this.closeNode.setStyle("display","block");if(e)e()}.bind(this)});l.start(this.list.css.itemNode_edit)},showEditNode_pc:function(t,e){var i=this.getEditNodePosition();this.list.css.itemNode_edit.top=""+i.y+"px";this.list.css.itemNode_edit.left=""+i.x+"px";this.editNode.setStyle("display","none");var s=new Fx.Morph(this.mainContentNode,{duration:200,transition:Fx.Transitions.Expo.easeOut,onComplete:function(){this.resizeEditNodeFun=this.resizeEditNode.bind(this);this.list.app.addEvent("resize",this.resizeEditNodeFun);this.setEditTaskNodes(t);this.closeNode.setStyle("display","block");if(e)e()}.bind(this)});s.start(this.list.css.itemNode_edit)},_getJobByTask:function(t){this.list.app.action.getSimpleJobByTask(function(e){if(t)t(e.data)}.bind(this),null,this.data.id)},setContent:function(){this.applicationTitleNode.set("text",this.data.applicationName);this.titleNode.set("html",'<font style="color: #333;">['+this.data.processName+"]&nbsp;&nbsp;</font>"+this.data.title);this.titleNode.set("title",this.data.title);this.activityNode.set("text","( "+(this.data.activityName||this.list.app.lp.completed)+" )");this.timeContentNode.set("text",this.list.app.lp.list_comedate+": "+this.data.startTime);this.loadActions();this.loadApplicationIcon()},loadActions:function(){if(this.data.allowRapid){this.editNode=new Element("div",{styles:this.list.css.titleActionEditNode}).inject(this.actionContentNode);this.closeNode=new Element("div",{styles:this.list.css.titleActionCloseNode}).inject(this.actionContentNode)}},loadApplicationIcon:function(){this.getApplicationIcon(function(t){debugger;if(t.icon){this.applicationIconNode.setStyle("background-image","url(data:image/png;base64,"+t.icon+")")}else{this.mainContentNode.setStyle("border-top","4px solid #4e82bd");this.applicationIconNode.setStyle("background-image","url("+"/x_component_process_ApplicationExplorer/$Main/default/icon/application.png)")}}.bind(this))},getApplicationIcon:function(t){var e=this.list.app.appIcons[this.data.application];if(!e){this.list.app.action.getApplicationIcon(function(e){if(e.data){if(e.data){this.list.app.appIcons[this.data.application]=e.data;if(t)t(e.data)}}else{this.invalidItem=true;if(t)t({icon:"iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAEgElEQVR4Xu1aPXMTSRB9vUaGQqs6iCgi4Bfgq7I2lqWrSwgQMQHyPzAJIeguvOT4BxbBxYjgkquTrFiiCvkXYCKKCFMSFEjs9tWsrEKWvTtfuyvXrTbd6ZnuN69fz842IecP5Tx+rAFYMyDnCKxTYBUE4MrWta9UuLu49hWeHlJveJy1P6kzQAT7eWPzPgN1MFeI6FpckMx8DKIeAe2iP3mVNiipADALuvAIQAOgLbtd5SGAVtGfvkgDjMQB+Fz1ngXgPdlO64IimOGAnhe7/d90bePGJwbAuOY9AqMJwu0kHTwzF+MIhKbb6b9IYh1rAATdxxub+yRyPMOHgbbrT3Zt08IKgHGlvIUN7NvnuSlyPISPXbc3EDph9BgDMPplu4KAXiad67pRhFXD4Qelf1/3dG3FeCMARPDEzoHJgmnZMAU7JiBoAyBozw4OVr3zy0AKJlCAHd100ALgpL4frC7nZfzhYdGf7ugIoxYAo5r3Mmu1l4V8hglAu9TpP1C1UwZgXC03QLSvOvFKxzHvut1BS8UHDQC8t6kfclQ8VhnDOHK7/TsqQ5UAGFW9JhGeqUy4PIZu3AR/eG9iChtbcPDY7b5+LltYCkB40nMKb01U/9Kv93D5yVN8++N3fP/nb5kvp97b2IqJRFVwg+kdmSBKARhXt/dAzp9a3gOYBzC30wHBxvaUnwoskANQK7/RLXvLAeiAYGN7dpN46HYGP8dtXiwAJ5cZH3V2X+Tt1b/akSZxTIgKfj7Zl4d1bT0p+pPrcWkQC4Bp6ZMFch4IJjZKGyMpibEAjGpem4D7SgstDdIJSGesri8MvCp1+pGf6vEAVMsfTdR/7qRKYGKsqBRRj454njeHqAal7uB61PzxKVDzWBfx5fEyEOLmtw1+Prfb6UfGGfnCRACjgjEBIanghU9GACT9za8DQpLBh4eimLuCSAYkDYBwRAWEpINfA3BRGKCy+zonRh1xNkqB3IugQHic5zIoABjVyscE+kmHbotjZbQXgpf6QQj8qdQZRP6QXR+F43Y39x9DJkL4v/ocDoWw6g1BONXNIdMEm0sNG9szfjEO3W4/tj9BfiOU9yux2e/vwpFJNbC52LSxDY+/4E+uP71tfSkalsM8X4vP82pc9URnxi1Z/l+I94x3brev1Kki1YAfAOT819jsZGh+R5gVM2R3gMt+KDMgFBbR/uZs9nTLYlbBg3FYDCYVmfAt+qMFQHguEA0SG+iZVIU0gRCqTz4qqTZIzANI47bIFpzMWmQWQQBTe9VMEDsP4rpJf5CIRTsFFncqbJNzqLUyTWAcIuCGLu2tNGCZqieNki3TP0im1Bdq7/qTho7gnbeWFQNOsUG00IBEq2y6hyXGO4Cbqi0wMoATA+DHgWl7j4maSWtDqPIsApd3fciCTjQFzltsdl641ACchrU+iDxH0CoG31u2dE81BaJQn4FRqDNRXRylZMwIVR3UI+Z2MZi20wg6dQaoUDDsNV54TMuYylpxYxLXAFuHsrZfA5A14hdtvTUDLtqOZO1P7hnwH8CljF98DV13AAAAAElFTkSuQmCC",iconHue:"#4e82bd"})}}.bind(this),function(){this.invalidItem=true;if(t)t({icon:"iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAEgElEQVR4Xu1aPXMTSRB9vUaGQqs6iCgi4Bfgq7I2lqWrSwgQMQHyPzAJIeguvOT4BxbBxYjgkquTrFiiCvkXYCKKCFMSFEjs9tWsrEKWvTtfuyvXrTbd6ZnuN69fz842IecP5Tx+rAFYMyDnCKxTYBUE4MrWta9UuLu49hWeHlJveJy1P6kzQAT7eWPzPgN1MFeI6FpckMx8DKIeAe2iP3mVNiipADALuvAIQAOgLbtd5SGAVtGfvkgDjMQB+Fz1ngXgPdlO64IimOGAnhe7/d90bePGJwbAuOY9AqMJwu0kHTwzF+MIhKbb6b9IYh1rAATdxxub+yRyPMOHgbbrT3Zt08IKgHGlvIUN7NvnuSlyPISPXbc3EDph9BgDMPplu4KAXiad67pRhFXD4Qelf1/3dG3FeCMARPDEzoHJgmnZMAU7JiBoAyBozw4OVr3zy0AKJlCAHd100ALgpL4frC7nZfzhYdGf7ugIoxYAo5r3Mmu1l4V8hglAu9TpP1C1UwZgXC03QLSvOvFKxzHvut1BS8UHDQC8t6kfclQ8VhnDOHK7/TsqQ5UAGFW9JhGeqUy4PIZu3AR/eG9iChtbcPDY7b5+LltYCkB40nMKb01U/9Kv93D5yVN8++N3fP/nb5kvp97b2IqJRFVwg+kdmSBKARhXt/dAzp9a3gOYBzC30wHBxvaUnwoskANQK7/RLXvLAeiAYGN7dpN46HYGP8dtXiwAJ5cZH3V2X+Tt1b/akSZxTIgKfj7Zl4d1bT0p+pPrcWkQC4Bp6ZMFch4IJjZKGyMpibEAjGpem4D7SgstDdIJSGesri8MvCp1+pGf6vEAVMsfTdR/7qRKYGKsqBRRj454njeHqAal7uB61PzxKVDzWBfx5fEyEOLmtw1+Prfb6UfGGfnCRACjgjEBIanghU9GACT9za8DQpLBh4eimLuCSAYkDYBwRAWEpINfA3BRGKCy+zonRh1xNkqB3IugQHic5zIoABjVyscE+kmHbotjZbQXgpf6QQj8qdQZRP6QXR+F43Y39x9DJkL4v/ocDoWw6g1BONXNIdMEm0sNG9szfjEO3W4/tj9BfiOU9yux2e/vwpFJNbC52LSxDY+/4E+uP71tfSkalsM8X4vP82pc9URnxi1Z/l+I94x3brev1Kki1YAfAOT819jsZGh+R5gVM2R3gMt+KDMgFBbR/uZs9nTLYlbBg3FYDCYVmfAt+qMFQHguEA0SG+iZVIU0gRCqTz4qqTZIzANI47bIFpzMWmQWQQBTe9VMEDsP4rpJf5CIRTsFFncqbJNzqLUyTWAcIuCGLu2tNGCZqieNki3TP0im1Bdq7/qTho7gnbeWFQNOsUG00IBEq2y6hyXGO4Cbqi0wMoATA+DHgWl7j4maSWtDqPIsApd3fciCTjQFzltsdl641ACchrU+iDxH0CoG31u2dE81BaJQn4FRqDNRXRylZMwIVR3UI+Z2MZi20wg6dQaoUDDsNV54TMuYylpxYxLXAFuHsrZfA5A14hdtvTUDLtqOZO1P7hnwH8CljF98DV13AAAAAElFTkSuQmCC",
iconHue:"#f44336"})}.bind(this),this.data.application)}else{if(t)t(e)}},setNewIcon:function(){var t=(new Date).parse(this.data.startTime);var e=new Date;if(e.getTime()-t.getTime()<864e5){this.newIconNode.setStyle("background-image","url("+"/x_component_process_TaskCenter/$Main/default/time/new.png)")}},setTimeIconNode:function(){var t=["#FF0000","#00d400","#f6ff0c"];var e=(Math.random()*3).toInt();var i=t[e];this.timeIconNode.setStyle("background-color",i)}});