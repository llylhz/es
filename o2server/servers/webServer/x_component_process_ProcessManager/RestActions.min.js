MWF.xDesktop.requireApp("process.ProcessManager","package",null,false);MWF.xApplication.process.ProcessManager.RestActions=new Class({initialize:function(s){this.actions=s;this.designAddress=""},listApplicationAddress:function(s,e){var t=this.actions.listAddress;t=this.actions.slotHost+t;var i=new MWF.xApplication.process.ProcessManager.RestActions.Callback(s,e);MWF.getJSON(t,i)},getDesignAddress:function(s,e){this.designAddress="http://xa01.zoneland.net:9080/x_processplatform_core_designer";if(s)s.apply()},request:function(s,e,t,i){if(this.designAddress){this["_"+t](s,e,i)}else{this.getDesignAddress(function(r){this["_"+t](s,e,i)}.bind(this),e)}},_getId:function(s,e,t){var i=this.designAddress+this.actions.getId;i=i.replace(/{count}/g,t);var r=new MWF.xApplication.process.ProcessManager.RestActions.Callback(s,e);MWF.getJSON(i,r)},getId:function(s,e,t){this.request(e,t,"getId",s)},getUUID:function(){if(!this.designAddress)this.getDesignAddress();var s=this.designAddress+this.actions.getId;s=s.replace(/{count}/g,"1");var e="";var t=new MWF.xApplication.process.ProcessManager.RestActions.Callback(function(s){e=s.data[0].id},null);MWF.getJSON(s,t,false);return e},_listFormCategory:function(s,e,t){var i=this.designAddress+this.actions.listFormCategory;i=i.replace(/{id}/g,t.lastId?t.lastId:"(0)");i=i.replace(/{count}/g,t.count?t.count:"20");var r=new MWF.xApplication.process.ProcessManager.RestActions.Callback(s,e);MWF.getJSON(i,r)},listFormCategory:function(s,e,t,i){this.request(t,i,"listFormCategory",{lastId:s,count:e})},_listProcessCategory:function(s,e,t){var i=this.designAddress+this.actions.listProcessCategory;i=i.replace(/{id}/g,t.lastId?t.lastId:"(0)");i=i.replace(/{count}/g,t.count?t.count:"20");var r=new MWF.xApplication.process.ProcessManager.RestActions.Callback(s,e);MWF.getJSON(i,r)},listProcessCategory:function(s,e,t,i){this.request(t,i,"listProcessCategory",{lastId:s,count:e})},_listForm:function(s,e,t){var i=this.designAddress+this.actions.listForm;i=i.replace(/{cid}/g,t.category);i=i.replace(/{id}/g,t.last?t.last:"(0)");i=i.replace(/{count}/g,t.count?t.count:"20");var r=new MWF.xApplication.process.ProcessManager.RestActions.Callback(s,e);MWF.getJSON(i,r)},listForm:function(s,e,t,i,r){this.request(i,r,"listForm",{category:s,last:e,count:t})},_listProcess:function(s,e,t){var i=this.designAddress+this.actions.listProcess;i=i.replace(/{cid}/g,t.category);i=i.replace(/{id}/g,t.last?t.last:"(0)");i=i.replace(/{count}/g,t.count?t.count:"20");var r=new MWF.xApplication.process.ProcessManager.RestActions.Callback(s,e);MWF.getJSON(i,r)},listProcess:function(s,e,t,i,r){this.request(i,r,"listProcess",{category:s,last:e,count:t})},_getForm:function(s,e,t){var i=this.designAddress+this.actions.getForm;i=i.replace(/{id}/g,t);var r=new MWF.xApplication.process.ProcessManager.RestActions.Callback(s,e);MWF.getJSON(i,r)},getForm:function(s,e,t){this.request(e,t,"getForm",s)},_getProcess:function(s,e,t){var i=this.designAddress+this.actions.getProcess;i=i.replace(/{id}/g,t);var r=new MWF.xApplication.process.ProcessManager.RestActions.Callback(s,e);MWF.getJSON(i,r)},getProcess:function(s,e,t){this.request(e,t,"getProcess",s)},_getProcessCategory:function(s,e,t){var i=this.designAddress+this.actions.getProcessCategory;i=i.replace(/{id}/g,t);var r=new MWF.xApplication.process.ProcessManager.RestActions.Callback(s,e);MWF.getJSON(i,r)},getProcessCategory:function(s,e,t){this.request(e,t,"getProcessCategory",s)},_getFormCategory:function(s,e,t){var i=this.designAddress+this.actions.getFormCategory;i=i.replace(/{id}/g,t);var r=new MWF.xApplication.process.ProcessManager.RestActions.Callback(s,e);MWF.getJSON(i,r)},getFormCategory:function(s,e,t){this.request(e,t,"getFormCategory",s)},saveProcessCategory:function(s,e,t){if(this.designAddress){if(s.id){this.updateProcessCategory(s,e,t)}else{this.addProcessCategory(s,e,t)}}else{this.getDesignAddress(function(i){if(s.id){this.updateProcessCategory(s,e,t)}else{this.addProcessCategory(s,e,t)}}.bind(this),t)}},updateProcessCategory:function(s,e,t){var i=this.designAddress+this.actions.updataProcessCategory;i=i.replace(/{id}/g,s.id);var r=new MWF.xApplication.process.ProcessManager.RestActions.Callback(e,t);MWF.restful("PUT",i,JSON.encode(s),r)},addProcessCategory:function(s,e,t){this.getId(1,function(i){s.id=i.data[0].id;var r=this.designAddress+this.actions.addProcessCategory;var o=new MWF.xApplication.process.ProcessManager.RestActions.Callback(e,t);MWF.restful("POST",r,JSON.encode(s),o)}.bind(this))},saveProcess:function(s,e,t){if(this.designAddress){if(!s.isNewProcess){this.updateProcess(s,e,t)}else{this.addProcess(s,e,t)}}else{this.getDesignAddress(function(i){if(!s.isNewProcess){this.updateProcess(s,e,t)}else{this.addProcess(s,e,t)}}.bind(this),t)}},addProcess:function(s,e,t){var i=this.designAddress+this.actions.addProcess;i=i.replace(/{id}/g,s.categoryId);var r=new MWF.xApplication.process.ProcessManager.RestActions.Callback(e,t);MWF.restful("POST",i,JSON.encode(s),r)},updateProcess:function(s,e,t){var i=this.designAddress+this.actions.updataProcess;i=i.replace(/{id}/g,s.id);var r=new MWF.xApplication.process.ProcessManager.RestActions.Callback(e,t);MWF.restful("PUT",i,JSON.encode(s),r)},_deleteProcess:function(s,e,t){var i=this.designAddress+this.actions.removeProcess;i=i.replace(/{id}/g,t);var r=new MWF.xApplication.process.ProcessManager.RestActions.Callback(s,e);MWF.restful("DELETE",i,"",r)},deleteProcess:function(s,e,t){this.request(e,t,"deleteProcess",s)},saveFormCategory:function(s,e,t){if(this.designAddress){if(s.id){this.updateFormCategory(s,e,t)}else{this.addFormCategory(s,e,t)}}else{this.getDesignAddress(function(i){if(s.id){this.updateFormCategory(s,e,t)}else{this.addFormCategory(s,e,t)}}.bind(this),t)}},updateFormCategory:function(s,e,t){var i=this.designAddress+this.actions.updataFormCategory;i=i.replace(/{id}/g,s.id);var r=new MWF.xApplication.process.ProcessManager.RestActions.Callback(e,t);MWF.restful("PUT",i,JSON.encode(s),r)},addFormCategory:function(s,e,t){this.getId(1,function(i){s.id=i.data[0].id;var r=this.designAddress+this.actions.addFormCategory;var o=new MWF.xApplication.process.ProcessManager.RestActions.Callback(e,t);MWF.restful("POST",r,JSON.encode(s),o)}.bind(this))},saveForm:function(s,e,t){if(this.designAddress){if(!s.isNewForm){this.updateForm(s,e,t)}else{this.addForm(s,e,t)}}else{this.getDesignAddress(function(i){if(!s.isNewForm){this.updateForm(s,e,t)}else{this.addForm(s,e,t)}}.bind(this),t)}},updateForm:function(s,e,t){var i=this.designAddress+this.actions.updataForm;i=i.replace(/{id}/g,s.json.id);var r=new MWF.xApplication.process.ProcessManager.RestActions.Callback(e,t);var o=MWF.encodeJsonString(JSON.encode(s));var a='{"id":"'+s.json.id+'", "data":"'+o+'", "name":"'+s.json.name+'", "alias":"'+s.json.name+'", "description":"'+s.json.description+'", "formCategory": "'+s.json.formCategory+'"}';MWF.restful("PUT",i,a,r)},addForm:function(s,e,t){var i=this.designAddress+this.actions.addForm;i=i.replace(/{id}/g,s.json.categoryId);var r=new MWF.xApplication.process.ProcessManager.RestActions.Callback(e,t);var o=MWF.encodeJsonString(JSON.encode(s));alert(o);var a='{"id":"'+s.json.id+'", "data": "'+o+'", "name":"'+s.json.name+'", "alias":"'+s.json.name+'", "description":"'+s.json.description+'", "formCategory": "'+s.json.formCategory+'"}';MWF.restful("POST",i,a,r)},_deleteForm:function(s,e,t){var i=this.designAddress+this.actions.removeForm;i=i.replace(/{id}/g,t);var r=new MWF.xApplication.process.ProcessManager.RestActions.Callback(s,e);MWF.restful("DELETE",i,"",r)},deleteForm:function(s,e,t){this.request(e,t,"deleteForm",s)}});MWF.xApplication.process.ProcessManager.RestActions.Callback=new Class({initialize:function(s,e,t,i){this.success=s;this.failure=e;this.appendSuccess=t;this.appendFailure=i},onSuccess:function(s,e){switch(s.type){case"success":if(this.appendSuccess)this.appendSuccess(s);if(this.success)this.success(s);break;case"warn":MWF.xDesktop.notice("info",{x:"right",y:"top"},s.errorMessage.join("\n"));if(this.appendSuccess)this.appendSuccess(s);if(this.success)this.success(s);break;case"error":this.doError(null,e,s.message);break}},onRequestFailure:function(s){this.doError(s,"","")},onFailure:function(s){this.doError(s,"","")},onError:function(s,e){this.doError(null,s,e)},doError:function(s,e,t){if(this.appendFailure)this.appendFailure(s,e,t);if(this.failure)this.failure(s,e,t);if(!this.failure&&!this.appendFailure){var i=t;if(s)i=s.responseText;MWF.xDesktop.notice("error",{x:"right",y:"top"},"request json error: "+i)}}});