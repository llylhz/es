MWF.xApplication.Setting.preview=MWF.xApplication.Setting.preview||{};MWF.xApplication.Setting.preview.Layout=new Class({Extends:MWF.xDesktop.Layout,Implements:[Options,Events],options:{style:"default",topShim:"layout_top_shim",top:"layout_top",desktop:"layout_desktop",content:"desktop_content",navi:"desktop_navi"},categoryCount:20,processCount:40,initialize:function(t,e){this.setOptions(e);this.initData();this.session.user=layout.desktop.session.user;this.node=$(t)},initNode:function(t){this.path=MWF.defaultPath+"/xDesktop/$Layout/";var e='<div id="layout" style="overflow: hidden; height: 100%; background-size: cover;">\n'+'            <div id="layout_top_shim"></div>\n'+'            <div id="layout_top"></div>\n'+'            <div id="layout_desktop">\n'+'            <div id="desktop_content">\n'+"         \n"+'            <div id="desktop_navi"></div>\n'+"        </div>\n"+"        </div>";this.node.set("html",e);this.node=this.node.getFirst();this.topShimNode=this.node.getElement("#"+this.options.topShim);this.topNode=this.node.getElement("#"+this.options.top);this.topAreaNode=this.node.getElement("#"+this.options.top);this.desktopNode=this.node.getElement("#"+this.options.desktop);this.contentNode=this.node.getElement("#"+this.options.content);this.naviNode=this.node.getElement("#"+this.options.navi);if(this.node)this.node.setStyles(this.css.layoutNode);if(this.topShimNode)this.topShimNode.setStyles(this.css.layoutTopShimNode);if(this.topNode)this.topNode.setStyles(this.css.layoutTopNode);if(this.desktopNode)this.desktopNode.setStyles(this.css.desktopNode);if(this.contentNode)this.contentNode.setStyles(this.css.contentNode);if(this.naviNode)this.naviNode.setStyles(this.css.naviNode);this.node.setStyle("background-image",this.css.desktop.background);this.node.setStyles(this.options.styles)},initData:function(t){this.apps={};this.widgets={};this.appCurrentList=[];this.lnkAreas=[];this.lnks=[];this.currentApp=null;this.status=null;this.session={};this.serviceAddressList=null},load:function(){this.initNode();this.loadDesktop();this.loadWindow()},loadWindow:function(){var t={style:"desktop_default",title:"app",isResize:true,isMax:true,isRefresh:true,container:this.node,width:"400",height:"280",top:"100",left:"50",fromTop:"0",fromLeft:"0",isMove:false};this.window=new MWF.xDesktop.Window(this.app,t);debugger;this.window.css=this.windowCss;this.content=this.window.content;this.window.reStyle();this.window.showNoAnimation(false,false)},maxOrRestoreSize:function(){},loadDesktop:function(){this.setHeight();var t=this.desktopNode.getSize();this.size={x:t.x,y:t.y};this.loadTop();this.loadLnkArea()},loadLnkAreaContainer:function(){this.lnkAreaContainer=new Element("div",{styles:{height:"100%",overflow:"hidden"}}).inject(this.contentNode)},loadLnkArea:function(){if(!this.lnkAreaContainer)this.loadLnkAreaContainer();var t=new Element("div",{styles:this.css.dsektopLnkArea}).inject(this.lnkAreaContainer);this.lnkAreas.push(t);var e=t.getSize().x*this.lnkAreas.length;var s=this.contentNode.getSize();this.lnkAreaContainer.setStyle("width",""+Math.max(e,s.x)+"px");this.setCurrentLnkArea()},setCurrentLnkArea:function(){if(this.lnkAreas.length>1){var t=this.lnkAreas[0].getSize().x;var e=t*this.lnkAreas.length;var s=this.contentNode.getSize();var i=this.lnkAreas[this.lnkAreas.length-1];if(e<s.x){e=e-t;i.setStyles({width:"auto","margin-left":""+e+"px",float:"none"})}else{i.setStyles(this.css.dsektopLnkArea)}}else{if(this.lnkAreas.length){this.lnkAreas[0].setStyles({width:"auto","margin-left":"0px",float:"none"})}}},addLnkArea:function(){if(this.lnkAreas.length){this.lnkAreas[this.lnkAreas.length-1].setStyles(this.css.dsektopLnkArea)}this.loadLnkArea()},addLnk:function(t){var e=new MWF.xDesktop.Lnk(t.icon,t.title,t.par);if(!this.lnkAreas.length)this.loadLnkArea();e.inject(this.lnkAreas[this.lnkAreas.length-1]);this.lnks.push(e)},resizeLnk:function(){if(this.lnkAreaContainer){if(this.lnkAreas.length>1){var t=this.lnkAreas[0].getSize().x*this.lnkAreas.length;var e=this.contentNode.getSize();this.lnkAreaContainer.setStyle("width",""+Math.max(t,e.x)+"px")}else{this.lnkAreaContainer.setStyle("width",""+this.contentNode.getSize().x+"px")}}var s=0;var i=0;this.lnks.each(function(t,e){while(!this.lnkAreas[s])this.addLnkArea();var o=this.lnkAreas[s];t.inject(o);i++;var n=t.node.getSize().y+t.node.getStyle("margin-top").toFloat();if(n*(i+1)>o.getSize().y){if(e<this.lnks.length-1)s++;i=0}}.bind(this));if(this.lnkAreas.length)while(this.lnkAreas.length>s+1)this.lnkAreas.pop().destroy();this.setCurrentLnkArea()},setHeight:function(){this.resizeHeight();$(window).addEvent("resize",function(){this.resizeHeight()}.bind(this))},resizeHeight:function(){var t=this.topNode.getSize().y;var e=this.node.getSize().y;var s=e-t;this.desktopNode.setStyle("height",""+s+"px");this.desktopHeight=s;var i=this.naviNode.getSize().y;s=s-i;this.contentNode.setStyle("height",""+s+"px");this.resizeLnk();this.resizeMessage();this.setTaskitemSize();if(this.top)if(this.top.userPanel)this.top.userPanel.setPosition();this.fireEvent("resize")},setTaskitemSize:function(){if(this.top){var t=10;var e=5;var s=this.top.taskbar.getSize();var i=this.top.taskbar.getChildren();var o=0;if(i.length){var n=i[0].getStyles("border-left-width","border-right-width","margin-left","margin-right","padding-left","padding-right");for(var h=0;h<i.length;h++){i[h].setStyle("width","auto");o+=i[h].getSize().x+n["border-left-width"].toInt()+n["border-right-width"].toInt()+n["margin-left"].toInt()+n["margin-right"].toInt()+n["padding-left"].toInt()+n["padding-right"].toInt()}if(o>s.x-t){var a=(s.x-t)/i.length;var d=a-n["border-left-width"].toInt()-n["border-right-width"].toInt()-n["margin-left"].toInt()-n["margin-right"].toInt()-n["padding-left"].toInt()-n["padding-right"].toInt();i.each(function(t){t.setStyle("width",""+d+"px")})}else{i.each(function(t){t.setStyle("width","auto")})}}}},resizeMessage:function(){if(this.message)this.message.resize()},loadTop:function(){if(!this.top){this.top=new MWF.xApplication.Setting.preview.Layout.Top(this.topNode,this);this.top.load()}},getNodeBackground:function(){MWF.UD.getDataJson("layoutDesktop",function(t){var e=MWF.defaultPath+"/xDesktop/$Layout/"+this.options.style+"/desktop.jpg";if(t){currentSrc=t.src;e=MWF.defaultPath+"/xDesktop/$Layout/"+currentSrc+"/desktop.jpg"}this.node.setStyle("background-image","url("+e+")")}.bind(this),false)}});MWF.xApplication.Setting.preview.Layout.Taskitem=new Class({initialize:function(t,e){this.layout=e;this.app=t;this.node=new Element("div",{styles:this.layout.css.taskItemNode,title:this.app.options.title+(this.app.appId?"-"+this.app.appId:"")}).inject(this.layout.top.taskbar);this.iconNode=new Element("div",{styles:this.layout.css.taskItemIconNode}).inject(this.node);this.iconNode.setStyle("background-image","url("+this.app.options.icon+")");this.closeNode=new Element("div",{styles:this.layout.css.taskItemCloseNode}).inject(this.node);this.textNode=new Element("div",{styles:this.layout.css.taskItemTextNode}).inject(this.node);this.textNode.set("text",this.app.options.title);this.setTaskitemSize();this.setEvent()},setTaskitemSize:function(){var t=10;var e=5;var s=this.layout.top.taskbar.getSize();var i=this.layout.top.taskbar.getChildren();var o=0;if(i.length){var n=i[0].getStyles("border-left-width","border-right-width","margin-left","margin-right","padding-left","padding-right");for(var h=0;h<i.length;h++){i[h].setStyle("width","auto");o+=i[h].getSize().x+n["border-left-width"].toInt()+n["border-right-width"].toInt()+n["margin-left"].toInt()+n["margin-right"].toInt()+n["padding-left"].toInt()+n["padding-right"].toInt()}if(o>s.x-t){var a=(s.x-t)/i.length;var d=a-n["border-left-width"].toInt()-n["border-right-width"].toInt()-n["margin-left"].toInt()-n["margin-right"].toInt()-n["padding-left"].toInt()-n["padding-right"].toInt();i.each(function(t){t.setStyle("width",""+d+"px")})}else{i.each(function(t){t.setStyle("width","auto")})}}},setText:function(t){this.textNode.set("text",t||this.app.options.title)},setEvent:function(){this.textNode.addEvents({mouseover:function(){if(!this.layout.currentApp||this.layout.currentApp.taskitem!=this)this.node.setStyles(this.layout.css.taskItemNode_over)}.bind(this),mouseout:function(){if(!this.layout.currentApp||this.layout.currentApp.taskitem!=this)this.node.setStyles(this.layout.css.taskItemNode)}.bind(this),mousedown:function(){if(!this.layout.currentApp||this.layout.currentApp.taskitem!=this)this.node.setStyles(this.layout.css.taskItemNode_down)}.bind(this),mouseup:function(){if(!this.layout.currentApp||this.layout.currentApp.taskitem!=this)this.node.setStyles(this.layout.css.taskItemNode_over)}.bind(this),click:function(){if(this.layout.currentApp==this.app){this.app.minSize()}else{this.app.setCurrent()}}.bind(this)});this.iconNode.addEvents({mouseover:function(){if(!this.layout.currentApp||this.layout.currentApp.taskitem!=this)this.node.setStyles(this.layout.css.taskItemNode_over)}.bind(this),mouseout:function(){if(!this.layout.currentApp||this.layout.currentApp.taskitem!=this)this.node.setStyles(this.layout.css.taskItemNode)}.bind(this),mousedown:function(){if(!this.layout.currentApp||this.layout.currentApp.taskitem!=this)this.node.setStyles(this.layout.css.taskItemNode_down)}.bind(this),mouseup:function(){if(!this.layout.currentApp||this.layout.currentApp.taskitem!=this)this.node.setStyles(this.layout.css.taskItemNode_over)}.bind(this),click:function(){if(this.layout.currentApp==this.app){this.app.minSize()}else{this.app.setCurrent()}}.bind(this)});this.node.addEvents({mouseover:function(){this.closeNode.fade("in")}.bind(this),mouseout:function(){this.closeNode.fade("out")}.bind(this)});this.closeNode.addEvent("click",function(){this.app.close()}.bind(this))},selected:function(){this.node.setStyles(this.layout.css.taskItemNode_current)},unSelected:function(){this.node.setStyles(this.layout.css.taskItemNode)},changStyle:function(){if(this.node){if(!this.layout.currentApp||this.layout.currentApp.taskitem!=this){this.node.setStyles(this.layout.css.taskItemNode)}else{this.node.setStyles(this.layout.css.taskItemNode);this.node.setStyles(this.layout.css.taskItemNode_current)}}if(this.iconNode)this.iconNode.setStyles(this.layout.css.taskItemIconNode);if(this.textNode)this.textNode.setStyles(this.layout.css.taskItemTextNode)},destroy:function(){this.node.destroy()}});MWF.xApplication.Setting.preview.Layout.Top=new Class({initialize:function(t,e){this.layout=e;this.node=$(t);this.userApplicationsLog=[];this.sysApplicationsLog=[]},load:function(){this.loadMenuAction();this.loadSeparate();this.loadShowDesktop();this.loadClock();this.loadSeparate("right");this.loadUserMenu();this.loadStyleAction();this.loadUserChat();this.loadMessageAction();this.loadSeparate("right");this.loadTaskbar()},loadMenuAction:function(){this.loadMenuAction=new Element("div",{styles:this.layout.css.loadMenuAction,title:MWF.LP.desktop.menuAction}).inject(this.node)},loadShowDesktop:function(){this.showDesktopAction=new Element("div",{styles:this.layout.css.showDesktopAction}).inject(this.node)},loadSeparate:function(t){var e=new Element("div.separateNode",{styles:this.layout.css.separateNode}).inject(this.node);if(t)e.setStyle("float",t)},loadTaskbar:function(){this.taskbar=new Element("div",{styles:this.layout.css.taskbar}).inject(this.node)},loadUserChat:function(){this.userChatNode=new Element("div",{styles:this.layout.css.userChatNode,title:MWF.LP.desktop.userChat}).inject(this.node)},loadStyleAction:function(){this.styleActionNode=new Element("div",{styles:this.layout.css.styleActionNode,title:MWF.LP.desktop.styleAction}).inject(this.node)},loadMessageAction:function(){this.messageActionNode=new Element("div",{styles:this.layout.css.messageActionNode,title:MWF.LP.desktop.showMessage}).inject(this.node)},loadUserMenu:function(){this.userMenuNode=new Element("div",{styles:this.layout.css.userMenuNode,title:MWF.LP.desktop.userMenu}).inject(this.node)},loadClock:function(){this.clockNode=new Element("div",{styles:this.layout.css.clockNode}).inject(this.node);this.setTime()},setTime:function(){var t=new Date;var e=1e3-t.getMilliseconds();var s=60-t.getSeconds();var i=t.format("%Y/%m/%d#%H:%M");dl=i.split("#");this.clockNode.set("html",dl[1]+"<br/>"+dl[0]);window.setTimeout(this.setTime.bind(this),s*1e3+e)}});