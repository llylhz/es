MWF.xDesktop.requireApp("Setting","Document",null,false);MWF.xApplication.Setting.UILoginDocument=new Class({Extends:MWF.xApplication.Setting.Document,load:function(){this.node=new Element("div",{styles:{overflow:"hidden","padding-bottom":"80px"}}).inject(this.contentAreaNode);this.titleName=new Element("div",{styles:this.explorer.css.explorerContentTitleNode}).inject(this.node);this.titleName.set("text",this.lp.ui_loginSetting);var t={title:this.lp.ui_login_default,name:"default",url:"/x_desktop/res/mwf4/package/xDesktop/$Authentication/default",enabled:true};MWF.UD.getPublicData("loginStyleList",function(e){this.loginStyleList=e;if(!this.loginStyleList)this.loginStyleList={enabledId:"",styleList:[]};t.enabled=!this.loginStyleList.enabledId;this.defaultStyle=new MWF.xApplication.Setting.UILoginDocument.Style(this,this.node,t,{title:this.lp.ui_login_defaultStyle,infor:this.lp.ui_login_defaultStyle_infor,onCreateStyle:function(t,e){this.createStyle(t,e)}.bind(this)});this.styleList=new MWF.xApplication.Setting.UILoginDocument.StyleList(this,this.node,this.loginStyleList.styleList,{title:this.lp.ui_login_customStyle,infor:this.lp.ui_login_customStyle_infor,actionTitle:this.lp.ui_login_customStyle_Action,defaultStyleData:t,type:"loginStyle",onCreateStyle:function(t,e){this.createStyle(t,e)}.bind(this)})}.bind(this))},createStyle:function(t,e){var i=(new MWF.widget.UUID).id;var s={title:t,name:"loginStyle_"+i,enabled:false};var n={title:t,name:"loginStyle_"+i,data:e};this.loginStyleList.styleList.push(s);MWF.UD.putPublicData("loginStyle_"+i,n,function(){MWF.UD.putPublicData("loginStyleList",this.loginStyleList,{success:function(){this.styleList.addItem(s)}.bind(this),failure:function(){MWF.UD.deletePublicData("loginStyle_"+i)}.bind(this)})}.bind(this))}});MWF.xApplication.Setting.UILoginDocument.StyleList=new Class({Implements:[Options,Events],initialize:function(t,e,i,s){this.setOptions(s);this.document=t;this.explorer=this.document.explorer;this.app=this.explorer.app;this.lp=this.app.lp;this.contentAreaNode=e;this.actions=this.app.actions;this.css=this.app.css;this.data=i;this.items=[];this.load()},load:function(){var t=new Element("div",{styles:this.css.explorerContentItemTitleNode,text:this.options.title}).inject(this.contentAreaNode);if(this.options.infor)var e=new Element("div",{styles:this.css.explorerContentInputInforNode,text:this.options.infor}).inject(this.contentAreaNode);var i=new Element("div",{styles:this.css.explorerContentListAreaNode}).inject(this.contentAreaNode);if(this.options.actionTitle)this.createCustomStyle(i);this.itemArea=new Element("div",{styles:{overflow:"hidden",clear:"both"}}).inject(i);if(this.data&&this.data.length){this.data.each(function(t){this.addItem(t)}.bind(this))}},addItem:function(t){this.items.push(new MWF.xApplication.Setting.UILoginDocument.Style.Item(this,t))},createCustomStyle:function(t){this.actionArea=new Element("div",{styles:this.css.explorerContentListStyleActionAreaNode}).inject(t);var e=new Element("div",{styles:this.css.explorerContentListActionIconAreaNode}).inject(this.actionArea);var i=new Element("div",{styles:this.css.explorerContentListActionIconNode}).inject(e);if(this.type=="object")i.setStyle("background","url("+this.app.path+this.app.options.style+"/icon/edit.png) no-repeat center center");var s=new Element("div",{styles:this.css.explorerContentListActionTextAreaNode,text:this.options.actionTitle}).inject(this.actionArea);this.actionArea.addEvents({mouseover:function(){this.actionArea.setStyles(this.css.explorerContentListStyleActionAreaNode_over)}.bind(this),mouseout:function(){this.actionArea.setStyles(this.css.explorerContentListStyleActionAreaNode)}.bind(this),mousedown:function(){this.actionArea.setStyles(this.css.explorerContentListStyleActionAreaNode_down)}.bind(this),mouseup:function(){this.actionArea.setStyles(this.css.explorerContentListStyleActionAreaNode_over)}.bind(this),click:function(t){this.createNewCustomStyle(t)}.bind(this)})},getDefaultCss:function(){var t=null;var e=this.options.defaultStyleData.url+"/css.wcss";e=e.indexOf("?")!=-1?e+"&v="+COMMON.version:e+"?v="+COMMON.version;MWF.getJSON(e,function(e){t=e}.bind(this),false);return t},createNewCustomStyle:function(t){var e=this.actionArea.getPosition(this.actionArea.getOffsetParent());var i=470;var s=110;var n=this.app.content.getSize();if(e.y+s>n.y)e.y=n.y-s-10;if(e.y<0)e.y=10;if(e.x+i>n.x)e.x=n.x-i-10;if(e.x<0)e.x=10;var o=this;MWF.require("MWF.xDesktop.Dialog",function(){var t=new MWF.xDesktop.Dialog({title:this.lp.ui_login_customStyle_newName,style:"settingStyle",top:e.y,left:e.x,fromTop:e.y,fromLeft:e.x,width:i,height:s,html:"",maskNode:this.app.content,container:this.app.content,buttonList:[{text:this.lp.ok,action:function(){o.createNewCustomStyleData(this)}},{text:this.lp.cancel,action:function(){this.close()}}]});t.show();var n=new Element("div",{styles:this.css.explorerContentListStyleEditAreaNode}).inject(t.content);new Element("input",{styles:this.css.explorerContentListEditInputNode}).inject(n)}.bind(this))},createNewCustomStyleData:function(t){var e=t.content.getElement("input").get("value");if(!e){this.app.notice(ui_login_customStyle_newName_empty,"error");return false}else{var i=this.getDefaultCss();var s=Object.clone(i);this.fireEvent("createStyle",[e,s]);t.close()}}});MWF.xApplication.Setting.UILoginDocument.Style=new Class({Implements:[Options,Events],initialize:function(t,e,i,s){this.setOptions(s);this.document=t;this.explorer=this.document.explorer;this.app=this.explorer.app;this.lp=this.app.lp;this.contentAreaNode=e;this.actions=this.app.actions;this.css=this.app.css;this.data=i;this.load()},load:function(){var t=new Element("div",{styles:this.css.explorerContentItemTitleNode,text:this.options.title}).inject(this.contentAreaNode);if(this.options.infor)var e=new Element("div",{styles:this.css.explorerContentInputInforNode,text:this.options.infor}).inject(this.contentAreaNode);var i=new Element("div",{styles:this.css.explorerContentListAreaNode}).inject(this.contentAreaNode);this.itemArea=new Element("div",{styles:{overflow:"hidden",clear:"both"}}).inject(i);this.item=new MWF.xApplication.Setting.UILoginDocument.Style.Item(this,this.data)}});MWF.xApplication.Setting.UILoginDocument.Style.Item=new Class({Extends:MWF.xApplication.Setting.Document.List.Item,load:function(){this.itemArea=new Element("div",{styles:this.css.explorerContentListStyleActionAreaNode}).inject(this.content);this.itemIconArea=new Element("div",{styles:this.css.explorerContentListItemIconAreaNode}).inject(this.itemArea);this.itemIcon=new Element("div",{styles:this.css.explorerContentListItemIconNode}).inject(this.itemIconArea);if(this.data.enabled){this.checkIcon=new Element("div",{styles:this.css.explorerContentListCheckIconAreaNode}).inject(this.itemArea);this.checkIcon.set("title",this.lp.ui_login_current)}else{this.checkIcon=new Element("div",{styles:this.css.explorerContentListNotCheckIconAreaNode}).inject(this.itemArea);this.checkIcon.set("title",this.lp.ui_login_setCurrent)}this.itemTextArea=new Element("div",{styles:this.css.explorerContentListActionTextAreaNode}).inject(this.itemArea);this.itemIcon.setStyle("background","url("+this.app.path+this.app.options.style+"/icon/style.png) no-repeat center center");this.itemTextArea.set("text",this.data.title);if(this.data.name!="default"){this.editAction=new Element("div",{styles:this.css.explorerContentStyleActionNode,text:this.lp.edit}).inject(this.content);this.copyAction=new Element("div",{styles:this.css.explorerContentStyleActionNode,text:this.lp.copy}).inject(this.content);this.deleteAction=new Element("div",{styles:this.css.explorerContentStyleActionNode,text:this.lp.delete}).inject(this.content)}else{this.copyAction=new Element("div",{styles:this.css.explorerContentStyleActionNode,text:this.lp.copy}).inject(this.content)}this.setEvents()},setEvents:function(){var t=this;this.itemArea.addEvents({mouseover:function(){if(!t.isSelected)this.setStyles(t.css.explorerContentListStyleActionAreaNode_over)},mouseout:function(){if(!t.isSelected)this.setStyles(t.css.explorerContentListStyleActionAreaNode)},mousedown:function(){this.setStyles(t.css.explorerContentListStyleActionAreaNode_down)},mouseup:function(){this.setStyles(t.css.explorerContentListStyleActionAreaNode_over)},click:function(){t.preview(this)}});this.checkIcon.addEvents({mousedown:function(t){t.stopPropagation()},mouseup:function(t){t.stopPropagation()},click:function(e){t.setCurrent(e)}});if(this.editAction){this.editAction.addEvents({mouseover:function(){this.setStyles(t.css.explorerContentStyleActionNode_over)},mouseout:function(){this.setStyles(t.css.explorerContentStyleActionNode)},click:function(){t.editStyle(this)}})}if(this.copyAction){this.copyAction.addEvents({mouseover:function(){this.setStyles(t.css.explorerContentStyleActionNode_over)},mouseout:function(){this.setStyles(t.css.explorerContentStyleActionNode)},click:function(){t.copyStyle(this)}})}if(this.deleteAction){this.deleteAction.addEvents({mouseover:function(){this.setStyles(t.css.explorerContentStyleActionNode_over)},mouseout:function(){this.setStyles(t.css.explorerContentStyleActionNode)},click:function(e){t.deleteStyle(e)}})}},copyStyle:function(){var t=this.itemArea.getPosition(this.itemArea.getOffsetParent());var e=600;var i=110;var s=this.app.content.getSize();if(t.y+i>s.y)t.y=s.y-i-10;if(t.y<0)t.y=10;if(t.x+e>s.x)t.x=s.x-e-10;if(t.x<0)t.x=10;var n=this;MWF.require("MWF.xDesktop.Dialog",function(){var s=new MWF.xDesktop.Dialog({title:this.lp.ui_login_customStyle_newName,style:"settingStyle",top:t.y,left:t.x,fromTop:t.y,fromLeft:t.x,width:e,height:i,html:"",maskNode:this.app.content,container:this.app.content,buttonList:[{text:this.lp.ok,action:function(){n.createNewCustomStyleData(this)}},{text:this.lp.cancel,action:function(){this.close()}}]});s.show();var o=new Element("div",{styles:this.css.explorerContentListStyleEditAreaNode}).inject(s.content);new Element("input",{styles:this.css.explorerContentListEditInputNode,value:this.data.title+this.lp.copyName}).inject(o)}.bind(this))},createNewCustomStyleData:function(t){debugger;var e=t.content.getElement("input").get("value");if(!e){this.app.notice(ui_login_customStyle_newName_empty,"error");return false}else{var i=this.getCss();var s=Object.clone(i);this.list.fireEvent("createStyle",[e,s]);t.close()}},editStyle:function(){this.editor=new MWF.xApplication.Setting.UILoginDocument.Style.Editor(this)},deleteStyle:function(t){var e=this;var i=this.lp.ui_login_delete_confirm.replace("{title}",this.data.title);this.app.confirm("wram",t,this.lp.ui_login_delete_confirmTitle,i,400,150,function(){e.deleteStyleData();this.close()},function(){this.close()})},deleteStyleData:function(){if(this.list.document.loginStyleList.enabledId==this.data.name){this.list.document.defaultStyle.item.setCurrentStyle(true)}this.list.document.loginStyleList.styleList.erase(this.data);MWF.UD.deletePublicData(this.data.name,function(){MWF.UD.putPublicData("loginStyleList",this.list.document.loginStyleList,function(){this.list.items.erase(this);this.destroy()}.bind(this))}.bind(this))},destroy:function(){this.itemArea.destroy();if(this.editAction)this.editAction.destroy();if(this.deleteAction)this.deleteAction.destroy();if(this.copyAction)this.copyAction.destroy();MWF.release(this)},setCurrent:function(t){var e=this;var i=this.lp.ui_login_setCurrent_confirm.replace("{title}",this.data.title);this.app.confirm("infor",t,this.lp.ui_login_setCurrent_confirmTitle,i,400,150,function(){e.setCurrentStyle();this.close()},function(){this.close()});t.stopPropagation()},setUncurrent:function(){this.data.enabled=false;this.checkIcon.setStyles(this.css.explorerContentListNotCheckIconAreaNode);this.checkIcon.set("title",this.lp.ui_login_setCurrent)},setCurrentStyle:function(t){this.list.document.defaultStyle.item.setUncurrent();this.list.document.styleList.items.each(function(t){t.setUncurrent()}.bind(this));this.list.document.loginStyleList.enabledId=this.data.name=="default"?"":this.data.name;this.data.enabled=true;this.checkIcon.setStyles(this.css.explorerContentListCheckIconAreaNode);this.checkIcon.set("title",this.lp.ui_login_current);if(!t)MWF.UD.putPublicData("loginStyleList",this.list.document.loginStyleList)},preview:function(){if(!this.isSelected){this.itemArea.setStyle("height","340px");this.isSelected=true;this.showPreview()}else{this.itemArea.setStyle("height","40px");this.isSelected=false;this.hidePreview()}},getCss:function(){var t=null;if(this.data.url){var e=this.data.url+"/css.wcss";e=e.indexOf("?")!=-1?e+"&v="+COMMON.version:e+"?v="+COMMON.version;MWF.getJSON(e,function(e){t=e}.bind(this),false)}else{MWF.UD.getPublicData(this.data.name,function(e){t=e.data},false)}return t},showPreview:function(){this.styleCss=this.getCss();this.previewNode=new Element("div",{styles:{"margin-top":"10px",position:"relative"}}).inject(this.itemArea);MWF.require("MWF.xDesktop.Authentication",function(){var t=new MWF.xApplication.Authentication.Actions.RestActions;var e=new MWF.xDesktop.Authentication.LoginForm(this,{},{draggable:false,closeAction:false,hasMask:false,relativeToApp:false,isLimitSize:false,hasScroll:false,ifFade:false,top:"0",left:"0"},{css:this.styleCss,container:this.previewNode,lp:MWF.LP.authentication,actions:t});e.create();this.previewMaskNode=new Element("div",{styles:{position:"absolute",top:"0px",left:"0px"}}).inject(this.previewNode);var i=e.formAreaNode.getSize();var s=e.formAreaNode.getStyle("z-index");this.previewMaskNode.setStyles({width:""+i.x+"px",height:""+i.y+"px","z-index":s+1});this.previewMaskNode.addEvents({click:function(t){t.stopPropagation()},mousedown:function(t){t.stopPropagation()},mouseup:function(t){t.stopPropagation()}});e.formAreaNode.setStyles({"transform-origin":"0px 0px",transform:"scale(0.58)"})}.bind(this))},hidePreview:function(){this.previewMaskNode.destroy();this.previewNode.empty();this.previewNode.destroy();this.previewMaskNode=null;this.previewNode=null}});MWF.xApplication.Setting.UILoginDocument.Style.Editor=new Class({initialize:function(t){this.item=t;this.document=this.item.list.document;this.explorer=this.document.explorer;this.app=this.explorer.app;this.lp=this.app.lp;this.contentAreaNode=this.document.contentAreaNode;this.actions=this.app.actions;this.css=this.app.css;this.load()},load:function(){this.editAreaNode=new Element("div",{styles:this.css.explorerContentStyleEditNode}).inject(this.contentAreaNode);this.editAreaNode.position({relativeTo:this.item.itemArea,position:"upperLeft",edge:"upperLeft"});this.document.node.setStyle("display","none");var t=new Fx.Morph(this.editAreaNode,{duration:"100",transition:Fx.Transitions.Sine.easeOut});var e=this.contentAreaNode.getPosition(this.contentAreaNode.getOffsetParent());var i=this.contentAreaNode.getSize();var s={left:""+e.x+"px",top:""+e.y+"px",width:""+i.x+"px",height:""+i.y+"px","background-color":"#ffffff"};t.start(s).chain(function(){this.editAreaNode.setStyles({width:"100%",height:"100%",position:"static"});new Element("div",{styles:{height:"100px","line-height":"100px","text-align":"center","font-size":"18px",color:"#999999"},text:this.lp.loading}).inject(this.editAreaNode);window.setTimeout(this.createEditorContent.bind(this),100)}.bind(this))},createEditorContent:function(){this.area=new Element("div",{styles:this.css.explorerContentStyleEditorAreaNode}).inject(this.editAreaNode);leftArea=new Element("div",{styles:this.css.explorerContentStyleEditorLeftAreaNode}).inject(this.area);rightArea=new Element("div",{styles:this.css.explorerContentStyleEditorRightAreaNode}).inject(this.area);this.editorArea=new Element("div",{styles:this.css.explorerContentStyleEditEditorNode}).inject(leftArea);this.previewArea=new Element("div",{styles:this.css.explorerContentStyleEditPreviewNode}).inject(rightArea);this.styleCss=this.item.getCss();this.createCssEditor();this.showPreview();this.area.getPrevious().destroy();this.returnAction=new Element("div",{styles:this.css.explorerContentStyleEditorReturnNode,text:this.lp.returnBack}).inject(this.editAreaNode);this.returnAction.addEvent("click",function(t){this.destroy()}.bind(this))},destroy:function(){this.editAreaNode.destroy();this.document.node.setStyle("display","block");MWF.release(this)},createCssEditor:function(){var t=this;MWF.require("MWF.widget.Maplist",function(){Object.each(this.styleCss,function(e,i){var s=new Element("div",{styles:this.css.explorerContentStyleEditMapNode}).inject(this.editorArea);var n=new MWF.widget.Maplist.Style(s,{title:i,style:"styleEditor",onChange:function(){t.styleCss[i]=this.toJson();t.showPreview();var e={name:t.item.data.name,title:t.item.data.title,data:t.styleCss};MWF.UD.putPublicData(t.item.data.name,e)}});n.app=this.app;n.load(e)}.bind(this))}.bind(this))},showPreview:function(){this.previewArea.empty();MWF.require("MWF.xDesktop.Authentication",function(){this.previewNode=new Element("div",{styles:{position:"relative",height:"216px"}}).inject(this.previewArea);var t=new MWF.xApplication.Authentication.Actions.RestActions;var e=new MWF.xDesktop.Authentication.LoginForm(this,{},{draggable:false,closeAction:false,hasMask:false,relativeToApp:false,isLimitSize:false,hasScroll:false,ifFade:false,top:"0",left:"0"},{css:this.styleCss,container:this.previewNode,lp:MWF.LP.authentication,actions:t});e.create();e.formAreaNode.setStyles({"transform-origin":"0px 0px",transform:"scale(0.4)"});var i=new Element("div",{styles:{position:"relative",height:"268px"}}).inject(this.previewArea);var s=new MWF.xDesktop.Authentication.SignUpForm(this,{},{draggable:false,closeAction:false,hasMask:false,relativeToApp:false,isLimitSize:false,hasScroll:false,ifFade:false,top:"0",left:"0"},{css:this.styleCss,container:i,lp:MWF.LP.authentication,actions:t});s.create();s.formAreaNode.setStyles({"transform-origin":"0px 0px",transform:"scale(0.4)"});var n=new Element("div",{styles:{position:"relative",height:"248px"}}).inject(this.previewArea);var o=new MWF.xDesktop.Authentication.ResetPasswordForm(this,{},{draggable:false,closeAction:false,hasMask:false,relativeToApp:false,isLimitSize:false,hasScroll:false,ifFade:false,top:"0",left:"0"},{css:this.styleCss,container:n,lp:MWF.LP.authentication,actions:t});o.create();o.formAreaNode.setStyles({"transform-origin":"0px 0px",transform:"scale(0.4)"})}.bind(this))}});