MWF.xApplication.Minder=MWF.xApplication.Minder||{};MWF.xDesktop.requireApp("Template","Explorer",null,false);MWF.xDesktop.requireApp("Template","MPopupForm",null,false);MWF.xDesktop.requireApp("Template","MTooltips",null,false);MWF.require("MWF.widget.O2Identity",null,false);MWF.xApplication.Minder.FolderSelector=new Class({Extends:MTooltips,options:{style:"",axis:"y",position:{x:"right",y:"auto"},event:"click",hiddenDelay:200,displayDelay:0,hasArrow:false,overflow:"scroll",nodeStyles:{"font-size":"12px",position:"absolute","max-width":"500px","min-width":"260px","z-index":"11","background-color":"#fff",padding:"5px","border-radius":"4px","box-shadow":"0 0 4px 0 #999999","-webkit-user-select":"text","-moz-user-select":"text"}},_loadCustom:function(e){var t=this;this.treeNode=new Element("div.treeNode",{styles:{position:"relative",overflow:"hidden","min-width":"395px","box-shadow":"0 1px 3px 0 rgba(0,0,0,0.25)",float:"left","background-color":"#F8F8F8"}}).inject(this.contentNode);this.tree=new MWF.xApplication.Minder.Tree({app:this.app},this.treeNode,{style:"default",defaultNode:this.options.defaultNode||"root",onPostLoad:function(){if(e)e()}.bind(this),onSelect:function(e){this.fireEvent("select",e.data);this.hide()}.bind(this),minWidth:425,maxWidth:425})}});MWF.xApplication.Minder.Tree=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],options:{style:"default",defaultNode:"root",minWidth:null,maxWidth:null},initialize:function(e,t,i){this.setOptions(i);this.explorer=e;this.app=e.app;this.node=$(t);this.cssPath="/x_component_Minder/$Common/"+this.options.style+"/css.wcss";this.load()},load:function(){this._loadCss();var e=this;this.treeContentNode=new Element("div",{styles:this.css.treeContentNode}).inject(this.node);var t={id:"root",name:"根目录",orderNumber:"1",description:""};this.app.restActions.listMyFolder(function(e){t.children=e.data;this.loadTreeNode(t);this.fireEvent("postLoad")}.bind(this),function(){this.fireEvent("postLoad")}.bind(this),true)},loadTreeNode:function(e){this.treeNode=new MWF.xApplication.Minder.Tree.Node(this,this.treeContentNode,e,{style:this.options.style,isCurrent:this.options.defaultNode==e.id,minWidth:this.options.minWidth,maxWidth:this.options.maxWidth})},reload:function(){this.node.empty();this.load()},getCurrentNode:function(){return this.currentItem},getCurrentFolderData:function(){var e=this.getCurrentNode();if(e){return e.data}else{return{}}},getCurrentFolderId:function(){var e=this.getCurrentNode();if(e){return e.data.id}else{return""}}});MWF.xApplication.Minder.Tree.Node=new Class({Implements:[Options,Events],options:{style:"default",isCurrent:false,isExpanded:true,level:0,minWidth:null,maxWidth:null},initialize:function(e,t,i,s){this.setOptions(s);this.tree=e;this.explorer=e.explorer;this.app=e.app;this.css=this.tree.css;this.data=i;this.node=$(t);this.load()},load:function(){var t=this;this.itemNode=new Element("div.treeItemNode",{styles:this.css.treeItemNode}).inject(this.node);this.itemNode.setStyle("padding-left",this.options.level*12+10+"px");this.itemExpendNode=new Element("div.treeItemExpendNode",{styles:this.css.emptyExpendNode}).inject(this.itemNode);if(this.data.children&&this.data.children.length){this.itemExpendNode.addEvent("click",function(e){if(t.options.isExpanded){t.collapse()}else{t.expand()}e.stopPropagation()})}this.itemIconNode=new Element("div.treeItemIconNode",{styles:this.css.treeItemIconNode}).inject(this.itemNode);this.itemTextNode=new Element("div.treeItemTextNode",{styles:this.css.treeItemTextNode,text:this.data.name}).inject(this.itemNode);this.setTextNodeWidth();this.itemNode.addEvents({mouseover:function(){if(!t.options.isCurrent){this.setStyles(t.css.treeItemNode_over);t.itemIconNode.setStyles(t.css.treeItemIconNode_over)}},mouseout:function(){if(!t.options.isCurrent){this.setStyles(t.css.treeItemNode);t.itemIconNode.setStyles(t.css.treeItemIconNode)}},click:function(){t.tree.fireEvent("select",t);t.setCurrent()}});if(this.data.children){this.treeContentNode=new Element("div.treeContentNode",{styles:this.css.treeContentNode}).inject(this.node);this.children=[];this.data.children.each(function(e){t.children.push(t.getTreeNode(e))})}if(this.options.isCurrent){this.setCurrent()}if(this.data.children&&this.data.children.length){if(this.options.isExpanded){this.expand()}else{this.collapse()}}},setTextNodeWidth:function(){if(this.options.minWidth){this.itemTextNode.setStyle("min-width",this.options.minWidth-this.options.level*12-10-80+"px")}if(this.options.maxWidth){this.itemTextNode.setStyle("max-width",this.options.maxWidth-this.options.level*12-10-80+"px")}},getTreeNode:function(e){return new MWF.xApplication.Minder.Tree.Node(this.tree,this.treeContentNode,e,{style:this.options.style,level:this.options.level+1,isCurrent:this.tree.options.defaultNode==e.id,minWidth:this.options.minWidth,maxWidth:this.options.maxWidth})},cancelCurrent:function(){this.itemNode.setStyles(this.css.treeItemNode);this.itemIconNode.setStyles(this.css.treeItemIconNode);if(this.data.children&&this.data.children.length>0){if(this.options.isExpanded){this.itemExpendNode.setStyles(this.css.treeItemExpendNode)}else{this.itemExpendNode.setStyles(this.css.treeItemCollapseNode)}}this._cancelCurrent();this.options.isCurrent=false;this.tree.currentItem=null},_cancelCurrent:function(){},setCurrent:function(){if(this.tree.currentItem){this.tree.currentItem.cancelCurrent()}this.itemNode.setStyles(this.css.treeItemNode_selected);this.itemIconNode.setStyles(this.css.treeItemIconNode_selected);if(this.data.children&&this.data.children.length>0){if(this.options.isExpanded){this.itemExpendNode.setStyles(this.css.treeItemExpendNode_selected)}else{this.itemExpendNode.setStyles(this.css.treeItemCollapseNode_selected)}}this.options.isCurrent=true;this.tree.currentItem=this;this._setCurrent()},_setCurrent:function(){},expand:function(){if(this.options.isCurrent){this.itemExpendNode.setStyles(this.css.treeItemExpendNode_selected)}else{this.itemExpendNode.setStyles(this.css.treeItemExpendNode)}if(this.treeContentNode)this.treeContentNode.setStyle("display","");this.options.isExpanded=true},collapse:function(){if(this.options.isCurrent){this.itemExpendNode.setStyles(this.css.treeItemCollapseNode_selected)}else{this.itemExpendNode.setStyles(this.css.treeItemCollapseNode)}if(this.treeContentNode)this.treeContentNode.setStyle("display","none");this.options.isExpanded=false}});MWF.xApplication.Minder.ShareForm=new Class({Extends:MPopupForm,Implements:[Options,Events],options:{style:"minder",width:700,height:"400",hasTop:true,hasIcon:false,draggable:true,title:"脑图分享"},_createTableContent:function(){var e="<table width='100%' bordr='0' cellpadding='7' cellspacing='0' styles='formTable' style='margin-top: 20px; '>"+"<tr><td styles='formTableTitle' lable='fileName' width='18%'></td>"+"    <td styles='formTableValue14' item='fileName'></td></tr>"+"<tr><td styles='formTableTitle' lable='shareTo' width='18%'></td>"+"    <td styles='formTableValue14' item='shareTo'></td></tr>"+"<tr><td styles='formTableTitle' width='18%'></td>"+"    <td styles='formTableValue14'>邀请其他人查看此文档</td></tr>"+"</table>";this.formTableArea.set("html",e);this.form=new MForm(this.formTableArea,this.data||{},{isEdited:true,style:"minder",hasColon:true,itemTemplate:{fileName:{text:"脑图名称",type:"innerHTML",value:function(){var t=[];this.checkedItemData.each(function(e){t.push(e.name)});return t.join("<br>")}.bind(this)},shareTo:{type:"org",orgType:["person","unit","group"],text:"分享对象",notEmpty:true,count:0,style:{"min-height":"100px"}}}},this.app);this.form.load()},_createBottomContent:function(){if(this.isNew||this.isEdited){this.okActionNode=new Element("button.inputOkButton",{styles:this.css.inputOkButton,text:"确定"}).inject(this.formBottomNode);this.okActionNode.addEvent("click",function(e){this.share(e)}.bind(this))}this.cancelActionNode=new Element("button.inputCancelButton",{styles:this.isEdited||this.isNew||this.getEditPermission()?this.css.inputCancelButton:this.css.inputCancelButton_long,text:"关闭"}).inject(this.formBottomNode);this.cancelActionNode.addEvent("click",function(e){this.close(e)}.bind(this))},share:function(){var e=this.form.getResult(true,null,true,false,true);if(e){var i={sharePersons:[],shareUnits:[],shareGroups:[]};e.shareTo.each(function(e){var t=e.substr(e.length-1,1);switch(t.toLowerCase()){case"p":i.sharePersons.push(e);break;case"u":i.shareUnits.push(e);break;case"g":i.shareGroups.push(e);break;default:break}}.bind(this));var t=0;this.checkedItemData.each(function(e){this.app.restActions.shareMind(e.id,i,function(){t++;if(t==this.checkedItemData.length){this.app.notice("分享成功！");this.close()}}.bind(this))}.bind(this))}}});MWF.xApplication.Minder.NewNameForm=new Class({Extends:MPopupForm,Implements:[Options,Events],options:{style:"minder",width:700,height:"300",hasTop:true,hasIcon:false,draggable:true,title:"新建脑图"},_createTableContent:function(){var e="<table width='100%' bordr='0' cellpadding='7' cellspacing='0' styles='formTable' style='margin-top: 20px; '>"+"<tr><td styles='formTableTitle' lable='folder' width='25%'></td>"+"    <td styles='formTableValue14' item='folder' colspan='3'></td></tr>"+"<tr><td styles='formTableTitle' lable='name' width='25%'></td>"+"    <td styles='formTableValue14' item='name' colspan='3'></td></tr>"+"</table>";this.formTableArea.set("html",e);var t=this.explorer.getCurrentFolderData?this.explorer.getCurrentFolderData():{};this.folderId=t.id||"root";this.form=new MForm(this.formTableArea,this.data||{},{isEdited:true,style:"minder",hasColon:true,itemTemplate:{folder:{text:"选择文件夹",notEmpty:true,attr:{readonly:true},defaultValue:t.name||"根目录"},name:{text:"脑图名称",notEmpty:true}}},this.app);this.form.load();this.loadFolderSelect()},_createBottomContent:function(){if(this.isNew||this.isEdited){this.okActionNode=new Element("button.inputOkButton",{styles:this.css.inputOkButton,text:"确定"}).inject(this.formBottomNode);this.okActionNode.addEvent("click",function(e){this.save(e)}.bind(this))}this.cancelActionNode=new Element("button.inputCancelButton",{styles:this.isEdited||this.isNew||this.getEditPermission()?this.css.inputCancelButton:this.css.inputCancelButton_long,text:"关闭"}).inject(this.formBottomNode);this.cancelActionNode.addEvent("click",function(e){this.close(e)}.bind(this))},save:function(){var t=this.form.getResult(true,null,true,false,true);if(t){t.content='{"root":{"data":{"text":"'+t.name+'"},"children":[]}}';t.folderId=this.folderId;this.app.restActions.saveMind(t,function(e){this.app.desktop.openApplication(null,"MinderEditor",{folderId:t.folderId,minderName:t.name,id:e.data.id,isEdited:true,isNew:false});if(this.explorer.currentView)this.explorer.currentView.reload();this.close()}.bind(this))}},loadFolderSelect:function(){this.folderSelect=new MWF.xApplication.Minder.FolderSelector(this.app.content,this.form.getItem("folder").getElements()[0],this.app,{},{defaultNode:this.folderId,onSelect:function(e){this.form.getItem("folder").setValue(e.name);this.folderId=e.id}.bind(this)})}});MWF.xApplication.Minder.FolderForm=new Class({Extends:MPopupForm,Implements:[Options,Events],options:{style:"minder",width:700,height:"200",hasTop:true,hasIcon:false,draggable:true,title:"新建目录"},_createTableContent:function(){var e="<table width='100%' bordr='0' cellpadding='7' cellspacing='0' styles='formTable' style='margin-top: 20px; '>"+"<tr><td styles='formTableTitle' lable='name' width='25%'></td>"+"    <td styles='formTableValue14' item='name' colspan='3'></td></tr>"+"</table>";this.formTableArea.set("html",e);this.form=new MForm(this.formTableArea,this.data||{},{isEdited:true,style:"minder",hasColon:true,itemTemplate:{name:{text:"名称",notEmpty:true}}},this.app);this.form.load()},_createBottomContent:function(){if(this.isNew||this.isEdited){this.okActionNode=new Element("button.inputOkButton",{styles:this.css.inputOkButton,text:"确定"}).inject(this.formBottomNode);this.okActionNode.addEvent("click",function(e){this.save(e)}.bind(this))}this.cancelActionNode=new Element("button.inputCancelButton",{styles:this.isEdited||this.isNew||this.getEditPermission()?this.css.inputCancelButton:this.css.inputCancelButton_long,text:"关闭"}).inject(this.formBottomNode);this.cancelActionNode.addEvent("click",function(e){this.close(e)}.bind(this))},save:function(){var e=this.form.getResult(true,null,true,false,true);if(e){if(this.isNew)e.parentId=this.explorer.getCurrentFolderId();this.app.restActions.saveFolder(e,function(e){this.explorer.tree.reload();this.close()}.bind(this))}}});MWF.xApplication.Minder.ReNameForm=new Class({Extends:MPopupForm,Implements:[Options,Events],options:{style:"minder",width:700,height:"200",hasTop:true,hasIcon:false,draggable:true,title:"重命名脑图",id:""},_createTableContent:function(){var e="<table width='100%' bordr='0' cellpadding='7' cellspacing='0' styles='formTable' style='margin-top: 20px; '>"+"<tr><td styles='formTableTitle' lable='name' width='25%'></td>"+"    <td styles='formTableValue14' item='name' colspan='3'></td></tr>"+"</table>";this.formTableArea.set("html",e);this.form=new MForm(this.formTableArea,this.data||{},{isEdited:true,style:"minder",hasColon:true,itemTemplate:{name:{text:"名称",notEmpty:true}}},this.app);this.form.load()},_createBottomContent:function(){if(this.isNew||this.isEdited){this.okActionNode=new Element("button.inputOkButton",{styles:this.css.inputOkButton,text:"确定"}).inject(this.formBottomNode);this.okActionNode.addEvent("click",function(e){this.save(e)}.bind(this))}this.cancelActionNode=new Element("button.inputCancelButton",{styles:this.isEdited||this.isNew||this.getEditPermission()?this.css.inputCancelButton:this.css.inputCancelButton_long,text:"关闭"}).inject(this.formBottomNode);this.cancelActionNode.addEvent("click",function(e){this.close(e)}.bind(this))},save:function(){var i=this.form.getResult(true,null,true,false,true);if(i){this.app.restActions.getMind(this.options.id,function(e){var t=e.data;t.name=i.name;this.app.restActions.saveMind(t,function(e){this.app.notice("重命名成功");this.explorer.currentView.reload();this.close()}.bind(this))}.bind(this))}}});MWF.xApplication.Minder.Toolbar=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],options:{style:"default",availableTool:[["createMinder","createFolder"],["rename","recycle"],["share"]],viewType:"list"},initialize:function(e,t,i){this.container=e;this.explorer=t;this.app=t.app;this.lp=t.app.lp;this.iconPath="/x_component_Minder/$Common/"+this.options.style+"/icon_tool/";this.cssPath="/x_component_Minder/$Common/"+this.options.style+"/css.wcss";this.setOptions(i);this.tools={createMinder:{action:"createMinder",text:"新建脑图",icon:"createminder"},createFolder:{action:"createFolder",text:"新建目录",icon:"createfolder"},rename:{action:"rename",text:"重命名",icon:"rename"},recycle:{action:"recycle",text:"删除",icon:"recycle"},destroyFromRecycle:{action:"destroyFromRecycle",text:"彻底删除",icon:"delete"},delete:{action:"delete",text:"彻底删除",icon:"delete"},share:{action:"share",text:"分享",icon:"share"},restore:{action:"restore",text:"恢复",icon:"restore"}}},load:function(){this._loadCss();this.node=new Element("div",{styles:this.css.toolbarNode}).inject(this.container);this.options.availableTool.each(function(e){var o=new Element("div",{styles:this.css.toolgroupNode}).inject(this.node);var r=e.length;e.each(function(e,t){var i;if(r==1){i="toolItemNode_single"}else{if(t==0){i="toolItemNode_left"}else if(t+1==r){i="toolItemNode_right"}else{i="toolItemNode_center"}}var s=this.tools[e];var n=new Element("div",{styles:this.css[i],text:s.text,events:{click:function(e){this[s.action](e)}.bind(this),mouseover:function(e){e.target.setStyles(this.css.toolItemNode_over);e.target.setStyle("background-image","url("+this.iconPath+s.icon+"_active.png)")}.bind(this),mouseout:function(e){e.target.setStyles(this.css.toolItemNode_normal);e.target.setStyle("background-image","url("+this.iconPath+s.icon+".png)")}.bind(this)}}).inject(o);n.setStyle("background-image","url("+this.iconPath+s.icon+".png)")}.bind(this))}.bind(this));this.loadRightNode()},createMinder:function(){var e=new MWF.xApplication.Minder.NewNameForm(this.explorer,{},{},{app:this.app});e.edit()},createFolder:function(){var e=new MWF.xApplication.Minder.FolderForm(this.explorer,{},{},{app:this.app});e.create()},rename:function(){var e=this.explorer.currentView.getCheckedItemData();if(e.length==0){this.app.notice("请先选择文件","error");return}var t=new MWF.xApplication.Minder.ReNameForm(this.explorer,{name:e[0].name},{id:e[0].id},{app:this.app});t.edit()},recycle:function(e){var i=this;var s=this.explorer.currentView.getCheckedItemIds();if(s.length==0){this.app.notice("请先选择文件","error");return}this.app.confirm("warn",e,"删除文件确认","是否删除选中的"+s.length+"个文件？删除的文件会放到回收站。",350,120,function(){var t=0;s.each(function(e){i.app.restActions.recycleMind(e,function(){t++;if(s.length==t){i.app.notice("成功删除"+t+"个文件，您可以从回收站找到文件。");i.explorer.currentView.reload()}})}.bind(this));this.close()},function(){this.close()})},delete:function(e){var i=this;var s=this.explorer.currentView.getCheckedItemIds();if(s.length==0){this.app.notice("请先选择文件","error");return}this.app.confirm("warn",e,"彻底删除文件确认","删除的文件无法恢复！是否彻底删除选中的"+s.length+"个文件？",350,120,function(){var t=0;s.each(function(e){i.app.restActions.deleteMind(e,function(){t++;if(s.length==t){i.app.notice("成功删除"+t+"个文件");i.explorer.currentView.reload()}})}.bind(this));this.close()},function(){this.close()})},destroyFromRecycle:function(e){var i=this;var s=this.explorer.currentView.getCheckedItemIds();if(s.length==0){this.app.notice("请先选择文件","error");return}this.app.confirm("warn",e,"彻底删除文件确认","删除的文件无法恢复！是否彻底删除选中的"+s.length+"个文件？",350,120,function(){var t=0;s.each(function(e){i.app.restActions.destroyFromRecycle(e,function(){t++;if(s.length==t){i.app.notice("成功删除"+t+"个文件");i.explorer.currentView.reload()}})}.bind(this));this.close()},function(){this.close()})},restore:function(){var t=this;var i=this.explorer.currentView.getCheckedItemIds();if(i.length==0){this.app.notice("请先选择文件","error");return}var s=0;i.each(function(e){t.app.restActions.restoreMind(e,function(){s++;if(i.length==s){t.app.notice("成功恢复"+s+"个文件");t.explorer.currentView.reload()}})}.bind(this))},loadRightNode:function(){this.toolabrRightNode=new Element("div",{styles:this.css.toolabrRightNode}).inject(this.node);this.loadSearch();this.loadListType()},loadSearch:function(){this.searchBarAreaNode=new Element("div",{styles:this.css.searchBarAreaNode}).inject(this.toolabrRightNode);this.searchBarNode=new Element("div",{styles:this.css.searchBarNode}).inject(this.searchBarAreaNode);this.searchBarInputBoxNode=new Element("div",{styles:this.css.searchBarInputBoxNode}).inject(this.searchBarNode);this.searchBarInputNode=new Element("input",{type:"text",placeHolder:this.lp.searchKey,styles:this.css.searchBarInputNode}).inject(this.searchBarInputBoxNode);this.searchBarResetActionNode=new Element("div",{styles:this.css.searchBarResetActionNode}).inject(this.searchBarInputBoxNode);this.searchBarResetActionNode.setStyle("display","none");this.searchBarActionNode=new Element("div",{styles:this.css.searchBarActionNode}).inject(this.searchBarNode);var e=this;this.searchBarActionNode.addEvent("click",function(){this.search()}.bind(this));this.searchBarResetActionNode.addEvent("click",function(){this.reset()}.bind(this));this.searchBarInputNode.addEvents({keydown:function(e){if(e.code==13){this.search();e.preventDefault()}}.bind(this)})},getListType:function(){return this.viewType||this.options.viewType},loadListType:function(){this.listViewTypeNode=new Element("div",{styles:this.css[this.options.viewType=="list"?"listViewTypeNode_active":"listViewTypeNode"],events:{click:function(){this.viewType="list";this.listViewTypeNode.setStyles(this.css.listViewTypeNode_active);this.tileViewTypeNode.setStyles(this.css.tileViewTypeNode);this.explorer.loadList(this.explorer.currentView.filterData)}.bind(this)}}).inject(this.toolabrRightNode);this.tileViewTypeNode=new Element("div",{styles:this.css[this.options.viewType!="list"?"tileViewTypeNode_active":"tileViewTypeNode"],events:{click:function(){this.viewType="tile";this.listViewTypeNode.setStyles(this.css.listViewTypeNode);this.tileViewTypeNode.setStyles(this.css.tileViewTypeNode_active);this.explorer.loadList(this.explorer.currentView.filterData)}.bind(this)}}).inject(this.toolabrRightNode)},search:function(){var e=this.searchBarInputNode.get("value");var t=Object.clone(this.explorer.currentView.filterData);if(e){t.name=e}else if(t.name){delete t.name}this.explorer.loadList(t)},share:function(){var e=this.explorer.currentView.getCheckedItemData();if(e.length==0){this.app.notice("请先选择文件","error");return}var t=new MWF.xApplication.Minder.ShareForm(this.explorer,{},{},{app:this.app});t.checkedItemData=e;t.edit()}});MWF.xApplication.Minder.List=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexView,options:{scrollEnable:true,scrollType:"window"},_createDocument:function(e,t){return new MWF.xApplication.Minder.Document(this.viewNode,e,this.explorer,this,null,t)},_getCurrentPageData:function(t,e){if(!e)e=30;var i=this.items.length?this.items[this.items.length-1].data.id:"(0)";var s=this.filterData||{};if(this.sortType&&this.sortField){s.orderField=this.sortField;s.orderType=this.sortType}this.actions.listNextMindWithFilter(i,e,s,function(e){if(!e.data)e.data=[];if(t)t(e)})},_removeDocument:function(e,t){this.actions.deleteSubject(e.id,function(e){this.reload();this.app.notice(this.app.lp.deleteDocumentOK,"success")}.bind(this))},_create:function(){},_openDocument:function(e,t){var i="MinderEditor"+e.id;if(this.app.desktop.apps[i]){this.app.desktop.apps[i].setCurrent()}else{this.app.desktop.openApplication(null,"MinderEditor",{appId:i,folderId:e.folderId,id:e.id,isEdited:true,isNew:false})}},_queryCreateViewNode:function(){},_postCreateViewNode:function(e){},_queryCreateViewHead:function(){},_postCreateViewHead:function(e){var t=e.getElement("[item='selectAll']");if(t){t.addEvent("click",function(){if(this.selectedAll){this.selectAllCheckbox_custom(false);this.selectedAll=false;t.setStyles(this.css.tileSelectAllNode)}else{this.selectAllCheckbox_custom(true);this.selectedAll=true;t.setStyles(this.css.tileSelectAllNode_selected)}}.bind(this))}},getCheckedItemData:function(){if(this.viewType=="tile"){var e=this.getCheckedItems_custom()}else{var e=this.getCheckedItems()}var t=[];e.each(function(e){t.push(e.data)});return t},getCheckedItemIds:function(){if(this.viewType=="tile"){var e=this.getCheckedItems_custom()}else{var e=this.getCheckedItems()}var t=[];e.each(function(e){t.push(e.data.id)});return t},selectAllCheckbox_custom:function(t){this.items.each(function(e){e.setSelect(t)}.bind(this))},getCheckedItems_custom:function(){var t=[];this.items.each(function(e){if(e.selected){t.push(e)}}.bind(this));return t}});MWF.xApplication.Minder.Document=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexDocument,mouseoverDocument:function(){this.node.setStyles(this.css.tileNode_over);if(!this.selected){var e=this.node.getElement("[item=select]");e.setStyle("display","")}},mouseoutDocument:function(){this.node.setStyles(this.css.tileNode);if(!this.selected){var e=this.node.getElement("[item=select]");e.setStyle("display","none")}},_queryCreateDocumentNode:function(e){},_postCreateDocumentNode:function(i,e){var t=i.getElement("[item=select]");if(t){t.addEvent("click",function(e){this.setSelect(!this.selected);e.stopPropagation()}.bind(this))}this.app.restActions.getMindIcon(e.id,function(e){var t=i.getElement("[item=thumbnail]");t.set("src","data:image/png;base64,"+e.data.value)},function(){var e=i.getElement("[item=thumbnail]");e.set("src",this.app.path+this.view.options.style+"/icon/default_thumbnail.png")}.bind(this))},setSelect:function(e){var t=this.node.getElement("[item=select]");if(!e){this.selected=false;t.setStyles(this.css.tileItemSelectNode)}else{this.selected=true;t.setStyles(this.css.tileItemSelectNode_selected)}},open:function(e){this.view._openDocument(this.data,this.index)},edit:function(e){var t="MinderEditor"+this.data.id;var i=this.app.desktop.apps[t];if(i){i.setCurrent();if(e){i.openMainMenu(e)}}else{this.app.desktop.openApplication(null,"MinderEditor",{appId:t,folderId:this.data.folderId,id:this.data.id,isEdited:true,isNew:false,menuAction:e})}},remove:function(){},showFileVersion:function(e){this.edit("openFileVersion");e.stopPropagation()},showShareRecord:function(e){this.edit("openShare");e.stopPropagation()}});MWF.xApplication.Minder.ShareTooltip=new Class({Extends:MTooltips,options:{style:"",axis:"y",position:{x:"auto",y:"auto"},event:"mouseenter",hiddenDelay:200,displayDelay:0,overflow:"scroll"},_getHtml:function(){var e=this.data;var t="font-size:14px;color:#333";var i="font-size:14px;color:#666;padding-right:20px";var s="<div style='overflow: hidden;padding:15px 20px 20px 10px;height:16px;line-height:16px;'>"+"   <div style='font-size: 16px;color:#333;float: left;'>分享细节</div>"+"</div>"+"<div style='font-size: 14px;color:#333;padding:0px 10px 15px 20px;'>"+e.name+"</div>"+"<div style='height:1px;margin:0px 20px;border-bottom:1px solid #ccc;'></div>"+"<table width='100%' bordr='0' cellpadding='7' cellspacing='0' style='margin:13px 13px 13px 13px;'>"+"<tr><td style='"+t+"' width='70'>个人:</td>"+"    <td style='"+i+"'>"+this.getCn(e.sharePersonList)+"</td></tr>"+"<tr><td style='"+t+"'>组织:</td>"+"    <td style='"+i+"'>"+this.getCn(e.shareUnitList)+"</td></tr>"+"<tr><td style='"+t+"'>群组:</td>"+"    <td style='"+i+"'>"+this.getCn(e.shareGroupList)+"</td></tr>"+"</table>";return""}});MWF.xApplication.Minder.ShareRecordForm=new Class({Extends:MPopupForm,Implements:[Options,Events],options:{style:"minder",width:"80%",height:"80%",hasTop:true,hasIcon:false,draggable:true,title:"分享记录"},_createTableContent:function(){},_createBottomContent:function(){this.cancelActionNode=new Element("button.inputCancelButton",{styles:this.css.inputCancelButton_long,text:"关闭"}).inject(this.formBottomNode);this.cancelActionNode.addEvent("click",function(e){this.close(e)}.bind(this))}});