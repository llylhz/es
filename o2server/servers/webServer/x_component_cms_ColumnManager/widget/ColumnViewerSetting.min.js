MWF.xApplication.cms.ColumnManager=MWF.xApplication.cms.ColumnManager||{};MWF.require("MWF.widget.O2Identity",null,false);MWF.xApplication.cms.ColumnManager.ColumnViewerSetting=new Class({Implements:[Options],options:{objectId:""},initialize:function(t,e,i,s){this.app=t;this.node=$(i);this.lp=e;this.setOptions(s)},load:function(){this.createNode();this.listData(function(){this.loadOrg()}.bind(this))},createNode:function(){this.titleNode=new Element("div.availableTitleNode",{styles:this.app.css.availableTitleNode,text:this.lp.title}).inject(this.node);this.contentNode=new Element("div",{styles:{overflow:"hidden"}}).inject(this.node);this.itemsContentNode=new Element("div.availableItemsContentNode",{styles:this.app.css.availableItemsContentNode}).inject(this.contentNode);this.actionAreaNode=new Element("div",{styles:{overflow:"hidden"}}).inject(this.node);var t=new Element("div.selectButtonStyle",{styles:this.app.css.selectButtonStyle,text:this.lp.set}).inject(this.actionAreaNode);t.addEvent("click",function(){this.change()}.bind(this))},loadOrg:function(){this.itemsContentNode.empty();this.loadOrgWidget(this.data.personList);this.loadOrgWidget(this.data.unitList);this.loadOrgWidget(this.data.groupList)},loadOrgWidget:function(t){this.OrgWidgetList=this.OrgWidgetList||[];var n={style:"xform",canRemove:false};var a=this.itemsContentNode;(t||[]).each(function(t){var e=t.substr(t.length-1,1);var i={name:t};switch(e.toLowerCase()){case"i":var s=new MWF.widget.O2Identity(i,a,n);break;case"p":var s=new MWF.widget.O2Person(i,a,n);break;case"u":var s=new MWF.widget.O2Unit(i,a,n);break;case"g":var s=new MWF.widget.O2Group(i,a,n);break;default:var s=new MWF.widget.O2Other(i,a,n)}this.OrgWidgetList.push(s)}.bind(this))},change:function(){MWF.xDesktop.requireApp("Selector","package",null,false);var t={type:"",types:["person","unit","group"],title:this.lp.set,count:0,values:(this.data.personList||[]).combine(this.data.unitList||[]).combine(this.data.groupList||[]),expand:false,onComplete:function(t){var s={personList:[],unitList:[],groupList:[]};t.each(function(t){var e=t.data.distinguishedName;var i=e.substr(e.length-1,1);switch(i.toLowerCase()){case"p":s.personList.push(e);break;case"u":s.unitList.push(e);break;case"g":s.groupList.push(e);break}});this.saveData(s,function(){this.listData(function(){this.loadOrg()}.bind(this))}.bind(this))}.bind(this)};var e=new MWF.O2Selector(this.app.content,t)},listData:function(e){this.app.restActions.listAppInfoViewers(this.options.objectId,function(t){this.data=t.data;if(e)e(t)}.bind(this),null,false)},saveData:function(t,i){this.app.restActions.saveAppInfoViewer(this.options.objectId,t,function(e){this.app.restActions.getColumn(this.options.objectId,function(t){this.dataParent.data=t.data;this.app.options.column=t.data;this.app.options.application=t.data;if(i)i(e)}.bind(this))}.bind(this),null,false)}});