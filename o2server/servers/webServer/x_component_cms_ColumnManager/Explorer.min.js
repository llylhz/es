MWF.xApplication.cms=MWF.xApplication.cms||{};MWF.xApplication.cms.ColumnManager=MWF.xApplication.cms.ColumnManager||{};MWF.xDesktop.requireApp("cms.ColumnManager","lp."+MWF.language,null,false);MWF.xDesktop.requireApp("cms.ColumnManager","package",null,false);MWF.xApplication.cms.ColumnManager.Explorer=new Class({Extends:MWF.widget.Common,Implements:[Options,Events],options:{style:"default",title:"",tooltip:{create:MWF.CMSCM.LP.category.create,search:MWF.CMSCM.LP.category.search,searchText:MWF.CMSCM.LP.category.searchText,noElement:MWF.CMSCM.LP.category.noCategoryNoticeText}},initialize:function(e,t,i){this.setOptions(i);this.setTooltip();this.path="/x_component_cms_ColumnManager/$Explorer/";this.cssPath="/x_component_cms_ColumnManager/$Explorer/"+this.options.style+"/css.wcss";this._loadCss();this.actions=t;this.node=$(e);this.initData()},setTooltip:function(e){if(e)this.options.tooltip=Object.merge(this.options.tooltip,e)},initData:function(){this.itemArray=[];this.itemObject={};this.deleteMarkItems=[]},reload:function(){if(!this.node)return;this.initData();this.node.empty();this.load()},load:function(){this.loadToolbar();this.loadContentNode();this.setNodeScroll();this.loadElementList()},loadToolbar:function(){this.toolbarNode=new Element("div",{styles:this.css.toolbarNode});this.createTitleElementNode();this.createCreateElementNode();this.createSearchElementNode();this.toolbarNode.inject(this.node)},createCreateElementNode:function(){this.createElementNode=new Element("div",{styles:this.css.createElementNode,title:this.options.tooltip.create}).inject(this.toolbarNode);this.createElementNode.addEvents({click:function(e){this._createElement(e)}.bind(this),mouseover:function(e){this.createElementNode.setStyles(this.css.createElementNode_over)}.bind(this),mouseout:function(e){this.createElementNode.setStyles(this.css.createElementNode)}.bind(this)})},createTitleElementNode:function(){this.titleElementNode=new Element("div",{styles:this.css.titleElementNode,text:this.options.title}).inject(this.toolbarNode)},createSearchElementNode:function(){this.searchElementNode=new Element("div",{styles:this.css.searchElementNode}).inject(this.toolbarNode);return false;this.searchElementButtonNode=new Element("div",{styles:this.css.searchElementButtonNode,title:this.options.tooltip.search}).inject(this.searchElementNode);this.searchElementInputAreaNode=new Element("div",{styles:this.css.searchElementInputAreaNode}).inject(this.searchElementNode);this.searchElementInputBoxNode=new Element("div",{styles:this.css.searchElementInputBoxNode}).inject(this.searchElementInputAreaNode);this.searchElementInputNode=new Element("input",{type:"text",value:this.options.tooltip.searchText,styles:this.css.searchElementInputNode,"x-webkit-speech":"1"}).inject(this.searchElementInputBoxNode);var e=this;this.searchElementInputNode.addEvents({focus:function(){if(this.value==e.options.tooltip.searchText)this.set("value","")},blur:function(){if(!this.value)this.set("value",e.options.tooltip.searchText)},keydown:function(e){if(e.code==13){this.searchElement();e.preventDefault()}}.bind(this),selectstart:function(e){e.preventDefault()}});this.searchElementButtonNode.addEvent("click",function(){this.searchElement()}.bind(this))},searchElement:function(){alert("search Element")},loadContentNode:function(){this.elementContentNode=new Element("div",{styles:this.css.elementContentNode}).inject(this.node);this.elementContentListNode=new Element("div",{styles:this.css.elementContentListNode}).inject(this.elementContentNode);this.setContentSize();this.app.addEvent("resize",function(){this.setContentSize()}.bind(this))},setContentSize:function(){var e=this.toolbarNode?this.toolbarNode.getSize():{x:0,y:0};var t=this.node.getSize();var i=this.elementContentNode.getStyle("padding-top").toFloat();var s=this.elementContentNode.getStyle("padding-bottom").toFloat();var n=t.y-e.y-i-s;this.elementContentNode.setStyle("height",""+n+"px");var o=this.app.content.getSize();var l=this.app.leftContentNode.getSize();var c=o.x-l.x;this.elementContentNode.setStyle("width",""+(c-10)+"px");if(this.options.noCreate)this.createElementNode.destroy()},setNodeScroll:function(){MWF.require("MWF.widget.DragScroll",function(){new MWF.widget.DragScroll(this.elementContentNode)}.bind(this));MWF.require("MWF.widget.ScrollBar",function(){new MWF.widget.ScrollBar(this.elementContentNode,{indent:false})}.bind(this))},loadElementList:function(i){this._loadItemDataList(function(e){if(e.data.length){e.data.each(function(e){var t=this._getItemObject(e,this.itemArray.length+1);t.load();this.itemObject[e.id]=t;this.itemArray.push(t)}.bind(this));if(i)i()}else{var t=this.noElementNode=new Element("div",{styles:this.css.noElementNode,text:this.options.tooltip.noElement}).inject(this.elementContentListNode);t.addEvent("click",function(e){this._createElement(e)}.bind(this))}}.bind(this))},showDeleteAction:function(){if(!this.deleteItemsAction){this.deleteItemsAction=new Element("div",{styles:this.css.deleteItemsAction,text:this.app.lp.deleteItems}).inject(this.node);this.deleteItemsAction.fade("in");this.deleteItemsAction.position({relativeTo:this.elementContentListNode});this.deleteItemsAction.addEvent("click",function(){var e=this;this.app.confirm("warn",this.deleteItemsAction,MWF.CMSCM.LP.deleteElementTitle,MWF.CMSCM.LP.deleteElement,300,120,function(){e.deleteItems();this.close()},function(){this.close()})}.bind(this))}},hideDeleteAction:function(){if(this.deleteItemsAction)this.deleteItemsAction.destroy();delete this.deleteItemsAction},_createElement:function(e){},_loadItemDataList:function(e){this.app.restActions.listCategory(this.app.options.column.id,e)},_getItemObject:function(e,t){return MWF.xApplication.cms.ColumnManager.Explorer.Item(this,e,{index:t})}});MWF.xApplication.cms.ColumnManager.Explorer.Item=new Class({Implements:[Options],options:{where:"bottom",index:1},initialize:function(e,t,i){this.setOptions(i);this.explorer=e;this.data=t;this.container=this.explorer.elementContentListNode;this.icon=this._getIcon()},load:function(){if(this.options.index%2==0){this.itemNodeCss=this.explorer.css.itemNode_even}else{this.itemNodeCss=this.explorer.css.itemNode}this.node=new Element("div",{styles:this.itemNodeCss,events:{click:function(e){this._open(e);e.stopPropagation()}.bind(this),mouseover:function(){this.node.setStyles(this.explorer.css.itemNode_over)}.bind(this),mouseout:function(){this.node.setStyles(this.itemNodeCss)}.bind(this)}}).inject(this.container,this.options.where);if(this.data.icon)this.icon=this.data.icon;var e=this.explorer.path+""+this.explorer.options.style+"/processIcon/"+this.icon;var t=new Element("div",{styles:this.explorer.css.itemIconNode}).inject(this.node);t.setStyle("background","url("+e+") center center no-repeat");t.makeLnk({par:this._getLnkPar()});this.actionsArea=new Element("div.actionsArea",{styles:this.explorer.css.actionsArea}).inject(this.node);if(!this.explorer.options.noDelete){this.deleteActionNode=new Element("div.deleteAction",{styles:this.explorer.css.deleteAction}).inject(this.actionsArea);this.deleteActionNode.addEvent("click",function(e){this.deleteItem(e);e.stopPropagation()}.bind(this));this.deleteActionNode.addEvents({mouseover:function(e){this.deleteActionNode.setStyles(this.explorer.css.deleteAction_over)}.bind(this),mouseout:function(e){this.deleteActionNode.setStyles(this.explorer.css.deleteAction)}.bind(this)})}var i=new Element("div.itemInforNode",{styles:this.explorer.css.itemInforNode}).inject(this.node);var s=new Element("div.itemInforBaseNode",{styles:this.explorer.css.itemInforBaseNode}).inject(i);new Element("div.itemTextTitleNode",{styles:this.explorer.css.itemTextTitleNode,text:this.data.name,title:this.data.name}).inject(s);new Element("div.itemTextAliasNode",{styles:this.explorer.css.itemTextAliasNode,text:this.data.alias,title:this.data.alias}).inject(s);new Element("div.itemTextDateNode",{styles:this.explorer.css.itemTextDateNode,text:this.data.updateTime||""}).inject(s);new Element("div.itemTextDescriptionNode",{styles:this.explorer.css.itemTextDescriptionNode,text:this.data.description||"",title:this.data.description||""}).inject(s)},deleteItem:function(){if(!this.deleteMode){this.deleteMode=true;this.node.setStyle("background-color","#ffb7b7");this.deleteActionNode.setStyle("background-image","url("+"/x_component_cms_ColumnManager/$Explorer/default/processIcon/deleteProcess_red1.png)");this.deleteActionNode.removeEvents("mouseover");this.deleteActionNode.removeEvents("mouseout");this.node.removeEvents("mouseover");this.node.removeEvents("mouseout");this.explorer.deleteMarkItems.push(this)}else{this.deleteMode=false;this.node.setStyle("background","#FFF");this.deleteActionNode.setStyles(this.explorer.css.deleteAction);this.deleteActionNode.addEvents({mouseover:function(e){this.deleteActionNode.setStyles(this.explorer.css.deleteAction_over)}.bind(this),mouseout:function(e){this.deleteActionNode.setStyles(this.explorer.css.deleteAction)}.bind(this)});this.node.addEvents({mouseover:function(){this.node.setStyles(this.explorer.css.itemNode_over)}.bind(this),mouseout:function(){this.node.setStyles(this.itemNodeCss)}.bind(this)});this.explorer.deleteMarkItems.erase(this)}if(this.explorer.deleteMarkItems.length){this.explorer.showDeleteAction()}else{this.explorer.hideDeleteAction()}},deleteItems:function(){},_open:function(e){var t=this;var i={onQueryLoad:function(){this.actions=t.explorer.actions;this.category=t;this.options.id=t.data.id;this.column=t.explorer.app.options.column;this.application=t.explorer.app.options.column}};this.explorer.app.desktop.openApplication(e,"cms.ProcessDesigner",i)},_getIcon:function(){var e=(Math.random()*33).toInt();return"process_icon_"+e+".png"},_getLnkPar:function(){return{icon:this.explorer.path+this.explorer.options.style+"/processIcon/lnk.png",title:this.data.name,par:'ProcessDesigner#{"id": "'+this.data.id+'"}'}},_isNew:function(){if(this.data.updateTime){var e=Date.parse(this.data.updateTime);var t=new Date;if(e.diff(t,"hour")<12){this.newNode=new Element("div",{styles:this.explorer.css.itemNewNode}).inject(this.node)}}}});