MWF.xApplication.Selector=MWF.xApplication.Selector||{};MWF.xDesktop.requireApp("Selector","Unit",null,false);MWF.xApplication.Selector.UnitWithType=new Class({Extends:MWF.xApplication.Selector.Unit,options:{style:"default",count:0,title:MWF.xApplication.Selector.LP.selectUnit,units:[],unitType:"",values:[],zIndex:1e3,expand:true},loadSelectItems:function(addToNext){debugger;var data={};data.type=this.options.unitType;data.unitList=[];this.options.units.each(function(unit){if(typeOf(unit)==="string"){data.unitList.push(unit)}else{data.unitList.push(unit.distinguishedName)}}.bind(this));this.orgAction.listUnitByType(function(json){if(json.data.length){json.data.each(function(data){if(!this.options.unitType||data.typeList.indexOf(this.options.unitType)!==-1){var unit=this._newItem(data,this,this.itemAreaNode,1)}else{if(data.woSubDirectUnitList.length)var category=this._newItemCategory("ItemCategory",data,this,this.itemAreaNode)}}.bind(this))}}.bind(this),null,data)},_scrollEvent:function(y){return true},_getChildrenItemIds:function(){return null},_newItemCategory:function(type,data,selector,item,level){return new MWF.xApplication.Selector.UnitWithType[type](data,selector,item,level)},_listItemByKey:function(callback,failure,key){key={key:key};if(this.options.units.length){var units=[];this.options.units.each(function(u){if(typeOf(u)==="string"){units.push(u)}if(typeOf(u)==="object"){units.push(u.distinguishedName)}});key.unitList=units}if(this.options.unitType)key.type=this.options.unitType;this.orgAction.listUnitByKey(function(json){if(callback)callback.apply(this,[json])}.bind(this),failure,key)},_getItem:function(callback,failure,id,async){this.orgAction.getUnit(function(json){if(callback)callback.apply(this,[json])}.bind(this),failure,typeOf(id)==="string"?id:id.distinguishedName,async)},_newItemSelected:function(data,selector,item){return new MWF.xApplication.Selector.UnitWithType.ItemSelected(data,selector,item)},_listItemByPinyin:function(callback,failure,key){key={key:key};if(this.options.units.length){var units=[];this.options.units.each(function(u){if(typeOf(u)==="string"){units.push(u)}if(typeOf(u)==="object"){units.push(u.distinguishedName)}});key.unitList=units}if(this.options.unitType)key.type=this.options.unitType;this.orgAction.listUnitByPinyininitial(function(json){if(callback)callback.apply(this,[json])}.bind(this),failure,key)},_newItem:function(data,selector,container,level){return new MWF.xApplication.Selector.UnitWithType.Item(data,selector,container,level)},_newItemSearch:function(data,selector,container,level){return new MWF.xApplication.Selector.UnitWithType.SearchItem(data,selector,container,level)}});MWF.xApplication.Selector.UnitWithType.Item=new Class({Extends:MWF.xApplication.Selector.Unit.Item,_getShowName:function(){return this.data.name},_setIcon:function(){this.iconNode.setStyle("background-image","url("+"/x_component_Selector/$Selector/default/icon/departmenticon.png)")},loadSubItem:function(){this.isExpand=this.selector.options.expand;if(this.data.subDirectUnitCount){if(this.selector.options.expand){if(this.level===1){this.levelNode.setStyles(this.selector.css.selectorItemLevelNode_expand);this.loadSubItems()}else{this.isExpand=false;this.levelNode.setStyles(this.selector.css.selectorItemLevelNode_collapse)}}else{this.levelNode.setStyles(this.selector.css.selectorItemLevelNode_collapse)}this.levelNode.addEvent("click",function(e){if(this.isExpand){this.children.setStyle("display","none");this.levelNode.setStyles(this.selector.css.selectorItemLevelNode_collapse);this.isExpand=false}else{this.loadSubItems();this.levelNode.setStyles(this.selector.css.selectorItemLevelNode_expand);this.isExpand=true}e.stopPropagation()}.bind(this))}},loadSubItems:function(){if(!this.loaded){if(!this.children){this.children=new Element("div",{styles:this.selector.css.selectorItemCategoryChildrenNode}).inject(this.node,"after")}this.children.setStyle("display","block");this.data.woSubDirectUnitList.each(function(subData){if(!this.selector.options.unitType||subData.typeList.indexOf(this.selector.options.unitType)!==-1){var unit=this.selector._newItem(subData,this.selector,this.children,this.level+1)}else{if(data.woSubDirectUnitList.length)var category=this.selector._newItemCategory("ItemCategory",subData,this.selector,this.children)}}.bind(this));this.loaded=true}else{this.children.setStyle("display","block")}}});MWF.xApplication.Selector.UnitWithType.SearchItem=new Class({Extends:MWF.xApplication.Selector.Unit.Item,_getShowName:function(){return this.data.levelName||this.data.name}});MWF.xApplication.Selector.UnitWithType.ItemSelected=new Class({Extends:MWF.xApplication.Selector.Unit.ItemSelected,_getTtiteText:function(){return this.data.levelName||this.data.name},_getShowName:function(){return this.data.name+(this.data.levelName?"("+this.data.levelName+")":"")},_setIcon:function(){this.iconNode.setStyle("background-image","url("+"/x_component_Selector/$Selector/default/icon/departmenticon.png)")}});MWF.xApplication.Selector.UnitWithType.ItemCategory=new Class({Extends:MWF.xApplication.Selector.Unit.ItemCategory,loadSub:function(callback){if(!this.loaded){this.data.woSubDirectUnitList.each(function(subData){if(!this.selector.options.unitType||subData.typeList.indexOf(this.selector.options.unitType)!==-1){var unit=this.selector._newItem(subData,this.selector,this.children,this.level+1)}else{if(subData.woSubDirectUnitList.length)var category=this.selector._newItemCategory("ItemCategory",subData,this.selector,this.children,this.level+1)}}.bind(this));this.loaded=true;if(callback)callback()}else{if(callback)callback()}},_hasChild:function(){return this.data.woSubDirectUnitList.length}});MWF.xApplication.Selector.UnitWithType.Filter=new Class({Implements:[Options,Events],options:{style:"default",units:[]},initialize:function(value,options){this.setOptions(options);this.value=value;this.orgAction=MWF.Actions.get("x_organization_assemble_control")},filter:function(value,callback){this.value=value;var key=this.value;key={key:key};if(this.options.units.length){var units=[];this.options.units.each(function(u){if(typeOf(u)==="string"){units.push(u)}if(typeOf(u)==="object"){units.push(u.distinguishedName)}});key.unitList=units}if(this.options.unitType)key.type=this.options.unitType;this.orgAction.listUnitByKey(function(json){data=json.data;if(callback)callback(data)}.bind(this),failure,key)}});