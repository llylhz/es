MWF.widget=MWF.widget||{};MWF.require("MWF.widget.Common",null,false);MWF.require("MWF.xDesktop.Actions.RestActions",null,false);MWF.widget.O2Identity=new Class({Implements:[Options,Events],Extends:MWF.widget.Common,options:{style:"default",canRemove:false,lazy:false},initialize:function(t,e,i){this.setOptions(i);this.loadedInfor=false;this.path=MWF.defaultPath+"/widget/$O2Identity/";this.cssPath=MWF.defaultPath+"/widget/$O2Identity/"+this.options.style+"/css.wcss";this._loadCss();this.container=$(e);this.data=t;this.style=this.css;this.action=new MWF.xDesktop.Actions.RestActions("","x_organization_assemble_control","x_component_Org");this.load()},setText:function(){this.node.set("text",this.data.name+"("+this.data.unitName+")")},load:function(){if(!this.options.lazy)this.getPersonData();this.node=new Element("div",{styles:this.style.identityNode}).inject(this.container);this.setText();if(this.options.canRemove){this.removeNode=new Element("div",{styles:this.style.identityRemoveNode}).inject(this.node);this.removeNode.addEvent("click",function(t){this.fireEvent("remove",[this,t]);t.stopPropagation()}.bind(this))}if(!this.options.lazy){this.createInforNode(function(){this.fireEvent("loadedInfor",[this])}.bind(this))}else{this.node.addEvents({mouseover:function(){if(!this.loadedInfor){this.getPersonData();this.createInforNode(function(){this.fireEvent("loadedInfor",[this])}.bind(this))}}.bind(this)})}this.setEvent();this.node.addEvents({mouseover:function(){this.node.setStyles(this.style.identityNode_over)}.bind(this),mouseout:function(){this.node.setStyles(this.style.identityNode)}.bind(this)})},setEvent:function(){},getPersonData:function(){if(!this.data.dutys){var t=MWF.Actions.get("x_organization_assemble_control");var e=this.data.distinguishedName||this.data.id||this.data.unique;if(e)t.listUnitdutyByIdentity(e,function(t){this.data.dutys=t.data}.bind(this),null,false)}if(!this.data.woPerson){this.action.actions={getPerson:{uri:"/jaxrs/person/{flag}"},getIdentity:{uri:"/jaxrs/identity/{id}"}};var i;if(this.data.person){this.action.invoke({name:"getPerson",async:false,parameter:{flag:this.data.person},success:function(t){this.data.woPerson=i;i=t.data}.bind(this)})}else{this.action.invoke({name:"getIdentity",async:false,parameter:{id:this.data.id||this.data.name},success:function(t){this.data=t.data;i=t.data.woPerson}.bind(this)})}return i}else{return this.data.woPerson}listDutyNameWithIdentity},createInforNode:function(t){debugger;var e=this.getPersonData();if(e){this.inforNode=new Element("div",{styles:this.style.identityInforNode});var i=new Element("div",{styles:this.style.identityInforNameNode}).inject(this.inforNode);var s="/jaxrs/person/{flag}/icon";s=s.replace("{flag}",e.id);this.action.getAddress();s=this.action.address+s;img="<img width='50' height='50' border='0' src='"+s+"' style='border-radius:25px'/>";var n=new Element("div",{styles:this.style.identityInforPicNode,html:img}).inject(i);var a=new Element("div",{styles:this.style.identityInforRightTextNode}).inject(i);var o=new Element("div",{styles:this.style.identityInforNameTextNode,text:e.name}).inject(a);var d=new Element("div",{styles:this.style.identityInforEmployeeTextNode,text:e.employee}).inject(a);debugger;var h=[];if(this.data.dutys&&this.data.dutys.length){this.data.dutys.each(function(t){var e=t.name+"("+t.woUnit.levelName+")";h.push(e)})}var r=new Element("div",{styles:this.style.identityInforPhoneNode,html:"<div style='width:30px; float:left'>"+MWF.LP.desktop.person.duty+": </div><div style='width:160px; float:left; margin-left:10px'>"+h.join(",")+"</div>"}).inject(this.inforNode);this.loadedInfor=true;this.tooltip=new mBox.Tooltip({content:this.inforNode,setStyles:{content:{padding:15,lineHeight:20}},attach:this.node,transition:"flyin"})}if(t)t()},destroy:function(){if(this.tooltip)this.tooltip.destroy();this.node.destroy();MWF.release(this)}});MWF.widget.O2Person=new Class({Extends:MWF.widget.O2Identity,getPersonData:function(){if(!this.data.distinguishedName){this.action.actions={getPerson:{uri:"/jaxrs/person/{id}"}};this.action.invoke({name:"getPerson",async:false,parameter:{id:this.data.id||this.data.name},success:function(t){this.data=t.data}.bind(this)})}return this.data},setText:function(){this.node.set("text",this.data.name)}});MWF.widget.O2Unit=new Class({Extends:MWF.widget.O2Identity,getPersonData:function(){if(!this.data.distinguishedName){this.action.actions={getUnit:{uri:"/jaxrs/unit/{id}"}};this.action.invoke({name:"getUnit",async:false,parameter:{id:this.data.id||this.data.name},success:function(t){this.data=t.data}.bind(this)})}},createInforNode:function(){this.inforNode=new Element("div",{styles:this.style.identityInforNode});var t=new Element("div",{styles:this.style.identityInforNameNode,text:this.data.levelName}).inject(this.inforNode);this.tooltip=new mBox.Tooltip({content:this.inforNode,setStyles:{content:{padding:15,lineHeight:20}},attach:this.node,transition:"flyin"})},setText:function(){this.node.set("text",this.data.name)}});MWF.widget.O2Duty=new Class({Extends:MWF.widget.O2Identity,getPersonData:function(){if(!this.data.woUnit){this.action.actions={getUnitduty:{uri:"/jaxrs/unitduty/{id}"}};this.action.invoke({name:"getUnitduty",async:false,parameter:{id:this.data.dutyId||this.data.name},success:function(t){this.data=t.data}.bind(this)})}},createInforNode:function(){this.inforNode=new Element("div",{styles:this.style.identityInforNode});var t=new Element("div",{styles:this.style.identityInforNameNode,text:this.data.woUnit.levelName}).inject(this.inforNode);this.tooltip=new mBox.Tooltip({content:this.inforNode,setStyles:{content:{padding:15,lineHeight:20}},attach:this.node,transition:"flyin"})},setText:function(){this.node.set("text",this.data.name)}});MWF.widget.O2Group=new Class({Extends:MWF.widget.O2Unit,getPersonData:function(){if(!this.data.distinguishedName){this.action.actions={getGroup:{uri:"/jaxrs/group/{id}"}};this.action.invoke({name:"getGroup",async:false,parameter:{id:this.data.id||this.data.name},success:function(t){this.data=t.data}.bind(this)})}},setText:function(){this.node.set("text",this.data.name)},createInforNode:function(){return false}});MWF.widget.O2Application=new Class({Extends:MWF.widget.O2Group,getPersonData:function(){if(!this.data.name){this.action=new MWF.xDesktop.Actions.RestActions("","x_processplatform_assemble_surface","");this.action.actions={getApplication:{uri:"/jaxrs/application/{id}"}};this.action.invoke({name:"getApplication",async:false,parameter:{id:this.data.id||this.data.name},success:function(t){this.data=t.data}.bind(this)})}}});MWF.widget.O2CMSApplication=new Class({Extends:MWF.widget.O2Group,getPersonData:function(){if(!this.data.name){MWF.Actions.get("x_cms_assemble_control").getApplication(this.data.id||this.data.name,function(t){this.data=t.data}.bind(this),null,false)}}});MWF.widget.O2Process=new Class({Extends:MWF.widget.O2Group,getPersonData:function(){if(!this.data.name){this.action=new MWF.xDesktop.Actions.RestActions("","x_processplatform_assemble_surface","");this.action.actions={getProces:{uri:"/jaxrs/process/{id}/complex"}};this.action.invoke({name:"getProces",async:false,parameter:{id:this.data.id||this.data.name},success:function(t){this.data=t.data}.bind(this)})}},createInforNode:function(){this.inforNode=new Element("div",{styles:this.style.identityInforNode});var t=new Element("div",{styles:this.style.identityInforNameNode,text:this.data.applicationName||this.data.appName}).inject(this.inforNode);this.tooltip=new mBox.Tooltip({content:this.inforNode,setStyles:{content:{padding:15,lineHeight:20}},attach:this.node,transition:"flyin"})}});MWF.widget.O2CMSCategory=new Class({Extends:MWF.widget.O2Group,getPersonData:function(){if(!this.data.name){MWF.Actions.get("x_cms_assemble_control").getCategory(this.data.id||this.data.name,function(t){this.data=t.data}.bind(this),null,false)}},createInforNode:function(){this.inforNode=new Element("div",{styles:this.style.identityInforNode});var t=new Element("div",{styles:this.style.identityInforNameNode,text:this.data.applicationName||this.data.appName}).inject(this.inforNode);this.tooltip=new mBox.Tooltip({content:this.inforNode,setStyles:{content:{padding:15,lineHeight:20}},attach:this.node,transition:"flyin"})}});MWF.widget.O2View=new Class({Extends:MWF.widget.O2Group,getPersonData:function(){return this.data},createInforNode:function(){this.inforNode=new Element("div",{styles:this.style.identityInforNode});var t=new Element("div",{styles:this.style.identityInforNameNode,text:this.data.applicationName||this.data.appName}).inject(this.inforNode);this.tooltip=new mBox.Tooltip({content:this.inforNode,setStyles:{content:{padding:15,lineHeight:20}},attach:this.node,transition:"flyin"})}});MWF.widget.O2CMSView=new Class({Extends:MWF.widget.O2View});MWF.widget.O2QueryView=new Class({Extends:MWF.widget.O2View});MWF.widget.O2QueryStat=new Class({Extends:MWF.widget.O2View});MWF.widget.O2FormField=new Class({Extends:MWF.widget.O2Group,getPersonData:function(){return this.data}});MWF.widget.O2Role=new Class({Extends:MWF.widget.O2Group,getPersonData:function(){if(!this.data.distinguishedName){this.action.actions={getRole:{uri:"/jaxrs/role/{id}"}};this.action.invoke({name:"getRole",async:false,parameter:{id:this.data.id||this.data.name},success:function(t){this.data=t.data}.bind(this)})}}});MWF.widget.O2Other=new Class({Extends:MWF.widget.O2Group,getPersonData:function(){return this.data}});