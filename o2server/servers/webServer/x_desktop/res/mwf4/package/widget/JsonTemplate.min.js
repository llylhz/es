MWF.widget=MWF.widget||{};MWF.widget.JsonTemplate=new Class({Implements:[Options,Events],options:{},initialize:function(t,e,n){this.setOptions(n);this.json=t;this.html=e},load:function(){if(this.fireEvent("queryLoad")){this.setContentText();this.setContentFun();this.setContentEach();this.fireEvent("postLoad")}return this.html},setContentText:function(){var t=/(text\{).+?\}/g;var e=this.html.match(t);if(e){if(e.length){for(var n=0;n<e.length;n++){var s=e[n].substr(0,e[n].lastIndexOf("}"));s=s.substr(s.indexOf("{")+1,s.length);var a=this.getJsonContent(this.json,s);this.html=this.html.replace(/(text\{).+?\}/,a)}}}},setContentFun:function(){var t=/(fun\{).+?\}/g;var e=this.html.match(t);if(e){if(e.length){for(var n=0;n<e.length;n++){var s=e[n].substr(0,e[n].lastIndexOf("}"));s=s.substr(s.indexOf("{")+1,s.length);var a=this.getJsonFunContent(this.json,s);this.html=this.html.replace(/(fun\{).+?\}/,a)}}}},getJsonContent:function(json,text){var $=json;var f=eval("(x = function($){\n return "+text+";\n})");returnValue=f.apply(json,[$]);return returnValue||""},getJsonFunContent:function(json,text){var $=json;var f=eval("(x = function($){\n "+text+";\n})");returnValue=f.apply(json,[$]);return returnValue||""},setContentEach:function(){var t=/(\{each\([\s\S]+\)\})[\s\S]+?(\{endEach\})/g;var e=this.html.match(t);if(e){if(e.length){for(var n=0;n<e.length;n++){var s=e[n].substr(0,e[n].indexOf(")"));s=s.substr(s.indexOf("(")+1,s.length);var a=s.split(/,[\s]*/g);eachItemsPar=a[0];eachItemsCount=a[1].toInt();var h=this.getJsonContent(this.json,eachItemsPar);if(h)if(eachItemsCount==0)eachItemsCount=h.length;var r=e[n].substr(0,e[n].lastIndexOf("{endEach}"));r=r.substr(r.indexOf("}")+1,r.length);var i=[];if(h){for(var o=0;o<Math.min(h.length,eachItemsCount);o++){var l=h[o];if(l){var f=r;var u=/(eachText\{).+?\}/g;texts=f.match(u);if(texts){if(texts.length){for(var v=0;v<texts.length;v++){var c=texts[v].substr(0,texts[v].lastIndexOf("}"));c=c.substr(c.indexOf("{")+1,c.length);var g=this.getJsonContent(l,c);f=f.replace(/(eachText\{).+?\}/,g)}}}i.push(f)}}}this.html=this.html.replace(/(\{each\([\s\S]+\)\})[\s\S]+?(\{endEach\})/,i.join(""))}}}}});