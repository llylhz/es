MWF.widget.SimpleEditor.Actions=MWF.widget.SimpleEditor.Actions||{};MWF.widget.SimpleEditor.Actions.Emotion=new Class({Implements:[Options,Events],options:{style:"default",title:MWF.LP.widget.SimpleEditor.insertEmotion},initialize:function(t,e,i,o,s){this.setOptions(t);this.editor=e;this.toolbar=i;this.button=o;this.bindObj=s;this.settingPath=MWF.defaultPath+"/widget/$SimpleEditor/"+this.options.style+"/ActionSetting.js";this._loadSetting()},_loadSetting:function(){var t=new Request({url:this.settingPath,async:false,method:"get",onSuccess:function(t,e){this.setting=MWF.widget.SimpleEditor.Actions.setting.emotion}.bind(this),onFailure:function(t){alert(t.responseText)}});t.send()},command:function(t){this.fireEvent("queryCommand");var e=t.target;if(e.tagName.toLowerCase()!="img")return;var i=$(e).get("src");this.closeDialog();var o='<img class="MWF_editor_emotion" src="'+i+'" alt="">';if(this.editor.selectionRange){this.editor.selection.setRange(this.editor.selectionRange)}else{this.editor.editareaNode.focus()}this.editor.selection.insertContent(o);this.editor.selectionRange=this.editor.selection.getRange();this.fireEvent("postCommand")},closeDialog:function(){this.fireEvent("queryCloseDialog");this.dialog.close();this.dialog.node=null;if(this.button)this.button.isActive=false;if(this.editor.selectionRange)this.editor.selection.setRange(this.editor.selectionRange);if(this.closeFun){document.body.removeEvent("mousedown",this.closeFun);this.closeFun=null}this.fireEvent("postCloseDialog")},showDialog:function(){var t=this;var e=this.setting;this.fireEvent("queryOpenDialog");var i=e.imageName.length;var o=e.cols;var s=e.rows||Math.ceil(i/o);var n=0;var a="";a+="<center>";a+='  <table width="100%">';for(var l=0;l<s;l++){a+="    <tr>";for(var d=0;d<o;d++){a+='   <td width="70">';if(n<i){imgNames=e.imageName[n].split("|");title=imgNames[1]?"title='"+imgNames[1]+"'":"";a+="   <img style='cursor:pointer;border:0;padding:2px;' "+title+" class='MWF_editor_emotion' src='"+e.imagesPath+imgNames[0]+e.fileExt+"'>"}a+="  </td>";n++}a+="    </tr>"}a+="  </table>";a+="</center>";if(e.dialog&&e.dialog.top){var r=e.dialog.top;var g=$(document.body)}else if(t.editor.iframe){var g=t.editor.iframe.getParent();var r=g.getCoordinates().top+(t.button?t.button.node.getCoordinates().bottom:130)}else{var r=t.button?t.button.node.getCoordinates().bottom:130;var g=t.editor.doc.body}if(e.dialog&&e.dialog.left){var h=e.dialog.left}else if(t.editor.iframe){var h=g.getCoordinates().left+(t.button?t.button.node.getCoordinates().left-5:10)}else{var h=t.button?t.button.node.getCoordinates().left:10}this.dialog=new MWF.widget.SimpleEditor.Dialog(g,{style:t.options.style,title:t.options.title,fx:e.dialog.fx||false,html:a,width:e.dialog.width||o*30,height:e.dialog.height||s*30,top:r,left:h,fromTop:e.dialog.fromTop||r,fromLeft:e.dialog.fromLeft||h,isMax:e.dialog.isMax||false,isClose:e.dialog.isClose||false,isResize:e.dialog.isResize||false,isMove:e.dialog.isMove||false,mark:e.dialog.mark||false,onPostLoad:function(){},onQueryInjectNode:function(){this.node.addEvent("mousedown",function(t){t.stopPropagation()});this.node.getElement(".MWF_dialod_close")&&this.node.getElement(".MWF_dialod_close").addEvent("click",t.closeDialog.bind(t));this.node.getElements(".MWF_editor_emotion")&&this.node.getElements(".MWF_editor_emotion").addEvent("click",t.command.bind(t))},onPostShow:function(){this.node.setStyle("height",(e.dialog.height||s*30)+30)}});this.dialog.show();this.closeFun=this.closeDialog.bind(this);document.body.addEvent("mousedown",this.closeFun);if(this.button)this.button.isActive=true;this.fireEvent("postOpenDialog")}});