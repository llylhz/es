MWF.widget=MWF.widget||{};MWF.require("MWF.widget.Common",null,false);MWF.widget.ScrollBar=new Class({Implements:[Options,Events],Extends:MWF.widget.Common,options:{distance:50,style:"default",isShow:false,where:"before",indent:true,offset:{V:{x:0,y:0},H:{x:0,y:0}}},scrollEvent:function(t){var o=t.scrollTop.toFloat();var e=t.scrollLeft.toFloat();this.fireEvent("scroll",[o,e])},initialize:function(t,o){if(COMMON.Browser.Platform.isMobile){t.setStyle("overflow","auto");t.addEvent("scroll",function(){this.scrollEvent(t)}.bind(this));return true}this.node=$(t);this.setOptions(o);this.path=MWF.defaultPath+"/widget/$ScrollBar/";this.cssPath=MWF.defaultPath+"/widget/$ScrollBar/"+this.options.style+"/css.wcss";this._loadCss();document.body.onresize=function(t){this.checkScroll()}.bind(this);this.node.onresize=function(t){this.checkScroll()}.bind(this);this.node.addEvent("mouseover",function(t){this.checkScroll();t.stopPropagation()}.bind(this));this.node.addEvent("mouseout",function(t){this.checkScroll();t.stopPropagation()}.bind(this));this.checkScrollShow();document.body.addEvent("mousemove",function(t){this.checkScrollShow(t)}.bind(this))},checkScrollShow:function(t){if(!this.node.isPointIn)return false;if(this.scrollVAreaNode){var o=this.scrollVAreaNode.getStyle("opacity");if(o==0){if(!this.scrollAreaOverLock&&!this.scrollAreaOutLock){this.scrollAreaOverLock=true;var e=this.node.getStyle("margin-right").toFloat();if(this.options.indent){var i=new Fx.Tween(this.node,{property:"margin-right",duration:"100"});i.start(e+this.scrollVWidth).chain(function(){this.scrollVAreaNode.setStyle("display","block");var t=new Fx.Tween(this.scrollVAreaNode,{property:"opacity",duration:"100"});t.start(0,1).chain(function(){this.scrollAreaOverLock=false}.bind(this))}.bind(this))}else{this.scrollVAreaNode.setStyle("display","block");var s=new Fx.Tween(this.scrollVAreaNode,{property:"opacity",duration:"100"});s.start(0,1).chain(function(){this.scrollAreaOverLock=false}.bind(this))}}}}},setScrollNodePosition:function(){this.node.scrollTo(0,0);if(this.scrollVNode){this.scrollVNode.setStyle("margin-top","0px");this.setScrollVNodeMoveLimit()}if(this.scrollHNode){var t=this.scrollHNode.getSize().y;t=0-t+this.options.offset.H.y;var o=0+this.options.offset.H.x;this.scrollHNode.setStyle("margin-left",""+o+"px");this.scrollHNode.setStyle("margin-top",""+t+"px")}},setScrollVNodeMove:function(){this.scrollVAreaNode.addEvent("click",function(t){t.stopPropagation()});this.scrollVNodeMove=new Drag(this.scrollVNode,{onStart:function(t,o){this.fireEvent("scrollStart");var e=o.event.clientX;var i=o.event.clientY;t.store("position",{x:e,y:i});t.store("margin",t.getStyle("margin-top"));this.showScrollBar=true}.bind(this),onComplete:function(t){this.showScrollBar=false;this.fireEvent("scrollComplete")}.bind(this),onDrag:function(t,o){var e=t.retrieve("position");var i=t.retrieve("margin").toFloat();var s=o.event.clientY.toFloat()-e.y.toFloat();var l=i+s;var r=this.node.getScrollSize();var n=this.node.getSize();var a=this.scrollVNode.getSize();var h=n.y.toFloat()-a.y.toFloat();var c=0;if(l<c)l=c;if(l>h)l=h;this.scrollVNode.setStyle("margin-top",""+l+"px");this.scroll(null,l)}.bind(this)})},setScrollVNodeMoveLimit:function(){var t=this.nodePosition.x.toFloat()+this.clientSize.x.toFloat();var o=this.nodePosition.y.toFloat();var e=o+this.clientSize.y.toFloat()-this.scrollVNodeSize.y.toFloat();this.scrollVNodeMove.detach();this.scrollVNodeMove.setOptions({limit:{x:[t,t],y:[o,e]}});this.scrollVNodeMove.attach()},scroll:function(t,o){var e=this.node.getScrollSize();var i=this.node.getSize();var s=this.scrollVNode.getSize();var l=e.y-i.y;var r=i.y.toFloat()-s.y.toFloat();var n=0;if(t){var a=this.node.getScroll();var h=a.y.toFloat()+t.toFloat();if(h<0)h=0;if(h>l)h=l;this.fireEvent("scroll",[h]);this.node.tweenScroll(h,1);var c=h/l.toFloat()*r.toFloat();if(c<n)c=n;if(c>r)c=r;this.scrollVNode.setStyle("margin-top",""+c+"px")}if(o){if(o>r)o=r;var c=o/r*l;var a=this.node.getScroll();this.node.tweenScroll(c,1);this.fireEvent("scroll",[c])}},checkScroll:function(){var t=this.node.getScrollSize();var o=this.node.getSize();var e=this.node.getPosition(this.node.getOffsetParent());this.mousewheel=function(t){var e=1-t.event.wheelDelta;var i=this.options.distance.toFloat()/100*o.y.toFloat();e=e/o.y.toFloat()*i;this.scroll(e,null);t.stopPropagation()}.bind(this);this.domMousewheel=function(t){var e=t.detail;var i=this.options.distance.toFloat()/100*o.y.toFloat();e=e/6*i;this.scroll(e,null);t.stopPropagation()}.bind(this);this.touchmove=function(t){var e=t.event.detail;var i=this.options.distance.toFloat()/100*o.y.toFloat();e=e/o.y.toFloat()*i;this.scroll(e,null);t.preventDefault();t.stopPropagation()}.bind(this);if(t.y>o.y){if(!this.scrollVNode){this.scrollVAreaNode=new Element("div",{styles:this.css.scrollVAreaNode}).inject(this.node,this.options.where);this.scrollVNode=new Element("div",{styles:this.css.scrollVNode}).inject(this.scrollVAreaNode);var i=this.node.getStyle("margin-right").toFloat();var s=this.node.getStyle("margin-top").toFloat();var l=this.node.getStyle("margin-bottom").toFloat();var r=this.scrollVAreaNode.getSize();if(this.options.indent)this.scrollVAreaNode.setStyle("margin-right",i);this.scrollVAreaNode.setStyle("margin-top",s);this.scrollVAreaNode.setStyle("display","none");this.scrollVWidth=this.scrollVAreaNode.getStyle("width").toFloat();this.setScrollVNodeMove();this.node.addEvent("mousewheel",this.mousewheel);this.node.addEvent("touchmove",this.touchmove);if(Browser.name=="firefox"){this.node.addEventListener("DOMMouseScroll",this.domMousewheel,false)}}if(this.scrollVAreaNode.getStyle("position")=="absolute"){this.scrollVAreaNode.position({relativeTo:this.node,position:"topright",edge:"topleft"})}this.scrollVAreaNode.setStyle("height",o.y)}else{if(this.scrollVNode){if(!this.scrollAreaOutLock&&!this.scrollAreaOverLock){if(!this.showScrollBar){this.scrollAreaOutLock=true;var n=new Fx.Tween(this.scrollVAreaNode,{property:"opacity",duration:"100"});n.start(0).chain(function(){var t=this.node.getStyle("margin-right").toFloat();this.scrollVAreaNode.setStyle("display","none");if(this.options.indent){var o=new Fx.Tween(this.node,{property:"margin-right",duration:"100"});o.start(t-this.scrollVWidth).chain(function(){this.scrollAreaOutLock=false;this.scrollVAreaNode.destroy();this.scrollVNode=null;this.scrollVAreaNode=null}.bind(this))}else{this.scrollAreaOutLock=false;this.scrollVAreaNode.destroy();this.scrollVNode=null;this.scrollVAreaNode=null}}.bind(this))}}}this.node.removeEvents("mousewheel",this.mousewheel);if(Browser.name=="firefox"){this.node.addEventListener("DOMMouseScroll",this.domMousewheel,false)}}}});