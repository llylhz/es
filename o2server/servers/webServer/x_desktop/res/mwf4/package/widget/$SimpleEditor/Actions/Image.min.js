MWF.widget.SimpleEditor.Actions=MWF.widget.SimpleEditor.Actions||{};MWF.widget.SimpleEditor.Actions.Image=new Class({Implements:[Options,Events],options:{style:"default",title:MWF.LP.widget.SimpleEditor.insertImage},initialize:function(e,t,i,o){this.setOptions(e);this.editor=t;this.toolbar=i;this.button=o},command:function(e){this.fireEvent("queryCommand");var t="";if(!this.webImageNode||this.webImageNode.get("value")==""){this.closeDialog();return}else{t='<img src="'+i(this.webImageNode.get("value"))+'" data-ke-src="'+i(this.webImageNode.get("value"))+'" ';if(this.imageWidthNode&&this.imageWidthNode.get("value")!="")t+='width="'+i(this.imageWidthNode.get("value"))+'" ';if(this.imageHeightNode&&this.imageHeightNode.get("value")!="")t+='height="'+i(this.imageHeightNode.get("value"))+'" ';if(this.imageTitleNode&&this.imageTitleNode.get("value")!=""){t+='title="'+i(this.imageTitleNode.get("value"))+'" ';t+='alt="'+i(this.imageTitleNode.get("value"))+'" '}t+="/>"}this.closeDialog();if(this.editor.selectionRange){this.editor.selection.setRange(this.editor.selectionRange)}else{this.editor.editareaNode.focus()}this.editor.selection.insertContent(t);this.editor.selectionRange=this.editor.selection.getRange();if(this.editor.iframe&&(this.editor.options.overFlow=="visible"||this.editor.options.overFlow=="max"))this.editor.setIframeHeight();this.fireEvent("postCommand");function i(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}},closeDialog:function(){this.fireEvent("queryCloseDialog");this.dialog.node.destroy();this.dialog.node=null;if(this.button)this.button.isActive=false;if(this.editor.selectionRange)this.editor.selection.setRange(this.editor.selectionRange);this.fireEvent("postCloseDialog")},showDialog:function(){var e=this;var t=0,i=0;var o=0;this.fireEvent("queryOpenDialog");var s="";s+="<center>";s+="  <table width='100%' style='padding:2px;'>";s+="    <tr>";s+="       <td width='50' style='padding:2px;'>";s+="         <span style='font-size:12px;color:#888;'>图片地址</span>";s+="      </td>";s+="      <td width='210' style='padding:2px;'>";s+="         <input type='text' style='width:200px;border:1px solid #ccc;font-size:12px;' name='webImage' id='webImage' value='http://'>";s+="      </td>";s+="    </tr>";s+="    <tr>";s+="       <td width='50' style='padding:2px;'>";s+="         <span style='font-size:12px;color:#888;'>图片大小</span>";s+="      </td>";s+="      <td width='210' style='padding:2px;'>";s+="         <label style='font-size:12px;color:#888;display:inline-block;'>宽</label>";s+="         <input type='text' style='width:40px;border:1px solid #ccc;font-size:12px;display:inline-block;' name='imageWidth' id='imageWidth' value=''>";s+="         <label style='font-size:12px;color:#888;display:inline-block;'>高</label>";s+="         <input type='text' style='width:40px;border:1px solid #ccc;font-size:12px;display:inline-block;' name='imageHeight' id='imageHeight' value=''>";s+="         <image src='"+MWF.defaultPath+"/widget/$SimpleEditor/default/img/refresh.png' style='cursor:pointer;' id='imageRefresh' title='重置大小'>";s+="      </td>";s+="    </tr>";s+="    <tr>";s+="       <td width='50' style='padding:2px;'>";s+="         <span style='font-size:12px;color:#888;'>图片说明</span>";s+="      </td>";s+="      <td width='210' style='padding:2px;'>";s+="         <input type='text' style='width:200px;border:1px solid #ccc;font-size:12px;' name='imageTitle' id='imageTitle' value=''>";s+="      </td>";s+="    </tr>";s+="    <tr>";s+="  </table>";s+="</center>";if(e.editor.iframe){var a=e.editor.iframe.getParent();var l=a.getCoordinates().top+(e.button?e.button.node.getCoordinates().bottom:130);var n=a.getCoordinates().left+(e.button?e.button.node.getCoordinates().left-15:10)}else{var l=e.button?e.button.node.getCoordinates().bottom:130;var n=e.button?e.button.node.getCoordinates().left:10;var a=e.editor.doc.body}this.dialog=new MWF.widget.SimpleEditor.Dialog(a,{style:e.options.style,html:s,width:300,height:120,top:l,left:n,fromTop:l,fromLeft:n,isMax:false,isClose:true,isResize:false,isMove:false,mark:false,buttons:{"确定":function(){e.command.call(e)},"取消":function(){e.closeDialog.call(e)}},onPostLoad:function(){this.button.setStyle("display","block")},onQueryInjectNode:function(){this.node.getElement(".MWF_dialod_close").addEvent("click",e.closeDialog.bind(e));this.node.getElement("#imageRefresh").addEvent("click",function(){g.call(this,true)});e.webImageNode=this.node.getElement("#webImage");e.imageWidthNode=this.node.getElement("#imageWidth");e.imageHeightNode=this.node.getElement("#imageHeight");e.imageTitleNode=this.node.getElement("#imageTitle");e.webImageNode.addEvents({change:function(){g.call(this,false)},focus:function(e){if(this.value=="http://")this.value=""}});e.imageWidthNode.addEvents({keyup:function(o){this.value=this.value.replace(/[^0-9_]/g,"");if(t>0){if(this.value!=""){e.imageHeightNode.set("value",Math.round(i/t*parseInt(this.value,10)))}else{e.imageHeightNode.set("value","")}}}});e.imageHeightNode.addEvents({keyup:function(o){this.value=this.value.replace(/[^0-9_]/g,"");if(t>0&&this.value!=""){if(this.value!=""){e.imageHeightNode.set("value",Math.round(i/t*parseInt(this.value,10)))}else{e.imageHeightNode.set("value","")}}}})},onPostShow:function(){this.node.setStyle("height",180)}});this.dialog.show();if(this.button)this.button.isActive=true;function d(o,s,a){if(a){e.imageWidthNode.set("value",o);e.imageHeightNode.set("value",s)}t=o;i=s}function g(t){var i=new Element("img",{id:"testaaaa",src:e.webImageNode.get("value")+"&sep="+o++,styles:{position:"absolute",visibility:"hidden",top:0,left:"-1000px"},events:{load:function(){d(i.getSize().x,i.getSize().y,t);i.dispose()}}}).inject($(document.body))}this.fireEvent("postOpenDialog")}});