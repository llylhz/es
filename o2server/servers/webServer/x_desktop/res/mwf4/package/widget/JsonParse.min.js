MWF.widget=MWF.widget||{};MWF.widget.JsonParse=new Class({initialize:function(e,t,s){this.json=e;this.jsonObjectNode=t;this.jsonStringNode=s;this.stopParseJson=false},load:function(){this.jsonString=JSON.encode(this.json);if(this.jsonStringNode)this.jsonStringNode.set("text",JSON.format(this.json));if(this.jsonObjectNode)this.loadObjectTree()},loadObjectTree:function(){if(this.objectTree){this.objectTree.node.destroy();this.objectTree=null}MWF.require("MWF.widget.Tree",function(){this.objectTree=new MWF.widget.Tree(this.jsonObjectNode,{style:"jsonview",text:"text"});this.objectTree.load();var e=this.parseJsonObject(0,this.objectTree,"","JSON",this.json,true);var t=e.substring(0,e.length-2);if(!this.stopParseJson){if(this.jsonStringNode)this.jsonStringNode.set("text",t)}else{this.stopParseJson=false}}.bind(this))},parseJsonObject:function(e,t,s,n,i,r){if(this.stopParseJson){return false}var o={expand:r,title:"",text:"",action:"",icon:""};var a="";for(var h=0;h<e;h++)a+="  ";var s=s;if(s)s='"'+s+'": ';var c="";var d=e+1;switch(typeOf(i)){case"object":o.text=n;o.icon="object.png";var j=t.appendChild(o);var b=a+s+"{";var g=a+"}";for(h in i){c+=this.parseJsonObject(d,j,h,h,i[h],false)}c=b+"\n"+c.substring(0,c.length-2)+"\n"+g+",\n";break;case"array":o.text=n;o.icon="array.png";var j=t.appendChild(o);var b=a+s+"[";var g=a+"]";i.each(function(e,t){c+=this.parseJsonObject(d,j,"","["+t+"]",e,false)}.bind(this));c=b+"\n"+c.substring(0,c.length-2)+"\n"+g+",\n";break;case"string":c+=a+s+'"'+i+'",\n';o.text=n+' : "'+i+'"';o.icon="string.png";var j=t.appendChild(o);break;case"date":c+=a+s+'"'+i+'",\n';o.text=n+' : "'+i+'"';o.icon="string.png";var j=t.appendChild(o);break;default:c+=a+s+i+",\n";o.text=n+" : "+i;o.icon="string.png";var j=t.appendChild(o)}return c}});