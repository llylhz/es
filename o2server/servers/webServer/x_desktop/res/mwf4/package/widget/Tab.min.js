MWF.widget=MWF.widget||{};MWF.widget.Tab=new Class({Implements:[Options,Events],Extends:MWF.widget.Common,options:{style:"default"},initialize:function(t,e){this.setOptions(e);this.pages=[];this.path=MWF.defaultPath+"/widget/$Tab/";this.cssPath=MWF.defaultPath+"/widget/$Tab/"+this.options.style+"/css.wcss";this._loadCss();this.css=Object.clone(this.css);this.showPage=null;this.node=$(t)},load:function(){if(this.fireEvent("queryLoad")){if(!this.tabNodeContainer)this.tabNodeContainer=new Element("div");this.tabNodeContainer.set("styles",this.css.tabNodeContainer);this.tabNodeContainer.inject(this.node);if(!this.contentNodeContainer)this.contentNodeContainer=new Element("div");this.contentNodeContainer.set("name","MWFcontentNodeContainer");this.contentNodeContainer.set("styles",this.css.contentNodeContainer);this.contentNodeContainer.inject(this.node);this.fireEvent("postLoad")}},rebuildTab:function(t,e,s){var i=new MWF.widget.TabPage(e,"",this,{isClose:false});i.contentNodeArea=t;i.tabNode=s;i.textNode=s.getFirst();i.closeNode=i.textNode.getFirst();i.options.title=i.textNode.get("text");i.load();this.pages.push(i);return i},addTab:function(t,e,s,i){var o=new MWF.widget.TabPage(t,e,this,{isClose:s,tabNode:i});o.load();this.pages.push(o);return o}});MWF.widget.TabPage=new Class({Implements:[Options,Events],options:{isClose:true,tabNode:null,title:""},initialize:function(t,e,s,i){this.setOptions(i);this.options.title=e;this.tab=s;this.contentNode=$(t)},load:function(){if(!this.contentNodeArea)this.contentNodeArea=new Element("div");this.contentNodeArea.set("styles",this.tab.css.contentNodeArea);if(!this.tabNode)this.tabNode=new Element("div");this.tabNode.set("styles",this.tab.css.tabNode);this.tabNode.addEvent("mousedown",function(t){t.stop()});if(!this.textNode)this.textNode=new Element("div").inject(this.tabNode);this.textNode.set({styles:this.tab.css.tabTextNode,text:this.options.title});this.tabNode.addEvent("click",this._showTab.bind(this));if(this.options.isClose){if(!this.closeNode)this.closeNode=new Element("div").inject(this.tabNode);this.closeNode.set({styles:this.tab.css.tabCloseNode});this.closeNode.addEvent("click",this.closeTab.bind(this))}this.contentNodeArea.inject(this.tab.contentNodeContainer);this.tabNode.inject(this.tab.tabNodeContainer);this.contentNode.inject(this.contentNodeArea)},_showTab:function(){this.showTabIm()},showTabIm:function(t){if(!this.isShow){this.tab.pages.each(function(t){if(t.isShow)t.hideIm()});this.showIm(t)}},showTab:function(t){if(!this.isShow){this.tab.pages.each(function(t){if(t.isShow)t.hide()});this.show(t)}},showIm:function(t){this.fireEvent("queryShow");this.tabNode.set("styles",this.tab.css.tabNodeCurrent);this.textNode.set("styles",this.tab.css.tabTextNodeCurrent);if(this.closeNode)this.closeNode.set("styles",this.tab.css.tabCloseNodeCurrent);this.contentNodeArea.setStyle("display","block");this.contentNodeArea.setStyle("opacity",1);this.isShow=true;this.tab.showPage=this;if(t)t();this.fireEvent("show");this.fireEvent("postShow")},show:function(t){this.fireEvent("queryShow");this.tabNode.set("styles",this.tab.css.tabNodeCurrent);this.textNode.set("styles",this.tab.css.tabTextNodeCurrent);if(this.closeNode)this.closeNode.set("styles",this.tab.css.tabCloseNodeCurrent);this.contentNodeArea.setStyle("display","block");this.contentNodeArea.setStyle("opacity",1);if(!this.morph){this.morph=new Fx.Morph(this.contentNodeArea,{duration:100})}this.morph.start({opacity:1}).chain(function(){this.isShow=true;this.tab.showPage=this;if(t)t();this.fireEvent("postShow")}.bind(this));this.fireEvent("show")},hideIm:function(){if(this.isShow){this.fireEvent("queryHide");this.tabNode.set("styles",this.tab.css.tabNode);this.textNode.set("styles",this.tab.css.tabTextNode);if(this.closeNode)this.closeNode.set("styles",this.tab.css.tabCloseNode);this.contentNodeArea.setStyle("display","none");this.contentNodeArea.setStyle("opacity",0);this.isShow=false;this.fireEvent("hide");this.fireEvent("postHide")}},hide:function(){if(this.isShow){this.fireEvent("queryHide");this.tabNode.set("styles",this.tab.css.tabNode);this.textNode.set("styles",this.tab.css.tabTextNode);if(this.closeNode)this.closeNode.set("styles",this.tab.css.tabCloseNode);if(!this.morph){this.morph=new Fx.Morph(this.contentNodeArea,{duration:100})}this.morph.start({opacity:0}).chain(function(){this.contentNodeArea.setStyle("display","none");this.isShow=false;this.fireEvent("postHide")}.bind(this));this.fireEvent("hide")}},closeTab:function(){this.fireEvent("queryClose");var t=this.getPrevPage();this.contentNodeArea.destroy();this.tabNode.destroy();var e=[];this.tab.pages=this.tab.pages.erase(this);if(t){t.showTab()}else{if(this.tab.pages.length)this.tab.pages[this.tab.pages.length-1].showTab()}this.fireEvent("close")},getPrevPage:function(){var t=this.tab.pages.indexOf(this);var e=t-1;if(e<0){return null}else{return this.tab.pages[e]}}});