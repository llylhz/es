MWF.widget=MWF.widget||{};MWF.require("MWF.widget.Calendar",null,false);MWF.widget.CalendarPage=MWF.CalendarPage=new Class({Extends:MWF.widget.Calendar,Implements:[Options,Events],initialize:function(t,e){Locale.use("zh-CHS");this.setOptions(e);this.path=MWF.defaultPath+"/widget/$Calendar/";this.cssPath=MWF.defaultPath+"/widget/$Calendar/"+this.options.style+"/css.wcss";this._loadCss();if(this.options.isTime){this.options.format=Locale.get("Date").shortDate+" "+"%H:%M"}else{this.options.format=Locale.get("Date").shortDate}this.options.containerPath=this.options.path+this.options.style+"/container.html";this.options.dayPath=this.options.path+this.options.style+"/day.html";this.options.monthPath=this.options.path+this.options.style+"/month.html";this.options.yearPath=this.options.path+this.options.style+"/year.html";this.options.timePath=this.options.path+this.options.style+"/time.html";this.today=new Date;this.currentView=this.options.defaultView;this.node=$(t);this.visible=false;this.container=this.createContainer();this.container.inject(this.node);this.contentTable=this.createContentTable();this.contentTable.inject(this.contentDateNode);this.addEvents();this.fireEvent("init")},addEvents:function(){this.prevNode.addEvent("click",function(){this.getPrev()}.bind(this));this.nextNode.addEvent("click",function(){this.getNext()}.bind(this));this.currentTextNode.addEvent("click",function(){this.changeView()}.bind(this))},show:function(){if(!this.visible){var t=this.node.get("value");if(t){this.options.baseDate=Date.parse(t.substr(0,10))}this.currentView=this.options.defaultView;switch(this.currentView){case"day":this.changeViewToDay();break;case"month":this.showMonth();break;case"year":this.showYear();break;case"time":this.showTime(this.options.baseDate);break;default:this.showDay()}this.container.setStyle("display","block");this.visible=true;this.fireEvent("show")}},_selectDate:function(t,e){var s=new Date(t);var i=s.format(this.options.format);if(this.options.isTime){this.changeViewToTime(s)}else{if(this.fireEvent("queryComplate",t)){var o=this.currentTextNode.retrieve("year");var a=this.currentTextNode.retrieve("month");baseDate=new Date;baseDate.setFullYear(o);baseDate.setMonth(a-1);var n=new Date(t);var h=e.getParent("tbody");var r=h.getElements("td");for(var l=0;l<r.length;l++){var d=new Date(r[l].retrieve("dateValue"));d.clearTime();if(d.clearTime().toString()==this.today.clearTime().toString()){r[l].setStyles(this.css["today_"+this.options.style]);r[l].setStyle("border","0px solid #AAA")}else if(d.toString()==n.toString()){r[l].addClass("current_"+this.options.style);r[l].setStyles(this.css["current_"+this.options.style]);r[l].removeClass("gray_"+this.options.style);r[l].setStyle("border","1px solid #FFF")}else if(baseDate.getMonth()!=d.getMonth()){r[l].addClass("gray_"+this.options.style);r[l].setStyles(this.css["gray_"+this.options.style]);r[l].removeClass("current_"+this.options.style);r[l].setStyle("border","1px solid #FFF")}else{r[l].setStyles(this.css["normal_"+this.options.style]);r[l].removeClass("current_"+this.options.style);r[l].removeClass("gray_"+this.options.style);r[l].setStyle("border","1px solid #FFF")}}e.setStyles(this.css["current_"+this.options.style]);this.fireEvent("complate")}}}});