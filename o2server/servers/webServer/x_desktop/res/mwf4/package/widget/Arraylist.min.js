MWF.widget=MWF.widget||{};MWF.widget.Arraylist=new Class({Implements:[Options,Events],Extends:MWF.widget.Common,options:{title:"arraylist",style:"default",isAdd:true,isDelete:true,isModify:true},initialize:function(t,e){this.setOptions(e);this.node=$(t);this.container=new Element("div");this.path=MWF.defaultPath+"/widget/$Arraylist/";this.cssPath=MWF.defaultPath+"/widget/$Arraylist/"+this.options.style+"/css.wcss";this._loadCss();this.items=[]},load:function(t){if(this.fireEvent("queryLoad")){this.container.set("styles",this.css.container);this.container.inject(this.node);this.createTitleNode();this.createContent(t);this.fireEvent("postLoad")}},createTitleNode:function(){this.titleNode=new Element("div",{styles:this.css.titleNode}).inject(this.container);this.titleActionNode=new Element("div",{styles:this.css.titleActionNode,events:{click:function(t){this.addNewItem(null,"top")}.bind(this)}}).inject(this.titleNode);this.titleTextNode=new Element("div",{styles:this.css.titleTextNode,text:this.options.title}).inject(this.titleNode)},createContent:function(t){this.contentNode=new Element("div",{styles:this.css.contentNode}).inject(this.container);this.contentItemsNode=new Element("div",{styles:this.css.contentItemsNode}).inject(this.contentNode);this.loadContent(t)},loadContent:function(t){t.each(function(t){var e=new MWF.widget.Arraylist.Item(this,t);e.load();e.itemNode.inject(this.contentItemsNode);this.items.push(e)}.bind(this))},addNewItem:function(t,e){if(this.notAddItem){this.notAddItem=false}else{var i=new MWF.widget.Arraylist.Item(this,"","");i.load();if(t){i.itemNode.inject(t.itemNode,"after")}else{i.itemNode.inject(this.contentItemsNode,e)}i.isNewItem=true;i.editValue();this.items.push(i)}},deleteItem:function(t){this.notAddItem=false;this.items.erase(t);t.itemNode.destroy();delete t;this.fireEvent("change")},toArray:function(){var t=this.contentItemsNode.getChildren("div");var e=[];t.each(function(t){var i=t.retrieve("item");if(i.text){e.push(i.text)}});return e}});MWF.widget.Arraylist.Item=new Class({initialize:function(t,e){this.arraylist=t;this.text=e},load:function(){this.creatItemNode();this.setItemEvents()},creatItemNode:function(){this.itemNode=new Element("div",{styles:this.arraylist.css.contentItemNode});this.itemNode.store("item",this);this.iconNode=new Element("div",{styles:this.arraylist.css.contentItemIconNode,events:{mouseover:function(t){t.stopPropagation()},mouseout:function(t){t.stopPropagation()}}}).inject(this.itemNode);this.valueNode=new Element("span",{styles:this.arraylist.css.contentItemValueNode,text:this.text}).inject(this.itemNode)},setItemEvents:function(){this.itemNode.addEvents({mouseover:function(t){t.target.setStyles(this.arraylist.css.contentItemNodeOver)}.bind(this),mouseout:function(t){t.target.setStyles(this.arraylist.css.contentItemNode)}.bind(this),click:function(t){this.arraylist.addNewItem(this)}.bind(this)});this.valueNodeClick=function(t){if(this.arraylist.options.isModify)this.editValue();t.stopPropagation()}.bind(this);this.valueNode.addEvent("click",this.valueNodeClick)},editValue:function(){this.editItem(this.valueNode,function(t){if(t)this.valueNode.addEvent("click",this.valueNodeClick)}.bind(this));this.valueNode.removeEvent("click",this.valueNodeClick)},editItem:function(t,e){var i=t.get("text");t.set("html","");var s=new Element("div",{styles:this.arraylist.css.editInputDiv});var n=new Element("input",{styles:this.arraylist.css.editInput,type:"text",value:i}).inject(s);var o=MWF.getTextSize(i+"a").x;n.setStyle("width",o);s.setStyle("width",o);s.inject(t);n.select();n.addEvents({keydown:function(t){var e=MWF.getTextSize(n.get("value")+"a").x;t.target.setStyle("width",e);t.target.getParent().setStyle("width",e);if(t.code==13){this.isEnterKey=true;t.target.blur()}}.bind(this),blur:function(i){var s=this.editItemComplate(t,i.target);if(e)e(s)}.bind(this),click:function(t){t.stopPropagation()}.bind(this)})},editItemComplate:function(t,e){var i=e.get("value");if(!i){this.arraylist.deleteItem(this)}var s=true;this.arraylist.items.each(function(t){if(t.text==i){if(t!=this)s=false}}.bind(this));if(s){this.text=i;this.arraylist.notAddItem=true}else{this.iconNode.setStyle("background","url("+this.arraylist.path+this.arraylist.options.style+"/icon/error.png) center center no-repeat");this.iconNode.title=MWF.LP.process.repetitionsValue;e.select();return false}var n=false;if(this.isEnterKey){if(this.isNewItem){n=true}this.editOkAddNewItem=false}this.isNewItem=false;t.set("html",i);this.iconNode.setStyle("background","transparent");this.iconNode.title="";this.arraylist.fireEvent("change");if(n){this.arraylist.notAddItem=false;this.arraylist.addNewItem(this)}else{this.arraylist.notAddItem=true}return true}});