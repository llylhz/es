MWF.widget=MWF.widget||{};MWF.require("MWF.widget.Calendar",null,false);MWF.widget.CalendarPage=MWF.CalendarPage=new Class({Extends:MWF.widget.Calendar,Implements:[Options,Events],initialize:function(t,e){Locale.use("zh-CHS");this.setOptions(e);this.path=MWF.defaultPath+"/widget/$Calendar/";this.cssPath=MWF.defaultPath+"/widget/$Calendar/"+this.options.style+"/css.wcss";this._loadCss();if(this.options.isTime){this.options.format=Locale.get("Date").shortDate+" "+"%H:%M"}else{this.options.format=Locale.get("Date").shortDate}this.options.containerPath=this.options.path+this.options.style+"/container.html";this.options.dayPath=this.options.path+this.options.style+"/day.html";this.options.monthPath=this.options.path+this.options.style+"/month.html";this.options.yearPath=this.options.path+this.options.style+"/year.html";this.options.timePath=this.options.path+this.options.style+"/time.html";this.today=new Date;this.currentView=this.options.defaultView;this.node=$(t);this.visible=false;this.container=this.createContainer();this.container.inject(this.node);this.contentTable=this.createContentTable();this.contentTable.inject(this.contentDateNode);this.addEvents();this.fireEvent("init")},addEvents:function(){this.prevNode.addEvent("click",function(){this.getPrev()}.bind(this));this.nextNode.addEvent("click",function(){this.getNext()}.bind(this));this.currentTextNode.addEvent("click",function(){this.changeView()}.bind(this))},show:function(){if(!this.visible){var t=this.node.get("value");if(t){this.options.baseDate=Date.parse(t.substr(0,10))}this.currentView=this.options.defaultView;switch(this.currentView){case"day":this.changeViewToDay();break;case"month":this.showMonth();break;case"year":this.showYear();break;case"time":this.showTime(this.options.baseDate);break;default:this.showDay()}this.container.setStyle("display","block");this.visible=true;this.fireEvent("show")}},_selectDate:function(t,e){var s=new Date(t);var i=s.format(this.options.format);if(this.options.isTime){this.changeViewToTime(s)}else{if(this.fireEvent("queryComplate",t)){var o=new Date(t);var n=o.clone();n.setDate(1);var a=n.getDay();var h=n.clone();var r=e.getParent("tbody");var l=r.getElements("td");for(var d=a;d<l.length;d++){l[d].set("text",n.getDate());if(n.toString()==this.options.baseDate.toString()){l[d].addClass("current_"+this.options.style);l[d].setStyles(this.css["current_"+this.options.style]);l[d].removeClass("gray_"+this.options.style);l[d].setStyle("border","1px solid #FFF")}else if(n.getMonth()!=o.getMonth()){l[d].addClass("gray_"+this.options.style);l[d].setStyles(this.css["gray_"+this.options.style]);l[d].removeClass("current_"+this.options.style);l[d].setStyle("border","1px solid #FFF")}else{l[d].setStyles(this.css["normal_"+this.options.style]);l[d].removeClass("current_"+this.options.style);l[d].removeClass("gray_"+this.options.style);l[d].setStyle("border","1px solid #FFF")}var c=n.clone();if(c.clearTime().toString()==this.today.clearTime().toString()){l[d].setStyles(this.css["today_"+this.options.style]);l[d].setStyle("border","0px solid #AAA")}l[d].store("dateValue",n.toString());n.increment("day",1)}e.setStyles(this.css["current_"+this.options.style]);this.fireEvent("complate")}}}});