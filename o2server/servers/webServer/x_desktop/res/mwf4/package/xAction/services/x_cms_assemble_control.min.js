MWF.xAction.RestActions.Action["x_cms_assemble_control"]=new Class({Extends:MWF.xAction.RestActions.Action,getUUID:function(e){var t="";this.action.invoke({name:"getId",async:false,parameter:{count:"1"},success:function(a){t=a.data[0];if(e)e(t)},failure:null});return t},saveColumn:function(a,e,t){if(!a.isNewColumn){this.updateColumn(a,e,t)}else{this.addColumn(a,e,t)}},addColumn:function(a,e,t){this.action.invoke({name:"addColumn",data:a,success:e,failure:t})},updateColumn:function(a,e,t){this.action.invoke({name:"updateColumn",data:a,parameter:{id:a.id},success:e,failure:t})},updataColumnIcon:function(a,e,t,i,n){this.action.invoke({name:"updataColumnIcon",parameter:{id:a},data:i,file:n,success:e,failure:t})},listCategory:function(a,e,t,i){var n=this;this.action.invoke({name:"listCategory",parameter:{appId:a},async:i,success:function(a){n.transCategoryData(a);e.call(this,a)},failure:t})},listCategoryByPublisher:function(a,e,t,i){var n=this;this.action.invoke({name:"listCategoryByPublisher",parameter:{appId:a},async:i,success:function(a){n.transCategoryData(a);e.call(this,a)},failure:t})},getCategory:function(a,e,t){var i=this;this.action.invoke({name:"getCategory",parameter:{id:a},success:function(a){i.transCategoryData(a);e.call(this,a)},failure:t})},saveCategory:function(a,e,t){if(!a.isNew){this.updateCategory(a,e,t)}else{this.addCategory(a,e,t)}},addCategory:function(a,e,t){this.action.invoke({name:"addCategory",data:a,success:e,failure:t})},updateCategory:function(a,e,t){this.action.invoke({name:"updateCategory",data:a,parameter:{id:a.id},success:e,failure:t})},transCategoryData:function(a){var e=function(a){if(!a.name)a.name=a.categoryName;if(!a.alias)a.alias=a.categoryAlias;if(!a.categoryName)a.categoryName=a.name;if(!a.categoryAlias)a.categoryAlias=a.alias};if(a.data){if(typeOf(a.data)=="array"){a.data.each(function(a){e(a)})}else{e(a.data)}}else{a.data=[]}},saveForm:function(a,e,t,i,n){if(!a.isNewForm){this.updateForm(a,e,t,i,n)}else{this.addForm(a,e,t,i,n)}},updateForm:function(a,e,t,i,n){var o,e;if(a)o=MWF.encodeJsonString(JSON.encode(a));if(e)e=MWF.encodeJsonString(JSON.encode(e));var c={id:a.json.id,name:a.json.name,alias:a.json.name,description:a.json.description,appId:a.json.application,formFieldList:t};if(a)c.data=o;if(e)c.mobileData=e;this.action.invoke({name:"updataForm",data:c,parameter:{id:a.json.id},success:i,failure:n})},addForm:function(t,i,n,o,c){var s,i;if(!t.json.id){this.getUUID(function(a){t.json.id=a;if(t)s=MWF.encodeJsonString(JSON.encode(t));if(i)i=MWF.encodeJsonString(JSON.encode(i));var e={id:t.json.id,name:t.json.name,alias:t.json.name,description:t.json.description,appId:t.json.application,formFieldList:n};if(t)e.data=s;if(i)e.mobileData=i;this.action.invoke({name:"addForm",data:e,parameter:{id:t.json.id},success:o,failure:c})}.bind(this))}else{if(t)s=MWF.encodeJsonString(JSON.encode(t));if(i)i=MWF.encodeJsonString(JSON.encode(i));var a={id:t.json.id,name:t.json.name,alias:t.json.name,description:t.json.description,appId:t.json.application};if(t)a.data=s;if(i)a.mobileData=i;this.action.invoke({name:"addForm",data:a,parameter:{id:t.json.categoryId},success:o,failure:c})}},addFormTemplate:function(i,n,o,c,s){var d,r;this.getUUID(function(a){o.id=a;if(i){var e=Object.clone(i);e.json.id=a;e.json.name=o.name;d=MWF.encodeJsonString(JSON.encode(e))}if(n){var t=Object.clone(n);t.json.id=a;t.json.name=o.name;r=MWF.encodeJsonString(JSON.encode(t))}if(i)o.data=d;if(n)o.mobileData=r;this.action.invoke({name:"addFormTemplate",data:o,success:c,failure:s})}.bind(this))},saveDictionary:function(a,e,t){if(a.id||a.appDictId){this.updateDictionary(a,e,t)}else{this.addDictionary(a,e,t)}},updateDictionary:function(a,e,t){if(!a.alias||a.alias=="")a.alias=a.name;this.action.invoke({name:"updataDictionary",data:a,parameter:{appDictId:a.id},success:e,failure:t})},addDictionary:function(e,t,i){if(!e.id){this.getUUID(function(a){e.id=a;e.appDictId=a;if(!e.alias||e.alias=="")e.alias=e.name;this.action.invoke({name:"addDictionary",data:e,parameter:{appDictId:e.id},success:t,failure:i})}.bind(this))}},getScript:function(a,e,t,i){var n=this;this.action.invoke({name:"getScript",async:i,parameter:{id:a},success:function(a){n.transScriptData(a);e.call(this,a)},failure:t})},getScriptByName:function(a,e,t,i,n){var o=this;this.action.invoke({name:"getScriptByName",async:n,parameter:{name:a,appId:e},success:function(a){o.transScriptData(a);t.call(this,a)},failure:i})},saveScript:function(a,e,t){if(!a.isNewScript){this.updateScript(a,e,t)}else{this.addScript(a,e,t)}},updateScript:function(a,e,t){this.transScriptData(a,"send");this.action.invoke({name:"updataScript",data:a,parameter:{id:a.id},success:e,failure:t})},addScript:function(e,t,i){this.transScriptData(e,"send");var a=this;if(!e.id){this.getUUID(function(a){e.id=a;this.action.invoke({name:"addScript",data:e,success:t,failure:i})}.bind(this))}else{this.action.invoke({name:"addScript",data:e,success:t,failure:i})}},transScriptData:function(a,e){var t=function(a){if(e&&e=="send"){if(!a.appId)a.appId=a.application;if(!a.appName)a.appName=a.applicationName;if(a.application)delete a.application;if(a.applicationName)delete a.applicationName}else{if(!a.appId)a.appId=a.application;if(!a.appName)a.appName=a.applicationName;if(!a.application)a.application=a.appId;if(!a.applicationName)a.application=a.appName}};if(typeOf(a)=="array"){a.each(function(a){t(a)})}else{t(a)}},saveView:function(a,e,t){if(!a.isNew){this.updateView(a,e,t)}else{this.addView(a,e,t)}},addView:function(a,e,t){this.action.invoke({name:"addView",data:a,success:e,failure:t})},updateView:function(a,e,t){this.action.invoke({name:"updateView",data:a,parameter:{id:a.id},success:e,failure:t})},saveViewColumn:function(a,e,t,i){if(!a.isNew){this.updateViewColumn(a,e,t,i)}else{this.addViewColumn(a,e,t,i)}},saveCategoryView:function(a,e,t,i){if(!a.isNew){this.updateViewColumn(a,e,t,i)}else{this.addViewColumn(a,e,t,i)}},saveQueryView:function(a,e,t,i){if(a.isNewView){a.isNewView=false;this.addQueryView(a,e,t,i)}else{this.updateQueryView(a,e,t,i)}},addQueryView:function(e,t,i,n){var o=e.data;var a=JSON.encode(e.data);e.data=a;if(!o.id){this.getUUID(function(a){e.id=a;this.action.invoke({name:"addQueryView",data:e,success:t,failure:i,async:n});e.data=o}.bind(this))}else{this.action.invoke({name:"addQueryView",data:e,success:t,failure:i,async:n});e.data=o}},updateQueryView:function(a,e,t,i){var n=a.data;var o=JSON.encode(a.data);a.data=o;this.action.invoke({name:"updateQueryView",data:a,async:i,parameter:{id:a.id},success:e,failure:t});a.data=n},saveDocument:function(a,e,t,i){if(!a.isNewDocument){this.updateDocument(a,e,t,i)}else{this.addDocument(a,e,t,i)}},addDocument:function(a,e,t,i){delete a.attachmentList;this.action.invoke({name:"addDocument",data:a,success:e,failure:t,async:i})},updateDocument:function(a,e,t,i){delete a.attachmentList;this.action.invoke({name:"updateDocument",data:a,parameter:{id:a.id},success:e,failure:t,async:i})},saveData:function(a,e,t,i,n){if(!i.isNew){this.updateData(a,e,t,i,n)}else{this.addData(a,e,t,i,n)}},uploadAttachment:function(a,e,t,i,n){this.action.invoke({name:"uploadAttachment",parameter:{id:a},data:i,file:n,success:e,failure:t})},replaceAttachment:function(a,e,t,i,n,o){this.action.invoke({name:"replaceAttachment",parameter:{documentid:e,id:a},data:n,file:o,success:t,failure:i})},getAttachmentData:function(e,t){this.action.getActions(function(){var a=this.action.actions.getAttachmentData.uri;a=a.replace("{id}",encodeURIComponent(e));a=a.replace("{documentid}",encodeURIComponent(t));window.open(this.action.address+a)}.bind(this))},getAttachmentStream:function(e,t){this.action.getActions(function(){var a=this.action.actions.getAttachmentStream.uri;a=a.replace("{id}",encodeURIComponent(e));a=a.replace("{documentid}",encodeURIComponent(t));window.open(this.action.address+a)}.bind(this))},getAttachmentUrl:function(e,t,i){this.action.getActions(function(){var a=this.action.actions.getAttachmentData.uri;a=a.replace("{id}",encodeURIComponent(e));a=a.replace("{documentid}",encodeURIComponent(t));if(i)i(this.action.address+a)}.bind(this))},convertLocalImageToBase64:function(a,e,t,i,n){this.action.invoke({name:"convertLocalImageToBase64",parameter:{size:a},data:i,file:n,success:e,failure:t})},getImageUrl:function(e,t,i){this.action.getActions(function(){var a=this.action.actions.getImage.uri;a=a.replace("{id}",encodeURIComponent(e));a=a.replace("{documentid}",encodeURIComponent(t));if(i)i(this.action.address+a)}.bind(this))},listDocumentFilterNext:function(a,e,t,i,n,o){if(t&&!t.documentType)t.documentType="全部";this.action.invoke({name:"listDocumentFilterNext",async:o,data:t,parameter:{id:a,count:e},success:i,failure:n})},listDocumentFilterPrev:function(a,e,t,i,n,o){if(t&&!t.documentType)t.documentType="全部";this.action.invoke({name:"listDocumentFilterPrev",async:o,data:t,parameter:{id:a,count:e},success:i,failure:n})},listDraftNext:function(a,e,t,i,n,o){if(t&&!t.documentType)t.documentType="全部";this.action.invoke({name:"listDraftNext",async:o,data:t,parameter:{id:a,count:e},success:i,failure:n})},listDraftPrev:function(a,e,t,i,n,o){if(t&&!t.documentType)t.documentType="全部";this.action.invoke({name:"listDraftPrev",async:o,data:t,parameter:{id:a,count:e},success:i,failure:n})},importDocumentFormExcel:function(a,e,t,i,n){this.action.invoke({name:"importDocumentFormExcel",parameter:{categoryId:a},data:i,file:n,success:e,failure:t})},getCategoryByAlias:function(a,e,t){var i=this;this.action.invoke({name:"getCategoryByAlias",parameter:{alias:a},success:function(a){i.transCategoryData(a);e.call(this,a)},failure:t})},batchModifyData:function(a,e,t,i){this.action.invoke({name:"batchModifyData",data:{docIds:a,dataChanges:e},success:t,failure:i})}});