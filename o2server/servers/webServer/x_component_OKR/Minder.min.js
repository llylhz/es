MWF.xApplication.OKR=MWF.xApplication.OKR||{};MWF.xApplication.OKR.Minder=new Class({Implements:[Options],options:{style:"default",template:"default",theme:"fresh-blue"},initialize:function(t,i,e,n){this.setOptions(n);this.app=i.app;this.lp=this.app.lp;this.actions=this.app.actions;this.container=t;this.css=i.css;this.data=e;this.node=new Element("div",{styles:{width:"100%",height:"100%"}}).inject(this.container)},destory:function(){if(this.km)delete this.km;if(this.node)this.node.destory();delete this},load:function(t){this.loadResource(function(){this.loadKityMinder();if(t)t()}.bind(this))},loadResource:function(t){var i="/x_desktop/res/framework/kityminder/";COMMON.AjaxModule.loadCss(i+"core/src/kityminder.css",function(){COMMON.AjaxModule.load(i+"kity/kity.js",function(){COMMON.AjaxModule.load(i+"core/dist/kityminder.core.js",function(){if(t)t()}.bind(this))}.bind(this))}.bind(this))},loadKityMinder:function(){var t=this;var i=this.km=new kityminder.Minder;i.renderTo(this.node);this.data.theme=this.data.theme||this.options.theme;this.data.template=this.data.template||this.options.template;i.importJson(this.data);if(this.options.onClickKMNode){i.on("execCommand",function(e){if(e.commandName==="camera"){var n=i.getAllNode();n.forEach(function(i){var e=i.getRenderContainer();e.node.addEventListener("click",function(){t.options.onClickKMNode(this,this.getData())}.bind(i))})}})}i.execCommand("camera")}});