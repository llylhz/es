MWF.xApplication.Execution=MWF.xApplication.Execution||{};MWF.require("MWF.widget.Identity",null,false);MWF.xDesktop.requireApp("Execution","Actions.RestActions",null,false);MWF.xDesktop.requireApp("Template","Explorer",null,false);MWF.xDesktop.requireApp("Template","MPopupForm",null,false);MWF.require("MWF.xDesktop.UserData",null,false);MWF.xDesktop.requireApp("Execution","IdenitySelector",null,false);MWF.xApplication.Execution.options={multitask:false,executable:true};MWF.xApplication.Execution.Main=new Class({Extends:MWF.xApplication.Common.Main,Implements:[Options,Events],options:{style:"default",name:"Execution",icon:"appicon.png",width:"1270",height:"700",isResize:false,isMax:true,title:MWF.xApplication.Execution.LP.title},onQueryClose:function(){this.logout()},onQueryLoad:function(){this.lp=MWF.xApplication.Execution.LP},loadApplication:function(t){this.user=layout.desktop.session.user.name;this.distinguishedName=layout.desktop.session.user.distinguishedName;this.userGender=layout.desktop.session.user.genderType;this.department="";this.trueUserName=this.user;this.restActions=new MWF.xApplication.Execution.Actions.RestActions;this.okrManager=false;var i;if(!this.workTabSwitch){i={};i.configCode="INDEX_WORK_STATUSLIST";this.restActions.getProfileByCode(i,function(t){if(t.type=="success"){if(t.data&&t.data.configValue){this.workTabSwitch=t.data.configValue}}}.bind(this),null,false)}if(!this.statSwitch){i={};i.configCode="INDEX_STATISTIC_TYPE";this.restActions.getProfileByCode(i,function(t){if(t.type=="success"){if(t.data&&t.data.configValue){this.statSwitch=t.data.configValue}}}.bind(this),null,false)}if(!this.companyAdmin){i={};i.configCode="TOPUNIT_WORK_ADMIN";this.restActions.getProfileByCode(i,function(t){if(t.type=="success"){if(t.data&&t.data.configValue){this.companyAdmin=t.data.configValue}}}.bind(this),null,false)}this.identites=this.getIdentityies();MWF.UD.getDataJson("okr_identity_login",function(t){if(t){this.restActions.login({loginIdentity:t.identity},function(i){if(i.data&&i.data.okrManager)this.okrManager=i.data.okrManager;this._loadApplication(null,t.identity)}.bind(this),function(t){var i=new MWF.xApplication.Execution.IdenitySelector(this,this.restActions,this.identites,this.css,{closeText:this.lp.close,onPostSelectorClose:function(){this.close()}.bind(this),onPostSelectorOk:function(t){this._loadApplication(null,t)}.bind(this)});i.load()}.bind(this),false)}else{if(this.identites.length>1){var i=new MWF.xApplication.Execution.IdenitySelector(this,this.restActions,this.identites,this.css,{closeText:this.lp.close,onPostSelectorClose:function(){this.close()}.bind(this),onPostSelectorOk:function(t){this._loadApplication(null,t)}.bind(this)});i.load()}else if(this.identites.length==1){this.restActions.login({loginIdentity:this.identites[0].distinguishedName},function(t){MWF.UD.putData("okr_identity_login",{identity:this.identites[0].distinguishedName});if(t.data)this.okrManager=t.data.okrManager;this._loadApplication(null,this.identites[0].distinguishedName)}.bind(this),null,false)}else{this.notice(this.lp.noIdentityNotice,"error")}}}.bind(this));if(this.identites){this.addEvent("resize",function(){this.resizeContent()}.bind(this))}},_loadApplication:function(t,i){this.identity=i;this.distinguishedName=this.identity;this.trueUserName=this.identity.split("@")[0];var e=[];e.push(this.identity);var o={identityList:e};this.restActions.listUnitWithIdentity(o,function(t){if(t.data&&t.data.length>0){this.department=t.data[0].name}var i=[];i.push(this.identity);var e={identityList:i};this.restActions.listWithIdentityObject(e,function(t){if(t.data&&t.data.length>0){this.trueUserName=t.data[0].name;this.user=t.data[0].name;this.distinguishedName=t.data[0].distinguishedName?t.data[0].distinguishedName:this.distinguishedName}this.createContainer();this.createTopBarVersion();this.createMiddleContent();if(this.options.form){this.status={};if(this.options.form=="work"){this.status.navi1="work"}else if(this.options.form=="xmind"){this.status.navi1="xmind"}else if(this.options.form=="setting"){this.status.navi1="setting"}if(this.options.subform){if(this.options.subform=="task"){this.status.navi2="task"}else if(this.options.subform=="report"){this.status.navi2="report"}else if(this.options.subform=="stat"){this.status.navi2="stat"}}if(this.status.navi2=="task"&&this.options.tab){this.status.navi3="base";this.status.navi4=this.options.tab}if(this.status.navi2=="report"&&this.options.tab){this.status.navi3=this.options.tab}}if(this.status&&this.status.navi1=="work"){if(this.status.navi2=="task"){this.openTask(this.status.navi3,this.status.navi4)}else if(this.status.navi2=="report"){this.openWorkReport(this.status.navi3)}else if(this.status.navi2=="stat"){this.openStat()}else{this.createLayout()}}else if(this.status&&this.status.navi1=="xmind"){this.openContent("xmind")}else if(this.status&&this.status.navi1=="setting"){this.openContent("setting")}else if(this.status&&this.status.navi1=="setting"){this.openContent("stat")}else{this.createLayout()}this.addEvent("resize",function(){var t=this.middleContent.getSize();var i=t.y-300;var e=t.x-450;if(this.todoListContent)this.todoListContent.setStyles({height:i+"px"});if(this.workListContent)this.workListContent.setStyles({height:i+"px"});if(this.workConditionContentDiv)this.workConditionContentDiv.setStyles({height:i+"px"});if(this.leftContent)this.leftContent.setStyles({width:e+"px"})}.bind(this))}.bind(this))}.bind(this))},logout:function(){var t={};this.restActions.logout(t,function(t){}.bind(this),function(t,i,e){}.bind(this),false)},getIdentityies:function(){var t=[];var i=[];i.push(this.distinguishedName);var e={personList:i};this.restActions.listIdentityWithPerson(e,function(i){if(i.data){t=i.data}}.bind(this),null,false);this.restActions.listMyRelief(function(i){if(i.data){i.data.each(function(i){t.push(i)})}}.bind(this),null,false);return t},resizeContent:function(){var t=this.middleContent.getSize();var i=t.y-300;var e=t.x-450;if(this.todoListContent){this.todoListContent.setStyles({height:i+"px"});this.todoListContentY=i}if(this.workListContent){this.workListContent.setStyles({height:i+"px"});this.todoListContentY=i}if(this.workConditionContentDiv)this.workConditionContentDiv.setStyles({height:i+"px"});if(this.leftContent)this.leftContent.setStyles({width:e+"px"})},changeIdentity:function(){MWF.xDesktop.requireApp("Execution","IdenitySelector",function(){this.identitySelector=new MWF.xApplication.Execution.IdenitySelector(this,this.restActions,this.identites,this.css,{closeText:this.lp.cancel,needLogout:true,onPostSelectorClose:function(){this.identitySelector.close()}.bind(this),onPostSelectorOk:function(t){this.status=null;this._loadApplication(null,t)}.bind(this)});this.identitySelector.load()}.bind(this))},recordStatus:function(){var t={identity:this.identity,navi1:this.currentTopBarTab,navi2:this.navi2};if(t.navi1=="work"){if(t.navi2=="task"){t.navi3=this.workTask?this.workTask.workNavi1:"";t.navi4=this.workTask?this.workTask.workNavi2:""}else if(t.navi2=="report"){t.navi3=this.workReportList.workNavi1;t.navi4=""}else{t.navi3="";t.navi4=""}}return t},openFromOut:function(t){if(!t)return;if(t.form){if(t.form=="work"){this.loadTopBarTab("work");if(t.subform){if(t.subform=="task"){this.openTask()}else if(t.subform=="report"){this.openWorkReport()}else if(t.subform=="stat"){this.openStat()}else{this.createLayout()}}else{this.createLayout()}}else if(t.form=="xmind"){this.openContent("xmind")}else if(t.form=="setting"){this.openContent("setting")}else if(t.form=="stat"){this.openStat()}else{this.createLayout()}}},openContent:function(t){if(t=="xmind"){this.currentTopBarTab="xmind";this.loadTopBarTab(this.currentTopBarTab);this.middleContent.empty();MWF.xDesktop.requireApp("Execution","MinderExplorer",null,false);var i=new MWF.xApplication.Execution.MinderExplorer(this.middleContent,this,this.restActions,{});i.load()}else if(t=="setting"){this.currentTopBarTab="setting";this.loadTopBarTab(this.currentTopBarTab);this.middleContent.empty();MWF.xDesktop.requireApp("Execution","SettingExplorer",function(){var t=new MWF.xApplication.Execution.SettingExplorer(this.middleContent,this,this.restActions,{});t.load()}.bind(this),false)}else{this.currentTopBarTab="work";this.loadTopBarTab(this.currentTopBarTab);this.middleContent.empty();this.createLayout()}},openTask:function(t,i){this.navi2="task";this.middleContent.empty();MWF.xDesktop.requireApp("Execution","WorkList",function(){this.workList=new MWF.xApplication.Execution.WorkList(this.middleContent,this,this.restActions,{workNavi1:t||"",workNavi2:i||""});this.workList.load()}.bind(this))},openWorkReport:function(t){this.navi2="report";this.middleContent.empty();MWF.xDesktop.requireApp("Execution","WorkReportList",function(){this.workReportList=new MWF.xApplication.Execution.WorkReportList(this.middleContent,this,this.restActions,{workNavi1:t||""});this.workReportList.load()}.bind(this))},openStat:function(){this.navi1="stat";this.middleContent.empty();MWF.xDesktop.requireApp("Execution","WorkStat",function(){this.workStat=new MWF.xApplication.Execution.WorkStat(this.middleContent,this,this.restActions,{});this.workStat.load()}.bind(this))},createContainer:function(){if(!this.container){this.content.setStyle("overflow","hidden");this.container=new Element("div.container",{styles:this.css.container}).inject(this.content)}},createMiddleContent:function(){if(!this.middleContent){this.middleContent=new Element("div.middleContent",{styles:this.css.middleContent}).inject(this.container)}},createLayout:function(){this.navi2="main";if(this.middleContent)this.middleContent.empty();this.leftContent=new Element("div.leftContent",{styles:this.css.leftContent}).inject(this.middleContent);this.leftTopContent=new Element("div",{styles:this.css.leftTopContent}).inject(this.leftContent);this.clearDiv=new Element("div",{styles:this.css.clearDiv}).inject(this.leftContent);this.createCategoryIconsVersion();this.leftBottomContent=new Element("div",{styles:this.css.leftBottomContent}).inject(this.leftContent);this.createTodoContentVersion();this.rightContent=new Element("div.rightContent",{styles:this.css.rightContent}).inject(this.middleContent);this.createMyStatVersion();this.rightBottomContent=new Element("div.rightBottomContent",{styles:this.css.rightBottomContent}).inject(this.rightContent);this.rightBottomContent.setStyle("display","");this.createRightBottomVersion();this.resizeContent()},createTopBarVersion:function(){this.createTopBar()},createTopBar:function(){this.currentTopBarTab="work";if(this.topBar){this.topBar.empty()}else{this.topBar=new Element("div.topBar",{styles:this.css.topBar}).inject(this.container)}this.topBarContent=new Element("div",{styles:this.css.topBarContent}).inject(this.topBar);this.topBarTitleLi=new Element("li",{styles:this.css.topBarTitleLi}).inject(this.topBarContent);this.topBarLog=new Element("img",{styles:this.css.topBarLog,src:this.path+"default/icon/okr.png"}).inject(this.topBarTitleLi);this.topBarTitleSpan=new Element("span",{styles:this.css.topBarTitleSpan,text:MWF.xApplication.Execution.LP.topBar.title}).inject(this.topBarTitleLi);this.topBarWorkLi=new Element("li.topBarWorkLi",{styles:this.css["topBarCurrentLi"]}).inject(this.topBarContent);this.topBarWorkLi.addEvents({mouseover:function(){if(this.currentTopBarTab!="work")this.topBarWorkLi.setStyles({"background-color":"#124c93"})}.bind(this),mouseout:function(){if(this.currentTopBarTab!="work")this.topBarWorkLi.setStyles({"background-color":"#5c97e1"})}.bind(this),click:function(){this.openContent("work")}.bind(this)});this.topBarWorkImg=new Element("img",{styles:this.css.topBarWorkImg,src:this.path+"default/icon/Outline-104.png"}).inject(this.topBarWorkLi);this.topBarWorkSpan=new Element("span",{styles:this.css.topBarWorkSpan,text:MWF.xApplication.Execution.LP.topBar.work}).inject(this.topBarWorkLi);this.topBarXmindLi=new Element("li.topBarXmindLi",{styles:this.css["topBarLi"]}).inject(this.topBarContent);this.topBarXmindImg=new Element("img",{styles:this.css.topBarXmindImg,src:this.path+"default/icon/MindMapFilled-100.png"}).inject(this.topBarXmindLi);this.topBarXmindSpan=new Element("span",{styles:this.css.topBarXmindSpan,text:MWF.xApplication.Execution.LP.topBar.xmind}).inject(this.topBarXmindLi);this.topBarXmindLi.addEvents({mouseover:function(){if(this.currentTopBarTab!="xmind")this.topBarXmindLi.setStyles({"background-color":"#124c93"})}.bind(this),mouseout:function(){if(this.currentTopBarTab!="xmind")this.topBarXmindLi.setStyles({"background-color":"#5c97e1"})}.bind(this),click:function(){this.openContent("xmind")}.bind(this)});this.topBarSettingLi=new Element("li.topBarSettingLi",{styles:this.css["topBarLi"]}).inject(this.topBarContent);new Element("img",{styles:this.css.topBarXmindImg,src:this.path+"default/icon/Maintenance-96.png"}).inject(this.topBarSettingLi);new Element("span",{styles:this.css.topBarXmindSpan,text:MWF.xApplication.Execution.LP.topBar.setting}).inject(this.topBarSettingLi);this.topBarSettingLi.addEvents({mouseover:function(){if(this.currentTopBarTab!="setting")this.topBarSettingLi.setStyles({"background-color":"#124c93"})}.bind(this),mouseout:function(){if(this.currentTopBarTab!="setting")this.topBarSettingLi.setStyles({"background-color":"#5c97e1"})}.bind(this),click:function(){this.openContent("setting")}.bind(this)});if(!this.okrManager)this.topBarSettingLi.destroy();this.topBarRight=new Element("div.toBarRight",{styles:this.css.topBarRight}).inject(this.topBar);this.topBarRightDeptLi=new Element("li",{styles:this.css.topBarRightDeptLi}).inject(this.topBarRight);this.topBarRightDeptImg=new Element("img",{styles:this.css.topBarRightDeptImg,src:this.path+"default/icon/Home-96.png"}).inject(this.topBarRightDeptLi);this.topBarRightDeptSpan=new Element("span",{styles:this.css.topBarRightDeptSpan,text:this.department}).inject(this.topBarRightDeptLi);if(this.userGender=="f")this.userFace=this.path+"default/icon/UserFemale-104.png";else this.userFace=this.path+"default/icon/UserMale-104.png";this.topBarRightPersonLi=new Element("li",{styles:this.css.topBarRightPersonLi}).inject(this.topBarRight);this.topBarRightPersonImg=new Element("img",{styles:this.css.topBarRightPersonImg,src:this.userFace}).inject(this.topBarRightPersonLi);this.topBarRightPersonSpan=new Element("span",{styles:this.css.topBarRightPersonSpan,text:this.trueUserName}).inject(this.topBarRightPersonLi);if(this.identites.length>1){this.topBarRightChangeUserLi=new Element("li",{styles:this.css["topBarRightOutLi"]}).inject(this.topBarRight).addEvents({click:function(){this.changeIdentity()}.bind(this)});new Element("img",{styles:this.css["topBarRightOutImg"],src:this.path+"default/icon/ChangeUser.png"}).inject(this.topBarRightChangeUserLi);new Element("span",{styles:this.css["topBarRightOutSpan"],text:MWF.xApplication.Execution.LP.changeUser}).inject(this.topBarRightChangeUserLi)}this.topBarRightLastLi=new Element("li",{styles:this.css.topBarRightLastLi}).inject(this.topBarRight);this.topBarRightLastImg=new Element("img",{styles:this.css.topBarRightLastImg,src:this.path+"default/icon/BulletedListFilled-100.png"}).inject(this.topBarRightLastLi)},createCategoryIconsVersion:function(){this.createCategoryIcons()},createCategoryIcons:function(){this.categoryIconsUl=new Element("ul",{styles:this.css.categoryIconsUl}).inject(this.leftTopContent);this.createCategoryNode(this.path+"default/icon/Checklist-100.png",MWF.xApplication.Execution.LP.categoryIcon.span1,"categoryIconsLi");this.createCategoryNode(this.path+"default/icon/ConferenceCall-104.png",MWF.xApplication.Execution.LP.categoryIcon.span2,"categoryIconsLi");if(this.okrManager||this.companyAdmin&&this.companyAdmin.indexOf(this.identity)>-1){this.createCategoryNode(this.path+"default/icon/AreaChart Filled-100.png",MWF.xApplication.Execution.LP.categoryIcon.span5,"categoryIconsLiRight")}},createTodoContentVersion:function(){this.createTodoContent2()},createTodoContent2:function(){this.todoMenuDiv=new Element("div",{styles:this.css.todoMenuDiv}).inject(this.leftBottomContent);this.todoMenuLeftDiv=new Element("div",{styles:this.css.todoMenuLeftDiv}).inject(this.todoMenuDiv);this.todoMenuLeftImg=new Element("img",{styles:this.css.todoMenuLeftImg,src:this.path+"default/icon/Outline-104.png"}).inject(this.todoMenuLeftDiv);this.todoMenuLeftSpan=new Element("span",{styles:this.css.todoMenuLeftSpan,text:MWF.xApplication.Execution.LP.todoMenu.title}).inject(this.todoMenuLeftDiv);this.todoMenuRightDiv=new Element("div.todoMenuRightDiv",{styles:this.css.todoMenuRightDiv}).inject(this.todoMenuDiv);this.todoMenuDo=new Element("li.todoMenuDo",{styles:this.css.todoMenuDo,text:this.lp.main.todoMenuDo}).inject(this.todoMenuRightDiv);this.todoMenuDoCount=new Element("span.todoMenuDoCount",{styles:this.css.todoMenuDoCount}).inject(this.todoMenuDo);if(this.workTabSwitch&&this.workTabSwitch=="OPEN"){this.todoMenuWork=new Element("li.todoMenuWork",{styles:this.css.todoMenuWork,text:this.lp.main.todoMenuWork}).inject(this.todoMenuRightDiv);this.todoMenuWorkCount=new Element("span.todoMenuWorkCount",{styles:this.css.todoMenuWorkCount}).inject(this.todoMenuWork)}this.todoListContent=new Element("div.todoListContent",{styles:this.css.todoList}).inject(this.leftBottomContent);this.todoListDiv=new Element("div.todoListDiv",{styles:this.css.todoListDiv}).inject(this.todoListContent);var t=this;this.todoMenuRightDiv.getElements("li").addEvents({click:function(){t.changeTodoTab(this)}});this.getTodoCount();this.createTodoList()},createTodoContent:function(){this.todoMenuDiv=new Element("div",{styles:this.css.todoMenuDiv}).inject(this.leftBottomContent);this.todoMenuLeftDiv=new Element("div",{styles:this.css.todoMenuLeftDiv}).inject(this.todoMenuDiv);this.todoMenuLeftImg=new Element("img",{styles:this.css.todoMenuLeftImg,src:this.path+"default/icon/Outline-104.png"}).inject(this.todoMenuLeftDiv);this.todoMenuLeftSpan=new Element("span",{styles:this.css.todoMenuLeftSpan,text:MWF.xApplication.Execution.LP.todoMenu.title}).inject(this.todoMenuLeftDiv);this.todoMenuRightDiv=new Element("div.todoMenuRightDiv",{styles:this.css.todoMenuRightDiv}).inject(this.todoMenuDiv);this.todoMenuRightDiv.setStyle("display","none");this.todoMenuRightLi=new Element("li",{styles:this.css["todoMenuRightCurrentLi"],text:MWF.xApplication.Execution.LP.todoMenu.all}).inject(this.todoMenuRightDiv);this.todoMenuRightLi=new Element("li",{styles:this.css.todoMenuRightLi,text:MWF.xApplication.Execution.LP.todoMenu.workTask}).inject(this.todoMenuRightDiv);this.todoMenuRightLi=new Element("li",{styles:this.css.todoMenuRightLi,text:MWF.xApplication.Execution.LP.todoMenu.workReport}).inject(this.todoMenuRightDiv);this.todoMenuRightLi=new Element("li",{styles:this.css["todoMenuRightLiLast"],text:MWF.xApplication.Execution.LP.todoMenu.workProblem}).inject(this.todoMenuRightDiv);this.todoList=new Element("div.todoList",{styles:this.css.todoList}).inject(this.leftBottomContent);this.todoListDiv=new Element("div.todoListDiv",{styles:this.css.todoListDiv}).inject(this.todoList);this.createTodoList()},createMyStatVersion:function(){this.rightTopContent=new Element("div.rightTopContent",{styles:this.css.rightTopContent}).inject(this.rightContent);if(this.statSwitch&&this.statSwitch=="PROMPTNESSRATE"){this.createMyStat()}},createMyStat:function(){var t=0;var i=0;var e=0;var o="100%";this.restActions.getMyStat(function(s){if(s.data&&s.data["responProcessingWorkCount"])t=s.data["responProcessingWorkCount"];if(s.data&&s.data["overtimeResponWorkCount"])i=s.data["overtimeResponWorkCount"];if(s.data&&s.data["responCompletedWorkCount"])e=s.data["responCompletedWorkCount"];if(s.data&&s.data.percent)o=parseInt(s.data.percent)*100}.bind(this),null,false);this.rightTopTable=new Element("table.rightTopTable",{styles:this.css.rightTopTable,border:"0"}).inject(this.rightTopContent);var s=new Element("tr").inject(this.rightTopTable);var n=new Element("td",{colspan:"4"}).inject(s);this.rightTopTdImg=new Element("img",{styles:this.css.rightTopTdImg,src:this.path+"default/icon/PieChart-104.png"}).inject(n);this.rightTopTdSpan=new Element("span",{styles:this.css.rightTopTdSpan,text:MWF.xApplication.Execution.LP.rightTop.title}).inject(n);s=new Element("tr").inject(this.rightTopTable);var r=new Element("td",{styles:this.css["rightTopNumTd"]}).inject(s);this.rightTopFlowSpan=new Element("span",{styles:this.css.rightTopFlowSpan,text:t}).inject(r);r=new Element("td",{styles:this.css["rightTopNumTd"]}).inject(s);this.rightTopCompletedSpan=new Element("span",{styles:this.css.rightTopCompletedSpan,text:i}).inject(r);r=new Element("td",{styles:this.css["rightTopNumTd"]}).inject(s);this.rightTopOverTimeSpan=new Element("span",{styles:this.css.rightTopOverTimeSpan,text:e}).inject(r);this.rightTopRateTd=new Element("td",{width:"80",align:"right"}).inject(s);this.rightTopRateSpan=new Element("span",{styles:this.css.rightTopRateSpan,text:o}).inject(this.rightTopRateTd);s=new Element("tr").inject(this.rightTopTable);new Element("td",{styles:this.css["rightTopTextTd"],width:"80",align:"center",text:MWF.xApplication.Execution.LP.rightTop.flow}).inject(s);new Element("td",{styles:this.css["rightTopTextTd"],width:"80",align:"center",text:MWF.xApplication.Execution.LP.rightTop.overTime}).inject(s);new Element("td",{styles:this.css["rightTopTextTd"],width:"80",align:"center",text:MWF.xApplication.Execution.LP.rightTop.completed}).inject(s);new Element("td",{styles:this.css["rightTopTextTd"],width:"80",align:"right",text:MWF.xApplication.Execution.LP.rightTop.rate}).inject(s)},createContentDiv:function(){this.rightTopTable=new Element("table.rightTopTable",{styles:this.css.rightTopTable,border:"0"}).inject(this.rightTopContent);this.rightTopTable.setStyle("display","none");var t=new Element("tr").inject(this.rightTopTable);var i=new Element("td",{colspan:"4"}).inject(t);this.rightTopTdImg=new Element("img",{styles:this.css.rightTopTdImg,src:this.path+"default/icon/PieChart-104.png"}).inject(i);this.rightTopTdSpan=new Element("span",{styles:this.css.rightTopTdSpan,text:MWF.xApplication.Execution.LP.rightTop.title}).inject(i);t=new Element("tr").inject(this.rightTopTable);var e=new Element("td",{styles:this.css["rightTopNumTd"]}).inject(t);this.rightTopFlowSpan=new Element("span",{styles:this.css.rightTopFlowSpan,text:"11"}).inject(e);e=new Element("td",{styles:this.css["rightTopNumTd"]}).inject(t);this.rightTopCompletedSpan=new Element("span",{styles:this.css.rightTopCompletedSpan,text:"9"}).inject(e);e=new Element("td",{styles:this.css["rightTopNumTd"]}).inject(t);this.rightTopOverTimeSpan=new Element("span",{styles:this.css.rightTopOverTimeSpan,text:"16"}).inject(e);this.rightTopRateTd=new Element("td",{width:"80",align:"right"}).inject(t);this.rightTopRateSpan=new Element("span",{styles:this.css.rightTopRateSpan,text:"71.75"}).inject(this.rightTopRateTd);t=new Element("tr").inject(this.rightTopTable);new Element("td",{styles:this.css["rightTopTextTd"],width:"80",align:"center",text:MWF.xApplication.Execution.LP.rightTop.flow}).inject(t);new Element("td",{styles:this.css["rightTopTextTd"],width:"80",align:"center",text:MWF.xApplication.Execution.LP.rightTop.overTime}).inject(t);new Element("td",{styles:this.css["rightTopTextTd"],width:"80",align:"center",text:MWF.xApplication.Execution.LP.rightTop.completed}).inject(t);new Element("td",{styles:this.css["rightTopTextTd"],width:"80",align:"right",text:MWF.xApplication.Execution.LP.rightTop.rate}).inject(t)},createRightBottomVersion:function(){this.workConditionMenuDiv=new Element("div.createRightBottom",{styles:this.css.workConditionMenuDiv}).inject(this.rightBottomContent);this.createRightBottom()},createRightBottom:function(){this.workConditionMenuTitleDiv=new Element("div.workConditionMenuTitleDiv",{styles:this.css.workConditionMenuTitleDiv}).inject(this.workConditionMenuDiv);this.workConditionMenuTitleImg=new Element("img",{styles:this.css.workConditionMenuTitleImg,src:this.path+"default/icon/AppointmentReminders-96.png"}).inject(this.workConditionMenuTitleDiv);this.workConditionMenuTitleSpan=new Element("span",{styles:this.css.workConditionMenuTitleSpan,text:MWF.xApplication.Execution.LP.workConditionMenuTitle}).inject(this.workConditionMenuTitleDiv);this.workConditionMenuMoreDiv=new Element("div",{styles:this.css.workConditionMenuMoreDiv}).inject(this.workConditionMenuDiv);this.workConditionMenuMoreLi=new Element("li",{styles:this.css.workConditionMenuMoreLi}).inject(this.workConditionMenuMoreDiv);this.createWorkConditionContentDiv()},loadTopBarTab:function(t){if(t=="work"){this.topBarWorkLi.setStyles({"background-color":"#124c93"});this.topBarXmindLi.setStyles({"background-color":"#5c97e1"});this.topBarSettingLi.setStyles({"background-color":"#5c97e1"})}else if(t=="xmind"){this.topBarWorkLi.setStyles({"background-color":"#5c97e1"});this.topBarXmindLi.setStyles({"background-color":"#124c93"});this.topBarSettingLi.setStyles({"background-color":"#5c97e1"})}else if(t=="setting"){this.topBarWorkLi.setStyles({"background-color":"#5c97e1"});this.topBarXmindLi.setStyles({"background-color":"#5c97e1"});this.topBarSettingLi.setStyles({"background-color":"#124c93"})}},createCategoryNode:function(t,i,e){var o=new Element("li.categoryIcons",{styles:this.css[e]}).inject(this.categoryIconsUl);o.addEvents({mouseover:function(){this.setStyles({"background-color":"#124c93"})},mouseout:function(){this.setStyles({"background-color":"#407ac1"})},click:function(){if(i==MWF.xApplication.Execution.LP.categoryIcon.span1){this.openTask()}else if(i==MWF.xApplication.Execution.LP.categoryIcon.span2){this.openWorkReport()}else if(i==MWF.xApplication.Execution.LP.categoryIcon.span3){}else if(i==MWF.xApplication.Execution.LP.categoryIcon.span4){}else if(i==MWF.xApplication.Execution.LP.categoryIcon.span5){this.openStat()}}.bind(this)});var s=new Element("img.categoryIconsImg",{styles:this.css["categoryIconsImg"],src:t}).inject(o);var n=new Element("span.categoryIconsSpan",{styles:this.css["categoryIconsSpan"],text:i}).inject(o)},getTodoCount:function(){this.restActions.getBaseWorkListMyDoNext("(0)",10,null,function(t){if(this.todoMenuWorkCount&&t.count)this.todoMenuWorkCount.set("text","("+t.count+")")}.bind(this))},changeTodoTab:function(t){if(t.className=="todoMenuDo"){t.setStyles({"background-color":"#0f72c2"});if(this.todoMenuWork)this.todoMenuWork.setStyles({"background-color":""});this.createTodoList()}if(t.className=="todoMenuWork"){t.setStyles({"background-color":"#0f72c2"});if(this.todoMenuDo)this.todoMenuDo.setStyles({"background-color":""});this.createWorkList()}},createTodoList:function(t){if(this.workView)delete this.workView;if(this.workListContent)this.workListContent.destroy();if(this.todoListContent)this.todoListContent.destroy();this.todoListContent=new Element("div.todoListContent",{styles:this.css.todoList}).inject(this.leftBottomContent);if(this.todoListContentY)this.todoListContent.setStyles({height:this.todoListContentY+"px"});this.todoListDiv=new Element("div.todoListDiv",{styles:this.css.todoListDiv}).inject(this.todoListContent);if(this.todoListDiv){this.todoListDiv.empty();var i={};this.todoView=new MWF.xApplication.Execution.TodoView(this.todoListDiv,this,this,{templateUrl:this.path+"todoList.json",category:t,filterData:i});this.todoView.load();this.setScrollBar(this.todoListDiv,this.todoView)}},createWorkList:function(t){if(this.todoView)delete this.todoView;if(this.todoListContent)this.todoListContent.destroy();if(this.workListContent)this.workListContent.destroy();this.workListContent=new Element("div.workListContent",{styles:this.css.todoList}).inject(this.leftBottomContent);if(this.todoListContentY)this.workListContent.setStyles({height:this.todoListContentY+"px"});this.workListDiv=new Element("div.workListDiv",{styles:this.css.todoListDiv}).inject(this.workListContent);if(this.workListDiv){this.workListDiv.empty();var i={};this.workView=new MWF.xApplication.Execution.WorkView(this.workListDiv,this,this,{templateUrl:this.path+"workList.json",category:t,filterData:i});this.workView.load();this.setScrollBar(this.workListDiv,this.workView)}},createWorkConditionContentDiv:function(){if(this.workConditionContentDiv)this.workConditionContentDiv.destroy();this.workConditionContentDiv=new Element("div",{styles:this.css.workConditionContentDiv}).inject(this.rightBottomContent);this.workConditionListDiv=new Element("div.workConditionListDiv",{styles:this.css.workConditionListDiv}).inject(this.workConditionContentDiv);if(this.workConditionListDiv)this.workConditionListDiv.empty();this.workConditionView=new MWF.xApplication.Execution.WorkConditionView(this.workConditionListDiv,this,this,{templateUrl:this.path+"workConditionList.json"});this.workConditionView.load();this.setScrollBar(this.workConditionListDiv,this.workConditionView)},createShade:function(t,i){var e=this.content;var o=t||e;var s=i||"loading...";if(this.shadeDiv){this.shadeDiv.destroy()}if(this["shadeTxtDiv"])this["shadeTxtDiv"].destroy();this.shadeDiv=new Element("div.shadeDiv").inject(o);this.inforDiv=new Element("div.inforDiv",{styles:{height:"16px",display:"inline-block",position:"absolute","background-color":"#000000","border-radius":"3px",padding:"5px 10px"}}).inject(this.shadeDiv);this.loadImg=new Element("img.loadImg",{styles:{width:"16px",height:"16px",float:"left"},src:"/x_component_Execution/$Main/default/icon/loading.gif"}).inject(this.inforDiv);this.shadeTxtSpan=new Element("span.shadeTxtSpan").inject(this.inforDiv);this.shadeTxtSpan.set("text",s);this.shadeDiv.setStyles({width:"100%",height:"100%",position:"absolute",opacity:"0.6","background-color":"#cccccc","z-index":"999"});this.shadeTxtSpan.setStyles({color:"#ffffff","font-size":"12px",display:"inline-block","line-height":"16px","padding-left":"5px"});var n=o.getSize().x;var r=o.getSize().y;this.shadeDiv.setStyles({left:o.getLeft()-e.getLeft()+"px",top:o.getTop()-e.getTop()+"px",width:n+"px",height:r+"px"});if(o.getStyle("position")=="absolute"){this.shadeDiv.setStyles({left:"0px",top:"0px"})}this.inforDiv.setStyles({left:n/2+"px",top:r/2+"px"})},setScrollBar:function(t,i,e,o,s){if(!e)e="default";if(!o){o={V:{x:0,y:0},H:{x:0,y:0}}}MWF.require("MWF.widget.ScrollBar",function(){if(this.scrollbar&&this.scrollbar.scrollVAreaNode){this.scrollbar.scrollVAreaNode.destroy();delete this.scrollbar}this.scrollbar=new MWF.widget.ScrollBar(t,{style:e,offset:o,where:"before",indent:false,distance:100,friction:4,onScroll:function(e){var o=t.getScrollSize();var s=t.getSize();var n=o.y-s.y;if(e+200>n&&i&&i.loadElementList){if(!i.isItemsLoaded)i.loadElementList()}}.bind(this)});if(s)s()}.bind(this));return false},destroyShade:function(){if(this.shadeDiv)this.shadeDiv.destroy()},showErrorMessage:function(t,i,e){var o=e;var s;if(t)s=t.responseText;if(s!=""){var n=JSON.parse(s);if(n.message){this.notice(n.message,"error")}else{this.notice(o,"error")}}else{this.notice(o,"error")}}});MWF.xApplication.Execution.TodoView=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexView,_createDocument:function(t){return new MWF.xApplication.Execution.TodoDocument(this.viewNode,t,this.explorer,this)},_getCurrentPageData:function(t,i){if(!i)i=20;var e=this.items.length?this.items[this.items.length-1].data.id:"(0)";var o=this.options.filterData||{};this.actions.getTaskListNext(e,i,o,function(i){if(this.explorer.todoMenuDoCount&&i.count)this.explorer.todoMenuDoCount.set("text","("+i.count+")");if(t)t(i)}.bind(this),function(t,i,e){}.bind(this))},_openDocument:function(t){if(t.dynamicObjectType&&t.dynamicObjectType==this.lp.todo.todoCategory.report){MWF.xDesktop.requireApp("Execution","WorkReport",function(){var i={workReportId:t["dynamicObjectId"],workId:t.workId};this.workReport=new MWF.xApplication.Execution.WorkReport(this,this.actions,i,{isEdited:false,onReloadView:function(){this.explorer.createTodoList();this.explorer.createWorkConditionContentDiv();this.explorer.getTodoCount();this.explorer.resizeContent()}.bind(this)});this.workReport.load()}.bind(this))}else if(t.dynamicObjectType&&t.dynamicObjectType==this.lp.todo.todoCategory.deploy){MWF.xDesktop.requireApp("Execution","WorkDeploy",function(){this.workDeploy=new MWF.xApplication.Execution.WorkDeploy(this,this.actions,{id:t["dynamicObjectId"]},{isEdited:false,centerWorkId:t["dynamicObjectId"],onReloadView:function(){this.explorer.createTodoList();this.explorer.createWorkConditionContentDiv();this.explorer.getTodoCount();this.explorer.resizeContent()}.bind(this)});this.workDeploy.load()}.bind(this))}else if(t.dynamicObjectType&&t.dynamicObjectType==this.lp.todo.todoCategory.gather){MWF.xDesktop.requireApp("Execution","WorkGather",function(){var i={gatherId:t.id,title:t["dynamicObjectTitle"]};this.workGather=new MWF.xApplication.Execution.WorkGather(this,this.actions,i,{onReloadView:function(){this.explorer.createTodoList();this.explorer.createWorkConditionContentDiv();this.explorer.getTodoCount();this.explorer.resizeContent()}.bind(this)});this.workGather.load()}.bind(this))}else if(t.dynamicObjectType&&t.dynamicObjectType==this.lp.todo.todoCategory.readReport){MWF.xDesktop.requireApp("Execution","WorkReport",function(){var i={todoId:t.id,workReportId:t["dynamicObjectId"],workId:t.workId};this.workReport=new MWF.xApplication.Execution.WorkReport(this,this.actions,i,{isEdited:false,isRead:true,onReloadView:function(){this.explorer.createTodoList();this.explorer.createWorkConditionContentDiv();this.explorer.getTodoCount();this.explorer.resizeContent()}.bind(this)});this.workReport.load()}.bind(this))}else if(t.dynamicObjectType&&t.dynamicObjectType==this.lp.todo.todoCategory.reportDrafter){MWF.xDesktop.requireApp("Execution","WorkReport",function(){var i={todoId:t.id,workReportId:t["dynamicObjectId"],workId:t.workId};this.workReport=new MWF.xApplication.Execution.WorkReport(this,this.actions,i,{isEdited:false,onReloadView:function(){this.explorer.createTodoList();this.explorer.createWorkConditionContentDiv();this.explorer.getTodoCount();this.explorer.resizeContent()}.bind(this)});this.workReport.load()}.bind(this))}}});MWF.xApplication.Execution.TodoDocument=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexDocument});MWF.xApplication.Execution.WorkView=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexView,_createDocument:function(t){return new MWF.xApplication.Execution.WorkDocument(this.viewNode,t,this.explorer,this)},_getCurrentPageData:function(t,i){if(!i)i=20;var e=this.items.length?this.items[this.items.length-1].data.id:"(0)";var o=this.options.filterData||{};this.actions.getBaseWorkListMyDoNext(e,i,o,function(i){if(this.explorer.todoMenuWorkCount&&i.count)this.explorer.todoMenuWorkCount.set("text","("+i.count+")");if(t)t(i)}.bind(this))},_openDocument:function(t){MWF.xDesktop.requireApp("Execution","WorkDetail",function(){var i=new MWF.xApplication.Execution.WorkDetail(this,this.app.restActions,t,{isNew:false,isEdited:false});i.load()}.bind(this))}});MWF.xApplication.Execution.WorkDocument=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexDocument,_postCreateDocumentNode:function(t,i){var e=t.getElement("div[class='barPercentDiv']");if(e){if(i.overallProgress){var o=parseFloat(i.overallProgress);o=o.toFixed(2);var s="#0099ff";if(i["isOverTime"])s="#f00";e.setStyles({width:o+"%","background-color":s});t.set("title",o+"%")}}}});MWF.xApplication.Execution.WorkConditionView=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexView,_createDocument:function(t){return new MWF.xApplication.Execution.WorkConditionDocument(this.viewNode,t,this.explorer,this)},loadElementList:function(t){if(!this.isItemsLoaded){if(!this.isItemLoadding){this.isItemLoadding=true;this._getCurrentPageData(function(t){var i=t.count;if(i<=this.items.length){this.isItemsLoaded=true}t.data.each(function(t){if(!this.documents[t.id]){var i=this._createDocument(t);this.items.push(i);this.documents[t.id]=i}}.bind(this));this.isItemLoadding=false;if(this.loadItemQueue>0){this.loadItemQueue--;this.loadElementList()}}.bind(this),t)}else{this.loadItemQueue++}}},parseEmotion:function(t){t.content=t.content.replace(/\[emotion=(.*?)\]/g,function(t,i){var e=MWF.defaultPath+"/widget/$SimpleEditor/default/img/emotion/";return"<img imagename='"+i+"' style='cursor:pointer;border:0;padding:2px;' "+" class='MWF_editor_emotion' src='"+e+i+".gif"+"'>"}.bind(this))},_getCurrentPageData:function(t,i){if(!i)i=20;var e=this.items.length?this.items[this.items.length-1].data.id:"(0)";var o=this.options.filterData||{};this.actions.getWorkConditionListNext(e,i,o,function(i){i.data.each(function(t){this.parseEmotion(t)}.bind(this));if(t)t(i)}.bind(this))}});MWF.xApplication.Execution.WorkConditionDocument=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexDocument});