MWF.xApplication.process.Application.options={multitask:true,executable:false};MWF.xApplication.process.Application.Main=new Class({Extends:MWF.xApplication.Common.Main,Implements:[Options,Events],options:{style:"default",name:"process.Application",icon:"icon.png",width:"1200",height:"700",application:"",id:"",title:MWF.xApplication.process.Application.LP.title},onQueryLoad:function(){this.lp=MWF.xApplication.process.Application.LP;if(this.status)this.options.id=this.status.id},getApplication:function(t,i){if(!this.options.application){this.getAction(function(){this.action.getApplication(this.options.id,function(o){if(o.data){this.setTitle(this.options.title+"-"+o.data.name);this.options.application=o.data;if(t)t()}else{if(i)i()}}.bind(this),function(){if(i)i()}.bind(this),false)}.bind(this))}else{if(t)t()}},getAction:function(t){if(!this.action){this.action=MWF.Actions.get("x_processplatform_assemble_surface");if(t)t()}else{if(t)t()}},createNode:function(){this.content.setStyle("overflow","hidden");this.node=new Element("div",{styles:{width:"100%",height:"100%",overflow:"hidden","background-color":"#ffffff"}}).inject(this.content)},loadApplication:function(t){debugger;this.getApplication(function(){this.createNode();this.loadStartMenu();if(t)t()}.bind(this),function(){this.close()}.bind(this))},loadStartMenu:function(t){this.startMenuNode=new Element("div",{styles:this.css.startMenuNode}).inject(this.node);this.menu=new MWF.xApplication.process.Application.Menu(this,this.startMenuNode,{onPostLoad:function(){this.css.rightContentNode["margin-left"]="140px";if(this.status){if(this.status.hideMenu){this.startMenuNode.setStyle("display","none");this.css.rightContentNode["margin-left"]="0px"}if(this.status.navi!=null){this.menu.doAction(this.menu.startNavis[this.status.navi])}else{this.menu.doAction(this.menu.startNavis[0])}}else{this.menu.doAction(this.menu.startNavis[0])}}.bind(this)});this.addEvent("resize",function(){if(this.menu)this.menu.onResize()}.bind(this))},clearContent:function(){if(this.myWorkConfiguratorContentNode){if(this.myWorkConfigurator){if(this.myWorkConfigurator.setContentSizeFun)this.removeEvent("resize",this.myWorkConfigurator.setContentSizeFun);MWF.release(this.myWorkConfigurator);this.myWorkConfigurator=null}this.myWorkConfiguratorContentNode.destroy();this.myWorkConfiguratorContentNode=null}if(this.myCompletedConfiguratorContentNode){if(this.myCompletedConfigurator){if(this.myCompletedConfigurator.setContentSizeFun)this.removeEvent("resize",this.myCompletedConfigurator.setContentSizeFun);MWF.release(this.myCompletedConfigurator);this.myCompletedConfigurator=null}this.myCompletedConfiguratorContentNode.destroy();this.myCompletedConfiguratorContentNode=null}if(this.workConfiguratorContentNode){if(this.workConfigurator){if(this.workConfigurator.setContentSizeFun)this.removeEvent("resize",this.workConfigurator.setContentSizeFun);MWF.release(this.workConfigurator);this.workConfigurator=null}this.workConfiguratorContentNode.destroy();this.workConfiguratorContentNode=null}if(this.completedConfiguratorContentNode){if(this.completedConfigurator){if(this.completedConfigurator.setContentSizeFun)this.removeEvent("resize",this.completedConfigurator.setContentSizeFun);MWF.release(this.completedConfigurator);this.completedConfigurator=null}this.completedConfiguratorContentNode.destroy();this.completedConfiguratorContentNode=null}if(this.dataConfiguratorContent){if(this.dataConfigurator){if(this.dataConfigurator.setContentSizeFun)this.removeEvent("resize",this.dataConfigurator.setContentSizeFun);MWF.release(this.dataConfigurator);this.dataConfigurator=null}this.dataConfiguratorContent.destroy();this.dataConfiguratorContent=null}if(this.serialConfiguratorContent){if(this.serialConfigurator){if(this.serialConfigurator.setContentSizeFun)this.removeEvent("resize",this.serialConfigurator.setContentSizeFun);MWF.release(this.serialConfigurator);this.serialConfigurator=null}this.serialConfiguratorContent.destroy();this.serialConfiguratorContent=null}if(this.statConfiguratorContentNode){if(this.statConfigurator){if(this.statConfigurator.setContentSizeFun)this.removeEvent("resize",this.statConfigurator.setContentSizeFun);MWF.release(this.statConfigurator);this.statConfigurator=null}this.statConfiguratorContentNode.destroy();this.statConfiguratorContentNode=null}if(this.viewConfiguratorContentNode){if(this.viewConfigurator){if(this.viewConfigurator.setContentSizeFun)this.removeEvent("resize",this.viewConfigurator.setContentSizeFun);MWF.release(this.viewConfigurator);this.viewConfigurator=null}this.viewConfiguratorContentNode.destroy();this.viewConfiguratorContentNode=null}},statConfig:function(){this.clearContent();this.statConfiguratorContentNode=new Element("div",{styles:this.css.rightContentNode}).inject(this.node);this.loadStatConfig()},loadStatConfig:function(){MWF.xDesktop.requireApp("process.Application","StatExplorer",function(){if(!this.restActions)this.restActions=MWF.Actions.get("x_processplatform_assemble_surface");this.statConfigurator=new MWF.xApplication.process.Application.StatExplorer(this.statConfiguratorContentNode,this.restActions);this.statConfigurator.app=this;this.statConfigurator.load()}.bind(this))},viewConfig:function(){this.clearContent();this.viewConfiguratorContentNode=new Element("div",{styles:this.css.rightContentNode}).inject(this.node);this.loadViewConfig()},loadViewConfig:function(){MWF.xDesktop.requireApp("process.Application","ViewExplorer",function(){if(!this.restActions)this.restActions=MWF.Actions.get("x_processplatform_assemble_surface");this.viewConfigurator=new MWF.xApplication.process.Application.ViewExplorer(this.viewConfiguratorContentNode,this.restActions);this.viewConfigurator.app=this;this.viewConfigurator.load()}.bind(this))},myWorkConfig:function(){this.clearContent();this.myWorkConfiguratorContentNode=new Element("div",{styles:this.css.rightContentNode}).inject(this.node);this.loadMyWorkConfig()},loadMyWorkConfig:function(){MWF.xDesktop.requireApp("process.Application","MyWorkExplorer",function(){if(!this.restActions)this.restActions=MWF.Actions.get("x_processplatform_assemble_surface");this.myWorkConfigurator=new MWF.xApplication.process.Application.MyWorkExplorer(this.myWorkConfiguratorContentNode,this.restActions);this.myWorkConfigurator.app=this;this.myWorkConfigurator.load()}.bind(this))},myWorkCompletedConfig:function(){this.clearContent();this.myCompletedConfiguratorContentNode=new Element("div",{styles:this.css.rightContentNode}).inject(this.node);this.loadMyWorkCompletedConfig()},loadMyWorkCompletedConfig:function(){MWF.xDesktop.requireApp("process.Application","MyWorkCompletedExplorer",function(){if(!this.restActions)this.restActions=MWF.Actions.get("x_processplatform_assemble_surface");this.myCompletedConfigurator=new MWF.xApplication.process.Application.MyWorkCompletedExplorer(this.myCompletedConfiguratorContentNode,this.restActions);this.myCompletedConfigurator.app=this;this.myCompletedConfigurator.load()}.bind(this))},workConfig:function(){this.clearContent();this.workConfiguratorContentNode=new Element("div",{styles:this.css.rightContentNode}).inject(this.node);this.loadWorkConfig()},loadWorkConfig:function(){MWF.xDesktop.requireApp("process.Application","WorkExplorer",function(){if(!this.restActions)this.restActions=MWF.Actions.get("x_processplatform_assemble_surface");this.workConfigurator=new MWF.xApplication.process.Application.WorkExplorer(this.workConfiguratorContentNode,this.restActions);this.workConfigurator.app=this;this.workConfigurator.load()}.bind(this))},workCompletedConfig:function(){this.clearContent();this.completedConfiguratorContentNode=new Element("div",{styles:this.css.rightContentNode}).inject(this.node);this.loadWorkCompletedConfig()},loadWorkCompletedConfig:function(){MWF.xDesktop.requireApp("process.Application","WorkCompletedExplorer",function(){if(!this.restActions)this.restActions=MWF.Actions.get("x_processplatform_assemble_surface");this.completedConfigurator=new MWF.xApplication.process.Application.WorkCompletedExplorer(this.completedConfiguratorContentNode,this.restActions);this.completedConfigurator.app=this;this.completedConfigurator.load()}.bind(this))},dataConfig:function(){this.clearContent();this.dataConfiguratorContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node);this.loadDataConfig()},loadDataConfig:function(){MWF.xDesktop.requireApp("process.Application","DictionaryExplorer",function(){if(!this.dictActions)this.dictActions=MWF.Actions.get("x_processplatform_assemble_designer");this.dataConfigurator=new MWF.xApplication.process.Application.DictionaryExplorer(this.dataConfiguratorContent,this.dictActions,{noCreate:true,noDelete:true,noModifyName:true,readMode:!this.options.application.allowControl});this.dataConfigurator.app=this;this.dataConfigurator.load()}.bind(this))},serialConfig:function(){this.clearContent();this.serialConfiguratorContent=new Element("div",{styles:this.css.rightContentNode}).inject(this.node);this.loadSerialConfig()},loadSerialConfig:function(){MWF.xDesktop.requireApp("process.Application","SerialExplorer",function(){if(!this.restActions)this.restActions=MWF.Actions.get("x_processplatform_assemble_surface");this.serialConfigurator=new MWF.xApplication.process.Application.SerialExplorer(this.serialConfiguratorContent,this.restActions);this.serialConfigurator.app=this;this.serialConfigurator.load()}.bind(this))},recordStatus:function(){var t=null;if(this.menu.currentNavi){t=this.menu.startNavis.indexOf(this.menu.currentNavi)}return{navi:t,id:this.options.id}}});MWF.xApplication.process.Application.Menu=new Class({Implements:[Options,Events],initialize:function(t,i,o){this.setOptions(o);this.app=t;this.node=$(i);this.currentNavi=null;this.status="start";this.startNavis=[];this.load()},load:function(){var t=this.app.path+"startMenu.json";MWF.getJSON(t,function(t){t.each(function(t){var i=new Element("div",{styles:this.app.css.startMenuNaviNode});i.store("naviData",t);if(t.hint)i.set("title",t.hint);var o=new Element("div",{styles:this.app.css.startMenuIconNode}).inject(i);o.setStyle("background-image","url("+this.app.path+this.app.options.style+"/icon/"+t.icon+")");var e=new Element("div",{styles:this.app.css.startMenuTextNode,text:t.title});e.inject(i);i.inject(this.node);this.startNavis.push(i);this.setStartNaviEvent(i,t);this.setNodeCenter(this.node)}.bind(this));this.setStartMenuWidth();this.fireEvent("postLoad")}.bind(this))},setStartNaviEvent:function(t){var i=this;t.addEvents({mouseover:function(){if(i.currentNavi!=this)this.setStyles(i.app.css.startMenuNaviNode_over)},mouseout:function(){if(i.currentNavi!=this)this.setStyles(i.app.css.startMenuNaviNode)},mousedown:function(){if(i.currentNavi!=this)this.setStyles(i.app.css.startMenuNaviNode_down)},mouseup:function(){if(i.currentNavi!=this)this.setStyles(i.app.css.startMenuNaviNode_over)},click:function(){i.doAction.apply(i,[this])}})},doAction:function(t){var i=t.retrieve("naviData");var o=i.action;if(this.currentNavi)this.currentNavi.setStyles(this.app.css.startMenuNaviNode);t.setStyles(this.app.css.startMenuNaviNode_current);this.currentNavi=t;if(this.app[o])this.app[o].apply(this.app);if(this.status=="start"){this.toNormal();this.status="normal"}},toNormal:function(){var t=this.app.css.normalStartMenuNode;if(!this.morph){this.morph=new Fx.Morph(this.node,{duration:50,link:"chain"})}this.morph.start(t).chain(function(){this.node.setStyles(t);MWF.require("MWF.widget.ScrollBar",function(){new MWF.widget.ScrollBar(this.node,{style:"xApp_ProcessManager_StartMenu",distance:100,friction:4,axis:{x:false,y:true}})}.bind(this))}.bind(this))},setNodeCenter:function(t){var i=t.getSize();var o=this.app.node.getSize();var e=o.y/2-i.y/2;var n=o.x/2-i.x/2;if(n<0)n=0;if(e<0)e=0;t.setStyles({left:n,top:e})},getStartMenuNormalSize:function(){var t=this.node.getFirst();var i=t.getComputedSize();var o=t.getStyle("margin-top").toFloat();var e=t.getStyle("margin-bottom").toFloat();var n=i.totalWidth+o+e;var s=t.getStyle("margin-left").toFloat();var r=t.getStyle("margin-right").toFloat();var a=i.totalWidth+s+r;return{width:a,height:n*this.startNavis.length}},setStartMenuWidth:function(){var t=this.node.getFirst();var i=t.getComputedSize();var o=t.getStyle("margin-left").toFloat();var e=t.getStyle("margin-right").toFloat();var n=i.totalWidth+o+e;this.node.setStyle("width",n*this.startNavis.length+"px")},onResize:function(){if(this.status=="start"){this.setNodeCenter(this.node)}}});