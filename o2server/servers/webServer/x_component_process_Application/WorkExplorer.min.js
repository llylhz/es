MWF.require("MWF.widget.Mask",null,false);MWF.require("MWF.widget.O2Identity",null,false);MWF.xDesktop.requireApp("Selector","package",null,false);MWF.xDesktop.requireApp("process.ProcessManager","DictionaryExplorer",null,false);MWF.xApplication.process.Application.WorkExplorer=new Class({Extends:MWF.xApplication.process.ProcessManager.DictionaryExplorer,Implements:[Options,Events],initialize:function(e,t,i){this.setOptions(i);this.setTooltip();this.path="/x_component_process_Application/$WorkExplorer/";this.cssPath="/x_component_process_Application/$WorkExplorer/"+this.options.style+"/css.wcss";this._loadCss();this.actions=t;this.node=$(e);this.items=[];this.works={};this.filter=null;this.isItemsLoaded=false;this.isItemLoadding=false;this.loadItemQueue=0;this.pageCount=20;this.initData()},load:function(){this.loadToolbar();this.loadFilterNode();this.loadFilterConditionNode();this.loadContentNode();this.setNodeScroll();this.mask=new MWF.widget.Mask({style:"desktop"});this.mask.loadNode(this.node);this.loadElementList()},createSearchElementNode:function(){this.toCompletedNode=new Element("div",{styles:this.css.toCompletedNode,text:this.app.lp.toCompleted}).inject(this.toolbarNode);this.toCompletedNode.addEvents({mouseover:function(){this.toCompletedNode.setStyles(this.css.toCompletedNode_over)}.bind(this),mouseout:function(){this.toCompletedNode.setStyles(this.css.toCompletedNode)}.bind(this),click:function(){this.app.workCompletedConfig()}.bind(this)})},clearWorks:function(){MWF.release(this.items);this.isCountShow=false;this.works=null;this.items=[];this.works={};this.elementContentListNode.empty();this.isItemsLoaded=false;this.isItemLoadding=false;this.loadItemQueue=0},loadFilterNode:function(){this.filterNode=new Element("div",{styles:this.css.filterNode}).inject(this.node);this.filterAllProcessNode=new Element("div",{styles:this.css.filterAllProcessNode,text:this.app.lp.all}).inject(this.filterNode);new Element("span",{styles:this.css.filterAllProcessCountNode}).inject(this.filterAllProcessNode);this.filterAllProcessNode.addEvent("click",function(){if(this.currentProcessNode)this.currentProcessNode.setStyles(this.css.filterProcessNode);this.currentProcessNode=null;this.filter=null;this.reloadWorks()}.bind(this));this.filterActionAreaNode=new Element("div",{styles:this.css.filterActionAreaNode}).inject(this.filterNode);this.filterActionNode=new Element("div",{styles:this.css.filterActionNode,text:this.app.lp.filter}).inject(this.filterActionAreaNode);this.filterActionNode.addEvent("click",function(e){this.showOrHideFilter();e.stopPropagation()}.bind(this));this.filterProcessAreaNode=new Element("div",{styles:this.css.filterProcessAreaNode}).inject(this.filterNode);this.filterProcessListNode=new Element("div",{styles:this.css.filterProcessListNode}).inject(this.filterProcessAreaNode);this.loadProcess()},showOrHideFilter:function(){if(!this.isFilterOpen){if(!this.filterAreaMorph||!this.filterAreaMorph.isRunning())this.showFilter()}else{if(this.filterAreaMorph||!this.filterAreaMorph.isRunning())this.hideFilter()}},showFilter:function(){this.filterActionNode.setStyles(this.css.filterActionNode_over);if(!this.filterAreaNode)this.createFilterAreaNode();this.filterAreaTipNode.setStyle("display","block");this.filterAreaNode.setStyle("display","block");this.resizeFilterAreaNode();var e={width:"460px",height:"500px"};this.isFilterOpen=true;this.filterAreaMorph.start(e).chain(function(){this.createFilterAreaTitle();this.createFilterAreaContent();this.hideFilterFun=this.hideFilter.bind(this);$(document.body).addEvent("click",this.hideFilterFun)}.bind(this))},hideFilter:function(){if(this.filterAreaNode){var e={width:"460px",height:"0px"};this.filterAreaNode.empty();this.isFilterOpen=false;this.filterAreaMorph.start(e).chain(function(){this.filterAreaNode.eliminate("input");this.filterAreaNode.setStyle("display","none");this.filterAreaTipNode.setStyle("display","none");this.filterActionNode.setStyles(this.css.filterActionNode);$(document.body).removeEvent("click",this.hideFilterFun)}.bind(this));$(document.body).removeEvent("click",this.hideFilterFun)}},createFilterAreaNode:function(){this.filterAreaNode=new Element("div",{styles:this.css.filterAreaNode}).inject(this.app.content);this.filterAreaNode.addEvent("click",function(e){e.stopPropagation()});this.filterAreaTipNode=new Element("div",{styles:this.css.filterAreaTipNode}).inject(this.app.content);this.filterAreaNode.setStyles({width:"460px",height:"0px"});this.filterAreaNode.position({relativeTo:this.filterNode,position:"bottomRight",edge:"upperRight",offset:{x:-20,y:-1}});this.filterAreaTipNode.position({relativeTo:this.filterNode,position:"bottomRight",edge:"bottomRight",offset:{x:-38,y:0}});this.app.addEvent("resize",function(){this.resizeFilterAreaNode()}.bind(this));this.filterAreaMorph=new Fx.Morph(this.filterAreaNode,{duration:"100",transition:Fx.Transitions.Sine.easeInOut})},resizeFilterAreaNode:function(){if(this.filterAreaNode){this.filterAreaNode.position({relativeTo:this.filterNode,position:"bottomRight",edge:"upperRight",offset:{x:-20,y:-1}});if(this.filterAreaTipNode){this.filterAreaTipNode.position({relativeTo:this.filterNode,position:"bottomRight",edge:"bottomRight",offset:{x:-38,y:0}})}}},createFilterAreaTitle:function(){var e=new Element("div",{styles:this.css.filterAreaTitleNode}).inject(this.filterAreaNode);var t=new Element("div",{styles:this.css.filterAreaTitleActionOkNode,text:this.app.lp.ok}).inject(e);var i=new Element("div",{styles:this.css.filterAreaTitleActionClearNode,text:this.app.lp.clear}).inject(e);i.addEvent("click",function(){this.filterAreaNode.getElements(".filterItem").each(function(e){this.unSelectedFilterItem(e)}.bind(this));var e=this.filterAreaNode.retrieve("input");e.set("value","");this.filter=null;this.hideFilter();this.reloadWorks()}.bind(this));t.addEvent("click",function(){var e=this.filterAreaNode.retrieve("input");if(!this.filter)this.filter={};var t=e.get("value");if(t&&t!=this.app.lp.searchKey){this.filter.key=t}else{this.filter.key="";delete this.filter.key}this.hideFilter();this.reloadWorks()}.bind(this));var s=new Element("div",{styles:this.css.filterAreaTitleSearchNode}).inject(e);var o=new Element("div",{styles:this.css.filterAreaTitleSearchIconNode}).inject(s);var n=new Element("div",{styles:this.css.filterAreaTitleSearchInputAreaNode}).inject(s);var r=new Element("input",{styles:this.css.filterAreaTitleSearchInputNode,value:this.app.lp.searchKey}).inject(n);if(this.filter){if(this.filter.key)r.set("value",this.filter.key)}this.filterAreaNode.store("input",r);var a=this.app.lp.searchKey;r.addEvents({blur:function(){if(!this.get("value"))this.set("value",a)},focus:function(){if(this.get("value")==a)this.set("value","")},keydown:function(e){if(e.code==13){var t=this.filterAreaNode.retrieve("input");if(!this.filter)this.filter={};var i=t.get("value");if(i&&i!=this.app.lp.searchKey){this.filter.key=i}else{this.filter.key="";delete this.filter.key}this.hideFilter();this.reloadWorks()}}.bind(this)})},createFilterAreaContent:function(){var e=new Element("div",{styles:this.css.applicationFilterAreaContentScrollNode}).inject(this.filterAreaNode);var t=new Element("div",{styles:{overflow:"hidden"}}).inject(e);MWF.require("MWF.widget.ScrollBar",function(){new MWF.widget.ScrollBar(e,{style:"xApp_filter",where:"after",distance:30,friction:4,axis:{x:false,y:true}})}.bind(this));var i=this;this._getFilterCount(function(e){var s=e.data;Object.each(s,function(e,s){var o=new Element("div",{styles:this.css.applicationFilterCategoryNode}).inject(t);o.set("text",this.app.lp[s]);var n=new Element("div",{styles:this.css.applicationFilterItemAreaNode}).inject(t);e.each(function(e){if(e.value){var t=new Element("div",{styles:this.css.applicationFilterItemNode}).inject(n);t.set("text",e.name);t.store("value",e.value);t.store("textname",e.name);t.store("key",s);t.addEvent("click",function(){if(this.hasClass("applicationFilterItemNode_over")){i.unSelectedFilterItem(this)}else{i.selectedFilterItem(this)}});if(this.filter){if(this.filter[s]){if(this.filter[s].some(function(t){return t.value===e.value})){this.selectedFilterItem(t)}}}}}.bind(this))}.bind(this))}.bind(this))},_getFilterCount:function(e){this.actions.listFilterAttributeManage(this.app.options.id,function(t){if(e)e(t)})},unSelectedFilterItem:function(e){if(e.hasClass("applicationFilterItemNode_over")){var t=e.retrieve("value");var i=e.retrieve("textname");var s=e.retrieve("key");e.setStyles(this.css.applicationFilterItemNode);e.removeClass("applicationFilterItemNode_over");e.addClass("applicationFilterItemNode");if(!this.filter){this.filter={}}else{if(this.filter[s]){this.filter[s]=this.filter[s].filter(function(e){return e.value!=t});if(!this.filter[s].length)delete this.filter[s]}}e.getParent().eliminate("current")}},selectedFilterItem:function(e){if(!e.hasClass("applicationFilterItemNode_over")){var t=e.getParent().retrieve("current");var i=e.retrieve("value");var s=e.retrieve("key");var o=e.retrieve("textname");e.setStyles(this.css.applicationFilterItemNode_over);e.removeClass("applicationFilterItemNode");e.addClass("applicationFilterItemNode_over");if(!this.filter)this.filter={};if(!this.filter[s])this.filter[s]=[];if(!this.filter[s].some(function(e){return e.value===i})){this.filter[s].push({value:i,name:o})}e.getParent().store("current",e)}},searchElement:function(){if(!this.filter)this.filter={};var e=this.searchElementInputNode.get("value");if(e&&e!=this.app.lp.searchKey){this.filter.key=e;this.hideFilter();this.reloadWorks()}},loadFilterConditionNode:function(){this.filterConditionNode=new Element("div",{styles:this.css.filterConditionNode}).inject(this.node);this.setFilterConditions()},setFilterConditions:function(){this.filterConditionNode.empty();if(this.filter&&Object.keys(this.filter).length){Object.each(this.filter,function(e,t){if(t!=="key"){e.each(function(e){this.createFilterItemNode(t,e)}.bind(this))}}.bind(this));if(this.filter.key){this.createFilterItemNode("key",{name:this.filter.key})}this.filterProcessListNode.setStyle("display","none")}else{this.filterProcessListNode.setStyle("display","block")}},createFilterItemNode:function(e,t){var i=this;var s=new Element("div",{styles:this.css.filterListItemNode}).inject(this.filterConditionNode);var o=new Element("div",{styles:this.css.filterListItemActionNode}).inject(s);var n=new Element("div",{styles:this.css.filterListItemTextNode}).inject(s);n.set("text",this.app.lp[e]+": "+t.name);o.store("key",e);o.store("value",t.name);o.store("valueId",t.value);s.addEvents({mouseover:function(){this.setStyles(i.css.filterListItemNode_over);this.getLast().setStyles(i.css.filterListItemTextNode_over);this.getFirst().setStyles(i.css.filterListItemActionNode_over)},mouseout:function(){this.setStyles(i.css.filterListItemNode);this.getLast().setStyles(i.css.filterListItemTextNode);this.getFirst().setStyles(i.css.filterListItemActionNode)}});o.addEvent("click",function(){var e=this.retrieve("key");var t=this.retrieve("value");var s=this.retrieve("valueId");if(i.filter[e]){i.filter[e]=i.filter[e].filter(function(e){return e.value!==s});if(!i.filter[e].length)delete i.filter[e]}this.destroy();i.reloadWorks()})},loadProcess:function(){this.actions.listProcessManage(this.app.options.id,function(e){e.data.each(function(e){this.loadProcessNode(e)}.bind(this))}.bind(this))},loadProcessNode:function(e){var t=new Element("div",{styles:this.css.filterProcessNode}).inject(this.filterProcessListNode);t.set("text",e.name+"("+e.count+")");t.store("process",e);var i=this;t.addEvent("click",function(){i.setCurrentProcess(this);i.reloadWorks()})},setCurrentProcess:function(e){if(this.currentProcessNode)this.currentProcessNode.setStyles(this.css.filterProcessNode);e.setStyles(this.css.filterProcessNode_current);this.currentProcessNode=e;var t=e.retrieve("process");this.filter={processList:[{name:t.name,value:t.value}]}},reloadWorks:function(){this.clearWorks();this.setFilterConditions();this.createWorkListHead();this.loadElementList()},loadContentNode:function(){this.elementContentNode=new Element("div",{styles:this.css.elementContentNode}).inject(this.node);this.elementContentListNode=new Element("div",{styles:this.css.elementContentListNode}).inject(this.elementContentNode);this.createWorkListHead();this.setContentSize();this.setContentSizeFun=this.setContentSize.bind(this);this.app.addEvent("resize",this.setContentSizeFun)},setNodeScroll:function(){var e=this;this.elementContentNode.addEvent("scroll",function(){var t=e.elementContentNode.scrollTop.toFloat();var i=e.elementContentNode.getScrollSize();var s=e.elementContentNode.getSize();var o=i.y-s.y;if(t+200>o){if(!e.isItemsLoaded)e.loadElementList()}})},createWorkListHead:function(){var e=new Element("div",{styles:this.css.workItemHeadNode}).inject(this.elementContentListNode);var t="<div class='headArea1Node'><div class='checkAreaHeadNode'></div><div class='iconAreaHeadNode'></div><div class='titleAreaHeadNode'>"+this.app.lp.workTitle+"</div></div>"+"<div class='headArea2Node'><div class='statusAreaHeadNode'>"+this.app.lp.status+"</div><div class='activityAreaHeadNode'>"+this.app.lp.activity+"</div></div>"+"<div class='headArea3Node'><div class='actionAreaHeadNode'>"+this.app.lp.action+"</div><div class='expireAreaHeadNode'>"+this.app.lp.expire+"</div><div class='personAreaHeadNode'>"+this.app.lp.person+"</div></div>";e.set("html",t);e.getElement(".headArea1Node").setStyles(this.css.headArea1Node);e.getElement(".headArea2Node").setStyles(this.css.headArea2Node);e.getElement(".headArea3Node").setStyles(this.css.headArea3Node);e.getElement(".checkAreaHeadNode").setStyles(this.css.checkAreaHeadNode);e.getElement(".iconAreaHeadNode").setStyles(this.css.iconAreaHeadNode);e.getElement(".titleAreaHeadNode").setStyles(this.css.titleAreaHeadNode);e.getElement(".statusAreaHeadNode").setStyles(this.css.statusAreaHeadNode);e.getElement(".activityAreaHeadNode").setStyles(this.css.activityAreaHeadNode);e.getElement(".personAreaHeadNode").setStyles(this.css.personAreaHeadNode);e.getElement(".actionAreaHeadNode").setStyles(this.css.actionAreaHeadNode);e.getElement(".expireAreaHeadNode").setStyles(this.css.expireAreaHeadNode)},createCreateElementNode:function(){},setContentSize:function(){var e=this.toolbarNode.getSize();var t=this.node.getSize();var i=this.elementContentNode.getStyle("padding-top").toFloat();var s=this.elementContentNode.getStyle("padding-bottom").toFloat();var o=this.filterNode.getSize();var n=this.filterConditionNode.getSize();var r=t.y-e.y-i-s-o.y-n.y;this.elementContentNode.setStyle("height",""+r+"px");this.pageCount=(r/40).toInt()+5;if(this.items.length<this.pageCount){this.loadElementList(this.pageCount-this.items.length)}if(this.options.noCreate)this.createElementNode.destroy()},_getCurrentPageData:function(e,t){var i=this.items.length?this.items[this.items.length-1].data.id:"(0)";if(this.filter){var s={};Object.each(this.filter,function(e,t){if(t!="key"){if(!s[t])s[t]=[];e.each(function(e){s[t].push(e.value)})}else{s[t]=e}});this.actions.listWorkFilterManage(i,t||this.pageCount,this.app.options.id,s,function(t){if(e)e(t)})}else{this.actions.listWorkNextManage(i,t||this.pageCount,this.app.options.id,function(t){if(e)e(t)})}},loadElementList:function(e){if(!this.isItemsLoaded){if(!this.isItemLoadding){this.isItemLoadding=true;this._getCurrentPageData(function(e){this.count=e.count;if(!this.isCountShow){this.filterAllProcessNode.getFirst("span").set("text","("+this.count+")");this.isCountShow=true}if(e.count<=this.items.length){this.isItemsLoaded=true}e.data.each(function(e){if(!this.works[e.id]){var t=this._createItem(e);this.items.push(t);this.works[e.id]=t}}.bind(this));this.isItemLoadding=false;if(this.loadItemQueue>0){this.loadItemQueue--;this.loadElementList()}this.mask.hide()}.bind(this),e)}else{this.loadItemQueue++}}},_createItem:function(e){return new MWF.xApplication.process.Application.WorkExplorer.Work(e,this)},removeWork:function(e,t){this.actions.removeWork(e.data.id,this.app.options.id,t,function(e){e.data.each(function(e){this.items.erase(this.works[e.id]);this.works[e.id].destroy();MWF.release(this.works[e.id]);delete this.works[e.id]}.bind(this))}.bind(this))}});MWF.xApplication.process.Application.WorkExplorer.Work=new Class({initialize:function(e,t,i){this.explorer=t;this.data=e;this.container=this.explorer.elementContentListNode;this.relative=i;this.css=this.explorer.css;this.tasks=[];this.dones=[];this.reads=[];this.readeds=[];this.taskChildren={};this.doneChildren={};this.readChildren={};this.readedChildren={};this.relativeWorks=[];this.load()},load:function(){this.node=new Element("div",{styles:this.css.workItemNode});if(this.relative){this.node.inject(this.relative.node,"after")}else{this.node.inject(this.container)}this.workAreaNode=new Element("div",{styles:this.css.workItemWorkNode}).inject(this.node);var e="<div class='area1Node'><div class='checkAreaNode'></div><div class='iconAreaNode'></div><div class='titleAreaNode'><div class='titleAreaTextNode'>"+this.data.title+"</div></div></div>"+"<div class='area2Node'><div class='statusAreaNode'></div><div class='activityAreaNode'><div class='activityAreaTextNode'>"+this.data.activityName+"</div></div></div>"+"<div class='area3Node'><div class='actionAreaNode'></div><div class='expireAreaNode'></div><div class='personAreaNode'></div></div>";this.workAreaNode.set("html",e);this.workAreaNode.getElement(".area1Node").setStyles(this.css.headArea1Node);this.workAreaNode.getElement(".area2Node").setStyles(this.css.headArea2Node);this.workAreaNode.getElement(".area3Node").setStyles(this.css.headArea3Node);this.checkAreaNode=this.workAreaNode.getElement(".checkAreaNode").setStyles(this.css.checkAreaHeadNode);this.iconAreaNode=this.workAreaNode.getElement(".iconAreaNode").setStyles(this.css.iconAreaHeadNode);this.titleAreaNode=this.workAreaNode.getElement(".titleAreaNode").setStyles(this.css.titleAreaHeadNode);this.statusAreaNode=this.workAreaNode.getElement(".statusAreaNode").setStyles(this.css.statusAreaHeadNode);this.activityAreaNode=this.workAreaNode.getElement(".activityAreaNode").setStyles(this.css.activityAreaHeadNode);this.personAreaNode=this.workAreaNode.getElement(".personAreaNode").setStyles(this.css.personAreaHeadNode);this.actionAreaNode=this.workAreaNode.getElement(".actionAreaNode").setStyles(this.css.actionAreaHeadNode);this.expireAreaNode=this.workAreaNode.getElement(".expireAreaNode").setStyles(this.css.expireAreaHeadNode);this.activityAreaTextNode=this.workAreaNode.getElement(".activityAreaTextNode").setStyles(this.css.activityAreaTextNode);this.titleAreaTextNode=this.workAreaNode.getElement(".titleAreaTextNode").setStyles(this.css.titleAreaTextNode);if(this.data.expireTime){var t=Date.parse(this.data.expireTime);var i=new Date;if(i.diff(t,"second")<0){this.expireAreaNode.setStyle("color","#FF0000")}this.expireAreaNode.set("text",this.data.expireTime)}else{this.expireAreaNode.set("text",this.explorer.app.lp.noExpire)}this.expireAreaNode.setStyles(this.css.expireAreaNode);if(!this.data.control.allowVisit){this.node.setStyles(this.css.workItemNode_noread);this.checkAreaNode.setStyles(this.css.actionStopWorkNode);this.actionAreaNode.setStyles(this.css.actionStopWorkActionNode)}this.iconAreaNode.setStyles(this.css.iconWorkNode);this.titleAreaNode.setStyles(this.css.titleWorkNode);this.setPersonData();this.setStatusData();this.setActions();this.setEvents();if(!this.relative)this.listRelatives()},reload:function(e){if(this.relative){this.relative.reload()}else{this.explorer.actions.getWork(this.data.id,function(t){this.data=t.data;this.titleAreaTextNode.set("text",this.data.title);this.activityAreaTextNode.set("text",this.data.activityName);this.statusAreaNode.empty();this.setStatusData();if(this.relativeWorks.length){this.relativeWorks.each(function(e){e.destroy()})}this.relativeWorks=[];this.listRelatives();if(e)e()}.bind(this))}},listRelatives:function(){if(this.data.splitting){this.explorer.actions.listRelatives(this.data.id,function(e){if(e.data){if(e.data.length)this.loadRelativeWorks(e.data)}}.bind(this))}},loadRelativeWorks:function(e){this.checkAreaNode.setStyles(this.css.relativeTop);this.workAreaNode.setStyle("height","40px");for(var t=e.length-1;t>=0;t--){var i=e[t];var s=this.explorer.works[i.id];if(s){s.node.inject(this.node,"after");s.relative=this}else{var s=new MWF.xApplication.process.Application.WorkExplorer.Work(i,this.explorer,this);this.explorer.works[i.id]=s}s.workAreaNode.setStyle("height","40px");if(t==e.length-1){s.checkAreaNode.setStyles(this.css.relativeBottom)}else{s.checkAreaNode.setStyles(this.css.relativeCenter)}this.relativeWorks.push(s)}},setEvents:function(){if(this.openNode){this.openNode.addEvents({mouseover:function(){this.openNode.setStyles(this.css.actionOpenNode_over)}.bind(this),mouseout:function(){this.openNode.setStyles(this.css.actionOpenNode)}.bind(this),mousedown:function(){this.openNode.setStyles(this.css.actionOpenNode_down)}.bind(this),mouseup:function(){this.openNode.setStyles(this.css.actionOpenNode_over)}.bind(this),click:function(e){this.openWork(e)}.bind(this)})}if(this.processNode){this.processNode.addEvents({mouseover:function(){this.processNode.setStyles(this.css.actionProcessNode_over)}.bind(this),mouseout:function(){this.processNode.setStyles(this.css.actionProcessNode)}.bind(this),mousedown:function(){this.processNode.setStyles(this.css.actionProcessNode_down)}.bind(this),mouseup:function(){this.processNode.setStyles(this.css.actionProcessNode_over)}.bind(this),click:function(e){this.processWork(e)}.bind(this)})}if(this.rerouteNode){this.rerouteNode.addEvents({mouseover:function(){this.rerouteNode.setStyles(this.css.actionRerouteNode_over)}.bind(this),mouseout:function(){this.rerouteNode.setStyles(this.css.actionRerouteNode)}.bind(this),mousedown:function(){this.rerouteNode.setStyles(this.css.actionRerouteNode_down)}.bind(this),mouseup:function(){this.rerouteNode.setStyles(this.css.actionRerouteNode_over)}.bind(this),click:function(e){this.rerouteWork(e)}.bind(this)})}if(this.deleteNode){this.deleteNode.addEvents({mouseover:function(){this.deleteNode.setStyles(this.css.actionDeleteNode_over)}.bind(this),mouseout:function(){this.deleteNode.setStyles(this.css.actionDeleteNode)}.bind(this),mousedown:function(){this.deleteNode.setStyles(this.css.actionDeleteNode_down)}.bind(this),mouseup:function(){this.deleteNode.setStyles(this.css.actionDeleteNode_over)}.bind(this),click:function(e){this.remove(e)}.bind(this)})}if(this.data.control.allowVisit){this.workAreaNode.addEvents({mouseover:function(){if(!this.readyRemove&&!this.readyFlow)this.workAreaNode.setStyles(this.css.workItemWorkNode_over)}.bind(this),mouseout:function(){if(!this.readyRemove&&!this.readyFlow)this.workAreaNode.setStyles(this.css.workItemWorkNode)}.bind(this)});this.titleAreaNode.addEvent("click",function(){this.loadChild()}.bind(this))}},processWork:function(e){var t=this.explorer.app.lp;var i=t.flowWork.replace(/{title}/g,this.data.title);var s=this;this.workAreaNode.setStyles(this.css.workItemWorkNode_action);this.readyFlow=true;this.explorer.app.confirm("warn",e,t.flowWorkTitle,i,380,130,function(){s.explorer.actions.flowWork(s.data.id,{},function(e){if(e.data.id){s.explorer.actions.getWork(s.data.id,function(e){s.workAreaNode.setStyles(s.css.workItemWorkNode);s.readyFlow=false;s.reload()}.bind(this))}else{s.reload()}this.close()}.bind(this),function(){s.workAreaNode.setStyles(s.css.workItemWorkNode);s.readyFlow=false;s.reload();this.close()}.bind(this))},function(){s.workAreaNode.setStyles(s.css.workItemWorkNode);s.readyFlow=false;this.close()})},rerouteWork:function(){var e=this.explorer.app.lp;this.workAreaNode.setStyles(this.css.workItemWorkNode_action);this.readyReroute=true;MWF.require("MWF.xDesktop.Dialog",function(){var t=480;var i=160;var s=MWF.getCenterPosition(this.explorer.app.content,t,i);var o=this;var o=this;var n=new MWF.xDesktop.Dialog({title:e.reroute,style:"work",top:s.y-100,left:s.x,fromTop:s.y-100,fromLeft:s.x,width:t,height:i,url:this.explorer.app.path+"reroute.html",container:this.explorer.app.content,isClose:true,onPostShow:function(){$("rerouteWork_okButton").addEvent("click",function(){o.doRerouteWork(this)}.bind(this));$("rerouteWork_cancelButton").addEvent("click",function(){this.close()}.bind(this));var e=$("rerouteWork_selectActivity");o.explorer.actions.getRerouteTo(o.data.process,function(t){if(t.data.agentList)t.data.agentList.each(function(t){new Element("option",{value:t.id+"#agent",text:t.name}).inject(e)}.bind(o));if(t.data.cancelList)t.data.cancelList.each(function(t){new Element("option",{value:t.id+"#cancel",text:t.name}).inject(e)}.bind(o));if(t.data.choiceList)t.data.choiceList.each(function(t){new Element("option",{value:t.id+"#choice",text:t.name}).inject(e)}.bind(o));if(t.data.conditionList)t.data.conditionList.each(function(t){new Element("option",{value:t.id+"#condition",text:t.name}).inject(e)}.bind(o));if(t.data.delayList)t.data.delayList.each(function(t){new Element("option",{value:t.id+"#delay",text:t.name}).inject(e)}.bind(o));if(t.data.embedList)t.data.embedList.each(function(t){new Element("option",{value:t.id+"#embed",text:t.name}).inject(e)}.bind(o));if(t.data.endList)t.data.endList.each(function(t){new Element("option",{value:t.id+"#end",text:t.name}).inject(e)}.bind(o));if(t.data.invokeList)t.data.invokeList.each(function(t){new Element("option",{value:t.id+"#invoke",text:t.name}).inject(e)}.bind(o));if(t.data.manualList)t.data.manualList.each(function(t){new Element("option",{value:t.id+"#manual",text:t.name}).inject(e)}.bind(o));if(t.data.mergeList)t.data.mergeList.each(function(t){new Element("option",{value:t.id+"#merge",text:t.name}).inject(e)}.bind(o));if(t.data.messageList)t.data.messageList.each(function(t){new Element("option",{value:t.id+"#message",text:t.name}).inject(e)}.bind(o));if(t.data.parallelList)t.data.parallelList.each(function(t){new Element("option",{value:t.id+"#parallel",text:t.name}).inject(e)}.bind(o));if(t.data.serviceList)t.data.serviceList.each(function(t){new Element("option",{value:t.id+"#service",text:t.name}).inject(e)}.bind(o));if(t.data.splitList)t.data.splitList.each(function(t){new Element("option",{value:t.id+"#split",text:t.name}).inject(e)}.bind(o))}.bind(o))}});n.show()}.bind(this))},doRerouteWork:function(e){var t=$("rerouteWork_opinion").get("value");var i=$("rerouteWork_selectActivity");var s=i.options[i.selectedIndex].get("value");var o=i.options[i.selectedIndex].get("text");var n=s.split("#");s=n[0];var r=n[1];MWF.require("MWF.widget.Mask",function(){this.mask=new MWF.widget.Mask({style:"desktop",zIndex:5e4});this.mask.loadNode(this.explorer.app.content);this.rerouteWorkToActivity(s,r,t,function(){this.explorer.actions.getWork(this.data.id,function(e){this.data=e.data;this.workAreaNode.setStyles(this.css.workItemWorkNode);this.readyReroute=false;this.reload()}.bind(this));e.close();if(this.mask){this.mask.hide();this.mask=null}}.bind(this),function(t,i,s){var o=s+":"+i;if(t)o=t.responseText;this.app.notice("request json error: "+o,"error",e.node);if(this.mask){this.mask.hide();this.mask=null}}.bind(this))}.bind(this))},rerouteWorkToActivity:function(e,t,i,s,o){this.explorer.actions.rerouteWork(this.data.id,e,t,null,function(e){if(s)s()}.bind(this),function(e,t,i){if(o)o(e,t,i)})},openWork:function(e){var t={workId:this.data.id,isControl:this.explorer.app.options.application.allowControl};this.explorer.app.desktop.openApplication(e,"process.Work",t)},remove:function(e){var t=this.explorer.app.lp;var i=t.deleteWork.replace(/{title}/g,this.data.title);var s=this;this.workAreaNode.setStyles(this.css.workItemWorkNode_remove);this.readyRemove=true;this.explorer.app.confirm("warn",e,t.deleteWorkTitle,i,350,120,function(){this.close();s.explorer.app.confirm("warn",e,t.deleteWorkTitle,{html:t.deleteAllWork},400,220,function(){var e=this.content.getElements("input");var i="";for(var o=0;o<e.length;o++){if(e[o].checked){i=e[o].get("value");break}}if(i){if(i=="all"){s.explorer.removeWork(s,true)}else{s.explorer.removeWork(s,false)}this.close()}else{this.content.getElement("#deleteWork_checkInfor").set("text",t.deleteAllWorkCheck).setStyle("color","red")}},function(){s.workAreaNode.setStyles(s.css.workItemWorkNode);this.close()})},function(){s.workAreaNode.setStyles(s.css.workItemWorkNode);s.readyRemove=false;this.close()})},destroy:function(){this.node.destroy()},loadChild:function(){if(!this.childNode){this.createChildNode();this.listAssignments()}else{if(this.childNode.getStyle("display")=="none"){this.childNode.setStyle("display","block")}else{this.childNode.setStyle("display","none")}}},createChildNode:function(){this.childNode=new Element("div",{styles:this.css.workItemChildNode}).inject(this.node);this.taskAreaNode=new Element("div",{styles:this.css.workItemTaskNode}).inject(this.childNode);this.doneAreaNode=new Element("div",{styles:this.css.workItemDonwNode}).inject(this.childNode);this.readAreaNode=new Element("div",{styles:this.css.workItemReadNode}).inject(this.childNode);this.readedAreaNode=new Element("div",{styles:this.css.workItemReadedNode}).inject(this.childNode);this.taskAreaTitleAreaNode=new Element("div",{styles:this.css.workItemListTitleNode}).inject(this.taskAreaNode);this.doneAreaTitleAreaNode=new Element("div",{styles:this.css.workItemListTitleNode}).inject(this.doneAreaNode);this.readAreaTitleAreaNode=new Element("div",{styles:this.css.workItemListTitleNode}).inject(this.readAreaNode);this.readedAreaTitleAreaNode=new Element("div",{styles:this.css.workItemListTitleNode}).inject(this.readedAreaNode);var e=new Element("div",{styles:this.css.workItemTaskTitleNode,text:this.explorer.app.lp.task}).inject(this.taskAreaTitleAreaNode);var t=new Element("div",{styles:this.css.workItemDoneTitleNode,text:this.explorer.app.lp.done}).inject(this.doneAreaTitleAreaNode);var i=new Element("div",{styles:this.css.workItemReadTitleNode,text:this.explorer.app.lp.read}).inject(this.readAreaTitleAreaNode);var s=new Element("div",{styles:this.css.workItemReadedTitleNode,text:this.explorer.app.lp.readed}).inject(this.readedAreaTitleAreaNode);this.taskAreaContentNode=new Element("div",{styles:this.css.taskAreaContentNode}).inject(this.taskAreaNode);this.doneAreaContentNode=new Element("div",{styles:this.css.doneAreaContentNode}).inject(this.doneAreaNode);this.readAreaContentNode=new Element("div",{styles:this.css.readAreaContentNode}).inject(this.readAreaNode);this.readedAreaContentNode=new Element("div",{styles:this.css.readedAreaContentNode}).inject(this.readedAreaNode)},listAssignments:function(){this.explorer.actions.listAssignments(this.data.id,function(e){this.listTasks(e.data.taskList);this.listDones(e.data.taskCompletedList);this.listReads(e.data.readList);this.listReadeds(e.data.readCompletedList)}.bind(this))},listTasks:function(e){if(e.length){e.each(function(e){var t=new MWF.xApplication.process.Application.WorkExplorer.Task(e,this.taskAreaContentNode,this.explorer,this);this.tasks.push(t);this.taskChildren[e.id]=t}.bind(this))}else{new Element("div",{styles:this.css.noListText,text:"［"+this.explorer.app.lp.noTask+"］"}).inject(this.taskAreaTitleAreaNode)}},listDones:function(e){if(e.length){e.each(function(e){var t=new MWF.xApplication.process.Application.WorkExplorer.Done(e,this.doneAreaContentNode,this.explorer,this);this.dones.push(t);this.doneChildren[e.id]=t}.bind(this))}else{new Element("div",{styles:this.css.noListText,text:"［"+this.explorer.app.lp.noDone+"］"}).inject(this.doneAreaTitleAreaNode)}},listReads:function(e){if(e.length){e.each(function(e){var t=new MWF.xApplication.process.Application.WorkExplorer.Read(e,this.readAreaContentNode,this.explorer,this);this.reads.push(t);this.readChildren[e.id]=t}.bind(this))}else{new Element("div",{styles:this.css.noListText,text:"［"+this.explorer.app.lp.noRead+"］"}).inject(this.readAreaTitleAreaNode)}},listReadeds:function(e){if(e.length){e.each(function(e){var t=new MWF.xApplication.process.Application.WorkExplorer.Readed(e,this.readedAreaContentNode,this.explorer,this);
this.readeds.push(t);this.readedChildren[e.id]=t}.bind(this))}else{new Element("div",{styles:this.css.noListText,text:"［"+this.explorer.app.lp.noReaded+"］"}).inject(this.readedAreaTitleAreaNode)}},setPersonData:function(){var e={name:MWF.name.cn(this.data.creatorIdentity),unitName:this.data.creatorUnit?MWF.name.cn(this.data.creatorUnit):"",id:this.data.creatorIdentity};new MWF.widget.O2Identity(e,this.personAreaNode,{style:"work",lazy:true})},setStatusData:function(){this.createStatusIcon("start");this.createStatusIcon("processing");this.createStatusIcon("hanging");this.statusAreaNode.set("title",this.explorer.app.lp[this.data.workStatus])},createStatusIcon:function(e){var t=new Element("div",{styles:this.css.statusIconNode}).inject(this.statusAreaNode);var i=this.data.workStatus==e?"status_"+e+"_red.png":"status_"+e+".png";var s="url("+"/x_component_process_Application/$WorkExplorer/"+this.explorer.options.style+"/icon/"+i+")";t.setStyle("background-image",s)},setActions:function(){if(this.data.control.allowVisit){this.openNode=new Element("div",{styles:this.css.actionOpenNode,title:this.explorer.app.lp.open}).inject(this.actionAreaNode)}if(this.data.control.allowReroute){this.processNode=new Element("div",{styles:this.css.actionProcessNode,title:this.explorer.app.lp.flowManager}).inject(this.actionAreaNode)}if(this.data.control.allowReroute){this.rerouteNode=new Element("div",{styles:this.css.actionRerouteNode,title:this.explorer.app.lp.reroute}).inject(this.actionAreaNode)}if(this.data.control.allowDelete){this.deleteNode=new Element("div",{styles:this.css.actionDeleteNode,title:this.explorer.app.lp.delete}).inject(this.actionAreaNode)}},removeTask:function(e){var t=e.data.id;this.explorer.actions.removeTask(t,function(e){this.tasks.erase(this.taskChildren[t]);this.taskChildren[t].destroy();MWF.release(this.taskChildren[t]);delete this.taskChildren[t]}.bind(this))},removeDone:function(e){var t=e.data.id;this.explorer.actions.removeDone(t,function(e){this.dones.erase(this.doneChildren[t]);this.doneChildren[t].destroy();MWF.release(this.doneChildren[t]);delete this.doneChildren[t]}.bind(this))},removeRead:function(e){var t=e.data.id;this.explorer.actions.removeRead(t,function(e){this.reads.erase(this.readChildren[t]);this.readChildren[t].destroy();MWF.release(this.readChildren[t]);delete this.readChildren[t]}.bind(this))},removeReaded:function(e){var t=e.data.id;this.explorer.actions.removeReaded(t,function(e){this.readeds.erase(this.readedChildren[t]);this.readedChildren[t].destroy();MWF.release(this.readedChildren[t]);delete this.readedChildren[t]}.bind(this))}});MWF.xApplication.process.Application.WorkExplorer.Task=new Class({initialize:function(e,t,i,s){this.explorer=i;this.work=s;this.data=e;this.container=t;this.css=this.explorer.css;this.load()},load:function(){this.node=new Element("div",{styles:this.css.taskItemNode}).inject(this.container);var e=new Element("div",{styles:this.css.taskArea1Node}).inject(this.node);var t=new Element("div",{styles:this.css.taskArea2Node}).inject(this.node);var i=new Element("div",{styles:this.css.taskArea3Node}).inject(this.node);this.iconAreaNode=new Element("div",{styles:this.css.taskItemIconAreaNode}).inject(e);this.personAreaNode=new Element("div",{styles:this.css.taskItemPersonAreaNode}).inject(e);this.timeAreaNode=new Element("div",{styles:this.css.taskItemTimeAreaNode}).inject(t);this.actionAreaNode=new Element("div",{styles:this.css.taskItemActionNode}).inject(i);this.activityAreaNode=new Element("div",{styles:this.css.taskItemActivityNode}).inject(i);this.setTaskContent();this.setActions();this.setEvents()},setTaskContent:function(){new MWF.widget.O2Identity({name:this.data.identity},this.personAreaNode,{style:"task"});var e=(new Date).parse(this.data.startTime).format("%Y-%m-%d %H:%M");this.timeAreaNode.set("text",e);this.activityAreaNode.set("text",this.data.activityName)},setActions:function(){if(this.data.control.allowReset){this.resetNode=new Element("div",{styles:this.css.taskActionResetNode,title:this.explorer.app.lp.reset}).inject(this.actionAreaNode)}if(this.data.control.allowProcessing){this.flowNode=new Element("div",{styles:this.css.taskActionFlowNode,title:this.explorer.app.lp.flow}).inject(this.actionAreaNode)}if(this.data.control.allowDelete){this.deleteNode=new Element("div",{styles:this.css.taskActionDeleteNode,title:this.explorer.app.lp.delete}).inject(this.actionAreaNode)}},setEvents:function(){if(this.resetNode){this.resetNode.addEvents({mouseover:function(){this.resetNode.setStyles(this.css.taskActionResetNode_over)}.bind(this),mouseout:function(){this.resetNode.setStyles(this.css.taskActionResetNode)}.bind(this),mousedown:function(){this.resetNode.setStyles(this.css.taskActionResetNode_down)}.bind(this),mouseup:function(){this.resetNode.setStyles(this.css.taskActionResetNode_over)}.bind(this),click:function(){this.reset()}.bind(this)})}if(this.flowNode){this.flowNode.addEvents({mouseover:function(){this.flowNode.setStyles(this.css.taskActionFlowNode_over)}.bind(this),mouseout:function(){this.flowNode.setStyles(this.css.taskActionFlowNode)}.bind(this),mousedown:function(){this.flowNode.setStyles(this.css.taskActionFlowNode_down)}.bind(this),mouseup:function(){this.flowNode.setStyles(this.css.taskActionFlowNode_over)}.bind(this),click:function(e){this.flow(e)}.bind(this)})}if(this.deleteNode){this.deleteNode.addEvents({mouseover:function(){this.deleteNode.setStyles(this.css.taskActionDeleteNode_over)}.bind(this),mouseout:function(){this.deleteNode.setStyles(this.css.taskActionDeleteNode)}.bind(this),mousedown:function(){this.deleteNode.setStyles(this.css.taskActionDeleteNode_down)}.bind(this),mouseup:function(){this.deleteNode.setStyles(this.css.taskActionDeleteNode_over)}.bind(this),click:function(e){this.remove(e)}.bind(this)})}},reset:function(){this.node.setStyles(this.css.taskItemNode_action);var e={type:"identity",title:this.explorer.app.lp.reset,onComplete:function(e){if(e.length){this.resetPeople(e)}else{this.node.setStyles(this.css.taskItemNode)}}.bind(this),onCancel:function(){this.node.setStyles(this.css.taskItemNode)}.bind(this)};var t=new MWF.O2Selector(this.explorer.app.content,e)},resetPeople:function(e){var t=[];e.each(function(e){t.push(e.data.distinguishedName)});var i={routeName:this.explorer.app.lp.reset,opinion:this.explorer.app.lp.reset+": "+t.join(", "),identityList:t};this.explorer.actions.resetTask(this.data.id,i,function(){this.work.childNode.destroy();this.work.childNode=null;this.work.loadChild()}.bind(this))},flow:function(e){this.node.setStyles(this.css.taskItemNode_action);this.processNode=new Element("div",{styles:this.css.taskItemFlowNode}).inject(this.explorer.app.content);MWF.require("MWF.xDesktop.Dialog",function(){var e=540;var t=260;var i=this.explorer.app.content.getSize();var s=i.x/2-e/2;var o=i.y/2-t/2;if(s+parseFloat(e)>i.x){s=s-parseFloat(e)}if(s<0)s=0;if(o+parseFloat(t)>i.y){o=o-parseFloat(t)}if(o<0)o=0;var n=new MWF.xDesktop.Dialog({title:"",style:"application",top:o,left:s-20,fromTop:o,fromLeft:s-20,width:e,height:t,content:this.processNode,container:this.explorer.app.content,onPostShow:function(){var e=this;MWF.xDesktop.requireApp("process.Work","Processor",function(){new MWF.xApplication.process.Work.Processor(this.processNode,this.data,{style:"task",onCancel:function(){n.close();e.node.setStyles(e.css.taskItemNode);delete this},onSubmit:function(t,i){e.submitTask(t,i,this,n);delete this}})}.bind(this))}.bind(this)});n.show()}.bind(this))},submitTask:function(e,t,i,s){var o={routeName:e,opinion:t};this.explorer.actions.flowTask(this.data.id,o,function(){i.destroy();s.close();this.work.childNode.destroy();this.work.childNode=null;this.work.reload(function(){this.work.loadChild()}.bind(this))}.bind(this))},remove:function(e){var t=this.explorer.app.lp;var i=t.deleteTask.replace(/{people}/g,this.data.person);var s=this;this.node.setStyles(this.css.taskItemNode_remove);this.explorer.app.confirm("warn",e,t.deleteTaskTitle,i,350,120,function(){this.close();s.work.removeTask(s)},function(){s.node.setStyles(s.css.taskItemNode);this.close()})},destroy:function(){this.node.destroy()}});MWF.xApplication.process.Application.WorkExplorer.Done=new Class({Extends:MWF.xApplication.process.Application.WorkExplorer.Task,setActions:function(){if(this.data.control.allowDelete){this.deleteNode=new Element("div",{styles:this.css.taskActionDeleteNode,title:this.explorer.app.lp.delete}).inject(this.actionAreaNode)}},setEvents:function(){if(this.deleteNode){this.deleteNode.addEvents({mouseover:function(){this.deleteNode.setStyles(this.css.taskActionDeleteNode_over)}.bind(this),mouseout:function(){this.deleteNode.setStyles(this.css.taskActionDeleteNode)}.bind(this),mousedown:function(){this.deleteNode.setStyles(this.css.taskActionDeleteNode_down)}.bind(this),mouseup:function(){this.deleteNode.setStyles(this.css.taskActionDeleteNode_over)}.bind(this),click:function(e){this.remove(e)}.bind(this)})}},remove:function(e){var t=this.explorer.app.lp;var i=t.deleteDone.replace(/{people}/g,this.data.person);var s=this;this.node.setStyles(this.css.taskItemNode_remove);this.explorer.app.confirm("warn",e,t.deleteDoneTitle,i,350,120,function(){this.close();s.work.removeDone(s)},function(){s.node.setStyles(s.css.taskItemNode);this.close()})}});MWF.xApplication.process.Application.WorkExplorer.Read=new Class({Extends:MWF.xApplication.process.Application.WorkExplorer.Task,setActions:function(){if(this.data.control.allowReadReset){this.resetNode=new Element("div",{styles:this.css.taskActionResetNode,title:this.explorer.app.lp.reset}).inject(this.actionAreaNode)}if(this.data.control.allowRead){this.flagNode=new Element("div",{styles:this.css.readActionFlagNode,title:this.explorer.app.lp.flag}).inject(this.actionAreaNode)}if(this.data.control.allowDelete){this.deleteNode=new Element("div",{styles:this.css.taskActionDeleteNode,title:this.explorer.app.lp.delete}).inject(this.actionAreaNode)}},setEvents:function(){if(this.resetNode){this.resetNode.addEvents({mouseover:function(){this.resetNode.setStyles(this.css.taskActionResetNode_over)}.bind(this),mouseout:function(){this.resetNode.setStyles(this.css.taskActionResetNode)}.bind(this),mousedown:function(){this.resetNode.setStyles(this.css.taskActionResetNode_down)}.bind(this),mouseup:function(){this.resetNode.setStyles(this.css.taskActionResetNode_over)}.bind(this),click:function(){this.reset()}.bind(this)})}if(this.flagNode){this.flagNode.addEvents({mouseover:function(){this.flagNode.setStyles(this.css.readActionFlagNode_over)}.bind(this),mouseout:function(){this.flagNode.setStyles(this.css.readActionFlagNode)}.bind(this),mousedown:function(){this.flagNode.setStyles(this.css.readActionFlagNode_down)}.bind(this),mouseup:function(){this.flagNode.setStyles(this.css.readActionFlagNode_over)}.bind(this),click:function(){this.flagRead()}.bind(this)})}if(this.deleteNode){this.deleteNode.addEvents({mouseover:function(){this.deleteNode.setStyles(this.css.taskActionDeleteNode_over)}.bind(this),mouseout:function(){this.deleteNode.setStyles(this.css.taskActionDeleteNode)}.bind(this),mousedown:function(){this.deleteNode.setStyles(this.css.taskActionDeleteNode_down)}.bind(this),mouseup:function(){this.deleteNode.setStyles(this.css.taskActionDeleteNode_over)}.bind(this),click:function(e){this.remove(e)}.bind(this)})}},reset:function(){this.node.setStyles(this.css.taskItemNode_action);var e={type:"identity",title:this.explorer.app.lp.reset,onComplete:function(e){if(e.length){this.resetPeople(e)}else{this.node.setStyles(this.css.taskItemNode)}}.bind(this),onCancel:function(){this.node.setStyles(this.css.taskItemNode)}.bind(this)};var t=new MWF.O2Selector(this.explorer.app.content,e)},resetPeople:function(e){var t=[];e.each(function(e){t.push(e.data.distinguishedName)});var i={routeName:this.explorer.app.lp.resetTo,opinion:this.explorer.app.lp.resetTo+": "+t.join(", "),identityList:t};this.explorer.actions.resetRead(this.data.id,i,function(){this.work.childNode.destroy();this.work.childNode=null;this.work.loadChild()}.bind(this))},remove:function(e){var t=this.explorer.app.lp;var i=t.deleteRead.replace(/{people}/g,this.data.person);var s=this;this.node.setStyles(this.css.taskItemNode_remove);this.explorer.app.confirm("warn",e,t.deleteReadTitle,i,350,120,function(){this.close();s.work.removeRead(s)},function(){s.node.setStyles(s.css.taskItemNode);this.close()})},flagRead:function(){var t=this.explorer.app.lp;var i=t.flagRead.replace(/{people}/g,this.data.person);var s=this;this.node.setStyles(this.css.taskItemNode_action);this.explorer.app.confirm("warn",e,t.flagReadTitle,i,350,120,function(){this.close();s.doFlagRead()},function(){s.node.setStyles(s.css.taskItemNode);this.close()})},doFlagRead:function(){this.explorer.actions.flagRead(this.data.id,{},function(){this.work.childNode.destroy();this.work.childNode=null;this.work.loadChild()}.bind(this))}});MWF.xApplication.process.Application.WorkExplorer.Readed=new Class({Extends:MWF.xApplication.process.Application.WorkExplorer.Done,remove:function(e){var t=this.explorer.app.lp;var i=t.deleteReaded.replace(/{people}/g,this.data.person);var s=this;this.node.setStyles(this.css.taskItemNode_remove);this.explorer.app.confirm("warn",e,t.deleteReadedTitle,i,350,120,function(){this.close();s.work.removeReaded(s)},function(){s.node.setStyles(s.css.taskItemNode);this.close()})}});