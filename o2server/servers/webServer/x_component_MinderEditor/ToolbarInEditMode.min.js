MWF.xApplication.MinderEditor.TopToolbar=new Class({Extends:MWF.widget.Common,initialize:function(t,e){this.editor=t;this.minder=t.minder;this.container=e;this.commands=this.editor.commands;this.path="/x_component_MinderEditor/$ToolbarInEditMode/";this.cssPath=this.path+this.editor.options.style+"/css.wcss";this._loadCss()},getHtml:function(){var e;var t=this.editor.options.tools;if(t&&t.top){e=t.top}else{e=["menu","|","save","|","undoredo","|","append","|","arrange","|","edit_remove","|","hyperLink","image","priority","progress","|","style","help"]}var i=this.editor.options.disableTools||[];i.each(function(t){e.erase(t)});var s="";var o="toolItem";e.each(function(t){switch(t){case"|":s+="<div styles='"+"separator"+"'></div>";break;case"menu":s+="<div item='menu' itemevent='click' styles='"+o+"'></div>";break;case"save":s+="<div item='save' styles='"+o+"'></div>";break;case"undoredo":s+="<div styles='"+"toolItemGroup"+"' style='width:70px;'>"+"   <div item='undo' styles='"+"toolItem_horizontal_top"+"'></div>"+"   <div item='redo' styles='"+"toolItem_horizontal_bottom"+"'></div>"+"</div>";break;case"append":s+="<div styles='"+"toolItemGroup"+"' style='width:250px;'>"+"   <div item='appendChild' styles='"+"toolItem_horizontal_top"+"'></div>"+"   <div item='appendParent' styles='"+"toolItem_horizontal_top"+"'></div>"+"   <div item='appendSibling' styles='"+"toolItem_horizontal_bottom"+"'></div>"+"</div>";break;case"arrange":s+="<div styles='"+"toolItemGroup"+"' style='width:70px;'>"+"   <div item='arrangeUp' styles='"+"toolItem_horizontal_top"+"'></div>"+"   <div item='arrangeDown' styles='"+"toolItem_horizontal_bottom"+"'></div>"+"</div>";break;case"edit_remove":s+="<div styles='"+"toolItemGroup"+"' style='width:70px;'>"+"   <div item='edit' styles='"+"toolItem_horizontal_top"+"'></div>"+"   <div item='remove' styles='"+"toolItem_horizontal_bottom"+"'></div>"+"</div>";break;case"hyperLink":s+="<div item='hyperLink' styles='"+o+"'></div>";break;case"image":s+="<div item='image' styles='"+o+"'></div>";break;case"priority":s+="<div item='priority' styles='"+o+"'></div>";break;case"progress":s+="<div item='progress' styles='"+o+"'></div>";break;case"style":s+="<div styles='"+"toolItemGroup"+"' style='width:170px;'>"+"   <div item='clearstyle' styles='"+o+"'></div>"+"   <div item='copystyle' styles='"+"toolItem_horizontal_top"+"'></div>"+"   <div item='pastestyle' styles='"+"toolItem_horizontal_bottom"+"'></div>"+"</div>";break;case"help":s+="<div item='help' styles='toolItem_help'></div>";break}});return s},load:function(){var t=this.getHtml();this.container.set("html",t);this.container.getElements("[styles]").each(function(t){if(!t.get("item")){t.setStyles(this.css[t.get("styles")])}}.bind(this));this.commands.addContainer("toptoolbar",this.container,this.css)},getCommandNode:function(t){return this.commands.getItemNode(t,"toptoolbar")}});MWF.xApplication.MinderEditor.RightToolbar=new Class({Extends:MWF.widget.Common,initialize:function(t,e){this.editor=t;this.minder=t.minder;this.container=e;this.commands=this.editor.commands;this.path="/x_component_MinderEditor/$ToolbarInEditMode/";this.cssPath=this.path+this.editor.options.style+"/css.wcss";this._loadCss()},getItems:function(){var e;var t=this.editor.options.tools;if(t&&t.right){e=t.right}else{e=["font","resource","note"]}var i=this.editor.options.disableTools||[];i.each(function(t){e.erase(t)});return e},load:function(){this.styleActive=true;this.resourceActive=false;this.noteActive=false;if(this.editor.status){this.styleActive=this.editor.status.styleActive;this.resourceActive=this.editor.status.resourceActive;this.noteActive=this.editor.status.noteActive}this.styleLoaded=this.styleActive;this.resourceLoaded=this.resourceActive;this.noteLoaded=this.noteActive;var t=this.getItems();var e="  lazyLoading='"+(this.styleActive?"false":"true")+"'";var i="";if(t.contains("font")){i+="<div styles='"+(this.styleActive?"rightToolbarItem_style_active":"rightToolbarItem_style")+"' title='文本样式' action='switchStyle'></div>"+"<div styles='tooltipNode' id='styleTooltip' style='display:"+(this.styleActive?"":"none")+";'>"+"   <div styles='closeNode' action='closeStyle'></div>"+"   <div style='width: 100%; height: 100%;'>"+"       <div item='fontsize' styles='fontToolbarItemSelector'"+e+"></div>"+"       <div item='bold' styles='fontToolbarItem'"+e+"></div>"+"       <div item='italic' styles='fontToolbarItem'"+e+"></div>"+"       <div item='forecolor' styles='fontToolbarItem'"+e+"></div>"+"       <div item='background' styles='fontToolbarItem'"+e+"></div>"+"       <div item='fontfamily' styles='fontToolbarItemSelector'"+e+"></div>"+"   </div>"+"</div>"}if(t.contains("resource")){i+="<div styles='"+(this.resourceActive?"rightToolbarItem_resource_active":"rightToolbarItem_resource")+"' title='标签' action='switchResource'></div>"+"<div styles='tooltipNode_resource' id='resourceTooltip' style='display:"+(this.resourceActive?"":"none")+";'>"+"   <div styles='closeNode' action='closeResource'></div>"+"   <div item='resource' styles='resourceToolbarItem' lazyLoading='"+(this.resourceActive?"false":"true")+"'></div>"+"</div>"}if(t.contains("note")){i+="<div styles='"+(this.noteActive?"rightToolbarItem_note_active":"rightToolbarItem_note")+"' title='备注' action='switchNote'></div>"+"<div styles='tooltipNode_note' id='noteTooltip' style='display:"+(this.noteActive?"":"none")+";'>"+"   <div styles='closeNode' action='closeNote'></div>"+"   <div item='note' styles='noteToolbarItem' lazyLoading='"+(this.noteActive?"false":"true")+"'></div>"+"</div>"}this.container.set("html",i);this.container.getElements("[styles]").each(function(t){if(!t.get("item")){t.setStyles(this.css[t.get("styles")])}}.bind(this));this.container.getElements("[action]").each(function(t){var e=t.get("action");t.addEvents({click:function(t){this[e](t.target)}.bind(this)})}.bind(this));this.styleTooltip=this.container.getElement("#styleTooltip");this.resourceTooltip=this.container.getElement("#resourceTooltip");this.noteTooltip=this.container.getElement("#noteTooltip");this.setTooltipsSize();this.commands.addContainer("righttoolbar",this.container,this.css)},closeStyle:function(t){this.switchStyle(this.container.getElement("[action='switchStyle']"),false)},switchStyle:function(t,e){if(typeOf(e)=="boolean")this.styleActive=!e;var i=this.styleTooltip;if(i){if(!this.styleActive){i.setStyle("display","");t.setStyles(this.css.rightToolbarItem_style_active);if(!this.styleLoaded){this.commands.loadItemsByNameList(["fontsize","bold","italic","forecolor","background","fontfamily"],"righttoolbar");this.styleLoaded=true}}else{i.setStyle("display","none");t.setStyles(this.css.rightToolbarItem_style)}this.styleActive=!this.styleActive}this.setTooltipsSize()},closeResource:function(t){this.switchResource(this.container.getElement("[action='switchResource']"),false)},switchResource:function(t,e){if(typeOf(e)=="boolean")this.resourceActive=!e;var i=this.resourceTooltip;if(i){if(!this.resourceActive){i.setStyle("display","");t.setStyles(this.css.rightToolbarItem_resource_active);if(!this.resourceLoaded){this.commands.loadItemByName("resource","righttoolbar");this.resourceLoaded=true}}else{i.setStyle("display","none");t.setStyles(this.css.rightToolbarItem_resource)}this.resourceActive=!this.resourceActive}this.setTooltipsSize()},closeNote:function(t){this.switchNote(this.container.getElement("[action='switchNote']"),false)},switchNote:function(t,e){if(typeOf(e)=="boolean")this.noteActive=!e;var i=this.noteTooltip;if(i){if(!this.noteActive){i.setStyle("display","");t.setStyles(this.css.rightToolbarItem_note_active);if(!this.noteLoaded){this.commands.loadItemByName("note","righttoolbar");this.noteLoaded=true}}else{i.setStyle("display","none");t.setStyles(this.css.rightToolbarItem_note)}this.noteActive=!this.noteActive}this.setTooltipsSize()},setTooltipsSize:function(){var t={bottom:0,y:0};var e=this.editor.Content_Offset_Top+5;var i=this.editor.content.getSize().y-e;var s=this.styleActive?this.styleTooltip.getCoordinates():t;if(this.resourceActive){var o=s.height?s.height+10:0;this.resourceTooltip.setStyle("top",o)}var l=this.resourceActive?this.resourceTooltip.getCoordinates():t;if(this.noteActive){var o=s.height?s.height+10:0;o+=l.height?l.height+10:0;var r=i-o-10;this.noteTooltip.setStyles({top:o,height:Math.min(r,500)})}if(this.commands)this.commands.setSizes()}});