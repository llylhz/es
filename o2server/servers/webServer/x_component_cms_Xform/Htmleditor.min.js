MWF.xDesktop.requireApp("process.Xform","Htmleditor",null,false);MWF.xApplication.cms.Xform.Htmleditor=MWF.CMSHtmleditor=new Class({Extends:MWF.APPHtmleditor,_loadUserInterface:function(){this.node.empty();if(this.readonly){this.node.set("html",this._getBusinessData());this.node.setStyles({"-webkit-user-select":"text","-moz-user-select":"text"});if(layout.mobile){this.node.getElements("img").each(function(t){t.setStyles({height:"auto","max-width":"100%"})}.bind(this))}}else{var i=Object.clone(this.json.editorProperties);if(this.json.config){if(this.json.config.code){var t=MWF.CMSMacro.exec(this.json.config.code,this);Object.each(t,function(t,e){i[e]=t})}}this.loadCkeditor(i)}},loadCkeditor:function(s){_self=this;COMMON.AjaxModule.loadDom("ckeditor",function(){CKEDITOR.disableAutoInline=true;var t=new Element("div").inject(this.node);var e=this._getBusinessData();if(e){t.set("html",e)}else if(this.json.templateCode){t.set("html",this.json.templateCode)}var i=this.node.getSize().y;var o=s||{};if(this.form.json.mode=="Mobile"){if(!o.toolbar&&!o.toolbarGroups){o.toolbar=[{name:"paragraph",items:["Bold","Italic","-","TextColor","BGColor","JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock","-","Undo","Redo"]},{name:"basicstyles",items:["Styles","FontSize"]}]}}o.localImageMaxWidth=800;o.reference=this.form.businessData.document.id;o.referenceType="cmsDocument";this.editor=CKEDITOR.replace(t,o);this._loadEvents();this.editor.on("change",function(){this._setBusinessData(this.getData())}.bind(this))}.bind(this))},getText:function(){return this.editor.document.getBody().getText()},getImages:function(){var t=[];var e=this.editor.document.find("img");if(e){for(var i=0;i<e.$.length;i++){t.push(e.getItem(i).$)}}return t},getImageIds:function(){var t=[];var e=this.getImages();for(var i=0;i<e.length;i++){var o=e[i];if(o.getAttribute("data-id")){t.push(o.getAttribute("data-id"))}}return t},_loadStyles:function(){if(this.json.styles)this.node.setStyles(this.json.styles);this.node.setStyle("overflow","hidden")},validationConfigItem:function(t,e){var i=e.status=="all"?true:t=="publish";if(i){var o=this.getData();var s=e.valueType=="value"?o:o.length;switch(e.operateor){case"isnull":if(!s){this.notValidationMode(e.prompt);return false}break;case"notnull":if(s){this.notValidationMode(e.prompt);return false}break;case"gt":if(s>e.value){this.notValidationMode(e.prompt);return false}break;case"lt":if(s<e.value){this.notValidationMode(e.prompt);return false}break;case"equal":if(s==e.value){this.notValidationMode(e.prompt);return false}break;case"neq":if(s!=e.value){this.notValidationMode(e.prompt);return false}break;case"contain":if(s.indexOf(e.value)!=-1){this.notValidationMode(e.prompt);return false}break;case"notcontain":if(s.indexOf(e.value)==-1){this.notValidationMode(e.prompt);return false}break}}return true}});