MWF.xApplication.HotArticle=MWF.xApplication.HotArticle||{};MWF.require("MWF.widget.O2Identity",null,false);MWF.xDesktop.requireApp("Template","Explorer",null,false);MWF.xApplication.HotArticle.options={multitask:false,executable:true};MWF.xApplication.HotArticle.Main=new Class({Extends:MWF.xApplication.Common.Main,Implements:[Options,Events],options:{style:"default",name:"HotArticle",icon:"icon.png",width:"1220",height:"700",isResize:true,isMax:true,title:MWF.xApplication.HotArticle.LP.title},onQueryLoad:function(){this.lp=MWF.xApplication.HotArticle.LP},loadApplication:function(t){this.userName=layout.desktop.session.user.distinguishedName;this.restActions=MWF.Actions.get("x_hotpic_assemble_control");this.path="/x_component_HotArticle/$Main/"+this.options.style+"/";this.createNode();this.loadApplicationContent()},loadController:function(t){if(t)t()},reload:function(){this.clearContent();if(this.explorer){this.openSetting(this.explorer.currentNaviItem.retrieve("index"))}else{this.loadApplicationLayout()}},isAdmin:function(){return this.access.isAdmin()},createNode:function(){this.content.setStyle("overflow","hidden");this.node=new Element("div",{styles:this.css.node}).inject(this.content)},loadApplicationContent:function(){this.loadController(function(){this.loadApplicationLayout()}.bind(this))},loadApplicationLayout:function(){this.contentContainerNode=new Element("div.contentContainerNode",{styles:this.css.contentContainerNode}).inject(this.node);this.createTopNode();this.createContainerNode()},createTopNode:function(){this.topContainerNode=new Element("div.topContainerNode",{styles:this.css.topContainerNode}).inject(this.contentContainerNode);this.topNode=new Element("div.topNode",{styles:this.css.topNode}).inject(this.topContainerNode);this.topIconNode=new Element("div",{styles:this.css.topIconNode}).inject(this.topNode);this.topTextNode=new Element("div",{styles:this.css.topTextNode,text:this.options.title}).inject(this.topNode);this.topContentNode=new Element("div",{styles:this.css.topContentNode}).inject(this.topNode)},createContainerNode:function(){this.createContent()},createContent:function(){this.middleNode=new Element("div.middleNode",{styles:this.css.middleNode}).inject(this.contentContainerNode);this.contentNode=new Element("div.contentNode",{styles:this.css.contentNode}).inject(this.middleNode);this.createView();this.setContentSizeFun=this.setContentSize.bind(this);this.addEvent("resize",this.setContentSizeFun);this.setContentSize()},setContentSize:function(){var t=this.topNode?this.topNode.getSize():{x:0,y:0};var e=this.node.getSize();var i=this.viewContainerNode.getStyle("padding-top").toFloat();var o=this.viewContainerNode.getStyle("padding-bottom").toFloat();var n=e.y-t.y-i-o;this.viewContainerNode.setStyle("height",""+n+"px")},createView:function(){var t=this.viewContainerNode=new Element("div.viewContainerNode",{styles:this.css.viewContainerNode}).inject(this.contentNode);var e=new MWF.xApplication.HotArticle.Main.View(t,this,this,{templateUrl:this.path+"listItem.json",scrollEnable:true},{lp:this.lp});e.load()},clearContent:function(){if(this.explorer)this.explorer.destroy();this.explorer=null;if(this.setContentSizeFun)this.removeEvent("resize",this.setContentSizeFun);if(this.scrollBar&&this.scrollBar.scrollVAreaNode)this.scrollBar.scrollVAreaNode.destroy();if(this.scrollBar)delete this.scrollBar;if(this.contentContainerNode){this.contentContainerNode.destroy()}},openCategory:function(t){var e="HotArticleCategory"+t.id;if(this.desktop.apps[e]){this.desktop.apps[e].setCurrent()}else{this.desktop.openApplication(null,"HotArticleCategory",{categoryId:t.id,appId:e})}},recordStatus:function(){var t={};if(this.explorer){t={setting:true,index:this.explorer.currentNaviItem.retrieve("index")}}return t}});MWF.xApplication.HotArticle.Main.View=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexView,_createDocument:function(t,e){return new MWF.xApplication.HotArticle.Main.Document(this.viewNode,t,this.explorer,this,null,e)},_getCurrentPageData:function(e,t,i){if(!t)t=9;if(!i){if(this.pageNum){i=this.pageNum=this.pageNum+1}else{i=this.pageNum=1}}else{this.pageNum=i}this.getPictureUrlHost();var o=this.filterData||{};this.actions.listHotPicFilterPage(i,t,o,function(t){if(!t.data)t.data=[];if(!t.count)t.count=0;if(e)e(t)}.bind(this))},_removeDocument:function(t,e){this.actions.removeHotPic(t.id,function(t){this.pageNum=0;this.reload();this.app.notice(this.app.lp.deleteDocumentOK,"success")}.bind(this))},_create:function(){},_openDocument:function(t){},_queryCreateViewNode:function(){},_postCreateViewNode:function(t){},_queryCreateViewHead:function(){},_postCreateViewHead:function(t){},getPictureUrlHost:function(){var t=layout.desktop.serviceAddressList["x_hotpic_assemble_control"];this.pictureUrlHost="http://"+t.host+(t.port!=80?":"+t.port+"/":"/")}});MWF.xApplication.HotArticle.Main.Document=new Class({Extends:MWF.xApplication.Template.Explorer.ComplexDocument,mouseoverDocument:function(t,e){var i=t.getElements("[styles='removeNode']")[0];if(i)i.setStyle("opacity",1)},mouseoutDocument:function(t,e){var i=t.getElements("[styles='removeNode']")[0];if(i)i.setStyle("opacity",0)},_queryCreateDocumentNode:function(t){},_postCreateDocumentNode:function(t,e){},getRemovePermission:function(t){if(this.app.userName==t.creator){return true}if(MWF.AC.isHotPictureManager()){return true}return false},open:function(){var t=this.data;if(t.application=="BBS"){var e="ForumDocument"+t.infoId;if(this.app.desktop.apps[e]){this.app.desktop.apps[e].setCurrent()}else{this.app.desktop.openApplication(null,"ForumDocument",{id:t.infoId,appId:e,isEdited:false,isNew:false})}}else{var e="cms.Document"+t.infoId;if(this.app.desktop.apps[e]){this.app.desktop.apps[e].setCurrent()}else{this.app.desktop.openApplication(null,"cms.Document",{documentId:t.infoId,appId:e,readonly:true})}}}});var getDateDiff=function(t){if(!t)return"";var e=Date.parse(t.replace(/-/gi,"/"));var i=1e3*60;var o=i*60;var n=o*24;var s=n*15;var r=n*30;var a=r*12;var l=(new Date).getTime();var c=l-e;if(c<0){}var p=(new Date).decrement("day",1);var d=(new Date).decrement("day",2);var u=c/a;var h=c/r;var f=c/(7*n);var m=c/n;var v=c/o;var N=c/i;if(p.getFullYear()==e.getFullYear()&&p.getMonth()==e.getMonth()&&p.getDate()==e.getDate()){result="昨天 "+e.getHours()+":"+e.getMinutes()}else if(d.getFullYear()==e.getFullYear()&&d.getMonth()==e.getMonth()&&d.getDate()==e.getDate()){result="前天 "+e.getHours()+":"+e.getMinutes()}else if(u>1){result=e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()}else if(h>=1){result=e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()}else if(f>=1){result=parseInt(f)+"周前"}else if(m>=1){result=parseInt(m)+"天前"}else if(v>=1){result=parseInt(v)+"小时前"}else if(N>=1){result=parseInt(N)+"分钟前"}else result="刚刚发表";return result};